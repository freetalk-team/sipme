/*! For license information please see app.min.js.LICENSE.txt */
import*as __WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_app_js_97f2d8e8__ from"https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";import*as __WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_auth_js_2c88a4ff__ from"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";import*as __WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_database_js_4fdd5b49__ from"https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";import*as __WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_storage_js_e5eea211__ from"https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";import*as __WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_messaging_js_6c0776cf__ from"https://www.gstatic.com/firebasejs/10.7.0/firebase-messaging.js";var __webpack_modules__={867:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>GameMixin});const kStat={win:0,loss:0,score:{win:0,loss:0},total:{win:0,loss:0}},kGameStateDS="games",GameMixin={initGame(){this.game={states:new Map,games:new Map,async params(e){let t=this.games.get(e);return t||(t=await Game.load(e),this.games.set(e,t)),t.params},async load(e,t,i){return e?(e="string"==typeof e?e:e.id,this.current=await this.loadState(e,t,i),this.current):await app.dsFilter(kGameStateDS,e=>!!e.state&&!e.own).ls()},async loadState(e,t,i){let a,s=e;t?a=e+"@"+t:(a=e,[s,t]=e.split("@"));let r,n,o,l=!1,c=this.states.get(a);if(c?i&&(c.state=c.game.init(i),l=i):((r=this.games.get(t))||(r=await Game.load(t),this.games.set(t,r)),[n,o,l]=await loadGameState(a,r,i),c={game:r,state:n,stat:o},this.states.set(a,c)),!c.state){if(!i)throw console.error("GAME failed to execute move"),new Error("GAME non-existing state without 'params'");c.state={}}return r=c.game,n=c.state,o=c.stat,{uid:s,state:n,id:a,type:t,stat:o,game:r,invite:l}},async reload(e){e=this.states.get(e);e&&e.game.reset(e.state,!0)},async onmove(e,t){var i=t.id,a=t["params"],s="string"==typeof e?e:e.id,{id:r,game:n,state:o,stat:l}=await this.loadState(s,i,a),[c,d]=(t.last,n.onmove(o,t.last));if(t.last)return a={own:!(t={own:!1,params:a,stat:kStat,user:s,type:i}),state:o},updateStat(l,c,d)&&(a.stat=l,a.own=!1,c)&&(a.state=void 0,a.last=void 0,a.ts=Date.seconds()),await app.ds("games").update(r,a,t),[{id:r,user:e,type:i,own:!1,stat:l,state:o,game:n},c]},async send(e,t,i){var{id:a,state:s,uid:r,type:n,stat:o,invite:l}=this.current,c={id:a,stat:kStat,user:r,type:n},s={last:e,state:s,own:!0};updateStat(o,t,i)&&(s.stat=o,t)&&(s.state=void 0,s.own=void 0,s.last=void 0,s.ts=Date.seconds());await app.ds(kGameStateDS).update(a,s,c);s={_type:"game",id:n,last:e},l&&(delete this.current.invite,s.params=l),await app.sendMessage(r,s),c=await app.loadContact(r),e={id:a,user:c,type:n,score:i,stat:o,own:!0,ts:Date.seconds()};app.emit(t?"gameover":"gamemove",e)},async resign(e,t){var{id:e,uid:t,type:i,stat:a}=await this.loadState(e,t);this.states.delete(e),a.loss++,await app.ds(kGameStateDS).update(e,{state:null,stat:a},{user:t,type:i}),app.emit("gameover",{id:e,user:t,type:i,stat:a})}}},async handleGameMessage(e){try{var t=e.msg,[i,a,,]=await this.game.onmove(e.user,t);a?this.emit("gameover",i):this.emit("gamemove",i)}catch(e){console.error("Failed to handle game move",e)}}};function updateStat(t,i,a){if(a){let e;return e=a<0?(t.score.loss-=a,t.total.loss-=a,"loss"):(t.score.win+=a,t.total.win+=a,"win"),i&&(t.last={...t.score},t.score.win=0,t.score.loss=0,t[e]++),1}}async function loadGameState(e,t,i){var a=app.ds(kGameStateDS);return!i&&(a=await a.get(e))?[a.state,a.stat]:[t.init(i),kStat,i]}class Game{#params={};#ratio=1;#init=()=>({});#render=()=>{};#onclick=()=>{};#onmove=()=>{};#description=()=>"";get ratio(){return this.#ratio}get params(){return this.#params}constructor(code){const ratio=e=>"number"==typeof e?this.#ratio=e:isNaN(e)?1:parseFloat(e),option=(e,t)=>this.#params[e]=t,init=e=>this.#init=e,render=e=>this.#render=e,onclick=e=>this.#onclick=e,onmove=e=>this.#onmove=e,param=()=>{},short=e=>this.#description=e;eval(code)}init(e){return this.#init(e)}render(e,t){this.#render.bind(e)(t)}onclick(e,t,i){t.width=i.canvas.width,t.height=i.canvas.height;t=this.#onclick.bind(e)(t);return!!t&&(this.render(e,i),Array.isArray(t)&&app.game.send(...t),t.isover)}onmove(e,t){return this.#onmove.bind(e)(t)}static async load(e){e=await app.cache.load("game",e);return new Game(e)}}},278:()=>{function i(e){let t,i=!1;"object"==typeof e?(t=e.content,i=!0):t=e;let a,s,r,n=t;(a=t.match(/^(!\[[^\]]+\]\((.*)\))?[ \n]*(.*)/))&&(r=a[2],a=(n=a[3]).match(/^(#{1,6}[ ]+(.*))?[ \n]*(.*)/))&&(s=a[2],n=a[3]||s);var o=Object.deleteUndefined({title:s,thumb:r});return i&&Object.assign(e,o),o.content=n,o}Object.assign(window,{toMarkdown:function(a,e=a.type){if("string"==typeof a)return a.replace(/"(.*?)"/g,(e,t)=>`***${t}***`).replace(/\((.*?)\)/g,(e,t)=>`(*${t}*)`);switch(e){case"files":{var i=a;let e,t="### Files share\n\n|name|size||\n|:-----|:-:|:-:|";for(const n of i)e=n.link,t+=`
|${n.name}|${fileX.formatSize(n.size)}|[link](${e})|`;return t;return}case"task":{i=a;let e="### "+i.title||0;i.user&&(t=i.user,e+='\n<font size="2">*Author:* '+`**${t.name}**</font>`);{var t;i.ts&&(t=new Date(1e3*i.ts),e+=`
<font size="2">*Created: ${t.formatTimeDate()}*</font>`)}i.md&&(e+="\n\n"+i.md.replace(/^#{1,3}/gm,"####"));return e;return}case"article":{var s=a;let e="",t;s.channel&&(t="string"==typeof s.channel?s.channel:s.channel.id);s.thumb&&(e+=`![thumb alt <](${s.thumb})
`);e+="### "+s.title+"\n\n",s.logo||(r=new URL(s.link),s.logo=r.origin+"/favicon.ico");let i=s.date;{var r;i||(r=new Date(s.time||1e3*s.ts),i=r.formatTimeDate())}return e+=`![logo alt <](${s.logo}) <font size="3">[link](${s.link}) *${i}*</font>`;return}}return null},fromMarkdown:function(e,t){return"post"===t?i(e):{content:e}},getPostInfo:i})},831:()=>{function i(r,n={},o=!0){return new Promise((i,a)=>{const s=new XMLHttpRequest;s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){var e=s.status;if(0===e||200<=e&&e<400){var t=s.getResponseHeader("content-type");let e=s.responseText;o?/application\/json/.test(t)&&(e=JSON.parse(e)):(t=s.response,t=inflate(t,{to:"string"}),e=JSON.parse(t)),i(e)}else a(e)}},s.open("GET",r,!0),o||(s.responseType="arraybuffer");for(var[e,t]of Object.entries(n))s.setRequestHeader(e,t);s.send()})}function s(l,c={},d={}){return new Promise((i,a)=>{const s=new XMLHttpRequest;var e,t,r=c.constructor===Object;let n=c;s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){var t,e=s.status;if(0===e||200<=e&&e<400){let e;s.responseText&&(t=s.getResponseHeader("content-type"),e=/application\/json/.test(t)?JSON.parse(s.responseText):s.responseText),i(e)}else a(e)}},s.open("POST",l,!0);let o;r?(o="application/json",n=JSON.stringify(c)):c instanceof Blob?o="application/octet-stream":0 instanceof FormData,o&&s.setRequestHeader("content-type",o);for([e,t]of Object.entries(d))s.setRequestHeader(e,t);s.send(n)})}window.ajax={get:i,post:s,delete:function(r,n={}){return new Promise((t,i)=>{const a=new XMLHttpRequest;a.onreadystatechange=()=>{var e;a.readyState===XMLHttpRequest.DONE&&(0===(e=a.status)||200<=e&&e<400?t():i(e))},a.open("DELETE",r,!0);for(var[e,s]of Object.entries(n))a.setRequestHeader(e,s);a.send()})},fetch:async function(e,t){return"application/json"==(e=await fetch(e,t)).headers.get("content-type")?await e.json():e.text()},submit:function(e,t){var i,a,s=document.createElement("form");s.method="POST",s.action=e;for([i,a]of Object.entries(t)){var r=document.createElement("input");r.type="hidden",r.name=i,r.value=a,s.appendChild(r)}document.body.appendChild(s),s.submit(),document.body.removeChild(s)},token(a){return{get(e,t={}){return t.authorization="Bearer "+a,i(e,t)},post(e,t,i={}){return i.authorization="Bearer "+a,s(e,t,i)},async post2(e,t,i={}){return i.authorization="Bearer "+a,i["content-type"]="application/json",(await fetch(e,{method:"POST",headers:i,body:JSON.stringify(t),mode:"no-cors"})).json()},options(e,t={}){return t.authorization="Bearer "+a,t.Origin=window.location.origin,[r,n={}]=[e,t],new Promise((t,i)=>{const a=new XMLHttpRequest;a.onreadystatechange=()=>{var e;a.readyState===XMLHttpRequest.DONE&&(0===(e=a.status)||200<=e&&e<400?t():i(e))},a.open("OPTIONS",r,!0);for(var[e,s]of Object.entries(n))a.setRequestHeader(e,s);a.send()});var r,n}}}}},910:()=>{function s(e){e=atob(e);const i=new Uint8Array(e.length);return Array.prototype.forEach.call(e,(e,t)=>i[t]=e.charCodeAt(0)),i}window.aes={generateKey:function(e=256){return crypto.subtle.generateKey({name:"AES-CTR",length:e},!0,["encrypt","decrypt"])},importKey:function(e,t="jwt",i=!0){let a;switch(t){case"raw":a=s(e);break;case"jwt":a=JSON.parse(atob(e))}return crypto.subtle.importKey(t,a,{name:"AES-CTR"},i,["encrypt","decrypt"])},exportKey:async function(e){return e=await crypto.subtle.exportKey("jwk",e),btoa(JSON.stringify(e))},encrypt:async function(e,t,i){var a=new TextEncoder,i="string"==typeof i?s(i):i,a=a.encode(e),e=await crypto.subtle.encrypt({name:"aes-ctr",counter:i,length:64},t,a);return i=e,btoa(String.fromCharCode.apply(null,i instanceof Uint8Array?i:new Uint8Array(i)))},decrypt:async function(e,t,i){return e=s(e),i="string"==typeof i?s(i):i,i=await crypto.subtle.decrypt({name:"aes-ctr",counter:i,length:64},t,e),(new TextDecoder).decode(i)}}},788:()=>{(new Date).getTimezoneOffset();function t(e){return e instanceof Date?e:"string"==typeof e?new Date(e):new Date(1e3*e)}Date.prototype.toLocalDateString=function(t,i){if("bg"!==t)return this.toLocaleDateString(t+"-"+t.toUpperCase(),i);{let e="";var a;return i.weekday&&(t=["Неделя","Понеделник","Вторник","Сряда","Четвъртък","Петък","Събота"],a=this.getDay(),e=e+("short"==i.weekday?t[a].slice(3)+".":t[a])+" "),i.day&&(e=e+this.getDate().toString()+" "),i.month&&"numeric"!=i.month&&(t=["Януари","Февруари","Март","Април","Май","Юни","Юли","Август","Септември","Октомври","Ноември","Декември"][this.getMonth()],e=e+("short"==i.month&&4<t.length?t.slice(0,3)+".":t)+" "),e.trimEnd()}},Date.prototype.toLocalDateStringShort=function(e,t={weekday:"long",month:"short",day:"numeric"}){return this.toLocalDateString(e,t)},Date.prototype.seconds=function(){return Date.toSeconds(this.getTime())},Date.prototype.age=function(e=new Date){return e.getFullYear()-this.getFullYear()},Date.seconds=function(e=1){var t=(new Date).seconds();return Math.floor(t/e)*e},Date.toSeconds=function(e=new Date){return(e="string"==typeof e?new Date(e):e)instanceof Date&&(e=e.getTime()),Math.floor(e/1e3)},Date.fromSeconds=function(e){return new Date(1e3*e)},Date.daysToSeconds=function(e){return 24*e*60*60},Date.secondsToString=function(e){return new Date(1e3*e).toISOString()},Date.prototype.offsetFrom=function(e=Date.now(),t=""){e=Math.floor((e-this.getTime())/1e3);let i,a;return a=e<3600?0==(i=Math.floor((e+40)/60))?"now":i+" min":e<86400?(i=Math.floor(e/3600))+" h":e<604800?(i=Math.floor(e/86400))+" d":(t=null,this.toLocaleDateString("en-US",{month:"short",day:"numeric"})),t&&(a+=" "+t),a},Date.timeElapsed=function(e,t=Date.now()){return new Date(e).offsetFrom(t)},Date.timeElapsedLong=function(e,t=Date.now()){return new Date(e).offsetFrom(t,"ago")},Date.secondsElapsed=function(e=Date.seconds(),t=Date.now()){return Date.timeElapsed(1e3*e,t)},Date.prototype.formatTimeDate=function(){return`${("0"+this.getHours()).slice(-2)}:${("0"+this.getMinutes()).slice(-2)} ${this.toLocaleString("default",{month:"short"})} `+("0"+this.getDate()).slice(-2)},Date.formatTimeDate=function(e=Date.seconds()){return t(e).formatTimeDate()},Date.formatDate=function(e=Date.seconds()){return t(e).toDateString()},Date.formatDateShort=function(e=Date.seconds()){return t(e).toLocalDateStringShort("en")},Date.formatDateShorter=function(e=Date.seconds()){return t(e).toLocalDateStringShort("en",{month:"short",day:"numeric"})},Date.todayUTC=function(e=new Date){e=(e="number"==typeof e?new Date(1e3*e):e).setUTCHours(0,0,0,0);return Date.toSeconds(e)},Date.today=function(e=new Date){e=(e="number"==typeof e?new Date(1e3*e):e).setHours(0,0,0,0);return Date.toSeconds(e)},Date.dayStartSeconds=function(e=Date.seconds(),t=0){var i=60*(new Date).getTimezoneOffset();return 86400*Math.floor(e/86400)+86400*t+i},Date.tomorrowSeconds=function(){return Date.dayStartSeconds(Date.seconds(),1)},Date.days=function(e,t=Date.now()){return new Date(t+24*e*3600*1e3)}},976:()=>{function a(i,a,s={}){return new Promise((e,t)=>i.getDirectory(a,s,e,t))}function s(i){return new Promise((t,e)=>{i.createReader().readEntries(function(e){t(e)})})}function r(e,a){return new Promise((i,t)=>{e.getFile(a,{},function(e){e.file(function(e){var t=new FileReader;t.file=e,i(t)},t)},t)})}function n(a,s=0,r){return new Promise((t,e)=>{a.onloadend=function(e){t(this.result)},a.onerror=e;let i=a.file;r&&(i=i.slice(s,s+r)),a.readAsArrayBuffer(i)})}function o(i){return new Promise((e,t)=>i.remove(e,t))}window.fs={init:function(e=1073741824){return new Promise((t,i)=>{navigator.webkitPersistentStorage.requestQuota(e,e=>webkitRequestFileSystem(window.PERSISTENT,e,t,i))})},ls:s,directory:a,rmdir:async function(e,t){for(const i of await s(e=await a(e,t)))await o(i);return o(e)},save:async function(e,t){var i=await(await showSaveFilePicker()).createWritable(),e=await n(await r(e,t));await i.write(e),await i.close()},writer:function(i,a,s=!1){return new Promise((t,e)=>{i.getFile(a,{create:!0,exclusive:s},function(e){e.createWriter(function(e){t(e)})},e)})},write:function(i,a){return new Promise((e,t)=>{i.onwriteend=e,i.onerror=t;e=new Blob(Array.isArray(a)?a:[a]);i.write(e)})},truncate:function(i,a){return new Promise((e,t)=>{i.onwriteend=e,i.onerror=t,i.truncate(a)})},read:n,reader:r,readFile:async function(e,t){return n(await r(e,t))},getFile:function(e,a){return new Promise((t,i)=>{e.getFile(a,{},function(e){e.file(e=>t(e),i)},i)})},metadata:function(i){return new Promise((e,t)=>{i.getMetadata(e,t)})},dump:function(i){return new Promise((t,e)=>{i.createReader().readEntries(function(e){t(e.map(e=>e.name))})})}}},265:()=>{Object.assign(window,{AsyncFunction:Object.getPrototypeOf(async function(){}).constructor,GeneratorFunction:Object.getPrototypeOf(function*(){}).constructor,AsyncGeneratorFunction:Object.getPrototypeOf(async function*(){}).constructor})},537:()=>{Object.toArray=function(e,t=function(){}){var i=[];if(e)for(var[a,s]of Object.entries(e))s.id=s.id||a,t(s),i.push(s);return i},Object.fromArray=function(e){var t={};for(const i of e)t[i.id]=i;return t},Object.empty=function(e){return 0===Object.keys(e).length&&e.constructor===Object},Object.deleteUndefined=function(t){return Object.keys(t).forEach(e=>void 0===t[e]&&delete t[e]),t},Object.flipEntries=function(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[t,e]))},Object.hash=function(e){let t=4294967279;for(const i of Object.values(e))"object"==typeof i?t^=(Array.isArray(i)?Array:Object).hash(i):"string"==typeof i?t^=i.hashCode():"number"==typeof i?t^=i:"boolean"==typeof i&&(t^=i?1549556828:3318072773);return t>>>0},Object.normalize=function(e){for(var[t,i]of Object.entries(e))if("object"==typeof i)if(Array.isArray(i)){var a=i.filter(e=>!!e);for(const s of a)Object.normalize(s);e[t]=a}else 0<Object.keys(i).length?Object.normalize(i):delete e[i]},Object.merge=function(e,t="info"){var i=e=>{e[t]&&(Object.assign(e,e[t]),delete e[t])};if(Array.isArray(e))for(const a of e)i(a);else i(e);return e},Array.hash=function(e){let t=3326489;for(const i of e)"object"==typeof i?t^=(Array.isArray(i)?Array:Object).hash(i):"string"==typeof i?t^=i.hashCode():"number"==typeof i?t^=i:"boolean"==typeof i&&(t^=i?1549556828:3318072773);return t>>>0},Array.prototype.unique=function(){return this.filter((e,t,i)=>i.indexOf(e)===t)},Array.prototype.uniqueId=function(i="id"){return Array.from(new Set(this.map(e=>e[i]))).map(t=>this.find(e=>e[i]==t))},Array.prototype.rotate=function(e){return e%=this.length,this.slice(e,this.length).concat(this.slice(0,e))},Array.prototype.sum=function(){return this.reduce((e,t)=>e+t,0)},Array.prototype.avg=function(){return this.sum()/this.length},Array.prototype.avgi=function(){return Math.floor(this.avg())},Array.prototype.max=function(e=-2147483648){return this.reduce((e,t)=>t<e?e:t,e)},Array.prototype.min=function(e=4294967295){return this.reduce((e,t)=>e<t?e:t,e)},Array.prototype.sortTimestamp=function(){this.sort((e,t)=>t.ts-e.ts)}},345:()=>{String.prototype.hashCode=function(){for(var e=5381,t=this.length;t;)e=33*e^this.charCodeAt(--t);return e>>>0},String.prototype.hashCodeSigned=function(){return this.hashCode()>>0},String.prototype.hashHex=function(){return this.hashCode().toString(16)},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.splitByCapital=function(){return this.split(/(?=[A-Z])/).join(" ").replace(/(?<=\b[A-Z]) (?=[A-Z]\b)/g,"")},String.prototype.toHex=function(){let t="";for(let e=0;e<this.length;e++)t+=this.charCodeAt(e).toString(16);return t},String.prototype.toByteArray=function(){var t=[];for(let e=0;e<this.length;e+=1){var i=this.charCodeAt(e);if(i<128)t.push(i);else if(i<2048)t.push(192|i>>6,128|63&i);else if(i<55296||57344<=i)t.push(224|i>>12,128|i>>6&63,128|63&i);else{if(!((e+=1)<this.length))break;i=65536+(1023&i)<<10|1023&this.charCodeAt(e);t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)}}return t},String.prototype.eval=function(ctx,..._){const exp=this.valueOf();return function(..._){return eval(exp)}.call(ctx,..._)},String.prototype.evalx=function(a,...s){var e=this.replace(/len\((.*?)\)/,(e,t)=>{var i=t.match(/_([0-9])/);return i?(i=parseInt(i[1]),s[i]?s[i].length:0):t.eval(a,...s).length}).replace(/_([0-9])/g,(e,t)=>`_[${t}]`||"").eval(a,...s);return null!=e?e:""},String.prototype.evalCtx=function(e,t=!0){const i=e,a={};let s=this;var e=s.match(/^var\s+(.*?);(.*)$/),e=(e&&(e[1].split(",").map(e=>e.trim()).map(e=>e.split("=").map(e=>e.trim())).map(([e,t])=>a[e]=t.evalCtx(i)),s=e[2]),Object.keys(i).concat(Object.keys(a))),r=Object.values(i).concat(Object.values(a)),n=s.replace(/(\.?)(val|len|arr|sum|avgi?|max)\((.*?)\)/,(e,t,i,a)=>{if(t)return e;switch(i){case"len":return`(typeof ${a} == "undefined" ? 0 : (Array.isArray(${a}) ? ${a}.length : 0))`;case"arr":return`(typeof ${a} == "undefined" ? [] : (Array.isArray(${a}) ? ${a} : []))`;case"sum":case"avg":case"avgi":case"max":return`(typeof ${a} == "undefined" ? 0 : (Array.isArray(${a}) ? ${a}.${i}() : 0))`}return`(typeof ${a} == "undefined" ? null : ${a})`});return Function(...e,t?"return "+n:n)(...r)},String.prototype.replacex=function(i,...a){return this.replace(/\{\{(.+?)\}\}/g,(e,t)=>t.evalx(i,...a))},String.prototype.localeCompareNocase=function(e){return this.localeCompare(e,"en",{sensitivity:"base"})},String.prototype.startsWithNocase=function(e){return this.toLowerCase().startsWith(e.toLowerCase())},String.prototype.reverse=function(){let t="";for(let e=this.length-1;0<=e;e--)t+=this[e];return t},String.prototype.removeComments=function(e=0){return this.replace(/\/\*[\s\S]*?\*\/|(?<=[^:])\/\/.*|^\/\/.*/g,"").trim()},String.prototype.align=function(e,t=!0){e=e>=this.length?" ".repeat(e-this.length):"";return t?this.concat(e):e.concat(this)},String.prototype.display=function(){return this.replace(/[_-]+/g," ").splitByCapital().capitalizeFirstLetter()};const kExpressionPrefix="$>";String.ExpressionPrefix=kExpressionPrefix,String.prototype.isExpression=function(){return this.startsWith(kExpressionPrefix)},String.prototype.expressionValue=function(){return this.slice(kExpressionPrefix.length)},String.prototype.evalExpression=function(e){return this.expressionValue().trim().evalCtx(e)},String.prototype.makeExpression=function(){return kExpressionPrefix+this},String.prototype.matchIndex=function(){var[,e,,t]=this.match(/^([A-z]+)(\[(\d+)\])?$/);return[e,t?parseInt(t):void 0]},String.longestCommonPrefix=function(e){let t=e.reduce((e,t)=>t.length<e.length?t:e);for(var i of e)for(;i.slice(0,t.length)!=t;)t=t.slice(0,-1);return t},String.evalCtx=function(e){exp.join("\n").evalCtx(e.false)},String.prototype.isEmail=function(){return/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(this.toLowerCase())},String.prototype.getInitials=function(){var e=this.split(/[ _-]/);return 1<e.length?e[0][0]+e[1][0]:this[0]+this[1]},String.isString=function(e){return"string"==typeof e},String.prototype.splitLast=function(e){let t=this.valueOf(),i;var a=this.lastIndexOf(e);return-1!=a&&(t=this.slice(0,a),i=this.slice(a+e.length)),[t,i]},String.sort=function(e,t){return e<t?-1:t<e?1:0}},830:()=>{const e=(e,t)=>{var i=t[0]-e[0],t=t[1]-e[1];return{length:Math.sqrt(Math.pow(i,2)+Math.pow(t,2)),angle:Math.atan2(t,i)}};var s,r,n;s=e,r=.2;n=(e,t,i,a)=>{t=s(t||e,i||e),i=t.angle+(a?Math.PI:0),a=t.length*r;return[e[0]+Math.cos(i)*a,e[1]+Math.sin(i)*a]};const y=(e,t,i)=>{var[a,s]=n(i[t-1],i[t-2],e),[i,t]=n(e,i[t-1],i[t+1],!0);return`C ${a},${s} ${i},${t} ${e[0]},`+e[1]};const b={width:400,marginX:10,marginY:15,maxLinesY:10};window.chart={create(u,e,t,i={...b}){i.height||(i.height=3*i.width/4);var{width:i,height:a,marginX:s,marginY:r}=i;const p=i-2*s-16,m=a-2*r-22,n=s+16,o=r;let g,f;var s=e.map(e=>e.min()),r=e.map(e=>e.max()),l=(g=s.min(),(f=r.max())-g),c=[1,2,5,10,25,50,100,200,500,1e3];let d=0;for(;10*c[d]<l;++d);10<l/c[d]&&d++;var h=c[d],s=(d,f+=h-f%h,g-=g%h,function(i,a,e,s,r,n){var o=n/(e=e-a),l=Math.ceil(e/s)+1,c=[],e=i.length,d=Math.floor(r/e);for(let e=0,t=0;t<i.length;++t,e+=d)c.push({x1:e,x2:e,y1:0,y2:n});for(let e=a,t=0;t<l;e+=s,++t){var h=n-t*s*o;c.push({x1:0,x2:r,y1:h,y2:h})}return c}(u,g,f,h,p,m)),r=(s.map(e=>(e.x1+=n,e.x2+=n,e.y1+=o,e.y2+=o)),e.map(e=>{var i,a=u,s=e,r=g,e=f,t=p,n=m,o=a.length,l=Math.floor(t/o),c=n,d=n/(e-r),h=[];for(let e=0,t=0;t<a.length;++t,e+=l)i=c-(s[t]-r)*d,h.push([e,i]);return h})),v=(r.map(e=>e.map(e=>(e[0]+=n,e[1]+=o))),r.map(e=>{return e.path=(e=e,s=y,e.reduce((e,t,i,a)=>0===i?`M ${t[0]},`+t[1]:e+" "+s(t,i,a),""));var s}),[]);for(let e=g;e<=f;e+=h)v.push(e);var w=m/(v.length-1),i={width:i,height:a,labels:u,series:e,grid:s,points:r,values:v,labelX:{start:n,step:p/u.length,Y:a-22},labelY:{start:a-22-o,step:-w,X:-16}};return dom.renderTemplate(t,i)},render(e,t,i){var a=(new Date).getDay(),a=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].rotate(a);return this.create(a,t,"weekly-chart").innerHTML}}},489:()=>{function t(e){return!!e.match(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/)}function i(e){return!!e.match(/(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/)}function a(e){return t(e)||i(e)}window.validate={host:function(e){return!!e.match(/^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})+$/)||a(e)},domain:function(e){return/^((?:(?:(?:\w[\.\-\+]?)*)\w)+)((?:(?:(?:\w[\.\-\+]?){0,62})\w)+)\.(\w{2,6})$/.test(e)},ipv4:t,ipv6:i,ip:a,url:function(e){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)},email:function(e){return/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(e.toLowerCase())},tags:function(e){return/^[a-z]{3,}( [a-z]{3,}){0,4}$/.test(e)},slug:function(e){return/^[a-z][0-9a-z]{3,11}$/.test(e)}}},753:()=>{CodeMirror.commands.tabAndIndentMarkdownList=function(e){var t=e.listSelections()[0].head;!1!==e.getStateAfter(t.line).list?e.execCommand("indentMore"):e.options.indentWithTabs?e.execCommand("insertTab"):(t=Array(e.options.tabSize+1).join(" "),e.replaceSelection(t))},CodeMirror.commands.shiftTabAndUnindentMarkdownList=function(e){var t=e.listSelections()[0].head;!1!==e.getStateAfter(t.line).list?e.execCommand("indentLess"):e.options.indentWithTabs?e.execCommand("insertTab"):(t=Array(e.options.tabSize+1).join(" "),e.replaceSelection(t))}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];return void 0!==t||(t=__webpack_module_cache__[e]={exports:{}},__webpack_modules__[e](t,t.exports,__webpack_require__)),t.exports}__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={},__webpack_exports__App=((()=>{__webpack_require__.d(__webpack_exports__,{g:()=>Im});var t={},t=(__webpack_require__.r(t),__webpack_require__.d(t,{Lexer:()=>ue,Parser:()=>fe,Renderer:()=>pe,Slugger:()=>ge,TextRenderer:()=>me,Tokenizer:()=>ce,defaults:()=>z,getDefaults:()=>R,lexer:()=>Ce,marked:()=>u,options:()=>ve,parse:()=>_e,parseInline:()=>ke,parser:()=>xe,setOptions:()=>we,use:()=>ye,walkTokens:()=>be}),{});__webpack_require__.r(t),__webpack_require__.d(t,{render:()=>Le,renderContainer:()=>je,renderHtml:()=>Te,renderText:()=>Ee}),__webpack_require__(278),__webpack_require__(345),__webpack_require__(788),__webpack_require__(265),__webpack_require__(537);function R(){return{baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1,externalLinks:!1}}let z=R();const B=/[&<>"']/,N=/[&<>"']/g,F=/[<>"']|&(?!#?\w+;)/,q=/[<>"']|&(?!#?\w+;)/g,U={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$=e=>U[e];function l(e,t){if(t){if(B.test(e))return e.replace(N,$)}else if(F.test(e))return e.replace(q,$);return e}const H=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function W(e){return e.replace(H,(e,t)=>"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):"")}const V=/(^|[^\[])\^/g;function i(i,e){i="string"==typeof i?i:i.source,e=e||"";const a={replace:(e,t)=>(t=(t=t.source||t).replace(V,"$1"),i=i.replace(e,t),a),getRegex:()=>new RegExp(i,e)};return a}const X=/[^\w:]/g,G=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function K(e,t,i){if(e){let e;try{e=decodeURIComponent(W(i)).replace(X,"").toLowerCase()}catch(e){return null}if(0===e.indexOf("javascript:")||0===e.indexOf("vbscript:")||0===e.indexOf("data:"))return null}var a;t&&!G.test(i)&&(e=t,t=i,Z[" "+e]||(J.test(e)?Z[" "+e]=e+"/":Z[" "+e]=ae(e,"/",!0)),a=-1===(e=Z[" "+e]).indexOf(":"),i="//"===t.substring(0,2)?a?t:e.replace(Q,"$1")+t:"/"===t.charAt(0)?a?t:e.replace(ee,"$1")+t:e+t);try{i=encodeURI(i).replace(/%25/g,"%")}catch(e){return null}return i}const Z={},J=/^[^:]+:\/*[^/]*$/,Q=/^([^:]+:)[\s\S]*$/,ee=/^([^:]+:\/*[^/]*)[\s\S]*$/;var a={exec:function(){}};function te(e){let t=1,i,a;for(;t<arguments.length;t++)for(a in i=arguments[t])Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);return e}function ie(e,t){var i=e.replace(/\|/g,(e,t,i)=>{let a=!1,s=t;for(;0<=--s&&"\\"===i[s];)a=!a;return a?"|":" |"}).split(/ \|/);let a=0;if(i[0].trim()||i.shift(),0<i.length&&!i[i.length-1].trim()&&i.pop(),i.length>t)i.splice(t);else for(;i.length<t;)i.push("");for(;a<i.length;a++)i[a]=i[a].trim().replace(/\\\|/g,"|");return i}function ae(e,t,i){var a=e.length;if(0===a)return"";let s=0;for(;s<a;){var r=e.charAt(a-s-1);if((r!==t||i)&&(r===t||!i))break;s++}return e.slice(0,a-s)}function se(i,a){if(-1!==i.indexOf(a[1])){var s=i.length;let e=0,t=0;for(;t<s;t++)if("\\"===i[t])t++;else if(i[t]===a[0])e++;else if(i[t]===a[1]&&--e<0)return t}return-1}function re(e){e&&e.sanitize&&!e.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function ne(e,t){if(t<1)return"";let i="";for(;1<t;)1&t&&(i+=e),t>>=1,e+=e;return i+e}function oe(e,t,i,a){var s=t.href,t=t.title?l(t.title):null,r=e[1].replace(/\\([\[\]])/g,"$1");return"!"!==e[0].charAt(0)?(a.state.inLink=!0,e={type:"link",raw:i,href:s,title:t,text:r,tokens:a.inlineTokens(r,[])},a.state.inLink=!1,e):{type:"image",raw:i,href:s,title:t,text:l(r)}}function le(e,t){e=e.match(/^(\s+)(?:```)/);if(null===e)return t;const i=e[1];return t.split("\n").map(e=>{var t=e.match(/^\s+/);return null!==t&&([t]=t,t.length>=i.length)?e.slice(i.length):e}).join("\n")}class ce{constructor(e){this.options=e||z}space(e){e=this.rules.block.newline.exec(e);if(e&&0<e[0].length)return{type:"space",raw:e[0]}}code(e){var t,e=this.rules.block.code.exec(e);if(e)return t=e[0].replace(/^ {1,4}/gm,""),{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:ae(t,"\n")}}fences(e){var t,i,e=this.rules.block.fences.exec(e);if(e)return i=le(t=e[0],e[3]||""),{type:"code",raw:t,lang:e[2]&&e[2].trim(),text:i}}heading(t){t=this.rules.block.heading.exec(t);if(t){let e=t[2].trim();/#$/.test(e)&&(i=ae(e,"#"),!this.options.pedantic&&i&&!/ $/.test(i)||(e=i.trim()));var i={type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:[]};return this.lexer.inline(i.text,i.tokens),i}}hr(e){e=this.rules.block.hr.exec(e);if(e)return{type:"hr",raw:e[0]}}blockquote(e){var t,e=this.rules.block.blockquote.exec(e);if(e)return t=e[0].replace(/^ *>[ \t]?/gm,""),{type:"blockquote",raw:e[0],tokens:this.lexer.blockTokens(t,[]),text:t}}list(p){let m=this.rules.block.list.exec(p);if(m){let e,t,i,a,s,r,n,o,l,c,d,h,u=m[1].trim();for(var g=1<u.length,f={type:"list",raw:"",ordered:g,start:g?+u.slice(0,-1):"",loose:!1,items:[]},v=(u=g?"\\d{1,9}\\"+u.slice(-1):"\\"+u,this.options.pedantic&&(u=g?u:"[*+-]"),new RegExp(`^( {0,3}${u})((?:[	 ][^\\n]*)?(?:\\n|$))`));p&&(h=!1,m=v.exec(p))&&!this.rules.block.hr.test(p);){if(e=m[0],p=p.substring(e.length),o=m[2].split("\n",1)[0],l=p.split("\n",1)[0],this.options.pedantic?(a=2,d=o.trimLeft()):(a=4<(a=m[2].search(/[^ ]/))?1:a,d=o.slice(a),a+=m[1].length),r=!1,!o&&/^ *$/.test(l)&&(e+=l+"\n",p=p.substring(l.length+1),h=!0),!h)for(var w=new RegExp(`^ {0,${Math.min(3,a-1)}}(?:[*+-]|\\d{1,9}[.)])((?: [^\\n]*)?(?:\\n|$))`),y=new RegExp(`^ {0,${Math.min(3,a-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`);p&&(c=p.split("\n",1)[0],o=c,this.options.pedantic&&(o=o.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!w.test(o))&&!y.test(p);){if(o.search(/[^ ]/)>=a||!o.trim())d+="\n"+o.slice(a);else{if(r)break;d+="\n"+o}r||o.trim()||(r=!0),e+=c+"\n",p=p.substring(c.length+1)}f.loose||(n?f.loose=!0:/\n *\n *$/.test(e)&&(n=!0)),this.options.gfm&&(t=/^\[[ xX]\] /.exec(d))&&(i="[ ] "!==t[0],d=d.replace(/^\[[ xX]\] +/,"")),f.items.push({type:"list_item",raw:e,task:!!t,checked:i,loose:!1,text:d}),f.raw+=e}f.items[f.items.length-1].raw=e.trimRight(),f.items[f.items.length-1].text=d.trimRight(),f.raw=f.raw.trimRight();var b=f.items.length;for(s=0;s<b;s++){this.lexer.state.top=!1,f.items[s].tokens=this.lexer.blockTokens(f.items[s].text,[]);var k=f.items[s].tokens.filter(e=>"space"===e.type),_=k.every(e=>{let t=0;for(const i of e.raw.split(""))if("\n"===i&&(t+=1),1<t)return!0;return!1});!f.loose&&k.length&&_&&(f.loose=!0,f.items[s].loose=!0)}return f}}html(e){var t,e=this.rules.block.html.exec(e);if(e)return t={type:"html",raw:e[0],pre:!this.options.sanitizer&&("pre"===e[1]||"script"===e[1]||"style"===e[1]),text:e[0]},this.options.sanitize&&(t.type="paragraph",t.text=this.options.sanitizer?this.options.sanitizer(e[0]):l(e[0]),t.tokens=[],this.lexer.inline(t.text,t.tokens)),t}def(e){e=this.rules.block.def.exec(e);if(e)return e[3]&&(e[3]=e[3].substring(1,e[3].length-1)),{type:"def",tag:e[1].toLowerCase().replace(/\s+/g," "),raw:e[0],href:e[2],title:e[3]}}table(r){r=this.rules.block.table.exec(r);if(r){var n={type:"table",header:ie(r[1]).map(e=>({text:e})),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:r[3]&&r[3].trim()?r[3].replace(/\n[ \t]*$/,"").split("\n"):[]};if(n.header.length===n.align.length){n.raw=r[0];let e=n.align.length,t,i,a,s;for(t=0;t<e;t++)/^ *-+: *$/.test(n.align[t])?n.align[t]="right":/^ *:-+: *$/.test(n.align[t])?n.align[t]="center":/^ *:-+ *$/.test(n.align[t])?n.align[t]="left":n.align[t]=null;for(e=n.rows.length,t=0;t<e;t++)n.rows[t]=ie(n.rows[t],n.header.length).map(e=>({text:e}));for(e=n.header.length,i=0;i<e;i++)n.header[i].tokens=[],this.lexer.inline(n.header[i].text,n.header[i].tokens);for(e=n.rows.length,i=0;i<e;i++)for(s=n.rows[i],a=0;a<s.length;a++)s[a].tokens=[],this.lexer.inline(s[a].text,s[a].tokens);return n}}}lheading(e){var e=this.rules.block.lheading.exec(e);if(e)return e={type:"heading",raw:e[0],depth:"="===e[2].charAt(0)?1:2,text:e[1],tokens:[]},this.lexer.inline(e.text,e.tokens),e}paragraph(e){var e=this.rules.block.paragraph.exec(e);if(e)return e={type:"paragraph",raw:e[0],text:"\n"===e[1].charAt(e[1].length-1)?e[1].slice(0,-1):e[1],tokens:[]},this.lexer.inline(e.text,e.tokens),e}text(e){var e=this.rules.block.text.exec(e);if(e)return e={type:"text",raw:e[0],text:e[0],tokens:[]},this.lexer.inline(e.text,e.tokens),e}escape(e){e=this.rules.inline.escape.exec(e);if(e)return{type:"escape",raw:e[0],text:l(e[1])}}tag(e){e=this.rules.inline.tag.exec(e);if(e)return!this.lexer.state.inLink&&/^<a /i.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(e[0]):l(e[0]):e[0]}}link(i){i=this.rules.inline.link.exec(i);if(i){var a=i[2].trim();if(!this.options.pedantic&&/^</.test(a)){if(!/>$/.test(a))return;var s=ae(a.slice(0,-1),"\\");if((a.length-s.length)%2==0)return}else{var r,s=se(i[2],"()");-1<s&&(r=(0===i[0].indexOf("!")?5:4)+i[1].length+s,i[2]=i[2].substring(0,s),i[0]=i[0].substring(0,r).trim(),i[3]="")}let e=i[2],t="";return this.options.pedantic?(s=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(e))&&(e=s[1],t=s[3]):t=i[3]?i[3].slice(1,-1):"",e=e.trim(),oe(i,{href:(e=/^</.test(e)?this.options.pedantic&&!/>$/.test(a)?e.slice(1):e.slice(1,-1):e)&&e.replace(this.rules.inline._escapes,"$1"),title:t&&t.replace(this.rules.inline._escapes,"$1")},i[0],this.lexer)}}reflink(t,i){let a;if(a=(a=this.rules.inline.reflink.exec(t))||this.rules.inline.nolink.exec(t)){let e=(a[2]||a[1]).replace(/\s+/g," ");return(e=i[e.toLowerCase()])&&e.href?oe(a,e,a[0],this.lexer):{type:"text",raw:t=a[0].charAt(0),text:t}}}emStrong(s,r,e=""){let n=this.rules.inline.emStrong.lDelim.exec(s);if(n&&(!n[3]||!e.match(/[\p{L}\p{N}]/u))){var t=n[1]||n[2]||"";if(!t||""===e||this.rules.inline.punctuation.exec(e)){var o=n[0].length-1;let e,t,i=o,a=0;var l,c="*"===n[0][0]?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(c.lastIndex=0,r=r.slice(-1*s.length+o);null!=(n=c.exec(r));)if(e=n[1]||n[2]||n[3]||n[4]||n[5]||n[6])if(t=e.length,n[3]||n[4])i+=t;else if((n[5]||n[6])&&o%3&&!((o+t)%3))a+=t;else if(!(0<(i-=t)))return t=Math.min(t,t+i+a),Math.min(o,t)%2?(l=s.slice(1,o+n.index+t),{type:"em",raw:s.slice(0,o+n.index+t+1),text:l,tokens:this.lexer.inlineTokens(l,[])}):(l=s.slice(2,o+n.index+t-1),{type:"strong",raw:s.slice(0,o+n.index+t+1),text:l,tokens:this.lexer.inlineTokens(l,[])})}}}codespan(t){t=this.rules.inline.code.exec(t);if(t){let e=t[2].replace(/\n/g," ");var i=/[^ ]/.test(e),a=/^ /.test(e)&&/ $/.test(e);return e=l(e=i&&a?e.substring(1,e.length-1):e,!0),{type:"codespan",raw:t[0],text:e}}}br(e){e=this.rules.inline.br.exec(e);if(e)return{type:"br",raw:e[0]}}del(e){e=this.rules.inline.del.exec(e);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2],[])}}autolink(i,a){i=this.rules.inline.autolink.exec(i);if(i){let e,t;return t="@"===i[2]?"mailto:"+(e=l(this.options.mangle?a(i[1]):i[1])):e=l(i[1]),{type:"link",raw:i[0],text:e,href:t,tokens:[{type:"text",raw:e,text:e}]}}}url(e,i){var a,s;if(a=this.rules.inline.url.exec(e)){let e,t;if("@"===a[2])e=l(this.options.mangle?i(a[0]):a[0]),t="mailto:"+e;else{for(;s=a[0],a[0]=this.rules.inline._backpedal.exec(a[0])[0],s!==a[0];);e=l(a[0]),t="www."===a[1]?"http://"+e:e}return{type:"link",raw:a[0],text:e,href:t,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(t,i){t=this.rules.inline.text.exec(t);if(t){let e;return e=this.lexer.state.inRawBlock?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):l(t[0]):t[0]:l(this.options.smartypants?i(t[0]):t[0]),{type:"text",raw:t[0],text:e}}}}const s={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:a,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\.|[^\[\]\\])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/},r=(s.def=i(s.def).replace("label",s._label).replace("title",s._title).getRegex(),s.bullet=/(?:[*+-]|\d{1,9}[.)])/,s.listItemStart=i(/^( *)(bull) */).replace("bull",s.bullet).getRegex(),s.list=i(s.list).replace(/bull/g,s.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+s.def.source+")").getRegex(),s._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",s._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,s.html=i(s.html,"i").replace("comment",s._comment).replace("tag",s._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),s.paragraph=i(s._paragraph).replace("hr",s.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",s._tag).getRegex(),s.blockquote=i(s.blockquote).replace("paragraph",s.paragraph).getRegex(),s.normal=te({},s),s.gfm=te({},s.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),s.gfm.table=i(s.gfm.table).replace("hr",s.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",s._tag).getRegex(),s.gfm.paragraph=i(s._paragraph).replace("hr",s.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",s.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",s._tag).getRegex(),s.pedantic=te({},s.normal,{html:i("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",s._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:a,paragraph:i(s.normal._paragraph).replace("hr",s.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",s.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()}),{escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:a,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[^*]+(?=[^*])|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:a,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/});function de(e){return e.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function he(e){let t="",i,a;var s=e.length;for(i=0;i<s;i++)a=e.charCodeAt(i),.5<Math.random()&&(a="x"+a.toString(16)),t+="&#"+a+";";return t}r._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~",r.punctuation=i(r.punctuation).replace(/punctuation/g,r._punctuation).getRegex(),r.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g,r.escapedEmSt=/\\\*|\\_/g,r._comment=i(s._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),r.emStrong.lDelim=i(r.emStrong.lDelim).replace(/punct/g,r._punctuation).getRegex(),r.emStrong.rDelimAst=i(r.emStrong.rDelimAst,"g").replace(/punct/g,r._punctuation).getRegex(),r.emStrong.rDelimUnd=i(r.emStrong.rDelimUnd,"g").replace(/punct/g,r._punctuation).getRegex(),r._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,r._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,r._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,r.autolink=i(r.autolink).replace("scheme",r._scheme).replace("email",r._email).getRegex(),r._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,r.tag=i(r.tag).replace("comment",r._comment).replace("attribute",r._attribute).getRegex(),r._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,r._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,r._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,r.link=i(r.link).replace("label",r._label).replace("href",r._href).replace("title",r._title).getRegex(),r.reflink=i(r.reflink).replace("label",r._label).replace("ref",s._label).getRegex(),r.nolink=i(r.nolink).replace("ref",s._label).getRegex(),r.reflinkSearch=i(r.reflinkSearch,"g").replace("reflink",r.reflink).replace("nolink",r.nolink).getRegex(),r.normal=te({},r),r.pedantic=te({},r.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:i(/^!?\[(label)\]\((.*?)\)/).replace("label",r._label).getRegex(),reflink:i(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",r._label).getRegex()}),r.gfm=te({},r.normal,{escape:i(r.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),r.gfm.url=i(r.gfm.url,"i").replace("email",r.gfm._extended_email).getRegex(),r.breaks=te({},r.gfm,{br:i(r.br).replace("{2,}","*").getRegex(),text:i(r.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});class ue{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||z,this.options.tokenizer=this.options.tokenizer||new ce,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,(this.tokenizer.lexer=this).inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};e={block:s.normal,inline:r.normal};this.options.pedantic?(e.block=s.pedantic,e.inline=r.pedantic):this.options.gfm&&(e.block=s.gfm,this.options.breaks?e.inline=r.breaks:e.inline=r.gfm),this.tokenizer.rules=e}static get rules(){return{block:s,inline:r}}static lex(e,t){return new ue(t).lex(e)}static lexInline(e,t){return new ue(t).inlineTokens(e)}lex(e){var t;for(e=e.replace(/\r\n|\r/g,"\n"),this.blockTokens(e,this.tokens);t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(a,t=[]){a=this.options.pedantic?a.replace(/\t/g,"    ").replace(/^ +$/gm,""):a.replace(/^( *)(\t+)/gm,(e,t,i)=>t+"    ".repeat(i.length));let i,e,s,r;for(;a;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(e=>!!(i=e.call({lexer:this},a,t))&&(a=a.substring(i.raw.length),t.push(i),!0))))if(i=this.tokenizer.space(a))a=a.substring(i.raw.length),1===i.raw.length&&0<t.length?t[t.length-1].raw+="\n":t.push(i);else if(i=this.tokenizer.code(a))a=a.substring(i.raw.length),!(e=t[t.length-1])||"paragraph"!==e.type&&"text"!==e.type?t.push(i):(e.raw+="\n"+i.raw,e.text+="\n"+i.text,this.inlineQueue[this.inlineQueue.length-1].src=e.text);else if(i=this.tokenizer.fences(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.heading(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.hr(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.blockquote(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.list(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.html(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.def(a))a=a.substring(i.raw.length),!(e=t[t.length-1])||"paragraph"!==e.type&&"text"!==e.type?this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title}):(e.raw+="\n"+i.raw,e.text+="\n"+i.raw,this.inlineQueue[this.inlineQueue.length-1].src=e.text);else if(i=this.tokenizer.table(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.lheading(a))a=a.substring(i.raw.length),t.push(i);else{if(s=a,this.options.extensions&&this.options.extensions.startBlock){let t=1/0;const o=a.slice(1);let i;this.options.extensions.startBlock.forEach(function(e){"number"==typeof(i=e.call({lexer:this},o))&&0<=i&&(t=Math.min(t,i))}),t<1/0&&0<=t&&(s=a.substring(0,t+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s)))e=t[t.length-1],r&&"paragraph"===e.type?(e.raw+="\n"+i.raw,e.text+="\n"+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=e.text):t.push(i),r=s.length!==a.length,a=a.substring(i.raw.length);else if(i=this.tokenizer.text(a))a=a.substring(i.raw.length),(e=t[t.length-1])&&"text"===e.type?(e.raw+="\n"+i.raw,e.text+="\n"+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=e.text):t.push(i);else if(a){var n="Infinite loop on byte: "+a.charCodeAt(0);if(this.options.silent){console.error(n);break}throw new Error(n)}}return this.state.top=!0,t}inline(e,t){this.inlineQueue.push({src:e,tokens:t})}inlineTokens(a,t=[]){let i,e,s,r=a,n,o,l;if(this.tokens.links){var c=Object.keys(this.tokens.links);if(0<c.length)for(;null!=(n=this.tokenizer.rules.inline.reflinkSearch.exec(r));)c.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,n.index)+"["+ne("a",n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(n=this.tokenizer.rules.inline.blockSkip.exec(r));)r=r.slice(0,n.index)+"["+ne("a",n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(n=this.tokenizer.rules.inline.escapedEmSt.exec(r));)r=r.slice(0,n.index)+"++"+r.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;a;)if(o||(l=""),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(e=>!!(i=e.call({lexer:this},a,t))&&(a=a.substring(i.raw.length),t.push(i),!0))))if(i=this.tokenizer.escape(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.tag(a))a=a.substring(i.raw.length),(e=t[t.length-1])&&"text"===i.type&&"text"===e.type?(e.raw+=i.raw,e.text+=i.text):t.push(i);else if(i=this.tokenizer.link(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.reflink(a,this.tokens.links))a=a.substring(i.raw.length),(e=t[t.length-1])&&"text"===i.type&&"text"===e.type?(e.raw+=i.raw,e.text+=i.text):t.push(i);else if(i=this.tokenizer.emStrong(a,r,l))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.codespan(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.br(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.del(a))a=a.substring(i.raw.length),t.push(i);else if(i=this.tokenizer.autolink(a,he))a=a.substring(i.raw.length),t.push(i);else if(!this.state.inLink&&(i=this.tokenizer.url(a,he)))a=a.substring(i.raw.length),t.push(i);else{if(s=a,this.options.extensions&&this.options.extensions.startInline){let t=1/0;const h=a.slice(1);let i;this.options.extensions.startInline.forEach(function(e){"number"==typeof(i=e.call({lexer:this},h))&&0<=i&&(t=Math.min(t,i))}),t<1/0&&0<=t&&(s=a.substring(0,t+1))}if(i=this.tokenizer.inlineText(s,de))a=a.substring(i.raw.length),"_"!==i.raw.slice(-1)&&(l=i.raw.slice(-1)),o=!0,(e=t[t.length-1])&&"text"===e.type?(e.raw+=i.raw,e.text+=i.text):t.push(i);else if(a){var d="Infinite loop on byte: "+a.charCodeAt(0);if(this.options.silent){console.error(d);break}throw new Error(d)}}return t}}class pe{constructor(e){this.options=e||z}code(e,t,i){var a,t=(t||"").match(/\S*/)[0];this.options.highlight&&null!=(a=this.options.highlight(e,t))&&a!==e&&(i=!0,e=a),e=e.replace(/\n$/,"")+"\n";let s="";return`<pre class="relative noevents"><code${s=s&&` class="${this.options.langPrefix+l(t,!0)}"`}>`+(i?e:l(e,!0))+'</code><button class="icon fa xs copy top-right display-hover" title="Copy" cmd="copy-code"></button></pre>\n'}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e){return e}heading(e,t,i,a){return this.options.headerIds?`<h${t} id="${this.options.headerPrefix+a.slug(i)}">${e}</h${t}>
`:`<h${t}>${e}</h${t}>
`}hr(){return this.options.xhtml?"<hr/>\n":"<hr>\n"}list(e,t,i){var a=t?"ol":"ul";return"<"+a+(t&&1!==i?' start="'+i+'"':"")+">\n"+e+"</"+a+">\n"}listitem(e){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e,t){return t?`<p class="image">${e}</p>
`:`<p>${e}</p>
`}table(e,t){return"<table>\n<thead>\n"+e+"</thead>\n"+(t=t&&`<tbody>${t}</tbody>`)+"</table>\n"}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){var i=t.header?"th":"td";return(t.align?`<${i} align="${t.align}">`:`<${i}>`)+e+`</${i}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,t,i){if(null===(e=K(this.options.sanitize,this.options.baseUrl,e)))return i;let a;return e.startsWith("#")?a='<a class="internal" link="'+e+'"':(a='<a href="'+l(e)+'"',this.options.externalLinks&&(a+=' target="_blank"')),t&&(a+=' title="'+t+'"'),a+=">"+i+"</a>"}image(e,t,i){if(null===(e=K(this.options.sanitize,this.options.baseUrl,e)))return i;let a=`<img src="${e}" alt="${i}"`;return t&&(a+=` title="${t}"`),a+=this.options.xhtml?"/>":">"}text(e){return e}}class me{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,i){return""+i}image(e,t,i){return""+i}br(){return""}}class ge{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,t){let i=e,a=0;if(this.seen.hasOwnProperty(i))for(a=this.seen[e];a++,i=e+"-"+a,this.seen.hasOwnProperty(i););return t||(this.seen[e]=a,this.seen[i]=0),i}slug(e,t={}){e=this.serialize(e);return this.getNextSafeSlug(e,t.dryrun)}}class fe{constructor(e){this.options=e||z,this.options.renderer=this.options.renderer||new pe,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new me,this.slugger=new ge}static parse(e,t){return new fe(t).parse(e)}static parseInline(e,t){return new fe(t).parseInline(e)}parse(e,t=!0){let i="",a,s,r,n,o,l,c,d,h,u,p,m,g,f,v,w,y,b,k;var _=e.length;for(a=0;a<_;a++)if(u=e[a],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[u.type]&&(!1!==(k=this.options.extensions.renderers[u.type].call({parser:this},u))||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(u.type)))i+=k||"";else switch(u.type){case"space":continue;case"hr":i+=this.renderer.hr();continue;case"heading":i+=this.renderer.heading(this.parseInline(u.tokens),u.depth,W(this.parseInline(u.tokens,this.textRenderer)),this.slugger);continue;case"code":i+=this.renderer.code(u.text,u.lang,u.escaped);continue;case"table":for(d="",c="",n=u.header.length,s=0;s<n;s++)c+=this.renderer.tablecell(this.parseInline(u.header[s].tokens),{header:!0,align:u.align[s]});for(d+=this.renderer.tablerow(c),h="",n=u.rows.length,s=0;s<n;s++){for(l=u.rows[s],c="",o=l.length,r=0;r<o;r++)c+=this.renderer.tablecell(this.parseInline(l[r].tokens),{header:!1,align:u.align[r]});h+=this.renderer.tablerow(c)}i+=this.renderer.table(d,h);continue;case"blockquote":h=this.parse(u.tokens),i+=this.renderer.blockquote(h);continue;case"list":for(p=u.ordered,m=u.start,g=u.loose,n=u.items.length,h="",s=0;s<n;s++)w=(v=u.items[s]).checked,y=v.task,f="",v.task&&(b=this.renderer.checkbox(w),g?0<v.tokens.length&&"paragraph"===v.tokens[0].type?(v.tokens[0].text=b+" "+v.tokens[0].text,v.tokens[0].tokens&&0<v.tokens[0].tokens.length&&"text"===v.tokens[0].tokens[0].type&&(v.tokens[0].tokens[0].text=b+" "+v.tokens[0].tokens[0].text)):v.tokens.unshift({type:"text",text:b}):f+=b),f+=this.parse(v.tokens,g),h+=this.renderer.listitem(f,y,w);i+=this.renderer.list(h,p,m);continue;case"html":i+=this.renderer.html(u.text);continue;case"paragraph":{const e=u.tokens;var x=1==e.length&&"image"==e[0].type;i+=this.renderer.paragraph(this.parseInline(e),x);continue}case"text":for(h=u.tokens?this.parseInline(u.tokens):u.text;a+1<_&&"text"===e[a+1].type;)u=e[++a],h+="\n"+(u.tokens?this.parseInline(u.tokens):u.text);i+=t?this.renderer.paragraph(h):h;continue;default:x='Token with "'+u.type+'" type was not found.';if(this.options.silent)return void console.error(x);throw new Error(x)}return i}parseInline(e,t){t=t||this.renderer;let i="",a,s,r;var n=e.length;for(a=0;a<n;a++)if(s=e[a],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]&&(!1!==(r=this.options.extensions.renderers[s.type].call({parser:this},s))||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)))i+=r||"";else switch(s.type){case"escape":i+=t.text(s.text);break;case"html":i+=t.html(s.text);break;case"link":i+=t.link(s.href,s.title,this.parseInline(s.tokens,t));break;case"image":i+=t.image(s.href,s.title,s.text);break;case"strong":i+=t.strong(this.parseInline(s.tokens,t));break;case"em":i+=t.em(this.parseInline(s.tokens,t));break;case"codespan":i+=t.codespan(s.text);break;case"br":i+=t.br();break;case"del":i+=t.del(this.parseInline(s.tokens,t));break;case"text":i+=t.text(s.text);break;default:var o='Token with "'+s.type+'" type was not found.';if(this.options.silent)return void console.error(o);throw new Error(o)}return i}}function u(e,s,r){if(null==e)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if("function"==typeof s&&(r=s,s=null),re(s=te({},u.defaults,s||{})),r){const n=s.highlight;let i;try{i=ue.lex(e,s)}catch(e){return r(e)}const o=function(t){let e;if(!t)try{s.walkTokens&&u.walkTokens(i,s.walkTokens),e=fe.parse(i,s)}catch(e){t=e}return s.highlight=n,t?r(t):r(null,e)};if(!n||n.length<3)return o();if(delete s.highlight,!i.length)return o();let a=0;u.walkTokens(i,function(i){"code"===i.type&&(a++,setTimeout(()=>{n(i.text,i.lang,function(e,t){if(e)return o(e);null!=t&&t!==i.text&&(i.text=t,i.escaped=!0),0===--a&&o()})},0))}),void(0===a&&o())}else try{var t=ue.lex(e,s);return s.walkTokens&&u.walkTokens(t,s.walkTokens),fe.parse(t,s).replace(/(\$fa-[a-z0-9-]+)(;[a-z]+)?/g,(e,t,i)=>{return`<i class="fa ${t.slice(1)}" style="color:${i?i.slice(1):"inherit"}"></i>`})}catch(e){if(e.message+="\nPlease report this to https://github.com/markedjs/marked.",s.silent)return"<p>An error occurred:</p><pre>"+l(e.message+"",!0)+"</pre>";throw e}}u.options=u.setOptions=function(e){return te(u.defaults,e),e=u.defaults,z=e,u},u.getDefaults=R,u.defaults=z,u.use=function(...e){const c=te({},...e),d=u.defaults.extensions||{renderers:{},childTokens:{}};let h;e.forEach(i=>{if(i.extensions&&(h=!0,i.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if(i.renderer){const a=d.renderers?d.renderers[i.name]:null;a?d.renderers[i.name]=function(...e){let t=i.renderer.apply(this,e);return t=!1===t?a.apply(this,e):t}:d.renderers[i.name]=i.renderer}if(i.tokenizer){if(!i.level||"block"!==i.level&&"inline"!==i.level)throw new Error("extension level must be 'block' or 'inline'");d[i.level]?d[i.level].unshift(i.tokenizer):d[i.level]=[i.tokenizer],i.start&&("block"===i.level?d.startBlock?d.startBlock.push(i.start):d.startBlock=[i.start]:"inline"===i.level&&(d.startInline?d.startInline.push(i.start):d.startInline=[i.start]))}i.childTokens&&(d.childTokens[i.name]=i.childTokens)})),i.renderer){const a=u.defaults.renderer||new pe;for(const s in i.renderer){const r=a[s];a[s]=(...e)=>{let t=i.renderer[s].apply(a,e);return t=!1===t?r.apply(a,e):t}}c.renderer=a}if(i.tokenizer){const n=u.defaults.tokenizer||new ce;for(const o in i.tokenizer){const l=n[o];n[o]=(...e)=>{let t=i.tokenizer[o].apply(n,e);return t=!1===t?l.apply(n,e):t}}c.tokenizer=n}if(i.walkTokens){const t=u.defaults.walkTokens;c.walkTokens=function(e){i.walkTokens.call(this,e),t&&t.call(this,e)}}h&&(c.extensions=d),u.setOptions(c)})},u.walkTokens=function(e,t){for(const i of e)switch(t.call(u,i),i.type){case"table":for(const a of i.header)u.walkTokens(a.tokens,t);for(const s of i.rows)for(const r of s)u.walkTokens(r.tokens,t);break;case"list":u.walkTokens(i.items,t);break;default:u.defaults.extensions&&u.defaults.extensions.childTokens&&u.defaults.extensions.childTokens[i.type]?u.defaults.extensions.childTokens[i.type].forEach(function(e){u.walkTokens(i[e],t)}):i.tokens&&u.walkTokens(i.tokens,t)}},u.parseInline=function(e,t){if(null==e)throw new Error("marked.parseInline(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");re(t=te({},u.defaults,t||{}));try{var i=ue.lexInline(e,t);return t.walkTokens&&u.walkTokens(i,t.walkTokens),fe.parseInline(i,t)}catch(e){if(e.message+="\nPlease report this to https://github.com/markedjs/marked.",t.silent)return"<p>An error occurred:</p><pre>"+l(e.message+"",!0)+"</pre>";throw e}},u.Parser=fe,u.parser=fe.parse,u.Renderer=pe,u.TextRenderer=me,u.Lexer=ue,u.lexer=ue.lex,u.Tokenizer=ce,u.Slugger=ge;const ve=(u.parse=u).options,we=u.setOptions,ye=u.use,be=u.walkTokens,ke=u.parseInline,_e=u,xe=fe.parse,Ce=ue.lex;function Ee(e,t,...i){var a=(e=e.trim()).matchAll(/@(if|else|endif|foreach|endforeach)(\{\{(.*?)\}\}(\[(.*?)\])?)?/g),s=[];let r,n,o=0,l=s,c;s.start=0;for(const d of a)switch(d[1]){case"if":case"foreach":n=e.slice(l.start,d.index).trim(),l.push(n),(c=[]).type=d[1],c.exp=d[3],c.parent=l,c.start=d.index+d[0].length,c.caps=d[5]?d[5].split(","):[],l.push(c),l=c;break;case"endif":case"endforeach":r=d.index+d[0].length,l.push(e.slice(l.start,d.index).trim()),(l=l.parent).start=r,o=r;break;case"else":{r=d.index+d[0].length,l.push(e.slice(l.start,d.index).trim());const c=[];c.parent=l.parent,c.start=d.index+d[0].length,l._else=c,l=c}}return s.push(e.slice(o,e.length).trim()),function e(t,i,...a){if(!t)return"";let s="";for(const r of t)if("string"==typeof r)s+=Se(r,i,...a).replacex(i,...a);else switch(r.type){case"if":{const n=r.exp.evalx(i,...a);s+=e(n?r:r._else,i,...a)}break;case"foreach":{const o=r.exp.evalx(i,...a)||[],l=r.caps.map(e=>i[e]);for(const c of o)s+=e(r,c,o.length,...l)}}return s}(s,t,...i).replaceAll(/>\s+</g,"><")}function Se(e,h,...u){return e.replace(/\[\[(.*?)\]\](\{\{(.*?)\}\})?/g,(e,t,i,a)=>{var[t,s,...r]=t.split(",");let n=/_\d/.test(t)?u[parseInt(t.slice(1))]:t,o=[];if(!(n=Array.isArray(n)?(o=n).shift():n))return"";for(const d of r)/_\d/.test(d)?o.push(u[parseInt(d.slice(1))]):o.push(d.replacex(h,...u));a&&(h=a.evalx(h,...u));var[t,r,a]=Ae(n,h,...o),t=Ee(t,h,...o);let l="div";var c=[],s=(s&&([l,...c]=s.split(" "),r.push(...c)),0<r.length?' class="'+r.join(" ")+'"':""),c=""+Object.entries(a).map(([e,t])=>`${e}="${t.replacex(h)}"`).join(" ");return`<${l}${s} ${c}>${t}</${l}>`})}function Te(e,t,i="div",a=[],...s){var e=Ee(e,t,...s),[t,...s]=i.split(" "),i=document.createElement(t);return i.classList.add(...a,...s),i.innerHTML=e,i}function Ae(e,t={},...i){var a=document.getElementById(e);a||console.error("Failed to load template",e);let s=a.innerHTML,r=(s=s.replace(/(?=<!--)([\s\S]*?)-->/gs,"").replace(/[\n\t]/,""),a.getAttribute("classes")||"");var n,o,e=(r=r&&r.replacex(t,...i))?r.split(" ").filter(e=>e):[];for([n,o]of Object.entries({"&gt;":">","&lt;":"<","&amp;":"&"}))s=s.replaceAll(n,o);var l,c={};for(const d of a.attributes){let e=d.name;["id","classes"].includes(e)||(e.startsWith("_a-")?(e=e.slice(3),(l=d.value.replacex(t))&&(c[e]=l)):c[e]=d.value.replacex(t,...i))}return[s,e,c]}function Le(t,e={},i="div",...a){var[s,r,n]=Ae(t,e,...a);let o;try{o=Te(s,e,i,r,...a);for(var[l,c]of Object.entries(n))o.setAttribute(l,c)}catch(e){throw console.groupCollapsed("Failed to render template",t),console.groupEnd(),e}return o}function je(e,t,i,a,...s){var[,r]=Ae(t,i);for(const o of i=Array.isArray(i)?i:[i]){var n=Te(t,i,a,r,...s);e.appendChild(n)}}const Me="highlight";function Ie(e,t){t.parentNode.insertBefore(e,t.nextElementSibling)}function De(e,t){t.parentNode.insertBefore(e,t)}function Oe(e,...t){var i,a,e=document.createElement(e);return[t,...i]=[e,...t],(a=i.shift())&&(Array.isArray(a)?t.classList.add(...a):t.classList.add(...a.split(" ")),0<i.length)&&t.classList.add(...i),e}function Pe(e,t){var i={headerIds:!1,breaks:!0,externalLinks:!0},t=(t&&Object.assign(i,t),e.trim());return _e(t,i)}function Re(e){const i={":)":"🙂",":')":"😃",':")':"😀",":p":"😋",":'p":"😛",':"p':"😝",":P":"😛",":'P":"😛",':"P':"😝",":d":"😀",":'d":"😄",':"d':"😆",":D":"😄",":'D":"😅",':"D':"😂",":k":"😗",":'k":"😙",':"k':"😚",":s":"💯",":X":"💣",":t":"👍",":b":"🍺",":B":"🍻",":w":"✋",":(":"😧",":'(":"😥",':"(':"😭",":o":"😯",":'o":"😲",':"o':"😵",":8":"😎",";)":"😉"},a={family:"👪️",zzz:"💤",newspaper:"📰",books:"📚️",up:"👍️",usd:"💲",card:"💳️",money:"💰️",cash:"💸",tm:"™️",boom:"💥",eye:"👁️",eyes:"👀",glasses:"👓️",dizzy:"💫",santa:"🎅",bird:"🐦️",dragon:"🐉",fox:"🦊",horse:"🐎",linux:"🐧",mushroom:"🍄",octopus:"🐙",ox:"🐂",shark:"🦈",snake:"🐍",tiger:"🐅",whale:"🐋",sunflower:"🌻",tree:"🌳",ok:"🆗",wc:"🚾",wtf:"⁉",new:"🆕",free:"🆓",cool:"🆒",cancer:"♋️",gemini:"♊️",taurus:"♉️",libra:"♎️",hamburger:"🍔",honeypot:"🍯",pizza:"🍕",strawberry:"🍓",beer:"🍺",cheers:"🍻",cocktail:"🍸️",coffee:"☕️",drink:"🍹",wine:"🍷",bg:"🇧🇬",de:"🇩🇪",es:"🇪🇸",fr:"🇫🇷",gb:"🇬🇧",gr:"🇬🇷",us:"🇺🇸",congratulations:"㊗️",cannabis:'<i class="fa fa-cannabis w3-text-green"></i>',joint:'<i class="fa fa-joint"></i>',facebook:'<i class="fa fa-facebook w3-text-blue"></i>',feather:'<i class="fa fa-feather w3-text-indigo"></i>'};return e.replaceAll(/\:([A-z]+)\:/g,(e,t)=>a[t.toLowerCase()]||e).replaceAll(/([:;]['"]?[)(pPdDksXtbBwo8])/g,(e,t)=>i[t]||e).replaceAll(/(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])|(\p{Emoji_Presentation})/gu,e=>`<i class="em">${e}</i>`)}window.dom={createFa(...e){return Oe("i","fa",...e)},createFaButton:function(e,...t){return Oe("button","icon","fa","fa-fw",e,...t)},highlightElement:function(e,t=0){e.classList.remove(Me),e.classList.add(Me)},isNode:function(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},isElement:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},isElementVisible(e){return 0<e.getBoundingClientRect().height},removeChilds:function(e){for(;e.lastElementChild;)e.removeChild(e.lastElementChild)},removeElement:function(e){return e&&e.parentElement&&e.parentElement.removeChild(e),e},insertAfter:Ie,insertBefore:De,insertTop:function(e,t){t.insertBefore(e,t.firstElementChild)},createElement:Oe,createElementFromMarkdown:function(e,t=!0){var i=dom.createElement("span","md","compact","r2","nomargin","noevents","text-expand"),e=(i.setAttribute("expandable",""),Pe(e));return i.innerHTML=t?Re(e):e,i},showElement:function(e,t=!0){t?e.classList.remove("hidden"):e.classList.add("hidden")},hideElement:function(e){e.classList.add("hidden")},toggleShow:function(e){return e.classList.toggle("hidden")},isHidden:function(e){return e.classList.contains("hidden")},moveTop:function(e,t,i){return(t=(e=t?e.querySelector(`[${t}="${i}"]`):e).parentElement).insertBefore(e,t.firstElementChild),e},moveAfterTop:function(e){Ie(e,e.parentElement.firstElementChild)},moveUp:function(e){De(e,e.previousElementSibling)},getParent:function(e,t=1){let i=e;for(let e=0;e<t;++e)i=i.parentElement;return i},findVisible:function e(t,i,a=0,s=i.length,r=Math.floor((a+s)/2)){if(a==s)return[];let n=i[r],o=n.getBoundingClientRect();if(o.top>=t.bottom)return e(t,i,a,r);if(o.bottom<=t.top)return e(t,i,r+1,s);var l=[n];for(let e=r-1;0<=e&&(n=i[e],(o=n.getBoundingClientRect()).bottom>t.top);e--)l.unshift(n);for(let e=r+1;e<i.length&&(n=i[e],(o=n.getBoundingClientRect()).top<t.bottom);++e)l.push(n);return l},isVisible:function(e,t){return!((e=e.getBoundingClientRect()).bottom<t.top||e.top>t.bottom)},getValues:function(e,t={}){for(const i of e.querySelectorAll("[role]")){let e;switch(i.tagName){case"IMG":e=i.src;break;case"A":e=i.href;break;case"TIME":if(i.dateTime){t.ts=new Date(i.dateTime).seconds();break}default:e=i.innerText}e&&(t[i.getAttribute("role")]=e)}return t},updateValues:function(e,t){var i,a,s;for([a,s]of Object.entries(t))(i=e.querySelector(`[role="${a}"]`))&&("status"==a?i.innerHTML=Re(s):"IMG"===i.tagName?i.src=s:i.innerText=s)},loadScript:function(e){const i=document.createElement("script");return i.type="text/javascript",i.src=e,document.getElementsByTagName("head")[0].appendChild(i),new Promise((e,t)=>{i.onload=e,i.onerror=t})},getData:function(e,t="input"){var i={};for(const a of e.querySelectorAll(t))a.name&&(i[a.name]=a.value.trim());return i},updateElapsed:function(e,t=Date.now()){for(const a of e.querySelectorAll("time[data-time]")){var i=a.dataset.time;i&&(i=new Date(1e3*parseInt(i)),a.innerText=i.offsetFrom(t))}},renderTemplate:Le,renderTemplateHtml:Te,renderTemplateContainer:je,template:t,facReplace:function(e,t){for(const i of e.className.split(" "))if(/^fac-/.test(i)){e.classList.remove(i);break}e.classList.add(t)},showNextImage:function(i,a=!0){var s=i.querySelectorAll("img");if(!(s.length<2))for(let t=0;t<s.length;++t){var r=s[t];if(!r.classList.contains("hidden")){let e=t+(a?1:-1);e<0?e=s.length-1:e==s.length&&(e=0),dom.hideElement(r),dom.showElement(s[e]);r=i.querySelector(".number");r&&(r.innerText=e+1+" / "+s.length);break}}},openTab:function(e,t){var i="w3-border-red";for(const a of e.getElementsByClassName("tablink"))a.dataset.id==t?a.classList.add(i):a.classList.remove(i);for(const s of e.querySelectorAll("div[data-tab]"))s.dataset.tab==t?dom.showElement(s):dom.hideElement(s)},markdown:Pe,markdowne:function(e,t){return e?Re(Pe(e,t)):""},tomarkdown:function(e){let t="";for(const i of(new DOMParser).parseFromString(e.innerHTML,"text/html").body.children)switch(i.nodeName){case"#text":t+=i.textContent;break;case"P":t+=i.innerText;break;case"H6":t+="#";case"H5":t+="#";case"H4":t+="#";case"H3":t+="#";case"H2":t+="#";case"H1":t+="# "+i.innerText}return t},renderEmojis:Re,escapeTags:function(e){return e.replace(/(&nbsp;|<([^>]+)>)/gi,"")},escape:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},toggleLoading(e){return e.classList.toggle("loading3")},icon:function(e,...t){if(!e)return"";var i=(i=t.pop())?` style="color:${i}"`:"";let[a,s]=/^f[0-9a-f]{3}/.test(e)?[` value="${String.fromCodePoint(parseInt(e,16))}"`,""]:[""," "+e];return 0<t.length&&(s+=" "+t.join(" ")),`<i class="fa${s}"${a}${i}></i>`},color:function(e){return e?"color:"+e:""},attr(e,t){return t?e+`="${t}"`:""},length(e){return e?e.length():0},logoFromLink(e){return new URL(e).origin+"/favicon.ico"},option(e,...t){let i="";var a,s=(e,t)=>`<option value="${e}" ${e==t?"selected":""}>${e.capitalizeFirstLetter()}</option>`;for(a of t)if("function"==typeof a&&(a=a()),Array.isArray(a))for(var r of a)i+=s(r,e);else i+=s(a,e);return i},radio(i,...e){let t="",a=!0;var s,r=(e,t)=>{e=`<input type="radio" name="${i}" value="${e}" ${a?"checked":""}><label class="radio">${e.capitalizeFirstLetter()}</label>`;return a=!1,e};for(s of e)if("function"==typeof s&&(s=s()),Array.isArray(s))for(var n of s)t+=r(n);else t+=r(s);return t}};__webpack_require__(831),__webpack_require__(489);function ze(e,t=1024){let i;var a;return(i="number"==typeof e?e:(Array.isArray(e)?e:Object.values(e)).reduce((e,t)=>e+t,0))<t?i:(e=e=>e.replace(".0",""),a=t**2,i<a?e((i/t).toFixed(1)+"K"):e((i/a).toFixed(1)+"M"))}Object.assign(window,{isPromise:function(e){return null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch},delayResolve:async function(e,i=1200){var t=new Promise((e,t)=>{setTimeout(e,i)});return await Promise.all([e,t]),e},sleep:function(t){return new Promise(e=>setTimeout(e,t))},clamp:function(e,t,i){return e<=t?t:i<=e?i:e},unclamp:function(e,t,i=-t){return t<e||e<i?e:Math.sign(e)*t},size:ze,time:function(e){var t=(e=e?new Date(1e3*e):new Date).getHours(),e=e.getMinutes();return`${9<t?t:"0"+t}:`+(9<e?e:"0"+e)},percent:function(e){return Math.floor(100*e)+"%"},randInt:function(e,t){return Math.floor((t-e)*Math.random())+e},count(e){return ze(e,1e3)},indexName:function(e,t,i){return"number"==typeof t?e=i?i+`[${t}].`+e:e+`[${t}]`:i&&(e=i+"."+e),e},dataset:function(e,t){return void 0!==t?`data-${e}="${t}"`:""},join:function(...e){return(e=e.join("/").replace(/\/+/g,"/")).endsWith("/")?e.slice(0,-1):e}});__webpack_require__(976),__webpack_require__(910);const Be=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop / Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast  Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Rock/Pop"];function p(t,e,i=0,a){let s=e||t.byteLength-i;var e="undefined"!=typeof Buffer,r=(s<0&&(s+=t.byteLength),[]),n=i+s;for(let e=i;e<n;e++){var o=t.getUint8(e);if(0===o)break;r.push(o)}return e?Buffer.from(r).toString():(i=r.map(e=>String.fromCharCode(e)).join(""),a?i:decodeURIComponent(escape(i)))}function Ne(t,e,i=0,a){let s=!1,r=e||t.byteLength-i;var n=[],e="undefined"!=typeof Buffer;if(r<0&&(r+=t.byteLength),i+1>t.byteLength)return"";a&&(65534===t.getUint16(i)&&(s=!0),i+=2,r-=2);var o=i+r;for(let e=i;e<o;e+=2){var l=t.getUint16(e,s);if(e<o-1&&0===l&&0===t.getUint16(e+1,s))break;0<=l&&l<=55295||57344<=l&&l<=65535?n.push(l):65536<=l&&l<=1114111&&(n.push(55296+((1047552&(l-=65536))>>10)),n.push(56320+(1023&l)))}if(e){var c=Buffer.alloc(2*n.length);for(let e=0;e<n.length;e++){var d=n[e];s?c.writeUInt16LE(d,2*e):c.writeUInt16BE(d,2*e)}return c.toString()}return String.fromCharCode.apply(null,new Uint16Array(n))}function Fe(e){let t=0,i=2130706432;for(;i;)t=(t>>=1)|e&i,i>>=8;return t}function qe(e,t=0){return Fe(e.getUint32(t))}function Ue(e,t=0,i){return i?e.getUint8(t)+(e.getUint8(t+1)<<8)+(e.getUint8(t+2)<<16):e.getUint8(t+2)+(e.getUint8(t+1)<<8)+(e.getUint8(t)<<16)}const $e=new Map([["TALB","album"],["TBPM","bpm"],["TCOM","composer"],["TCON","genre"],["TCOP","copyright"],["TDEN","encoding-time"],["TDLY","playlist-delay"],["TDOR","original-release-time"],["TDRC","recording-time"],["TDRL","release-time"],["TDTG","tagging-time"],["TENC","encoder"],["TEXT","writer"],["TFLT","file-type"],["TIPL","involved-people"],["TIT1","content-group"],["TIT2","title"],["TIT3","subtitle"],["TKEY","initial-key"],["TLAN","language"],["TLEN","length"],["TMCL","credits"],["TMED","media-type"],["TMOO","mood"],["TOAL","original-album"],["TOFN","original-filename"],["TOLY","original-writer"],["TOPE","original-artist"],["TOWN","owner"],["TPE1","artist"],["TPE2","band"],["TPE3","conductor"],["TPE4","remixer"],["TPOS","set-part"],["TPRO","produced-notice"],["TPUB","publisher"],["TRCK","track"],["TRSN","radio-name"],["TRSO","radio-owner"],["TSOA","album-sort"],["TSOP","performer-sort"],["TSOT","title-sort"],["TSRC","isrc"],["TSSE","encoder-settings"],["TSST","set-subtitle"],["TYER","year"],["TAL","album"],["TBP","bpm"],["TCM","composer"],["TCO","genre"],["TCR","copyright"],["TDY","playlist-delay"],["TEN","encoder"],["TFT","file-type"],["TKE","initial-key"],["TLA","language"],["TLE","length"],["TMT","media-type"],["TOA","original-artist"],["TOF","original-filename"],["TOL","original-writer"],["TOT","original-album"],["TP1","artist"],["TP2","band"],["TP3","conductor"],["TP4","remixer"],["TPA","set-part"],["TPB","publisher"],["TRC","isrc"],["TRK","track"],["TSS","encoder-settings"],["TT1","content-group"],["TT2","title"],["TT3","subtitle"],["TXT","writer"],["TYE","year"],["WCOM","url-commercial"],["WCOP","url-legal"],["WOAF","url-file"],["WOAR","url-artist"],["WOAS","url-source"],["WORS","url-radio"],["WPAY","url-payment"],["WPUB","url-publisher"],["WAF","url-file"],["WAR","url-artist"],["WAS","url-source"],["WCM","url-commercial"],["WCP","url-copyright"],["WPB","url-publisher"],["COMM","comments"],["APIC","image"],["PIC","image"],["PRIV","private"]]),He=["other","file-icon","icon","cover-front","cover-back","leaflet","media","artist-lead","artist","conductor","band","composer","writer","location","during-recording","during-performance","screen","fish","illustration","logo-band","logo-publisher"];function We(e,a){a=a||4;var s={id:null,tag:null,value:null},r=new DataView(e);if(a<3){var a=e,n={id:null,tag:null,value:null},i=new DataView(a),t={id:p(i,3),type:p(i,1),size:Ue(i,3)},o=$e.get(t.id);if(!o)return null;if(n.id=t.id,n.tag=o,"T"===t.type){let e=p(i,-7,7);"TCO"===t.id&&parseInt(e)&&(e=Be[parseInt(e)]),n.value=e}else if("W"===t.type)n.value=p(i,-7,7);else if("COM"===t.id){let e=p(i,-10,10);-1!==e.indexOf("\0")&&(e=e.substr(e.indexOf("\0")+1)),n.value=e}else if("PIC"===t.id){o={type:null,mime:"image/"+p(i,3,7).toLowerCase(),description:null,data:null};o.type=He[i.getUint8(11)]||"other";let t=0;for(let e=11;;e++)if(0===i.getUint8(e)){t=e-11;break}o.description=0===t?null:p(i,t,11),o.data=a.slice(12),n.value=o}return n.tag?n:null}t={id:p(r,4),type:p(r,1),size:qe(r,4),flags:[r.getUint8(8),r.getUint8(9)]};if(0!==t.flags[1])return null;a=$e.get(t.id);if(!a)return null;if(s.tag=a,s.id=t.id,"T"===t.type){o=r.getUint8(10);let e=null;0===o||3===o?e=p(r,-11,11):1===o?e=Ne(r,-11,11,!0):2===o&&(e=Ne(r,-11,11)),"TCON"===t.id&&null!==e&&parseInt(e)&&(e=Be[parseInt(e)]),s.value=e}else if("W"===t.type)s.value=p(r,-10,10);else if("PRIV"===t.id){let t=0;for(let e=0;;e++)if(0===r.getUint8(e)){t=e-10;break}s.value={identifier:0===t?null:p(r,t,10),data:e.slice(t+10+1)}}else if("COMM"===t.id){var l=r.getUint8(10);let t=14;for(let e=t;;e++)if(1===l||2===l){if(0===r.getUint16(e)){t=e+2;break}e++}else if(0===r.getUint8(e)){t=e+1;break}0===l||3===l?s.value=p(r,-1*t,t):1===l?s.value=Ne(r,-1*t,t,!0):2===l&&(s.value=Ne(r,-1*t,t))}else if("APIC"===t.id){n=r.getUint8(10),a={type:null,mime:null,description:null,data:null};let t=11,i=0;for(let e=t;;e++)if(0===r.getUint8(e)){i=e-t;break}a.mime=p(r,i,t),a.type=He[r.getUint8(t+i+1)]||"other",t+=i+2,i=0;for(let e=t;;e++)if(0===r.getUint8(e)){i=e-t;break}0!==i&&(0===n||3===n?a.description=p(r,i,t):1===n?a.description=Ne(r,i,t,!0):2===n&&(a.description=Ne(r,i,t))),a.data=e.slice(t+1),s.value=a}return s.tag?s:null}class Ve extends class{constructor(){this.size=0}async close(){}async readBlob(e,t=0,i="application/octet-stream"){e=await this.read(e,t);return new Blob([e],{type:i})}}{constructor(e){super(),this._file=e}async open(){this.size=this._file.size}async read(e,t){const a=this._file.slice(t,t+e);return new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{e(i.result)},i.onerror=()=>{t(new Error("File read failed"))},i.readAsArrayBuffer(a)})}}const Xe="undefined"!=typeof window&&"File"in window&&"FileReader"in window&&"undefined"!=typeof ArrayBuffer;async function Ye(e){await e.open();var t=await async function(t){let a=null;var s=await t.read(128,t.size-128),r=new DataView(s),s=(128===s.byteLength&&"TAG"===p(r,3,void 0,!0)&&(a={kind:"v1",title:p(r,30,3).trim()||null,album:p(r,30,63).trim()||null,artist:p(r,30,33).trim()||null,year:p(r,4,93).trim()||null,genre:null,comment:null,track:null},0===r.getUint8(125)?(a.comment=p(r,28,97),a.version=1.1,a.track=r.getUint8(126)):a.comment=p(r,30,97),a.genre=Be[r.getUint8(127)]||null),await t.read(14,0)),r=new DataView(s);if(14===s.byteLength&&"ID3"===p(r,3,void 0,!0)&&r.getUint8(3)<=4){let e=10;var s=0,n=[r.getUint8(3),r.getUint8(4)],o=r.getUint8(5);if(0==(128&o)){a={kind:"v2",title:a?a.title:null,album:a?a.album:null,artist:a?a.artist:null,year:a?a.year:null,version:n,frames:[],images:[]},0!=(64&o)&&(e+=qe(r,11)),s+=qe(r,6);var l=await t.read(s,e),c=new DataView(l);let i=0;for(;i<l.byteLength;){let e,t=!0;for(let e=0;e<3;e++){var d=c.getUint8(i+e);(d<65||90<d)&&(d<48||57<d)&&(t=!1)}if(!t)break;var h,u=await We(e=n[0]<3?l.slice(i,i+6+Ue(c,i+3)):3===n[0]?l.slice(i,i+10+c.getUint32(i+4)):l.slice(i,i+10+qe(c,i+4)),n[0]);u&&u.tag&&((h=a).frames.push(u),"image"===u.tag?h.images.push(u.value):a[u.tag]=u.value),i+=e.byteLength}}}return a}(e);return await e.close(),t}const Ge=new Set(["c","cc","cpp","js","json","yml","yaml","py","sh","wsdl"]);function Ke(e){let t;e=(t=e instanceof File?e.name:/^http(s)?:/.test(e)?new URL(e).pathname:e).lastIndexOf(".");return-1==e?/^data/.test(t)?[null,t.slice(5).split(";")[0].split("/")[1]]:[t,""]:[t.slice(0,e),t.slice(e+1).toLowerCase()]}function Ze(e){return["jpg","jpeg","png","svg","gif"].includes(e.toLowerCase())}function Je(e){return["mp3","flac","ogg"].includes(e)}function Qe(e){return["mp4","mkv","webm"].includes(e)}function et(e){let[t,i]=e.split("/");if("application"!==t)return t;switch(i){case"x-bzip":case"gzip":i="zip";break;case"x-shellscript":case"x-yaml":case"json":i="text"}return i}window.fileX={getExtension(e){return Ke(e)[1]},getName(e){return Ke(e)[0]},getFilename:Ke,getType:et,getTypeFromExtension:function(e){return Je(e)?"audio":Qe(e)?"video":Ze(e)?"image":Ge.has(e)?"text":void 0},getTypeFromFilename(e){return this.getTypeFromExtension(this.getExtension(e))},getMimeType:function(e){switch(e){case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"svg":return"image/svg";case"gif":return"image/gif";case"bz2":return"application/x-bzip2";case"gz":return"application/gzip";case"zip":return"application/zip";case"json":return"application/json";case"mp3":return"audio/mpeg";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"webm":return"video/webm"}},getDuration:function(e){return(((e=e)-(e%=60))/60+(9<e?":":":0")+e).split(".")[0]},getRating:function(e){return Math.floor((e.rating||0)/10).toString()},getDescriptionFromMeta:function(t){if(!t.meta){let e="";return t.artist&&(e+=t.artist),t.album&&(e&&(e+=" - "),e+=t.album),t.year&&(e+=` (${t.year})`),(e=e.trim())||"Unknown"}let e="";return t=t.meta,e=t.album?t.year?t.album+" - "+t.year:t.album:e},getTitleFromMeta:function(e,t=!0){var i=e.title||e.name||e.filename||e.file.name;if(!e.meta)return fileX.getName(i);let a;if((e=e.meta).title)a=e.artist&&t?e.title+" - "+e.artist:e.title;else{if(!e.artist)return fileX.getName(i);a=e.artist}return a},isImage:Ze,isAudio:Je,isVideo:Qe,isMedia:function(e){return Je(e)||Qe(e)},formatSize:function(e){if(e<1024)return e.toString()+" B";let t,i;return t=e<1048576?(i=e/1024,"K"):(i=e/1048576,"M"),`${(i=i.toFixed(1)).endsWith(".0")?i.slice(0,-2):i} `+t},readFile:function(a){return new Promise((t,e)=>{const i=new FileReader;i.onerror=e,i.onload=()=>{var e=i.result;t(e)},i.readAsText(a)})},getFileType(e){return e.type?et(e.type):this.getTypeFromFilename(e.name)},getMeta:async function(t){let e,i={};var[a,s]=Ke(t.name);if((e=a.match(/^\s*(\d{1,2})[\s-_.]*(.*)(\.\w+)?$/))&&(i={title:e[2],track:parseInt(e[1])}),"mp3"==s)try{var r=await function(e){if(Xe)return Ye(new Ve(e));throw new Error("Browser does not have support for the File API and/or ArrayBuffers")}(t);if(r){var n=Object.fromEntries(Object.entries(r).filter(([,e])=>null!=e));if(n.track&&"string"==typeof n.track){const e=r.track.match(/^([0-9]{1,2}).*/);e&&(n.track=parseInt(e[1]))}Object.assign(i,n)}}catch(e){t.name}return i},getSize:function(e){return size(e.size||e.file.size)},getTitle:function(e){var t;return e.title||(e.meta&&e.meta.title?e.meta.title:(t=(e=e.name||e.file.name).match(/^\s*(\d{1,2})[\s-_.]*(.*)(\.\w+)?$/))?t[2]:([t]=Ke(e),t))},getAlbum:function(e){return e.meta&&e.meta.album?e.meta.album:""}};const tt=0,it=1;function at(e){let t=e.length;for(;0<=--t;)e[t]=0}const st=29,rt=256,nt=rt+1+st,ot=30,lt=19,ct=2*nt+1,ht=15,ut=16,pt=7,mt=256,gt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ft=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),vt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),wt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);const yt=new Array(2*(nt+2)),bt=(at(yt),new Array(2*ot)),kt=(at(bt),new Array(512)),_t=(at(kt),new Array(256)),xt=(at(_t),new Array(st)),Ct=(at(xt),new Array(ot));function Et(e,t,i,a,s){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=a,this.max_length=s,this.has_stree=e&&e.length}at(Ct);let St,Tt,At;function Lt(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const jt=e=>e<256?kt[e]:kt[256+(e>>>7)],Mt=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},d=(e,t,i)=>{e.bi_valid>ut-i?(e.bi_buf|=t<<e.bi_valid&65535,Mt(e,e.bi_buf),e.bi_buf=t>>ut-e.bi_valid,e.bi_valid+=i-ut):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},It=(e,t,i)=>{d(e,i[2*t],i[2*t+1])},Dt=(e,t)=>{let i=0;for(;i|=1&e,e>>>=1,i<<=1,0<--t;);return i>>>1},Ot=(e,t)=>{var i,a=t.dyn_tree,s=t.max_code,r=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length;let d,h,u,p,m,g=0;for(p=0;p<=ht;p++)e.bl_count[p]=0;for(a[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<ct;d++)h=e.heap[d],(p=a[2*a[2*h+1]+1]+1)>c&&(p=c,g++),a[2*h+1]=p,h>s||(e.bl_count[p]++,m=0,h>=l&&(m=o[h-l]),i=a[2*h],e.opt_len+=i*(p+m),n&&(e.static_len+=i*(r[2*h+1]+m)));if(0!==g){do{for(p=c-1;0===e.bl_count[p];)p--}while(e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[c]--,0<(g-=2));for(p=c;0!==p;p--)for(h=e.bl_count[p];0!==h;)s<(u=e.heap[--d])||(a[2*u+1]!==p&&(e.opt_len+=(p-a[2*u+1])*a[2*u],a[2*u+1]=p),h--)}},Pt=(e,t,i)=>{var a=new Array(ht+1);let s=0,r,n;for(r=1;r<=ht;r++)a[r]=s=s+i[r-1]<<1;for(n=0;n<=t;n++){var o=e[2*n+1];0!==o&&(e[2*n]=Dt(a[o]++,o))}},Rt=e=>{let t;for(t=0;t<nt;t++)e.dyn_ltree[2*t]=0;for(t=0;t<ot;t++)e.dyn_dtree[2*t]=0;for(t=0;t<lt;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*mt]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},zt=e=>{8<e.bi_valid?Mt(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Bt=(e,t,i,a)=>{var s=2*t,r=2*i;return e[s]<e[r]||e[s]===e[r]&&a[t]<=a[i]},Nt=(e,t,i)=>{var a=e.heap[i];let s=i<<1;for(;s<=e.heap_len&&(s<e.heap_len&&Bt(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!Bt(t,a,e.heap[s],e.depth));)e.heap[i]=e.heap[s],i=s,s<<=1;e.heap[i]=a},Ft=(e,t,i)=>{var a,s,r,n;let o=0;if(0!==e.last_lit)for(;a=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],s=e.pending_buf[e.l_buf+o],o++,0==a?It(e,s,t):(r=_t[s],It(e,r+rt+1,t),0!==(n=gt[r])&&(s-=xt[r],d(e,s,n)),a--,r=jt(a),It(e,r,i),0!==(n=ft[r])&&(a-=Ct[r],d(e,a,n))),o<e.last_lit;);It(e,mt,t)},qt=(e,t)=>{var i=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let n,o,l=-1,c;for(e.heap_len=0,e.heap_max=ct,n=0;n<r;n++)0!==i[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(c=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[c]=0,e.opt_len--,s&&(e.static_len-=a[2*c+1]);for(t.max_code=l,n=e.heap_len>>1;1<=n;n--)Nt(e,i,n);for(c=r;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Nt(e,i,1),o=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=o,i[2*c]=i[2*n]+i[2*o],e.depth[c]=(e.depth[n]>=e.depth[o]?e.depth[n]:e.depth[o])+1,i[2*n+1]=i[2*o+1]=c,e.heap[1]=c++,Nt(e,i,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],Ot(e,t),Pt(i,l,e.bl_count)},Ut=(e,t,i)=>{let a,s=-1;var r;let n=t[1],o=0,l=7,c=4;for(0===n&&(l=138,c=3),t[2*(i+1)+1]=65535,a=0;a<=i;a++)r=n,n=t[2*(a+1)+1],++o<l&&r===n||(o<c?e.bl_tree[2*r]+=o:0!==r?(r!==s&&e.bl_tree[2*r]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=r,c=0===n?(l=138,3):r===n?(l=6,3):(l=7,4))},$t=(e,t,i)=>{let a,s=-1;var r;let n=t[1],o=0,l=7,c=4;for(0===n&&(l=138,c=3),a=0;a<=i;a++)if(r=n,n=t[2*(a+1)+1],!(++o<l&&r===n)){if(o<c)for(;It(e,r,e.bl_tree),0!=--o;);else 0!==r?(r!==s&&(It(e,r,e.bl_tree),o--),It(e,16,e.bl_tree),d(e,o-3,2)):o<=10?(It(e,17,e.bl_tree),d(e,o-3,3)):(It(e,18,e.bl_tree),d(e,o-11,7));o=0,s=r,c=0===n?(l=138,3):r===n?(l=6,3):(l=7,4)}};let Ht=!1;const Wt=(e,t,i,a)=>{d(e,0+(a?1:0),3),a=e,e=t,t=i,i=!0,zt(a),i&&(Mt(a,t),Mt(a,~t)),a.pending_buf.set(a.window.subarray(e,e+t),a.pending),a.pending+=t};var a={_tr_init:e=>{if(!Ht){{let e,t,i,a,s;var r=new Array(ht+1);for(i=0,a=0;a<st-1;a++)for(xt[a]=i,e=0;e<1<<gt[a];e++)_t[i++]=a;for(_t[i-1]=a,s=0,a=0;a<16;a++)for(Ct[a]=s,e=0;e<1<<ft[a];e++)kt[s++]=a;for(s>>=7;a<ot;a++)for(Ct[a]=s<<7,e=0;e<1<<ft[a]-7;e++)kt[256+s++]=a;for(t=0;t<=ht;t++)r[t]=0;for(e=0;e<=143;)yt[2*e+1]=8,e++,r[8]++;for(;e<=255;)yt[2*e+1]=9,e++,r[9]++;for(;e<=279;)yt[2*e+1]=7,e++,r[7]++;for(;e<=287;)yt[2*e+1]=8,e++,r[8]++;for(Pt(yt,nt+1,r),e=0;e<ot;e++)bt[2*e+1]=5,bt[2*e]=Dt(e,5);St=new Et(yt,gt,rt+1,nt,ht),Tt=new Et(bt,ft,0,ot,ht),At=new Et(new Array(0),vt,0,lt,pt)}Ht=!0}e.l_desc=new Lt(e.dyn_ltree,St),e.d_desc=new Lt(e.dyn_dtree,Tt),e.bl_desc=new Lt(e.bl_tree,At),e.bi_buf=0,e.bi_valid=0,Rt(e)},_tr_stored_block:Wt,_tr_flush_block:(t,i,a,e)=>{let s,r,n=0;if(0<t.level?(2===t.strm.data_type&&(t.strm.data_type=(e=>{let t=4093624447,i;for(i=0;i<=31;i++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*i])return tt;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return it;for(i=32;i<rt;i++)if(0!==e.dyn_ltree[2*i])return it;return tt})(t)),qt(t,t.l_desc),qt(t,t.d_desc),n=(e=>{let t;for(Ut(e,e.dyn_ltree,e.l_desc.max_code),Ut(e,e.dyn_dtree,e.d_desc.max_code),qt(e,e.bl_desc),t=lt-1;3<=t&&0===e.bl_tree[2*wt[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(t),s=t.opt_len+3+7>>>3,(r=t.static_len+3+7>>>3)<=s&&(s=r)):s=r=a+5,a+4<=s&&-1!==i)Wt(t,i,a,e);else if(4===t.strategy||r===s)d(t,2+(e?1:0),3),Ft(t,yt,bt);else{d(t,4+(e?1:0),3);{var o=t;i=t.l_desc.max_code+1;a=t.d_desc.max_code+1;var l=n+1;let e;for(d(o,i-257,5),d(o,a-1,5),d(o,l-4,4),e=0;e<l;e++)d(o,o.bl_tree[2*wt[e]+1],3);$t(o,o.dyn_ltree,i-1),$t(o,o.dyn_dtree,a-1)}Ft(t,t.dyn_ltree,t.dyn_dtree)}Rt(t),e&&zt(t)},_tr_tally:(e,t,i)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(_t[i]+rt+1)]++,e.dyn_dtree[2*jt(t)]++),e.last_lit===e.lit_bufsize-1),_tr_align:e=>{d(e,2,3),It(e,mt,yt),16===(e=e).bi_valid?(Mt(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},Vt=(e,t,i,a)=>{let s=65535&e|0,r=e>>>16&65535|0,n=0;for(;0!==i;){for(i-=n=2e3<i?2e3:i;s=s+t[a++]|0,r=r+s|0,--n;);s%=65521,r%=65521}return s|r<<16|0};const Xt=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var Y=(t,i,e,a)=>{var s=Xt,r=a+e;t^=-1;for(let e=a;e<r;e++)t=t>>>8^s[255&(t^i[e])];return-1^t},Yt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},t={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Gt,_tr_stored_block:Kt,_tr_flush_block:Zt,_tr_tally:Jt,_tr_align:Qt}=a,{Z_NO_FLUSH:ei,Z_PARTIAL_FLUSH:ti,Z_FULL_FLUSH:ii,Z_FINISH:ai,Z_BLOCK:si,Z_OK:ri,Z_STREAM_END:ni,Z_STREAM_ERROR:oi,Z_DATA_ERROR:li,Z_BUF_ERROR:ci,Z_DEFAULT_COMPRESSION:di,Z_FILTERED:hi,Z_HUFFMAN_ONLY:ui,Z_RLE:pi,Z_FIXED:mi,Z_DEFAULT_STRATEGY:gi,Z_UNKNOWN:fi,Z_DEFLATED:vi}=t,wi=9;const yi=286,bi=30,ki=19,_i=2*yi+1,xi=15,c=3,Ci=258,Ei=Ci+c+1,Si=42,Ti=113,o=1,Ai=2,Li=3,ji=4,Mi=(e,t)=>(e.msg=Yt[t],t),Ii=e=>(e<<1)-(4<e?9:0),Di=e=>{let t=e.length;for(;0<=--t;)e[t]=0};let Oi=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const Pi=e=>{var t=e.state;let i=t.pending;0!==(i=i>e.avail_out?e.avail_out:i)&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending)&&(t.pending_out=0)},h=(e,t)=>{Zt(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Pi(e.strm)},n=(e,t)=>{e.pending_buf[e.pending++]=t},Ri=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},zi=(e,t,i,a)=>{let s=e.avail_in;return 0===(s=s>a?a:s)?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),i),1===e.state.wrap?e.adler=Vt(e.adler,t,s,i):2===e.state.wrap&&(e.adler=Y(e.adler,t,s,i)),e.next_in+=s,e.total_in+=s,s)},Bi=(e,t)=>{let i=e.max_chain_length,a=e.strstart,s;var r;let n=e.prev_length,o=e.nice_match;var l=e.strstart>e.w_size-Ei?e.strstart-(e.w_size-Ei):0,c=e.window,d=e.w_mask,h=e.prev,u=e.strstart+Ci;let p=c[a+n-1],m=c[a+n];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(s=t)+n]===m&&c[s+n-1]===p&&c[s]===c[a]&&c[++s]===c[a+1]){for(a+=2,s++;c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&c[++a]===c[++s]&&a<u;);if(r=Ci-(u-a),a=u-Ci,r>n){if(e.match_start=t,(n=r)>=o)break;p=c[a+n-1],m=c[a+n]}}}while((t=h[t&d])>l&&0!=--i);return n<=e.lookahead?n:e.lookahead},Ni=e=>{var t=e.w_size;let i,a,s,r,n;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ei)){for(e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,a=e.hash_size,i=a;s=e.head[--i],e.head[i]=s>=t?s-t:0,--a;);for(a=t,i=a;s=e.prev[--i],e.prev[i]=s>=t?s-t:0,--a;);r+=t}if(0===e.strm.avail_in)break;if(a=zi(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=a,e.lookahead+e.insert>=c)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=Oi(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=Oi(e,e.ins_h,e.window[n+c-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<c)););}while(e.lookahead<Ei&&0!==e.strm.avail_in)};var a=(e,t)=>{let i,a;for(;;){if(e.lookahead<Ei){if(Ni(e),e.lookahead<Ei&&t===ei)return o;if(0===e.lookahead)break}if(i=0,e.lookahead>=c&&(e.ins_h=Oi(e,e.ins_h,e.window[e.strstart+c-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-Ei&&(e.match_length=Bi(e,i)),e.match_length>=c)if(a=Jt(e,e.strstart-e.match_start,e.match_length-c),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=c){for(e.match_length--;e.strstart++,e.ins_h=Oi(e,e.ins_h,e.window[e.strstart+c-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Oi(e,e.ins_h,e.window[e.strstart+1]);else a=Jt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(h(e,!1),0===e.strm.avail_out))return o}return e.insert=e.strstart<c-1?e.strstart:c-1,t===ai?(h(e,!0),0===e.strm.avail_out?Li:ji):e.last_lit&&(h(e,!1),0===e.strm.avail_out)?o:Ai},m=(e,t)=>{let i,a;for(var s;;){if(e.lookahead<Ei){if(Ni(e),e.lookahead<Ei&&t===ei)return o;if(0===e.lookahead)break}if(i=0,e.lookahead>=c&&(e.ins_h=Oi(e,e.ins_h,e.window[e.strstart+c-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=c-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Ei&&(e.match_length=Bi(e,i),e.match_length<=5)&&(e.strategy===hi||e.match_length===c&&4096<e.strstart-e.match_start)&&(e.match_length=c-1),e.prev_length>=c&&e.match_length<=e.prev_length){for(s=e.strstart+e.lookahead-c,a=Jt(e,e.strstart-1-e.prev_match,e.prev_length-c),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=s&&(e.ins_h=Oi(e,e.ins_h,e.window[e.strstart+c-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=c-1,e.strstart++,a&&(h(e,!1),0===e.strm.avail_out))return o}else if(e.match_available){if((a=Jt(e,0,e.window[e.strstart-1]))&&h(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return o}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=Jt(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<c-1?e.strstart:c-1,t===ai?(h(e,!0),0===e.strm.avail_out?Li:ji):e.last_lit&&(h(e,!1),0===e.strm.avail_out)?o:Ai};function Fi(e,t,i,a,s){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=a,this.func=s}const qi=[new Fi(0,0,0,0,(e,t)=>{let i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Ni(e),0===e.lookahead&&t===ei)return o;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var a=e.block_start+i;if((0===e.strstart||e.strstart>=a)&&(e.lookahead=e.strstart-a,e.strstart=a,h(e,!1),0===e.strm.avail_out))return o;if(e.strstart-e.block_start>=e.w_size-Ei&&(h(e,!1),0===e.strm.avail_out))return o}return e.insert=0,t===ai?(h(e,!0),0===e.strm.avail_out?Li:ji):(e.strstart>e.block_start&&(h(e,!1),e.strm.avail_out),o)}),new Fi(4,4,8,4,a),new Fi(4,5,16,8,a),new Fi(4,6,32,32,a),new Fi(4,4,16,16,m),new Fi(8,16,32,32,m),new Fi(8,16,128,128,m),new Fi(8,32,128,256,m),new Fi(32,128,258,1024,m),new Fi(32,258,258,4096,m)];function Ui(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=vi,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*_i),this.dyn_dtree=new Uint16Array(2*(2*bi+1)),this.bl_tree=new Uint16Array(2*(2*ki+1)),Di(this.dyn_ltree),Di(this.dyn_dtree),Di(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(xi+1),this.heap=new Uint16Array(2*yi+1),Di(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*yi+1),Di(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const $i=e=>{if(!e||!e.state)return Mi(e,oi);e.total_in=e.total_out=0,e.data_type=fi;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?Si:Ti,e.adler=2===t.wrap?0:1,t.last_flush=ei,Gt(t),ri},Hi=e=>{var t=$i(e);return t===ri&&((e=e.state).window_size=2*e.w_size,Di(e.head),e.max_lazy_match=qi[e.level].max_lazy,e.good_match=qi[e.level].good_length,e.nice_match=qi[e.level].nice_length,e.max_chain_length=qi[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=c-1,e.match_available=0,e.ins_h=0),t};const Wi=(e,t,i,a,s,r)=>{if(!e)return oi;let n=1;if(t===di&&(t=6),a<0?(n=0,a=-a):15<a&&(n=2,a-=16),s<1||s>wi||i!==vi||a<8||15<a||t<0||9<t||r<0||r>mi)return Mi(e,oi);8===a&&(a=9);var o=new Ui;return(e.state=o).strm=e,o.wrap=n,o.gzhead=null,o.w_bits=a,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+c-1)/c),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=r,o.method=i,Hi(e)};var Vi={deflateInit:(e,t)=>Wi(e,t,vi,15,8,gi),deflateInit2:Wi,deflateReset:Hi,deflateResetKeep:$i,deflateSetHeader:(e,t)=>!e||!e.state||2!==e.state.wrap?oi:(e.state.gzhead=t,ri),deflate:(i,e)=>{let t,a;if(!i||!i.state||e>si||e<0)return i?Mi(i,oi):oi;var s=i.state;if(!i.output||!i.input&&0!==i.avail_in||666===s.status&&e!==ai)return Mi(i,0===i.avail_out?ci:oi);s.strm=i;var r=s.last_flush;if(s.last_flush=e,s.status===Si)if(2===s.wrap)i.adler=0,n(s,31),n(s,139),n(s,8),s.gzhead?(n(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),n(s,255&s.gzhead.time),n(s,s.gzhead.time>>8&255),n(s,s.gzhead.time>>16&255),n(s,s.gzhead.time>>24&255),n(s,9===s.level?2:s.strategy>=ui||s.level<2?4:0),n(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(n(s,255&s.gzhead.extra.length),n(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(i.adler=Y(i.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(n(s,0),n(s,0),n(s,0),n(s,0),n(s,0),n(s,9===s.level?2:s.strategy>=ui||s.level<2?4:0),n(s,3),s.status=Ti);else{let e=vi+(s.w_bits-8<<4)<<8,t=-1;t=s.strategy>=ui||s.level<2?0:s.level<6?1:6===s.level?2:3,e|=t<<6,0!==s.strstart&&(e|=32),e+=31-e%31,s.status=Ti,Ri(s,e),0!==s.strstart&&(Ri(s,i.adler>>>16),Ri(s,65535&i.adler)),i.adler=1}if(69===s.status)if(s.gzhead.extra){for(t=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>t&&(i.adler=Y(i.adler,s.pending_buf,s.pending-t,t)),Pi(i),t=s.pending,s.pending!==s.pending_buf_size));)n(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>t&&(i.adler=Y(i.adler,s.pending_buf,s.pending-t,t)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){t=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>t&&(i.adler=Y(i.adler,s.pending_buf,s.pending-t,t)),Pi(i),t=s.pending,s.pending===s.pending_buf_size)){a=1;break}}while(a=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,n(s,a),0!==a);s.gzhead.hcrc&&s.pending>t&&(i.adler=Y(i.adler,s.pending_buf,s.pending-t,t)),0===a&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){t=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>t&&(i.adler=Y(i.adler,s.pending_buf,s.pending-t,t)),Pi(i),t=s.pending,s.pending===s.pending_buf_size)){a=1;break}}while(a=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,n(s,a),0!==a);s.gzhead.hcrc&&s.pending>t&&(i.adler=Y(i.adler,s.pending_buf,s.pending-t,t)),0===a&&(s.status=103)}else s.status=103;if(103===s.status&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&Pi(i),s.pending+2<=s.pending_buf_size&&(n(s,255&i.adler),n(s,i.adler>>8&255),i.adler=0,s.status=Ti)):s.status=Ti),0!==s.pending){if(Pi(i),0===i.avail_out)return s.last_flush=-1,ri}else if(0===i.avail_in&&Ii(e)<=Ii(r)&&e!==ai)return Mi(i,ci);if(666===s.status&&0!==i.avail_in)return Mi(i,ci);if(0!==i.avail_in||0!==s.lookahead||e!==ei&&666!==s.status){r=s.strategy===ui?((e,t)=>{for(var i;;){if(0===e.lookahead&&(Ni(e),0===e.lookahead)){if(t===ei)return o;break}if(e.match_length=0,i=Jt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(h(e,!1),0===e.strm.avail_out))return o}return e.insert=0,t===ai?(h(e,!0),0===e.strm.avail_out?Li:ji):e.last_lit&&(h(e,!1),0===e.strm.avail_out)?o:Ai})(s,e):s.strategy===pi?((e,t)=>{let i;var a;let s,r;for(var n=e.window;;){if(e.lookahead<=Ci){if(Ni(e),e.lookahead<=Ci&&t===ei)return o;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=c&&0<e.strstart&&(a=n[s=e.strstart-1])===n[++s]&&a===n[++s]&&a===n[++s]){for(r=e.strstart+Ci;a===n[++s]&&a===n[++s]&&a===n[++s]&&a===n[++s]&&a===n[++s]&&a===n[++s]&&a===n[++s]&&a===n[++s]&&s<r;);e.match_length=Ci-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=c?(i=Jt(e,1,e.match_length-c),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=Jt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(h(e,!1),0===e.strm.avail_out))return o}return e.insert=0,t===ai?(h(e,!0),0===e.strm.avail_out?Li:ji):e.last_lit&&(h(e,!1),0===e.strm.avail_out)?o:Ai})(s,e):qi[s.level].func(s,e);if(r!==Li&&r!==ji||(s.status=666),r===o||r===Li)return 0===i.avail_out&&(s.last_flush=-1),ri;if(r===Ai&&(e===ti?Qt(s):e!==si&&(Kt(s,0,0,!1),e===ii)&&(Di(s.head),0===s.lookahead)&&(s.strstart=0,s.block_start=0,s.insert=0),Pi(i),0===i.avail_out))return s.last_flush=-1,ri}return e!==ai||!(s.wrap<=0)&&(2===s.wrap?(n(s,255&i.adler),n(s,i.adler>>8&255),n(s,i.adler>>16&255),n(s,i.adler>>24&255),n(s,255&i.total_in),n(s,i.total_in>>8&255),n(s,i.total_in>>16&255),n(s,i.total_in>>24&255)):(Ri(s,i.adler>>>16),Ri(s,65535&i.adler)),Pi(i),0<s.wrap&&(s.wrap=-s.wrap),0!==s.pending)?ri:ni},deflateEnd:e=>{var t;return e&&e.state?(t=e.state.status)!==Si&&69!==t&&73!==t&&91!==t&&103!==t&&t!==Ti&&666!==t?Mi(e,oi):(e.state=null,t===Ti?Mi(e,li):ri):oi},deflateSetDictionary:(e,t)=>{let i=t.length;if(!e||!e.state)return oi;var a=e.state,s=a.wrap;if(2===s||1===s&&a.status!==Si||a.lookahead)return oi;1===s&&(e.adler=Vt(e.adler,t,i,0)),a.wrap=0,i>=a.w_size&&(0===s&&(Di(a.head),a.strstart=0,a.block_start=0,a.insert=0),(r=new Uint8Array(a.w_size)).set(t.subarray(i-a.w_size,i),0),t=r,i=a.w_size);var r=e.avail_in,n=e.next_in,o=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Ni(a);a.lookahead>=c;){let e=a.strstart,t=a.lookahead-(c-1);for(;a.ins_h=Oi(a,a.ins_h,a.window[e+c-1]),a.prev[e&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=e,e++,--t;);a.strstart=e,a.lookahead=c-1,Ni(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=c-1,a.match_available=0,e.next_in=n,e.input=o,e.avail_in=r,a.wrap=s,ri},deflateInfo:"pako deflate (from Nodeca project)"};var Xi=function(e){for(var t,i,a=Array.prototype.slice.call(arguments,1);a.length;){var s=a.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const r in s)t=s,i=r,Object.prototype.hasOwnProperty.call(t,i)&&(e[r]=s[r])}}return e},Yi=a=>{let i=0;for(let e=0,t=a.length;e<t;e++)i+=a[e].length;var s=new Uint8Array(i);for(let e=0,t=0,i=a.length;e<i;e++){var r=a[e];s.set(r,t),t+=r.length}return s};let Gi=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Gi=!1}const Ki=new Uint8Array(256);for(let e=0;e<256;e++)Ki[e]=252<=e?6:248<=e?5:240<=e?4:224<=e?3:192<=e?2:1;Ki[254]=Ki[254]=1;var Zi=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,a,s,r,n=e.length,o=0;for(s=0;s<n;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<n&&56320==(64512&(a=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(a-56320),s++),o+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(o),r=0,s=0;r<o;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<n&&56320==(64512&(a=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(a-56320),s++),i<128?t[r++]=i:(i<2048?t[r++]=192|i>>>6:(i<65536?t[r++]=224|i>>>12:(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63),t[r++]=128|i>>>6&63),t[r++]=128|63&i);return t},Ji=(i,e)=>{var a=e||i.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(i.subarray(0,e));let s,r;var n=new Array(2*a);for(r=0,s=0;s<a;){let t=i[s++];if(t<128)n[r++]=t;else{let e=Ki[t];if(4<e)n[r++]=65533,s+=e-1;else{for(t&=2===e?31:3===e?15:7;1<e&&s<a;)t=t<<6|63&i[s++],e--;1<e?n[r++]=65533:t<65536?n[r++]=t:(t-=65536,n[r++]=55296|t>>10&1023,n[r++]=56320|1023&t)}}}{var o=n,l=r;if(l<65534&&o.subarray&&Gi)return String.fromCharCode.apply(null,o.length===l?o:o.subarray(0,l));let t="";for(let e=0;e<l;e++)t+=String.fromCharCode(o[e]);return t}},Qi=(e,t)=>{let i=(t=(t=t||e.length)>e.length?e.length:t)-1;for(;0<=i&&128==(192&e[i]);)i--;return!(i<0)&&0!==i&&i+Ki[e[i]]>t?i:t};var ea=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ta=Object.prototype.toString,{Z_NO_FLUSH:ia,Z_SYNC_FLUSH:aa,Z_FULL_FLUSH:sa,Z_FINISH:ra,Z_OK:na,Z_STREAM_END:oa,Z_DEFAULT_COMPRESSION:la,Z_DEFAULT_STRATEGY:ca,Z_DEFLATED:da}=t;function ha(t){this.options=Xi({level:la,method:da,chunkSize:16384,windowBits:15,memLevel:8,strategy:ca},t||{});var t=this.options,i=(t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ea,this.strm.avail_out=0,Vi.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy));if(i!==na)throw new Error(Yt[i]);if(t.header&&Vi.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Zi(t.dictionary):"[object ArrayBuffer]"===ta.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=Vi.deflateSetDictionary(this.strm,e))!==na)throw new Error(Yt[i]);this._dict_set=!0}}function ua(e,t){t=new ha(t);if(t.push(e,!0),t.err)throw t.msg||Yt[t.err];return t.result}ha.prototype.push=function(e,t){var i=this.strm,a=this.options.chunkSize;let s,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?ra:ia,"string"==typeof e?i.input=Zi(e):"[object ArrayBuffer]"===ta.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),(r===aa||r===sa)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(Vi.deflate(i,r)===oa)return 0<i.next_out&&this.onData(i.output.subarray(0,i.next_out)),s=Vi.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===na;if(0===i.avail_out)this.onData(i.output);else if(0<r&&0<i.next_out)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}return!0},ha.prototype.onData=function(e){this.chunks.push(e)},ha.prototype.onEnd=function(e){e===na&&(this.result=Yi(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};a={Deflate:ha,deflate:ua,deflateRaw:function(e,t){return(t=t||{}).raw=!0,ua(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,ua(e,t)},constants:t};const pa=30,ma=12;const ga=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),fa=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),va=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),wa=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ya=(e,t,i,a,s,r,n,o)=>{var l,c=o.bits;let d=0,h=0,u=0,p=0,m=0,g=0,f=0,v=0,w=0,y=0,b,k,_,x,C=null,E=0,S;var T=new Uint16Array(16),A=new Uint16Array(16);let L=null,j=0,M,I,D;for(d=0;d<=15;d++)T[d]=0;for(h=0;h<a;h++)T[t[i+h]]++;for(m=c,p=15;1<=p&&0===T[p];p--);if(m>p&&(m=p),0===p)s[r++]=20971520,s[r++]=20971520,o.bits=1;else{for(u=1;u<p&&0===T[u];u++);for(m<u&&(m=u),v=1,d=1;d<=15;d++)if((v=(v<<=1)-T[d])<0)return-1;if(0<v&&(0===e||1!==p))return-1;for(A[1]=0,d=1;d<15;d++)A[d+1]=A[d]+T[d];for(h=0;h<a;h++)0!==t[i+h]&&(n[A[t[i+h]]++]=h);if(S=0===e?(C=L=n,19):1===e?(C=ga,E-=257,L=fa,j-=257,256):(C=va,L=wa,-1),y=0,h=0,d=u,x=r,g=m,f=0,_=-1,l=(w=1<<m)-1,1===e&&852<w||2===e&&592<w)return 1;for(;;){for(M=d-f,D=n[h]<S?(I=0,n[h]):n[h]>S?(I=L[j+n[h]],C[E+n[h]]):(I=96,0),b=1<<d-f,k=1<<g,u=k;k-=b,s[x+(y>>f)+k]=M<<24|I<<16|D|0,0!==k;);for(b=1<<d-1;y&b;)b>>=1;if(y=0!==b?(y&=b-1)+b:0,h++,0==--T[d]){if(d===p)break;d=t[i+n[h]]}if(d>m&&(y&l)!==_){for(0===f&&(f=m),x+=u,g=d-f,v=1<<g;g+f<p&&!((v-=T[g+f])<=0);)g++,v<<=1;if(w+=1<<g,1===e&&852<w||2===e&&592<w)return 1;s[_=y&l]=m<<24|g<<16|x-r|0}}0!==y&&(s[x+y]=d-f<<24|64<<16|0),o.bits=m}return 0};const ba=1,ka=2,{Z_FINISH:_a,Z_BLOCK:xa,Z_TREES:Ca,Z_OK:Ea,Z_STREAM_END:Sa,Z_NEED_DICT:Ta,Z_STREAM_ERROR:Aa,Z_DATA_ERROR:La,Z_MEM_ERROR:ja,Z_BUF_ERROR:Ma,Z_DEFLATED:Ia}=t,Da=1,Oa=852,Pa=592;const Ra=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function za(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ba=e=>{var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Da,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(Oa),t.distcode=t.distdyn=new Int32Array(Pa),t.sane=1,t.back=-1,Ea):Aa},Na=e=>{var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,Ba(e)):Aa},Fa=(e,t)=>{let i;var a;return!e||!e.state||(a=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t))?Aa:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=i,a.wbits=t,Na(e))},qa=(e,t)=>{var i;return e?(i=new za,(e.state=i).window=null,(i=Fa(e,t))!==Ea&&(e.state=null),i):Aa};let Ua=!0,$a,Ha;const Wa=(e,t,i,a)=>{let s;e=e.state;return null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new Uint8Array(e.wsize)),a>=e.wsize?(e.window.set(t.subarray(i-e.wsize,i),0),e.wnext=0,e.whave=e.wsize):((s=e.wsize-e.wnext)>a&&(s=a),e.window.set(t.subarray(i-a,i-a+s),e.wnext),(a-=s)?(e.window.set(t.subarray(i-a,i),0),e.wnext=a,e.whave=e.wsize):(e.wnext+=s,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=s))),0};var Va={inflateReset:Na,inflateReset2:Fa,inflateResetKeep:Ba,inflateInit:e=>qa(e,15),inflateInit2:qa,inflate:(c,e)=>{var t;let i,a,s,r,n,o,l,d,h,u,p,R,z,m=0,g,f,v,w,y,b,k,_;var x=new Uint8Array(4);let C,E;var S,B,T,N,F,q,A,L,U,$,H,W,j,M,I,V=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!c||!c.state||!c.output||!c.input&&0!==c.avail_in)return Aa;12===(t=c.state).mode&&(t.mode=13),r=c.next_out,a=c.output,o=c.avail_out,s=c.next_in,i=c.input,n=c.avail_in,l=t.hold,d=t.bits,h=n,u=o,_=Ea;e:for(;;)switch(t.mode){case Da:if(0===t.wrap)t.mode=13;else{for(;d<16;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}if(2&t.wrap&&35615===l)x[t.check=0]=255&l,x[1]=l>>>8&255,t.check=Y(t.check,x,2,0),l=0,d=0,t.mode=2;else if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&l)<<8)+(l>>8))%31)c.msg="incorrect header check",t.mode=30;else if((15&l)!==Ia)c.msg="unknown compression method",t.mode=30;else{if(l>>>=4,d-=4,k=8+(15&l),0===t.wbits)t.wbits=k;else if(k>t.wbits){c.msg="invalid window size",t.mode=30;break}t.dmax=1<<t.wbits,c.adler=t.check=1,t.mode=512&l?10:12,l=0,d=0}}break;case 2:for(;d<16;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}if(t.flags=l,(255&t.flags)!==Ia){c.msg="unknown compression method",t.mode=30;break}if(57344&t.flags){c.msg="unknown header flags set",t.mode=30;break}t.head&&(t.head.text=l>>8&1),512&t.flags&&(x[0]=255&l,x[1]=l>>>8&255,t.check=Y(t.check,x,2,0)),l=0,d=0,t.mode=3;case 3:for(;d<32;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}t.head&&(t.head.time=l),512&t.flags&&(x[0]=255&l,x[1]=l>>>8&255,x[2]=l>>>16&255,x[3]=l>>>24&255,t.check=Y(t.check,x,4,0)),l=0,d=0,t.mode=4;case 4:for(;d<16;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}t.head&&(t.head.xflags=255&l,t.head.os=l>>8),512&t.flags&&(x[0]=255&l,x[1]=l>>>8&255,t.check=Y(t.check,x,2,0)),l=0,d=0,t.mode=5;case 5:if(1024&t.flags){for(;d<16;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}t.length=l,t.head&&(t.head.extra_len=l),512&t.flags&&(x[0]=255&l,x[1]=l>>>8&255,t.check=Y(t.check,x,2,0)),l=0,d=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&((p=(p=t.length)>n?n:p)&&(t.head&&(k=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(s,s+p),k)),512&t.flags&&(t.check=Y(t.check,i,p,s)),n-=p,s+=p,t.length-=p),t.length))break e;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(0===n)break e;for(p=0;k=i[s+p++],t.head&&k&&t.length<65536&&(t.head.name+=String.fromCharCode(k)),k&&p<n;);if(512&t.flags&&(t.check=Y(t.check,i,p,s)),n-=p,s+=p,k)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(0===n)break e;for(p=0;k=i[s+p++],t.head&&k&&t.length<65536&&(t.head.comment+=String.fromCharCode(k)),k&&p<n;);if(512&t.flags&&(t.check=Y(t.check,i,p,s)),n-=p,s+=p,k)break e}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;d<16;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}if(l!==(65535&t.check)){c.msg="header crc mismatch",t.mode=30;break}l=0,d=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),c.adler=t.check=0,t.mode=12;break;case 10:for(;d<32;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}c.adler=t.check=Ra(l),l=0,d=0,t.mode=11;case 11:if(0===t.havedict)return c.next_out=r,c.avail_out=o,c.next_in=s,c.avail_in=n,t.hold=l,t.bits=d,Ta;c.adler=t.check=1,t.mode=12;case 12:if(e===xa||e===Ca)break e;case 13:if(t.last)l>>>=7&d,d-=7&d,t.mode=27;else{for(;d<3;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}switch(t.last=1&l,l>>>=1,--d,3&l){case 0:t.mode=14;break;case 1:var D=t;if(Ua){$a=new Int32Array(512),Ha=new Int32Array(32);let e=0;for(;e<144;)D.lens[e++]=8;for(;e<256;)D.lens[e++]=9;for(;e<280;)D.lens[e++]=7;for(;e<288;)D.lens[e++]=8;for(ya(ba,D.lens,0,288,$a,0,D.work,{bits:9}),e=0;e<32;)D.lens[e++]=5;ya(ka,D.lens,0,32,Ha,0,D.work,{bits:5}),Ua=!1}if(D.lencode=$a,D.lenbits=9,D.distcode=Ha,D.distbits=5,t.mode=20,e!==Ca)break;l>>>=2,d-=2;break e;case 2:t.mode=17;break;case 3:c.msg="invalid block type",t.mode=30}l>>>=2,d-=2}break;case 14:for(l>>>=7&d,d-=7&d;d<32;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){c.msg="invalid stored block lengths",t.mode=30;break}if(t.length=65535&l,l=0,d=0,t.mode=15,e===Ca)break e;case 15:t.mode=16;case 16:if(p=t.length){if(0===(p=(p=p>n?n:p)>o?o:p))break e;a.set(i.subarray(s,s+p),r),n-=p,s+=p,o-=p,r+=p,t.length-=p}else t.mode=12;break;case 17:for(;d<14;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}if(t.nlen=257+(31&l),l>>>=5,d-=5,t.ndist=1+(31&l),l>>>=5,d-=5,t.ncode=4+(15&l),l>>>=4,d-=4,286<t.nlen||30<t.ndist){c.msg="too many length or distance symbols",t.mode=30;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;d<3;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}t.lens[V[t.have++]]=7&l,l>>>=3,d-=3}for(;t.have<19;)t.lens[V[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,C={bits:t.lenbits},_=ya(0,t.lens,0,19,t.lencode,0,t.work,C),t.lenbits=C.bits,_){c.msg="invalid code lengths set",t.mode=30;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;m=t.lencode[l&(1<<t.lenbits)-1],g=m>>>24,f=m>>>16&255,v=65535&m,!(g<=d);){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}if(v<16)l>>>=g,d-=g,t.lens[t.have++]=v;else{if(16===v){for(E=g+2;d<E;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}if(l>>>=g,d-=g,0===t.have){c.msg="invalid bit length repeat",t.mode=30;break}k=t.lens[t.have-1],p=3+(3&l),l>>>=2,d-=2}else if(17===v){for(E=g+3;d<E;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}l>>>=g,d-=g,k=0,p=3+(7&l),l>>>=3,d-=3}else{for(E=g+7;d<E;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}l>>>=g,d-=g,k=0,p=11+(127&l),l>>>=7,d-=7}if(t.have+p>t.nlen+t.ndist){c.msg="invalid bit length repeat",t.mode=30;break}for(;p--;)t.lens[t.have++]=k}}if(30===t.mode)break;if(0===t.lens[256]){c.msg="invalid code -- missing end-of-block",t.mode=30;break}if(t.lenbits=9,C={bits:t.lenbits},_=ya(ba,t.lens,0,t.nlen,t.lencode,0,t.work,C),t.lenbits=C.bits,_){c.msg="invalid literal/lengths set",t.mode=30;break}if(t.distbits=6,t.distcode=t.distdyn,C={bits:t.distbits},_=ya(ka,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,C),t.distbits=C.bits,_){c.msg="invalid distances set",t.mode=30;break}if(t.mode=20,e===Ca)break e;case 20:t.mode=21;case 21:if(6<=n&&258<=o){c.next_out=r,c.avail_out=o,c.next_in=s,c.avail_in=n,t.hold=l,t.bits=d;{S=void 0;B=void 0;T=void 0;N=void 0;F=void 0;q=void 0;A=void 0;L=void 0;U=void 0;$=void 0;H=void 0;W=void 0;j=void 0;M=void 0;I=void 0;P=void 0;var O=c;var X=u;let e;let t,i,a,s,r,n,o,l;var P=O.state;e=O.next_in,M=O.input,S=e+(O.avail_in-5),t=O.next_out,I=O.output,B=t-(X-O.avail_out),T=t+(O.avail_out-257),N=P.dmax,F=P.wsize,q=P.whave,A=P.wnext,L=P.window,i=P.hold,a=P.bits,U=P.lencode,$=P.distcode,H=(1<<P.lenbits)-1,W=(1<<P.distbits)-1;t:do{for(a<15&&(i+=M[e++]<<a,a+=8,i+=M[e++]<<a,a+=8),s=U[i&H];;){if(r=s>>>24,i>>>=r,a-=r,0===(r=s>>>16&255))I[t++]=65535&s;else{if(!(16&r)){if(0==(64&r)){s=U[(65535&s)+(i&(1<<r)-1)];continue}if(32&r){P.mode=ma;break t}O.msg="invalid literal/length code",P.mode=pa;break t}for(n=65535&s,(r&=15)&&(a<r&&(i+=M[e++]<<a,a+=8),n+=i&(1<<r)-1,i>>>=r,a-=r),a<15&&(i+=M[e++]<<a,a+=8,i+=M[e++]<<a,a+=8),s=$[i&W];;){if(r=s>>>24,i>>>=r,a-=r,!(16&(r=s>>>16&255))){if(0==(64&r)){s=$[(65535&s)+(i&(1<<r)-1)];continue}O.msg="invalid distance code",P.mode=pa;break t}if(j=65535&s,r&=15,a<r&&(i+=M[e++]<<a,(a+=8)<r)&&(i+=M[e++]<<a,a+=8),N<(j+=i&(1<<r)-1)){O.msg="invalid distance too far back",P.mode=pa;break t}if(i>>>=r,a-=r,j>(r=t-B)){if((r=j-r)>q&&P.sane){O.msg="invalid distance too far back",P.mode=pa;break t}if(o=0,l=L,0===A){if(o+=F-r,r<n){for(n-=r;I[t++]=L[o++],--r;);o=t-j,l=I}}else if(A<r){if(o+=F+A-r,(r-=A)<n){for(n-=r;I[t++]=L[o++],--r;);if(o=0,A<n){for(r=A,n-=r;I[t++]=L[o++],--r;);o=t-j,l=I}}}else if(o+=A-r,r<n){for(n-=r;I[t++]=L[o++],--r;);o=t-j,l=I}for(;2<n;)I[t++]=l[o++],I[t++]=l[o++],I[t++]=l[o++],n-=3;n&&(I[t++]=l[o++],1<n)&&(I[t++]=l[o++])}else{for(o=t-j;I[t++]=I[o++],I[t++]=I[o++],I[t++]=I[o++],2<(n-=3););n&&(I[t++]=I[o++],1<n)&&(I[t++]=I[o++])}break}}break}}while(e<S&&t<T);n=a>>3,e-=n,a-=n<<3,i&=(1<<a)-1,O.next_in=e,O.next_out=t,O.avail_in=e<S?S-e+5:5-(e-S),O.avail_out=t<T?T-t+257:257-(t-T),P.hold=i,P.bits=a}r=c.next_out,a=c.output,o=c.avail_out,s=c.next_in,i=c.input,n=c.avail_in,l=t.hold,d=t.bits,12===t.mode&&(t.back=-1);break}for(t.back=0;m=t.lencode[l&(1<<t.lenbits)-1],g=m>>>24,f=m>>>16&255,v=65535&m,!(g<=d);){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}if(f&&0==(240&f)){for(w=g,y=f,b=v;m=t.lencode[b+((l&(1<<w+y)-1)>>w)],g=m>>>24,f=m>>>16&255,v=65535&m,!(w+g<=d);){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}l>>>=w,d-=w,t.back+=w}if(l>>>=g,d-=g,t.back+=g,t.length=v,0===f){t.mode=26;break}if(32&f){t.back=-1,t.mode=12;break}if(64&f){c.msg="invalid literal/length code",t.mode=30;break}t.extra=15&f,t.mode=22;case 22:if(t.extra){for(E=t.extra;d<E;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,d-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;m=t.distcode[l&(1<<t.distbits)-1],g=m>>>24,f=m>>>16&255,v=65535&m,!(g<=d);){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}if(0==(240&f)){for(w=g,y=f,b=v;m=t.distcode[b+((l&(1<<w+y)-1)>>w)],g=m>>>24,f=m>>>16&255,v=65535&m,!(w+g<=d);){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}l>>>=w,d-=w,t.back+=w}if(l>>>=g,d-=g,t.back+=g,64&f){c.msg="invalid distance code",t.mode=30;break}t.offset=v,t.extra=15&f,t.mode=24;case 24:if(t.extra){for(E=t.extra;d<E;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,d-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){c.msg="invalid distance too far back",t.mode=30;break}t.mode=25;case 25:if(0===o)break e;if(p=u-o,t.offset>p){if((p=t.offset-p)>t.whave&&t.sane){c.msg="invalid distance too far back",t.mode=30;break}R=p>t.wnext?(p-=t.wnext,t.wsize-p):t.wnext-p,p>t.length&&(p=t.length),z=t.window}else z=a,R=r-t.offset,p=t.length;for(p>o&&(p=o),o-=p,t.length-=p;a[r++]=z[R++],--p;);0===t.length&&(t.mode=21);break;case 26:if(0===o)break e;a[r++]=t.length,o--,t.mode=21;break;case 27:if(t.wrap){for(;d<32;){if(0===n)break e;n--,l|=i[s++]<<d,d+=8}if(u-=o,c.total_out+=u,t.total+=u,u&&(c.adler=t.check=(t.flags?Y:Vt)(t.check,a,u,r-u)),u=o,(t.flags?l:Ra(l))!==t.check){c.msg="incorrect data check",t.mode=30;break}l=0,d=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;d<32;){if(0===n)break e;n--,l+=i[s++]<<d,d+=8}if(l!==(4294967295&t.total)){c.msg="incorrect length check",t.mode=30;break}l=0,d=0}t.mode=29;case 29:_=Sa;break e;case 30:_=La;break e;case 31:return ja;default:return Aa}return c.next_out=r,c.avail_out=o,c.next_in=s,c.avail_in=n,t.hold=l,t.bits=d,(t.wsize||u!==c.avail_out&&t.mode<30&&(t.mode<27||e!==_a))&&Wa(c,c.output,c.next_out,u-c.avail_out),h-=c.avail_in,u-=c.avail_out,c.total_in+=h,c.total_out+=u,t.total+=u,t.wrap&&u&&(c.adler=t.check=(t.flags?Y:Vt)(t.check,a,u,c.next_out-u)),c.data_type=t.bits+(t.last?64:0)+(12===t.mode?128:0)+(20===t.mode||15===t.mode?256:0),_=(0==h&&0===u||e===_a)&&_===Ea?Ma:_},inflateEnd:e=>{var t;return e&&e.state?((t=e.state).window&&(t.window=null),e.state=null,Ea):Aa},inflateGetHeader:(e,t)=>{return!e||!e.state||0==(2&(e=e.state).wrap)?Aa:((e.head=t).done=!1,Ea)},inflateSetDictionary:(e,t)=>{var i,a=t.length;return!e||!e.state||0!==(i=e.state).wrap&&11!==i.mode?Aa:11===i.mode&&Vt(1,t,a,0)!==i.check?La:Wa(e,t,a,a)?(i.mode=31,ja):(i.havedict=1,Ea)},inflateInfo:"pako inflate (from Nodeca project)"};var Xa=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ya=Object.prototype.toString,{Z_NO_FLUSH:Ga,Z_FINISH:Ka,Z_OK:Za,Z_STREAM_END:Ja,Z_NEED_DICT:Qa,Z_STREAM_ERROR:es,Z_DATA_ERROR:ts,Z_MEM_ERROR:is}=t;function as(e){this.options=Xi({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options,e=(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits)&&(t.windowBits=-15),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ea,this.strm.avail_out=0,Va.inflateInit2(this.strm,t.windowBits));if(e!==Za)throw new Error(Yt[e]);if(this.header=new Xa,Va.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Zi(t.dictionary):"[object ArrayBuffer]"===Ya.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw)&&(e=Va.inflateSetDictionary(this.strm,t.dictionary))!==Za)throw new Error(Yt[e])}function ss(e,t){t=new as(t);if(t.push(e),t.err)throw t.msg||Yt[t.err];return t.result}as.prototype.push=function(e,t){var i,a,s,r=this.strm,n=this.options.chunkSize,o=this.options.dictionary;let l,c,d;if(this.ended)return!1;for(c=t===~~t?t:!0===t?Ka:Ga,"[object ArrayBuffer]"===Ya.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(l=Va.inflate(r,c))===Qa&&o&&((l=Va.inflateSetDictionary(r,o))===Za?l=Va.inflate(r,c):l===ts&&(l=Qa));0<r.avail_in&&l===Ja&&0<r.state.wrap&&0!==e[r.next_in];)Va.inflateReset(r),l=Va.inflate(r,c);switch(l){case es:case ts:case Qa:case is:return this.onEnd(l),!(this.ended=!0)}if(d=r.avail_out,!r.next_out||0!==r.avail_out&&l!==Ja||("string"===this.options.to?(i=Qi(r.output,r.next_out),a=r.next_out-i,s=Ji(r.output,i),r.next_out=a,r.avail_out=n-a,a&&r.output.set(r.output.subarray(i,i+a),0),this.onData(s)):this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out))),l!==Za||0!==d){if(l===Ja)return l=Va.inflateEnd(this.strm),this.onEnd(l),this.ended=!0;if(0===r.avail_in)break}}return!0},as.prototype.onData=function(e){this.chunks.push(e)},as.prototype.onEnd=function(e){e===Za&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Yi(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var{Deflate:m,deflate:a,deflateRaw:rs,gzip:g}=a,{Inflate:ns,inflate:os,inflateRaw:ls,ungzip:cs}={Inflate:as,inflate:ss,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ss(e,t)},ungzip:ss};const ds={Deflate:m,deflate:a,deflateRaw:rs,gzip:g,Inflate:ns,inflate:os,inflateRaw:ls,ungzip:cs,constants:t};Object.assign(window,{unzip(e,t={to:"string"}){return ds.inflate(e,t)},zip(e){let t=e;return"string"==typeof e&&(t=new TextEncoder("utf-8").encode(e)),ds.deflate(t)}});__webpack_require__(830);var hs=2,us={maxCacheSize:100,maxCacheTime:864e5,warnIfItemPurgedBeforeTime:5e3,opLimit:200,scanLimit:50};function ps(){return(ps=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,a=arguments[t];for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}function ms(e){return Ss(e,{maxCacheSize:Ls(e.maxCacheSize),maxCacheTime:Ls(e.maxCacheTime),opLimit:Ls(e.opLimit)}),e}function gs(e,t){return Ms(e),ms(Ss(e.options,t))}function vs(e){var t;return js(e)?(Ms(t=e),t):(t=ms(ps({},us,e)),Ps({limitedCacheMetaVersion:hs,options:t}))}function ws(r){Ms(r);var n=r.cache,e=r.keyList,o=r.keyInfo,l=As(),t=(e=e.reduce(function(e,t){var i=e[0],a=e[1],s=e[2];return Ds(r,t,l)||(i[t]=n[t],a.push(t),s[t]=o[t]),e},[{},[],Es(null)]))[0],i=e[1],e=e[2];return Ss(r,{cache:t,keyList:i,keyInfo:e,opsLeft:r.options.opLimit})}function ys(e,t){Ms(e);var i=e.cache;if(Ts.call(i,t)&&void 0!==i[t]){if(!Ds(e,t,As()))return!0;i[t]=void 0}return!1}function bs(e,t){if(Ms(e),ys(e,t))return e.cache[t]}function ks(e){return Ms(e),ws(e),e.cache}function _s(e,t,i){Ms(e);var a=e.options.maxCacheSize,s=e.keyList,r=e.keyInfo,n=As(),o=!r[t];if(e.cache[t]!==i&&(e.cache=ps({},e.cache,((d={})[t]=i,d))),r[t]=[n,0],o&&(s.push(t),e.opsLeft--,e.opsLeft<=0&&ws(e),a)&&e.keyList.length>a){var l=e,c=n,i=l.options,d=i.scanLimit,h=(i.warnIfItemPurgedBeforeTime,l.cache,l.keyList),u=(l.keyInfo,0),p=Is(l,h[0]);if(c<p)for(var m=0,g=Math.min(h.length,d);m<g;){var f=h[m],f=Is(l,f);if(f<c){u=m,p=0;break}f<p&&(u=m,p=f),m+=1}Os(l,u,c)}return Ds(e,s[0],n)&&Os(e,0,n),e}function xs(e,t){Ms(e);var i=e.cache,a=e.keyInfo;return a[t]&&(void 0!==i[t]&&(e.cache=ps({},i,((i={})[t]=void 0,i))),a[t]=void 0),e}function Cs(e,t){return e.bind(null,t)}var Es=Object.create,Ss=Object.assign,Ts=Object.prototype.hasOwnProperty,As=Date.now,Ls=function(e){return Math.max(e,0)||0},js=function(e){return!!e&&!!e.limitedCacheMetaVersion},Ms=function(e){if(!js(e))throw new Error("Limited-cache metadata is missing: please check your usage");e.limitedCacheMetaVersion!==hs&&(console.warn("Limited-cache metadata is from an incompatible version (1). It must be reset."),e.limitedCacheMetaVersion=hs,Ps(e))},Is=function(e,t){var i=e.options.maxCacheTime,e=e.keyInfo[t];return e?(t=e[0],e[1]||t+(i||31536e6)):0},Ds=function(e,t,i){return Is(e,t)<i},Os=function(e,t,i){for(var a=e.cache,s=e.keyList,r=e.keyInfo,n=t,o=s[t],l=s.length;a[o]=r[o]=void 0,o=s[++n],n<l&&Ds(e,o,i););s.splice(t,n-t)},Ps=function(e){return Ms(e),Ss(e,{cache:{},keyList:[],keyInfo:Es(null),opsLeft:e.options.opLimit})},Rs=(__webpack_require__(753),/Mac/.test(navigator.platform)),zs={toggleBold:Ws,toggleItalic:Vs,drawLink:sr,toggleHeadingSmaller:Ks,toggleHeadingBigger:Zs,drawImage:rr,toggleBlockquote:Gs,toggleOrderedList:ir,toggleUnorderedList:tr,toggleCodeBlock:Ys,togglePreview:hr,toggleStrikethrough:Xs,toggleHeading1:Js,toggleHeading2:Qs,toggleHeading3:er,cleanBlock:ar,drawTable:nr,drawHorizontalRule:or,undo:lr,redo:cr,toggleSideBySide:dr,toggleFullScreen:Hs},Bs={toggleBold:"Cmd-B",toggleItalic:"Cmd-I",drawLink:"Cmd-K",toggleHeadingSmaller:"Cmd-H",toggleHeadingBigger:"Shift-Cmd-H",cleanBlock:"Cmd-E",drawImage:"Cmd-Alt-I",toggleBlockquote:"Cmd-'",toggleOrderedList:"Cmd-Alt-L",toggleUnorderedList:"Cmd-L",toggleCodeBlock:"Cmd-Alt-C",togglePreview:"Cmd-P",toggleSideBySide:"F9",toggleFullScreen:"F11"},Ns=function(e){for(var t in zs)if(zs[t]===e)return t;return null};function Fs(e){return e=Rs?e.replace("Ctrl","Cmd"):e.replace("Cmd","Ctrl")}function qs(e,t,i){e=e||{};var a=document.createElement("a");return t=null==t||t,e.title&&t&&(a.title=function(e,t,i){t&&(t=Ns(t),i[t])&&(e+=" ("+Fs(i[t])+")");return e}(e.title,e.action,i),Rs)&&(a.title=a.title.replace("Ctrl","⌘"),a.title=a.title.replace("Alt","⌥")),a.tabIndex=-1,a.className=e.className,a}function Us(e,t){t=t||e.getCursor("start");var i=e.getTokenAt(t);if(!i.type)return{};for(var a,s,r=i.type.split(" "),n={},o=0;o<r.length;o++)"strong"===(a=r[o])?n.bold=!0:"variable-2"===a?(s=e.getLine(t.line),/^\s*\d+\.\s/.test(s)?n["ordered-list"]=!0:n["unordered-list"]=!0):"atom"===a?n.quote=!0:"em"===a?n.italic=!0:"quote"===a?n.quote=!0:"strikethrough"===a?n.strikethrough=!0:"comment"===a?n.code=!0:"link"===a?n.link=!0:"tag"===a?n.image=!0:a.match(/^header(\-[1-6])?$/)&&(n[a.replace("header","heading")]=!0);return n}var $s="";function Hs(e){var t=e.codemirror,i=(t.setOption("fullScreen",!t.getOption("fullScreen")),t.getOption("fullScreen")?($s=document.body.style.overflow,document.body.style.overflow="hidden"):document.body.style.overflow=$s,t.getWrapperElement()),i=(/fullscreen/.test(i.previousSibling.className)?i.previousSibling.className=i.previousSibling.className.replace(/\s*fullscreen\b/,""):i.previousSibling.className+=" fullscreen",e.toolbarElements.fullscreen),i=(/active/.test(i.className)?i.className=i.className.replace(/\s*active\s*/g,""):i.className+=" active",t.getWrapperElement().nextSibling);/editor-preview-active-side/.test(i.className)&&dr(e)}function Ws(e){gr(e,"bold",e.options.blockStyles.bold)}function Vs(e){gr(e,"italic",e.options.blockStyles.italic)}function Xs(e){gr(e,"strikethrough","~~")}function Ys(e){var t=e.options.blockStyles.code;function r(e){if("object"!=typeof e)throw"fencing_line() takes a 'line' object (not a line number, or line text).  Got: "+typeof e+": "+e;return e.styles&&e.styles[2]&&-1!==e.styles[2].indexOf("formatting-code-block")}function n(e){return e.state.base.base||e.state.base}function i(e,t,i,a,s){i=i||e.getLineHandle(t),a=a||e.getTokenAt({line:t,ch:1}),s=s||!!i.text&&e.getTokenAt({line:t,ch:i.text.length-1});e=a.type?a.type.split(" "):[];return s&&n(s).indentedCode?"indented":-1!==e.indexOf("comment")&&(n(a).fencedChars||n(s).fencedChars||r(i)?"fenced":"single")}var a,s,o,l,c=e.codemirror,e=c.getCursor("start"),d=c.getCursor("end"),h=c.getTokenAt({line:e.line,ch:e.ch||1}),u=c.getLineHandle(e.line),h=i(c,e.line,u,h);if("single"===h){var p=u.text.slice(0,e.ch).replace("`",""),m=u.text.slice(e.ch).replace("`","");c.replaceRange(p+m,{line:e.line,ch:0},{line:e.line,ch:99999999999999}),e.ch--,e!==d&&d.ch--,c.setSelection(e,d),c.focus()}else if("fenced"===h){if(e.line!==d.line||e.ch!==d.ch){for(a=e.line;0<=a&&!r(u=c.getLineHandle(a));a--);var g,f,v,p=n(c.getTokenAt({line:a,ch:1})).fencedChars,w=r(c.getLineHandle(e.line))?(g="",e.line):r(c.getLineHandle(e.line-1))?(g="",e.line-1):(g=p+"\n",e.line);r(c.getLineHandle(d.line))?(f="",v=d.line,0===d.ch&&(v+=1)):v=(f=0!==d.ch&&r(c.getLineHandle(d.line+1))?"":p+"\n",d.line+1),0===d.ch&&--v,c.operation(function(){c.replaceRange(f,{line:v,ch:0},{line:v+(f?0:1),ch:0}),c.replaceRange(g,{line:w,ch:0},{line:w+(g?0:1),ch:0})}),c.setSelection({line:w+(g?1:0),ch:0},{line:v+(g?1:-1),ch:0})}else{var m=e.line;if(r(c.getLineHandle(e.line))&&(m="fenced"===i(c,e.line+1)?(a=e.line,e.line+1):(s=e.line,e.line-1)),void 0===a)for(a=m;0<=a&&!r(u=c.getLineHandle(a));a--);if(void 0===s)for(o=c.lineCount(),s=m;s<o&&!r(u=c.getLineHandle(s));s++);c.operation(function(){c.replaceRange("",{line:a,ch:0},{line:a+1,ch:0}),c.replaceRange("",{line:s-1,ch:0},{line:s,ch:0})})}c.focus()}else if("indented"===h){if(e.line!==d.line||e.ch!==d.ch)a=e.line,s=d.line,0===d.ch&&s--;else{for(a=e.line;0<=a;a--)if(!(u=c.getLineHandle(a)).text.match(/^\s*$/)&&"indented"!==i(c,a,u)){a+=1;break}for(o=c.lineCount(),s=e.line;s<o;s++)if(!(u=c.getLineHandle(s)).text.match(/^\s*$/)&&"indented"!==i(c,s,u)){--s;break}}p=c.getLineHandle(s+1),m=p&&c.getTokenAt({line:s+1,ch:p.text.length-1});m&&n(m).indentedCode&&c.replaceRange("\n",{line:s+1,ch:0});for(var y=a;y<=s;y++)c.indentLine(y,"subtract");c.focus()}else{h=e.line===d.line&&e.ch===d.ch&&0===e.ch,p=e.line!==d.line;h||p?(m=c,h=d,p=t,t=(d=e).line+1,e=h.line+1,d=d.line!==h.line,l="\n"+p,d&&e++,d&&0===h.ch&&(l=p+"\n",e--),ur(m,!1,[p+"\n",l]),m.setSelection({line:t,ch:0},{line:e,ch:0})):ur(c,!1,["`","`"])}}function Gs(e){mr(e.codemirror,"quote")}function Ks(e){pr(e.codemirror,"smaller")}function Zs(e){pr(e.codemirror,"bigger")}function Js(e){pr(e.codemirror,void 0,1)}function Qs(e){pr(e.codemirror,void 0,2)}function er(e){pr(e.codemirror,void 0,3)}function tr(e){mr(e.codemirror,"unordered-list")}function ir(e){mr(e.codemirror,"ordered-list")}function ar(e){var t=e.codemirror;if(!/editor-preview-active/.test(t.getWrapperElement().lastChild.className))for(var i,e=t.getCursor("start"),a=t.getCursor("end"),s=e.line;s<=a.line;s++)i=(i=t.getLine(s)).replace(/^[ ]*([# ]+|\*|\-|[> ]+|[0-9]+(.|\)))[ ]*/,""),t.replaceRange(i,{line:s,ch:0},{line:s,ch:99999999999999})}function sr(e){var t=e.codemirror,i=Us(t),e=e.options,a="http://";if(e.promptURLs&&!(a=prompt(e.promptTexts.link)))return!1;ur(t,i.link,e.insertTexts.link,a)}function rr(e){var t=e.codemirror,i=Us(t),e=e.options,a="http://";if(e.promptURLs&&!(a=prompt(e.promptTexts.image)))return!1;ur(t,i.image,e.insertTexts.image,a)}function nr(e){var t=e.codemirror,i=Us(t),e=e.options;ur(t,i.table,e.insertTexts.table)}function or(e){var t=e.codemirror,i=Us(t),e=e.options;ur(t,i.image,e.insertTexts.horizontalRule)}function lr(e){e=e.codemirror;e.undo(),e.focus()}function cr(e){e=e.codemirror;e.redo(),e.focus()}function dr(e){var t=e.codemirror,i=t.getWrapperElement(),a=i.nextSibling,s=e.toolbarElements["side-by-side"],r=!1,s=(/editor-preview-active-side/.test(a.className)?(a.className=a.className.replace(/\s*editor-preview-active-side\s*/g,""),s.className=s.className.replace(/\s*active\s*/g,""),i.className=i.className.replace(/\s*CodeMirror-sided\s*/g," ")):(setTimeout(function(){t.getOption("fullScreen")||Hs(e),a.className+=" editor-preview-active-side"},1),s.className+=" active",i.className+=" CodeMirror-sided",r=!0),i.lastChild);/editor-preview-active/.test(s.className)&&(s.className=s.className.replace(/\s*editor-preview-active\s*/g,""),s=e.toolbarElements.preview,i=i.previousSibling,s.className=s.className.replace(/\s*active\s*/g,""),i.className=i.className.replace(/\s*disabled-for-preview*/g,""));t.sideBySideRenderingFunction||(t.sideBySideRenderingFunction=function(){a.innerHTML=e.options.previewRender(e.value(),a)}),r?(a.innerHTML=e.options.previewRender(e.value(),a),t.on("update",t.sideBySideRenderingFunction)):t.off("update",t.sideBySideRenderingFunction),t.refresh()}function hr(e){var t=e.codemirror,i=t.getWrapperElement(),a=i.previousSibling,s=!!e.options.toolbar&&e.toolbarElements.preview,r=i.lastChild,i=(r&&/editor-preview/.test(r.className)||((r=document.createElement("div")).className="editor-preview",i.appendChild(r)),/editor-preview-active/.test(r.className)?(r.className=r.className.replace(/\s*editor-preview-active\s*/g,""),s&&(s.className=s.className.replace(/\s*active\s*/g,""),a.className=a.className.replace(/\s*disabled-for-preview*/g,""))):(setTimeout(function(){r.className+=" editor-preview-active"},1),s&&(s.className+=" active",a.className+=" disabled-for-preview")),r.innerHTML=e.options.previewRender(e.value(),r),t.getWrapperElement().nextSibling);/editor-preview-active-side/.test(i.className)&&dr(e)}function ur(e,t,i,a){var s,r,n,o;/editor-preview-active/.test(e.getWrapperElement().lastChild.className)||(r=i[0],i=i[1],n=e.getCursor("start"),o=e.getCursor("end"),a&&(i=i.replace("#url#",a)),t?(r=(s=e.getLine(n.line)).slice(0,n.ch),i=s.slice(n.ch),e.replaceRange(r+i,{line:n.line,ch:0})):(s=e.getSelection(),e.replaceSelection(r+s+i),n.ch+=r.length,n!==o&&(o.ch+=r.length)),e.setSelection(n,o),e.focus())}function pr(e,t,i){if(!/editor-preview-active/.test(e.getWrapperElement().lastChild.className)){for(var a,s,r,n=e.getCursor("start"),o=e.getCursor("end"),l=n.line;l<=o.line;l++)a=l,r=s=void 0,s=(r=e.getLine(a)).search(/[^#]/),r=void 0!==t?s<=0?"bigger"==t?"###### "+r:"# "+r:6==s&&"smaller"==t?r.substr(7):1==s&&"bigger"==t?r.substr(2):"bigger"==t?r.substr(1):"#"+r:1==i?s<=0?"# "+r:s==i?r.substr(s+1):"# "+r.substr(s+1):2==i?s<=0?"## "+r:s==i?r.substr(s+1):"## "+r.substr(s+1):s<=0?"### "+r:s==i?r.substr(s+1):"### "+r.substr(s+1),e.replaceRange(r,{line:a,ch:0},{line:a,ch:99999999999999});e.focus()}}function mr(e,t){if(!/editor-preview-active/.test(e.getWrapperElement().lastChild.className)){for(var i,a,s=Us(e),r=e.getCursor("start"),n=e.getCursor("end"),o={quote:/^(\s*)\>\s+/,"unordered-list":/^(\s*)(\*|\-|\+)\s+/,"ordered-list":/^(\s*)\d+\.\s+/},l={quote:"> ","unordered-list":"* ","ordered-list":"1. "},c=r.line;c<=n.line;c++)i=c,a=void 0,a=e.getLine(i),a=s[t]?a.replace(o[t],"$1"):l[t]+a,e.replaceRange(a,{line:i,ch:0},{line:i,ch:99999999999999});e.focus()}}function gr(e,t,i,a){var s,r,n,o,l;/editor-preview-active/.test(e.codemirror.getWrapperElement().lastChild.className)||(a=void 0===a?i:a,s=Us(e=e.codemirror),n=i,a=a,o=e.getCursor("start"),l=e.getCursor("end"),s[t]?(n=(r=e.getLine(o.line)).slice(0,o.ch),a=r.slice(o.ch),"bold"==t?(n=n.replace(/(\*\*|__)(?![\s\S]*(\*\*|__))/,""),a=a.replace(/(\*\*|__)/,"")):"italic"==t?(n=n.replace(/(\*|_)(?![\s\S]*(\*|_))/,""),a=a.replace(/(\*|_)/,"")):"strikethrough"==t&&(n=n.replace(/(\*\*|~~)(?![\s\S]*(\*\*|~~))/,""),a=a.replace(/(\*\*|~~)/,"")),e.replaceRange(n+a,{line:o.line,ch:0},{line:o.line,ch:99999999999999}),"bold"==t||"strikethrough"==t?(o.ch-=2,o!==l&&(l.ch-=2)):"italic"==t&&(--o.ch,o!==l)&&--l.ch):(r=e.getSelection(),"bold"==t?r=(r=r.split("**").join("")).split("__").join(""):"italic"==t?r=(r=r.split("*").join("")).split("_").join(""):"strikethrough"==t&&(r=r.split("~~").join("")),e.replaceSelection(n+r+a),o.ch+=i.length,l.ch=o.ch+r.length),e.setSelection(o,l),e.focus())}function fr(e){for(var t=1;t<arguments.length;t++)e=function e(t,i){for(var a in i)i.hasOwnProperty(a)&&(i[a]instanceof Array?t[a]=i[a].concat(t[a]instanceof Array?t[a]:[]):null!==i[a]&&"object"==typeof i[a]&&i[a].constructor===Object?t[a]=e(t[a]||{},i[a]):t[a]=i[a]);return t}(e,arguments[t]);return e}function vr(e){var t=e.match(/[a-zA-Z0-9_\u0392-\u03c9\u0410-\u04F9]+|[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g),i=0;if(null!==t)for(var a=0;a<t.length;a++)19968<=t[a].charCodeAt(0)?i+=t[a].length:i+=1;return i}var wr={bold:{name:"bold",action:Ws,className:"fa fa-bold",title:"Bold",default:!0},italic:{name:"italic",action:Vs,className:"fa fa-italic",title:"Italic",default:!0},strikethrough:{name:"strikethrough",action:Xs,className:"fa fa-strikethrough",title:"Strikethrough"},heading:{name:"heading",action:Ks,className:"fa fa-header",title:"Heading",default:!0},"heading-smaller":{name:"heading-smaller",action:Ks,className:"fa fa-header fa-header-x fa-header-smaller",title:"Smaller Heading"},"heading-bigger":{name:"heading-bigger",action:Zs,className:"fa fa-header fa-header-x fa-header-bigger",title:"Bigger Heading"},"heading-1":{name:"heading-1",action:Js,className:"fa fa-header fa-header-x fa-header-1",title:"Big Heading"},"heading-2":{name:"heading-2",action:Qs,className:"fa fa-header fa-header-x fa-header-2",title:"Medium Heading"},"heading-3":{name:"heading-3",action:er,className:"fa fa-header fa-header-x fa-header-3",title:"Small Heading"},"separator-1":{name:"separator-1"},code:{name:"code",action:Ys,className:"fa fa-code",title:"Code",default:!0},quote:{name:"quote",action:Gs,className:"fa fa-quote-left",title:"Quote",default:!0},"unordered-list":{name:"unordered-list",action:tr,className:"fa fa-list-ul",title:"Generic List",default:!0},"ordered-list":{name:"ordered-list",action:ir,className:"fa fa-list-ol",title:"Numbered List",default:!0},"clean-block":{name:"clean-block",action:ar,className:"fa fa-eraser fa-clean-block",title:"Clean block"},link:{name:"link",action:sr,className:"fa fa-link",title:"Create Link",default:!0},image:{name:"image",action:rr,className:"fa fa-picture-o",title:"Insert Image",default:!1},table:{name:"table",action:nr,className:"fa fa-table",title:"Insert Table"},"horizontal-rule":{name:"horizontal-rule",action:or,className:"fa fa-minus",title:"Insert Horizontal Line"},"separator-3":{name:"separator-3"},preview:{name:"preview",action:hr,className:"fa fa-eye no-disable",title:"Toggle Preview",default:!0},"side-by-side":{name:"side-by-side",action:dr,className:"fa fa-columns no-disable no-mobile",title:"Toggle Side by Side",default:!1},fullscreen:{name:"fullscreen",action:Hs,className:"fa fa-arrows-alt no-disable no-mobile",title:"Toggle Fullscreen",default:!1},"separator-4":{name:"separator-4"},guide:{name:"guide",action:"https://simplemde.com/markdown-guide",className:"fa fa-question-circle",title:"Markdown Guide",default:!1},"separator-5":{name:"separator-5"},undo:{name:"undo",action:lr,className:"fa fa-undo no-disable",title:"Undo"},redo:{name:"redo",action:cr,className:"fa fa-repeat no-disable",title:"Redo"}},yr={link:["[","](#url#)"],image:["![](","#url#)"],table:["","\n\n| Column 1 | Column 2 | Column 3 |\n| -------- | -------- | -------- |\n| Text     | Text     | Text     |\n\n"],horizontalRule:["","\n\n-----\n\n"]},br={link:"URL for the link:",image:"URL of the image:"},kr={bold:"**",code:"```",italic:"*"};function f(e){(e=e||{}).parent=this;var t,i=!0;if(!1===e.autoDownloadFontAwesome&&(i=!1),!0!==e.autoDownloadFontAwesome)for(var a=document.styleSheets,s=0;s<a.length;s++)a[s].href&&-1<a[s].href.indexOf("//maxcdn.bootstrapcdn.com/font-awesome/")&&(i=!1);if(i&&((t=document.createElement("link")).rel="stylesheet",t.href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css",document.getElementsByTagName("head")[0].appendChild(t)),e.element)this.element=e.element;else if(null===e.element)return;if(void 0===e.toolbar)for(var r in e.toolbar=[],wr)wr.hasOwnProperty(r)&&(-1!=r.indexOf("separator-")&&e.toolbar.push("|"),!0===wr[r].default||e.showIcons&&e.showIcons.constructor===Array&&-1!=e.showIcons.indexOf(r))&&e.toolbar.push(r);e.hasOwnProperty("status")||(e.status=["autosave","lines","words","cursor"]),e.previewRender||(e.previewRender=function(e){return this.parent.markdown(e)}),e.parsingConfig=fr({highlightFormatting:!0},e.parsingConfig||{}),e.insertTexts=fr({},yr,e.insertTexts||{}),e.promptTexts=br,e.blockStyles=fr({},kr,e.blockStyles||{}),e.shortcuts=fr({},Bs,e.shortcuts||{}),null!=e.autosave&&null!=e.autosave.unique_id&&""!=e.autosave.unique_id&&(e.autosave.uniqueId=e.autosave.unique_id),this.options=e,this.render(),!e.initialValue||this.options.autosave&&!0===this.options.autosave.foundSavedValue||this.value(e.initialValue)}function _r(){if("object"==typeof localStorage){try{localStorage.setItem("smde_localStorage",1),localStorage.removeItem("smde_localStorage")}catch(e){return}return 1}}f.prototype.markdown=function(e){var t={headerIds:!1};return this.options&&this.options.renderingConfig&&!1===this.options.renderingConfig.singleLineBreaks?t.breaks=!1:t.breaks=!0,this.options&&this.options.renderingConfig&&!0===this.options.renderingConfig.codeSyntaxHighlighting&&window.hljs&&(t.highlight=function(e){return window.hljs.highlightAuto(e).value}),we(t),u(e)},f.prototype.render=function(e){if(e=e||this.element||document.getElementsByTagName("textarea")[0],!this._rendered||this._rendered!==e){this.element=e;var t,i,a,s,r=this.options,n=this,o={};for(t in r.shortcuts)null!==r.shortcuts[t]&&null!==zs[t]&&!function(e){o[Fs(r.shortcuts[e])]=function(){zs[e](n)}}(t);o.Enter="newlineAndIndentContinueMarkdownList",o.Tab="tabAndIndentMarkdownList",o["Shift-Tab"]="shiftTabAndUnindentMarkdownList",o.Esc=function(e){e.getOption("fullScreen")&&Hs(n)},document.addEventListener("keydown",function(e){27==(e=e||window.event).keyCode&&n.codemirror.getOption("fullScreen")&&Hs(n)},!1),!1!==r.spellChecker?(i="spell-checker",(a=r.parsingConfig).name="gfm",a.gitHubSpice=!1):((i=r.parsingConfig).name="gfm",i.gitHubSpice=!1),this.codemirror=CodeMirror.fromTextArea(e,{mode:i,backdrop:a,theme:"paper",tabSize:null!=r.tabSize?r.tabSize:2,indentUnit:null!=r.tabSize?r.tabSize:2,indentWithTabs:!1!==r.indentWithTabs,lineNumbers:!1,autofocus:!0===r.autofocus,extraKeys:o,lineWrapping:!1!==r.lineWrapping,allowDropFileTypes:["text/plain"],placeholder:r.placeholder||e.getAttribute("placeholder")||"",styleSelectedText:null==r.styleSelectedText||r.styleSelectedText}),!0===r.forceSync&&(s=this.codemirror).on("change",function(){s.save()}),!(this.gui={})!==r.toolbar&&(this.gui.toolbar=this.createToolbar()),!1!==r.status&&(this.gui.statusbar=this.createStatusbar()),null!=r.autosave&&!0===r.autosave.enabled&&this.autosave(),this.gui.sideBySide=this.createSideBySide(),this._rendered=this.element;var l=this.codemirror;setTimeout(function(){l.refresh()}.bind(l),0)}},f.prototype.autosave=function(){var e,t,i,a,s,r;_r()&&null!=(e=this).options.autosave.uniqueId&&""!=this.options.autosave.uniqueId&&(null!=e.element.form&&null!=e.element.form&&e.element.form.addEventListener("submit",function(){localStorage.removeItem("smde_"+e.options.autosave.uniqueId)}),!0!==this.options.autosave.loaded&&("string"==typeof localStorage.getItem("smde_"+this.options.autosave.uniqueId)&&""!=localStorage.getItem("smde_"+this.options.autosave.uniqueId)&&(this.codemirror.setValue(localStorage.getItem("smde_"+this.options.autosave.uniqueId)),this.options.autosave.foundSavedValue=!0),this.options.autosave.loaded=!0),localStorage.setItem("smde_"+this.options.autosave.uniqueId,e.value()),null!=(t=document.getElementById("autosaved"))&&""!=t&&(i=(a=new Date).getHours(),a=a.getMinutes(),s="am",12<=(r=i)&&(r=i-12,s="pm"),t.innerHTML="Autosaved: "+(r=0==r?12:r)+":"+(a=a<10?"0"+a:a)+" "+s),this.autosaveTimeoutId=setTimeout(function(){e.autosave()},this.options.autosave.delay||1e4))},f.prototype.clearAutosavedValue=function(){_r()&&null!=this.options.autosave&&null!=this.options.autosave.uniqueId&&""!=this.options.autosave.uniqueId&&localStorage.removeItem("smde_"+this.options.autosave.uniqueId)},f.prototype.createSideBySide=function(){var t=this.codemirror,e=t.getWrapperElement(),i=e.nextSibling,a=(i&&/editor-preview-side/.test(i.className)||((i=document.createElement("div")).className="editor-preview-side",e.parentNode.insertBefore(i,e.nextSibling)),!1),s=!1;return t.on("scroll",function(e){var t;a?a=!1:(s=!0,t=e.getScrollInfo().height-e.getScrollInfo().clientHeight,e=parseFloat(e.getScrollInfo().top)/t,t=(i.scrollHeight-i.clientHeight)*e,i.scrollTop=t)}),i.onscroll=function(){var e;s?s=!1:(a=!0,e=i.scrollHeight-i.clientHeight,e=parseFloat(i.scrollTop)/e,e=(t.getScrollInfo().height-t.getScrollInfo().clientHeight)*e,t.scrollTo(0,e))},i},f.prototype.createToolbar=function(e){if((e=e||this.options.toolbar)&&0!==e.length){for(var t=0;t<e.length;t++)null!=wr[e[t]]&&(e[t]=wr[e[t]]);var i,a,s=document.createElement("div"),r=(s.className="editor-toolbar",this),n={};for(r.toolbar=e,t=0;t<e.length;t++)if(("guide"!=e[t].name||!1!==r.options.toolbarGuideIcon)&&!(r.options.hideIcons&&-1!=r.options.hideIcons.indexOf(e[t].name)||("fullscreen"==e[t].name||"side-by-side"==e[t].name)&&(i=void 0,a=!1,i=navigator.userAgent||navigator.vendor||window.opera,a=!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(i)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4)))||a))){if("|"===e[t]){for(var o=!1,l=t+1;l<e.length;l++)"|"===e[l]||r.options.hideIcons&&-1!=r.options.hideIcons.indexOf(e[l].name)||(o=!0);if(!o)continue}!function(t){var e="|"===t?((e=document.createElement("i")).className="separator",e.innerHTML="|",e):qs(t,r.options.toolbarTips,r.options.shortcuts);t.action&&("function"==typeof t.action?e.onclick=function(e){e.preventDefault(),t.action(r)}:"string"==typeof t.action&&(e.href=t.action,e.target="_blank")),n[t.name||t]=e,s.appendChild(e)}(e[t])}r.toolbarElements=n;var c=this.codemirror,d=(c.on("cursorActivity",function(){var e,t,i,a=Us(c);for(e in n)i=void 0,i=n[t=e],a[t]?i.className+=" active":"fullscreen"!=t&&"side-by-side"!=t&&(i.className=i.className.replace(/\s*active\s*/g,""))}),c.getWrapperElement());return d.parentNode.insertBefore(s,d),s}},f.prototype.createStatusbar=function(e){e=e||this.options.status;var t=this.options,i=this.codemirror;if(e&&0!==e.length){for(var a=[],s=0;s<e.length;s++){var r,n=void 0,o=void 0;"object"==typeof e[s]?a.push({className:e[s].className,defaultValue:e[s].defaultValue,onUpdate:e[s].onUpdate}):("words"===(r=e[s])?(o=function(e){e.innerHTML=vr(i.getValue())},n=function(e){e.innerHTML=vr(i.getValue())}):"lines"===r?(o=function(e){e.innerHTML=i.lineCount()},n=function(e){e.innerHTML=i.lineCount()}):"cursor"===r?(o=function(e){e.innerHTML="0:0"},n=function(e){var t=i.getCursor();e.innerHTML=t.line+":"+t.ch}):"autosave"===r&&(o=function(e){null!=t.autosave&&!0===t.autosave.enabled&&e.setAttribute("id","autosaved")}),a.push({className:r,defaultValue:o,onUpdate:n}))}var l=document.createElement("div");for(l.className="editor-statusbar",s=0;s<a.length;s++){var c=a[s],d=document.createElement("span");d.className=c.className,"function"==typeof c.defaultValue&&c.defaultValue(d),"function"==typeof c.onUpdate&&this.codemirror.on("update",function(e,t){return function(){t.onUpdate(e)}}(d,c)),l.appendChild(d)}var h=this.codemirror.getWrapperElement();return h.parentNode.insertBefore(l,h.nextSibling),l}},f.prototype.value=function(e){return void 0===e?this.codemirror.getValue():(this.codemirror.getDoc().setValue(e),this)},f.toggleBold=Ws,f.toggleItalic=Vs,f.toggleStrikethrough=Xs,f.toggleBlockquote=Gs,f.toggleHeadingSmaller=Ks,f.toggleHeadingBigger=Zs,f.toggleHeading1=Js,f.toggleHeading2=Qs,f.toggleHeading3=er,f.toggleCodeBlock=Ys,f.toggleUnorderedList=tr,f.toggleOrderedList=ir,f.cleanBlock=ar,f.drawLink=sr,f.drawImage=rr,f.drawTable=nr,f.drawHorizontalRule=or,f.undo=lr,f.redo=cr,f.togglePreview=hr,f.toggleSideBySide=dr,f.toggleFullScreen=Hs,f.prototype.toggleBold=function(){Ws(this)},f.prototype.toggleItalic=function(){Vs(this)},f.prototype.toggleStrikethrough=function(){Xs(this)},f.prototype.toggleBlockquote=function(){Gs(this)},f.prototype.toggleHeadingSmaller=function(){Ks(this)},f.prototype.toggleHeadingBigger=function(){Zs(this)},f.prototype.toggleHeading1=function(){Js(this)},f.prototype.toggleHeading2=function(){Qs(this)},f.prototype.toggleHeading3=function(){er(this)},f.prototype.toggleCodeBlock=function(){Ys(this)},f.prototype.toggleUnorderedList=function(){tr(this)},f.prototype.toggleOrderedList=function(){ir(this)},f.prototype.cleanBlock=function(){ar(this)},f.prototype.drawLink=function(){sr(this)},f.prototype.drawImage=function(){rr(this)},f.prototype.drawTable=function(){nr(this)},f.prototype.drawHorizontalRule=function(){or(this)},f.prototype.undo=function(){lr(this)},f.prototype.redo=function(){cr(this)},f.prototype.togglePreview=function(){hr(this)},f.prototype.toggleSideBySide=function(){dr(this)},f.prototype.toggleFullScreen=function(){Hs(this)},f.prototype.isPreviewActive=function(){var e=this.codemirror.getWrapperElement().lastChild;return/editor-preview-active/.test(e.className)},f.prototype.isSideBySideActive=function(){var e=this.codemirror.getWrapperElement().nextSibling;return/editor-preview-active-side/.test(e.className)},f.prototype.isFullscreenActive=function(){return this.codemirror.getOption("fullScreen")},f.prototype.getState=function(){return Us(this.codemirror)},f.prototype.toTextArea=function(){var e=this.codemirror,t=e.getWrapperElement(),t=(t.parentNode&&(this.gui.toolbar&&t.parentNode.removeChild(this.gui.toolbar),this.gui.statusbar&&t.parentNode.removeChild(this.gui.statusbar),this.gui.sideBySide)&&t.parentNode.removeChild(this.gui.sideBySide),e.getTextArea());return e.toTextArea(),this.autosaveTimeoutId&&(clearTimeout(this.autosaveTimeoutId),this.autosaveTimeoutId=void 0,this.clearAutosavedValue()),t};const xr=Er({label:"UTILS"});function Cr(a,o=200,l=o){return new Promise((s,e)=>{var t=dom.createElement("img","obj"),i=fileX.getExtension(a);const r=fileX.getMimeType(i);"string"==typeof a||a instanceof Blob||(t.file=a);var n,i=new FileReader;i.onload=(n=t,e=>{n.onload=()=>{var e=dom.createElement("canvas","photo"),t=e.getContext("2d");let i=n.width,a=n.height;i>a?i>o&&(a*=o/i,i=o):a>l&&(i*=l/a,a=l),e.width=i,e.height=a,t.drawImage(n,0,0,i,a),s({url:e.toDataURL(r),width:i,height:a})},n.src=e.target.result}),i.readAsDataURL(a)})}function Er(t={}){const i=["color: "+(t.color||"#fff"),"background-color: "+(t.bgcolor||"#87CEEB"),"padding: 2px 4px","border-radius: 2px"].join(";"),a=t.label||"",s=window.console;return{log(...e){Sr(s.log,!!t.time,a,i,...e)},error(...e){Sr(s.error,!!t.time,a,i,...e)},debug(...e){Sr(s.debug,!!t.time,a,i,...e)}}}function Sr(e,t,i,a,...s){e(t?(new Date).toLocaleTimeString()+" %c"+i:"%c"+i,a,...s)}f.wrap=function(e){return new f({element:e,spellChecker:!1,autoDownloadFontAwesome:!1})};const Tr="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";Object.assign(window,{download:function(e,t,i){var a=document.createElement("a"),e=new Blob([e],{type:t}),t=URL.createObjectURL(e);a.setAttribute("href",t),a.setAttribute("download",i),a.click()},loadImage:async function(e,t=200,i=t){xr.debug("Load image begin ...");var{url:e,width:i,height:a}=await Cr(e,t,i),s=new Image;return s.src=e,s.width=i,s.height=a,xr.debug("Load image DONE!!!"),s},loadImageUrl:function(i,r=200,n=r){const o=dom.createElement("img","obj");var e=fileX.getExtension(i);const l=fileX.getMimeType(e);return"string"==typeof i||i instanceof Blob||(o.file=i),new Promise((s,e)=>{o.onerror=e,o.onload=()=>{var e=dom.createElement("canvas","photo"),t=e.getContext("2d");let i=o.width,a=o.height;i>a?i>r&&(a*=r/i,i=r):a>n&&(i*=n/a,a=n),e.width=i,e.height=a,t.drawImage(o,0,0,i,a),URL.revokeObjectURL(o.src),s({url:e.toDataURL(l),width:i,height:a})};const t=new FileReader;t.onerror=e,t.onload=()=>o.src=t.result,t.readAsDataURL(i)})},loadVideoThumb:function(c,d=640,h=d){return xr.log("LOADING VIDEO"),new Promise((t,e)=>{var i=dom.createElement("canvas","video"),a=i.getContext("2d"),s=URL.createObjectURL(c);const r=dom.createElement("video");r.autoplay=!0,r.src=s,r.createTime=5;let n=!(r.muted=!0),o,l;r.onloadedmetadata=e=>{xr.log("VIDEO metadata loaded",r.videoWidth,"x",r.height),xr.log(e),o=r.videoWidth,l=r.videoHeight,o>l?o>d&&(l*=d/o,o=d):l>h&&(o*=h/l,l=h),i.width=o,i.height=l},r.oncanplay=()=>{xr.log("VIDEO can play",r.width,"x",r.height),n||(r.currentTime=10,n=!0)},r.onseeked=()=>{a.drawImage(r,0,0,o,l);var e=new Image;e.src=i.toDataURL("image/jpeg"),e.width=o,e.height=l,r.pause(),t(e)},r.onerror=()=>e("Unable to load video")})},parseMagnetURI:function(e){var t,i,a=e.match(/magnet:\?xt=urn:[a-z0-9]+:([a-z0-9]{40})(.+)/),s={uri:e,hash:a[1]};for([t,i]of a[2].slice(1).split("&").map(e=>e.split("="))){var r=decodeURIComponent(i);s[t]?Array.isArray(s[t])?s[t].push(r):s[t]=[s[t],r]:s[t]=r}return s},generatePushID:function(e,t=Date.seconds()){for(var e="string"==typeof e?e.hashCode():e,i=1e3*t+e%1e3,a=(e^i)>>>0,s=new Array(8),r=7;0<=r;r--)s[r]=Tr.charAt(i%64),i=Math.floor(i/64);for(var t=s.join(""),r=a%Tr.length,n=Tr.slice(r)+Tr.slice(0,r),r=7;0<=r;r--)s[r]=n.charAt(a%64),a=Math.floor(a/64);return t+=s.join("")},createConsole:Er,CacheMap:function(e){var i=vs(e);return{get:Cs(bs,i),getAll:Cs(ks,i),has:Cs(ys,i),set:function(e,t){return _s(i,e,t),t},remove:function(e){return xs(i,e),!0},reset:Cs(Ps,i),getCacheMeta:function(){return i},getOptions:function(){return i.options},setOptions:Cs(gs,i),doMaintenance:Cs(ws,i),values(){return Object.values(this.getAll())}}},MDE:f,le(e,t){return e<t},leq(e,t){return e<=t},gt(e,t){return t<e},gte(e,t){return t<=e}});const Ar={append(e,t=!1){t?this.area.insertBefore(e,this.area.firstElementChild):this.area.appendChild(e)},appendTemplate(e,t,i="div",...a){e=dom.renderTemplate(e,t,i,[...a]);return this.append(e),e},removeContent(){dom.removeChilds(this.area)},querySelector(e){return this.area.querySelector(e)},querySelectorAll(e){return this.area.querySelectorAll(e)},getLastElement(){return this.area.lastElementChild},getFirstElement(){return this.area.firstElementChild},moveTop(e,t=!1){t?dom.moveAfterTop(e):dom.moveTop(e)},insertTop(e){dom.insertTop(e,this.area)},addStyle(...e){this.area.classList.add(...e)},removeStyle(...e){this.area.classList.remove(...e)},removeSelf(){dom.removeElement(this.area)},getViewport(){return this.area.getBoundingClientRect()},showSelf(e){e=e?this.area.parentElement:this.area;dom.showElement(e)},hideSelf(e){e=e?this.area.parentElement:this.area;dom.hideElement(e)},childCount(){return this.area.childElementCount}};class Lr{#container;#area;#width;get area(){return this.#area}get viewport(){return this.#container.getBoundingClientRect()}set bottom(e){this.alignBottom=e,this.posY=1}get sliderMaxY(){return this.height-this.sliderHeight}get sliderPosY(){return this.sliderMaxY*this.posY}get containerElement(){return this.#container}get parentElement(){return this.#container.parentElement}get firstElement(){return this.#container.firstElement}get Y(){return this.posY}set Y(e){this.posY=e,this.#updateSliderPos(),this.#updateContent()}get offsetY(){return Math.floor(this.posY*this.totalHeight)}set offsetY(e){0<this.totalHeight&&(e=Math.abs(e/this.totalHeight),this.Y=e<=1?e:1)}constructor(i){this.height=i.getBoundingClientRect().height,this.scroller=i.querySelector("div.v-scroller"),this.slider=this.scroller.querySelector("div.slider"),this.#area=i.querySelector("div.content");var e=this.area.getBoundingClientRect();this.totalHeight=e.height,this.#width=e.width,this.posY=0,this.alignBottom=!1,this.scrolling=!1,this.#area.hasAttribute("bottom")&&(this.bottom=!0),this.#container=i,this.#updateSize(),this.resizeObserver=new ResizeObserver(e=>{var t=Math.floor(i.getBoundingClientRect().height);0<t&&(this.height=t,this.#updateScroller())}),this.resizeAreaObserver=new ResizeObserver(()=>{var e,t=this.#area.getBoundingClientRect(),i=Math.ceil(t.height);if(20<Math.abs(this.#width-t.width)){this.#width=t.width;for(const r of this.area.querySelectorAll(".marquee-container > .marquee")){var a=r.clientWidth,s=r.parentElement.clientWidth;let e=s/100*1.2;s<a?e+=a/s:e-=s/a,(e=Math.floor(e))<4&&(e=4),r.style.animationDuration=e+"s"}}0<i&&(t=this.alignBottom?this.totalHeight-this.offsetY:this.offsetY,e=this.totalHeight,this.totalHeight=i,this.#updateSize(),this.offsetY=this.alignBottom?i-t:t,this.onHeightChange(e,i,this.height))})}registerEvents(){this.resizeObserver.observe(this.#container),this.resizeAreaObserver.observe(this.area),this.#container.addEventListener("wheel",this,{passive:!0}),this.#container.addEventListener("keyup",this),this.registerSliderEvents()}unregisterEvents(){this.resizeObserver.unobserve(this.#container),this.resizeAreaObserver.unobserve(this.area),this.#container.removeEventListener("wheel",this),this.#container.removeEventListener("keyup",this),this.unregisterSliderEvents()}registerSliderEvents(){this.slider.addEventListener("mouseup",this),this.slider.addEventListener("mousedown",this),this.slider.addEventListener("mouseleave",this),this.slider.addEventListener("mousemove",this)}unregisterSliderEvents(){this.slider.removeEventListener("mouseup",this),this.slider.removeEventListener("mousedown",this),this.slider.removeEventListener("mouseleave",this),this.slider.removeEventListener("mousemove",this)}handleEvent(t){switch(t.type){case"wheel":if(this.totalHeight>this.height){if(this.posY<=0&&t.deltaY<0)return;if(1<=this.posY&&0<t.deltaY)return;var i=t.deltaY;let e=this.posY+i/this.totalHeight;1<e?e=1:e<0&&(e=0),this.posY=e,this.#update()}return!0;case"keyup":return this.totalHeight>this.height&&(i=this.height/this.totalHeight,33==t.keyCode?0<this.posY&&(this.posY-=i,this.posY<0&&(this.posY=0),this.#update()):34==t.keyCode&&this.posY<1&&(this.posY+=i,1<this.posY&&(this.posY=1),this.#update())),!0;case"mousedown":t.stopPropagation(),this.scrolling=!0,this.sliderY=t.offsetY;break;case"mouseup":t.stopPropagation(),this.scrolling=!1;break;case"mousemove":if(this.scrolling){t.stopPropagation();var i=t.offsetY-this.sliderY,e=this.sliderPosY;if(e<=0){if(i<=0)return;this.posY=i/this.sliderMaxY}else this.posY*=(e+i)/e;1<this.posY?this.posY=1:this.posY<0&&(this.posY=0),this.#update()}break;case"mouseleave":this.scrolling=!1,t.stopPropagation()}return!1}setFocus(){this.#container.focus()}scrollTo(e){var t,e=e.getBoundingClientRect().top;e<=10?this.Y=0:0<(t=this.totalHeight)&&(this.Y=e/t)}scrollBottom(){this.posY=1,this.#update(),this.alignBottom&&this.totalHeight<this.height&&(this.area.style.top=this.height-this.totalHeight+"px")}onScrollY(){}onHeightChange(){}#update(){this.#updateSliderPos(),this.#updateContent();var e=Math.floor(this.posY*this.totalHeight);this.onScrollY(e,this.totalHeight)}#updateSize(){this.#updateScroller(),this.#updateContent()}#updateScroller(){if(0==this.totalHeight)this.scroller.style.display="none";else if(this.totalHeight<=this.height)this.scroller.style.display="none";else{this.scroller.style.display="block",this.scroller.style.height=this.height+"px";var t=this.height/this.totalHeight;let e=this.height*t;e<20&&(e=20),this.slider.style.height=e+"px",this.sliderHeight=e,this.#updateSliderPos()}}#updateSliderPos(){var e=Math.floor((this.height-this.sliderHeight)*this.posY);this.slider.style.top=e+"px"}#updateContent(){var e;this.totalHeight<=this.height?this.alignBottom?this.area.style.top=this.height-this.totalHeight+"px":this.area.style.top="0px":(e=this.totalHeight-this.height,e=Math.ceil(this.posY*e),this.area.style.top=-e+"px")}static createContent(e){var t=dom.createElement("div","slider"),i=dom.createElement("div","v-scroller"),t=(i.appendChild(t),dom.createElement("div","shadow")),a=dom.createElement("div","content"),s=(a.setAttribute("tabindex","0"),dom.createElement("div","area"));s.appendChild(t),s.appendChild(a),e.appendChild(i),e.appendChild(s),e.classList.add("scrollable")}static create(e){return Lr.createContent(e),new Lr(e)}static createElement(e){var t=dom.renderTemplate("scrollable");return e&&e.appendChild(t),t}static createMixin(e){return{area:e,...Ar}}}Object.assign(Lr.prototype,Ar);(class extends null{});const jr="hidden";class Mr{constructor(e){let t="string"==typeof e?document.getElementById(e):e;"TEMPLATE"==t.tagName&&(t=dom.renderTemplate(t.id)),this.container=t}set id(e){this.container.dataset.id=e}get id(){return this.container.dataset.id||this.container.id}get headerElement(){return this.container.querySelector(":scope > .header")}get editorElement(){return this.container.querySelector(".editor")}get active(){return!this.container.classList.contains(jr)}get viewport(){return this.container.getBoundingClientRect()}set mode(e){e?this.container.setAttribute("mode",e):this.container.removeAttribute("mode")}onAction(){}onCommand(){}onEditorAction(){}onInput(){}onChange(){}onFilter(){}onKeyPress(){}onClick(){}onLinkClick(){}onElementClick(){}onResize(){}loadAutocomplete(){}static createHeader(e){var t=dom.createElement("div","header");return e.appendChild(t),t}static createEditor(e){var t=dom.createElement("div","editor");return e.appendChild(t),t}}const Ir={hide(){this.container.classList.add(jr)},show(){this.container.classList.remove(jr)},getElementByClass(e){return this.container.querySelector(":scope > ."+e)},getButton(e){return this.container.querySelector(`button[name="${e}"]`)},showLoading(){var e=dom.createElement("div","loader");return this.container.appendChild(e),e},query(e){return this.container.querySelector(e)},appendChild(e,t=!1){t&&this.container.firstElementChild?dom.insertBefore(e,this.container.firstElementChild):this.container.appendChild(e)},removeChilds(){dom.removeChilds(this.container)},clearContent(){this.container.innerHTML=""},removeSelf(){dom.removeElement(this.container)},updateTimes(e=Date.now()){dom.updateElapsed(this.container,e)},addStyle(...e){this.container.classList.add(...e)},toggleLoading(e="loading3"){return this.container.classList.toggle(e)},addTemplate(e,t,i="div",...a){e=dom.renderTemplate(e,t,i,...a);return this.container.appendChild(e),e},queryElement(e){return this.container.querySelector(e)},querySelector(e){return this.container.querySelector(e)},querySelectorAll(e){return this.container.querySelectorAll(e)}};Object.assign(Mr.prototype,Ir);class Dr extends Mr{get sashElement(){return this.container.querySelector("div.v-sash")}get sidebarElement(){return this.container.querySelector("div.sidebar")}get meta(){return{}}static createMixin(e){return{container:e,...Ir}}}class Or{constructor(){this.pages=new Map,this.current=null}get currentPage(){return this.pages.get(this.current)}}var Pr,Rr,zr,Br,m={addPage(e,t){let i=t;if("string"!=typeof t)return t.hide(),this.pages.set(e,t),i;t=document.getElementById(t),(i=new Dr(t)).hide(),this.pages.set(e,i)},switchTo(e){if(this.current==e)return this.pages.get(e);if(this.current){const t=this.pages.get(this.current);t.hide()}const t=this.pages.get(e);return t&&(t.show(),this.current=e),t},getPage(e){return this.pages.get(e)},getCurrentPage(){return this.pages.get(this.current)},remove(e){let t;"string"==typeof e?(t=e,e=this.pages.get(t)):t=e.id;e=e.container;dom.removeElement(e),this.pages.delete(t)}};Object.assign(Or.prototype,m);const Nr=Object.assign({addItem(e,t=!1){var i=e.create();return e.render(i),this.append(i),t&&this.area.insertBefore(i,this.area.firstElementChild),i},addItemTemplate(t,e,i=!1,...a){var s=this.elementTag||"div";let r=[];0<a.length&&Array.isArray(a[0])&&(r=a.shift());t=dom.renderTemplate(t,e,s,...r);if(t.classList.add("item"),!t.dataset.id&&e.id&&(t.dataset.id=e.id),0<a.length&&t.classList.add(...a),this.append(t),i){let e=this.area.firstElementChild;"li"===s&&e&&"LH"==e.tagName&&(e=e.nextElementSibling),this.area.insertBefore(t,e)}return t},addGroup(e={},t=!1){return y.createGroup(this.area,e,t)},addContent(e={}){var e=Object.assign({template:"list-group-content",item:"list-base-item",hide:!1,empty:!1,draggable:!1,visible:-1>>>0},e),t=dom.renderTemplate(e.template,e);return e.name&&t.setAttribute("name",e.name),e.id&&(t.dataset.id=e.id),top?this.area.insertBefore(t,this.area.firstElementChild):this.area.appendChild(t),Fr(t,e)},wrapGroup(e,t){e="string"==typeof e?this.area.querySelector(`[group="${e}"]`):e;return y.wrapGroup(e,t)},open(e){e&&(e=this.getElement(e))&&!e.hasAttribute("selected")&&(this.clearSelection(),e.setAttribute("selected",""))},clearSelection(){y.clearSelection(this.area)},getSelected(){return this.querySelector(".item[selected]")},selectItem(e){var t=this.getSelected();if(t){if(t.dataset.id==e)return;t.removeAttribute("selected")}t=this.getElement(e);return t&&t.setAttribute("selected",""),t},delete(e){e=this.getElement(e);return e&&e.parentElement.removeChild(e),e},getElement(e){return this.area.querySelector(`.item[data-id="${e}"]`)},getElements(e){return Array.from(this.querySelectorAll(e?`.item[data-id="${e}"]`:".item[data-id]"))},getLastElement(){return this.area.lastElementChild},getElementBy(e,t){return this.area.querySelector(`.item[data-${e}="${t}"]`)},getElementsBy(e,t){return this.area.querySelectorAll(`.item[data-${e}="${t}"]`)},getElementByClass(e){return this.area.querySelector(".item."+e)},getElementIds(){return this.getElements().map(e=>e.dataset.id)},getItem(e){return this.area.querySelector(`:scope > .item[data-id="${e}"]`)},getItems(e,t,i=":scope > .item"){return e&&(i+=t?`[data-${e}="${t}"]`:`[data-${e}]`),this.area.querySelectorAll(i)},queryItems(e){return this.area.querySelectorAll(":scope > .item "+e)},registerClickHandlers(){this.area.onclick=a=>{a=a.target;if(!y.handleClick(a,this)&&"BUTTON"===a.tagName){var e=a.closest(".item[data-id]");let i;if(e)i=e.dataset.id;else{let e,t=a.closest(".group");(e=t?t.querySelector("[group]"):a.closest("[group]"))&&(i=e.getAttribute("group"))}this.onAction(a.name,i,a)}}},filter(e,t=".item"){if(e&&""!=e){var i=new RegExp(e,"i");const s=this.getItems("name",null,t);for(const r of s){var a=r.dataset.name;i.test(a)?r.classList.remove("filter"):r.classList.add("filter")}}else{const s=this.querySelectorAll(".item[data-name].filter");for(const n of s)n.classList.remove("filter")}},filterDelay(e,a,s=[".name"]){const r=()=>{for(const e of this.getItems())dom.showElement(e)};this._filter=e.toLowerCase(),e.length<3?r():(this._filterTimeout&&clearTimeout(this._filterTimeout),this._filterTimeout=setTimeout(async()=>{if(this._filter.length<3)r();else{this.toggleLoading(),a.disabled=!0,await sleep(800),a.disabled=!1,a.focus(),this.toggleLoading();for(const t of this.getItems()){let e=!1;for(const i of s)if(-1!=t.querySelector(i).innerText.toLowerCase().search(this._filter)){e=!0;break}e?dom.showElement(t):dom.hideElement(t)}}delete this._filter,delete this._filterTimeout},1e3))},sort(e){var t=this.getItems();for(const i of[].slice.call(t).sort(e))this.area.appendChild(i)},clear(){for(const e of this.getElements())dom.removeElement(e)},toggleLoading(){return dom.toggleLoading(this.area)},async loadGroups(){for(const e of this.area.querySelectorAll("[group][ds]"))await y.loadGroup(e)}},Ar);class y extends Lr{set hover(e){e?this.containerElement.removeAttribute("nohover"):this.containerElement.setAttribute("nohover","")}scrollToItem(e){e=this.getElement(e);e&&(this.scrollTo(e),dom.highlightElement(e))}static create(e){e=y.createElement(e);return new y(e)}static createElement(e){e=Lr.createElement(e);return e.classList.add("list2"),e.tabIndex=0,e}static createItemElement(t){var e=document.createElement("div");return e.classList.add("item",...t.template.split(" ")),t.id&&(e.dataset.id=t.id),t.draggable&&(e.draggable=!0,e.addEventListener("dragstart",e=>t.setDraggableData(e.dataTransfer))),e}static clearSelection(e){for(const t of e.querySelectorAll(".item[selected]"))t.removeAttribute("selected")}static createMixin(e,t="div"){return{area:e,elementTag:t,...Nr}}static createPageMixin(e,t="div"){return{container:e,area:e,elementTag:t,...Ir,...Nr}}static createGroup(e,t,i=!1){t=Object.assign({template:"list-group",item:"list-base-item",badge:!1,collapse:!0,hide:!1,empty:!1,draggable:!1,visible:-1>>>0},t);let a,s;return s=t.template?(a=dom.renderTemplate(t.template,t)).querySelector(".content"):a=dom.createElement("div","list"),t.classes&&a.classList.add(...Array.isArray(t.classes)?t.classes:t.classes.split(" ")),t.badge&&a.classList.add("badge"),t.name&&a.setAttribute("name",t.name),t.id&&(a.dataset.id=t.id),i?e.insertBefore(a,e.firstElementChild):e.appendChild(a),t.help&&(i=dom.renderTemplate(t.help),s.classList.add("help"),s.appendChild(i)),Fr(s,t)}static wrapGroup(a,e){var t=y.createMixin(a);const s=e||a.getAttribute("template")||"list-base-item";e=parseInt(a.getAttribute("visible")||5);return a.dataset.count||(a.dataset.count=e),t.add=function(e,t=!1,...i){var e=this.addItemTemplate(s,e,t,...i),i=this.childCount();return parseInt(a.dataset.count)<i&&(t||(dom.hideElement(e),(i=a.closest(".group"))&&(t=i.querySelector('[name="_more"]'))&&dom.showElement(t))),e},t.get=function(e){return this.getItem(e)},t.load=async function(e){for(const t of await e.ls())this.add(t)},t.push=function(...e){for(const t of e)this.add(t)},t}static async loadGroup(e){var t=y.wrapGroup(e),i=app.ds(e.getAttribute("ds"));t.toggleLoading(),i=await delayResolve(i.load(t),1200),t.toggleLoading(),(t=e.closest(".group"))&&(e=t.querySelector('[name="_more"]'))&&(i?dom.showElement(e):dom.hideElement(e))}static handleClick(e,t){if("BUTTON"==e.tagName)switch(e.name){case"_less":var i=e.parentElement.nextElementSibling,a=parseInt(i.getAttribute("visible")),s=qr(i).reverse(),r=s.length-a>=a?a:s.length-a;for(let e=0;e<r;++e)dom.hideElement(s[e]);return i.classList.add("more"),s.length-r<=a&&i.parentElement.classList.remove("less"),!0;case"_up":var n,o=e.closest(".group");if(o)for(;;)if(!(n=o.previousElementSibling)||!n.classList.contains("group")||(dom.moveUp(o),dom.isElementVisible(n)))break;return!0;case"rm":var l,a=e.closest(".item");a&&((i=a.closest("[group]"))&&((l=i.querySelector(":scope > .item.hidden"))&&dom.showElement(l),i.closest(".group")),dom.removeElement(a))}else if("A"==e.tagName)switch(e.name){case"_more":var c=e.closest(".group");if(c){var d=c.querySelector("[group]");if(d){var h=parseInt(d.getAttribute("visible")||5),u=parseInt(d.dataset.count||h),u=(d.dataset.count=u+h,qr(d,!1).slice(0,h));for(const v of u)dom.showElement(v);u.length<h&&(dom.hideElement(e),d.hasAttribute("ds"))&&y.loadGroup(d)}u=c.querySelector('[name="_less"]');u&&dom.showElement(u)}return!0;case"_less":h=e.closest(".group");if(h){d=h.querySelector("[group]");if(d){var c=parseInt(d.getAttribute("visible")||5),u=parseInt(d.dataset.count||c),p=u-c,d=(d.dataset.count=p,qr(d)),u=c-(u-d.length);for(const w of d.reverse().slice(0,u))dom.hideElement(w);p==c&&dom.hideElement(e)}d=h.querySelector('[name="_more"]');d&&dom.showElement(d)}return!0}else{if(e.hasAttribute("grouphdr"))return e.parentElement.classList.toggle("collapsed"),!0;if(e.hasAttribute("group")&&e.classList.contains("more")){var m=parseInt(e.getAttribute("visible")),g=e.querySelectorAll(":scope > .item.hidden"),f=Math.min(g.length,m);for(let e=0;e<f;++e)dom.showElement(g[e]);return g.length<=m&&e.classList.remove("more"),e.parentElement.classList.add("less"),!0}}t&&e.classList.contains("item")&&(m=e.dataset.id,t.onClick(m,e))}}Object.assign(y.prototype,Nr);function Fr(o,l){return l.hide&&o.classList.add("hidable"),l.empty&&o.classList.add("show-empty"),l.count&&o.classList.add("count"),l.hideFirst&&o.classList.add("hide-first"),l.cmd&&o.setAttribute("cmd",l.cmd),l.ds&&o.setAttribute("ds",l.ds),l.item&&o.setAttribute("template",l.item),{count:0,...y.createMixin(o),addTemplate(e,t,i=!1,a=[],...s){let r=!1;l.visible&&(n=l.visible,r=!i,this.count>n?o.classList.add("more"):this.count<n&&(r=!1)),++this.count;var n=this.addItemTemplate(e,t,i,a,...s);return l.draggable&&(n.draggable=!0),r&&dom.hideElement(n),n},add(...e){return this.addTemplate(l.item,...e)},get(e){return this.getItem(e)},async load(e,t){e=await e.ls();t&&e.sort(t);for(const i of e)this.add(i)},push(...e){for(const t of e)this.add(t)}}}function qr(e,t=!0){return Array.from(e.querySelectorAll(":scope > .item"+(t?":not(.hidden)":".hidden")))}class Ur extends Dr{get scrollableElement(){return this.query(".editor .scrollable")}get scrollableContent(){return this.query(".editor .scrollable > .area > .content")}set bottom(e){this.area.setAttribute("bottom","")}get height(){return this.scrollableElement.getBoundingClientRect().height}constructor(e,t={}){let i;(i=e?"string"==typeof e?document.getElementById(e):e:dom.renderTemplate("editor-base",t,"div","editor-header-grid","editor-scrollable")).querySelector("div.header")||Ur.createHeader(i);let a=i.querySelector("div.editor"),s=(a=a||Ur.createEditor(i)).querySelector(".scrollable");s=s||Lr.createElement(a),super(i),this.area=s.querySelector(".content")}onScrollY(){}onResize(){}registerEvents(){}}Object.assign(Ur.prototype,Ar);class $r extends Ur{constructor(e){super(e),this.scrollableElement.classList.add("list2")}}Object.assign($r.prototype,Nr);class Hr extends $r{onFilter(e){1!=e.length&&this.filter(e)}}class Wr extends Hr{pages=new Map;get currentPage(){return this.pages.get(this.current)}}Object.assign(Wr.prototype,m),window.UX={Scrollable:Lr,ScrollableMixin:Ar,List:y,ListMixin:Nr,ListItem:class{constructor(e){this.info=e}get template(){return"column"}get id(){return this.info.id}get draggable(){return!1}create(){return y.createItemElement(this)}render(){}},Page:Dr,PageController:Or,PageControllerMixin:m,ScrollablePage:Ur,ListPage:Hr,ListPageController:Wr};class Vr{#setup=!1;get name(){return"app"}get version(){return 1}get isSetup(){return this.#setup}async init(){if(!window.indexedDB)throw new Error("IndexDB is not supported");this.db=await this.#openDatabase(),this.isSetup&&await this.setup()}needSetup(e){return 0==e}setup(){}ls(e,t=!1,i=0,a=100){return this.#getAll(v(e),t,i,a)}tail(e,t=0,i=50){return this.#getAll(v(e),!0,t,i)}lsByIndex(e,t,i,a=!1,s=30,r=0){return this.#getAllByIndex(v(e),t,i,r,s,a)}lsByRating(e,t,i){return this.#getAllBy(v(e),"rating",t,i,!0)}lsByRange(e,t,i,a,s=!1,r=50){return this.#getByRange(v(e),t,i,a,s,r)}count(e){return this.#count(v(e))}put(e,t){return Vr.put(this.db,v(e),t)}update(e,...t){return this.#update(v(e),...t)}updateByIndex(e,...t){return this.#updateByIndex(v(e),...t)}push(e,...t){return this.#push(v(e),...t)}get(e,t){return this.#getById(v(e),t)}rm(e,t){return this.#rm(v(e),t)}rmByIndex(e,t,i){return this.#rmByIndex(v(e),t,i)}pushValue(e,t,i,a){return this.#pushValue(v(e),t,i,a)}pushValueByIndex(e,t,i,a,s){return this.#pushValueByIndex(v(e),t,i,a,s)}deleteValue(e,...t){return this.#deleteValue(v(e),...t)}deleteValueByIndex(e,...t){return this.#deleteValueByIndex(v(e),...t)}add(e,t){return this.#add(v(e),t)}getById(e){return this.#getById(kContact,e)}getByEmail(e){return this.#getByIndex(kContact,"email",e)}getByIndex(e,t,i){return this.#getByIndex(e,t,i)}#openDatabase(){const a=this.name,s=this.version;return new Promise((t,i)=>{var e=indexedDB.open(a,s);e.onerror=e=>{console.error("Database error: "+e.target.errorCode),i(e.target.errorCode)},e.onsuccess=e=>{e=e.target.result;t(e)},e.onupgradeneeded=e=>{var t=e.target.result,i=e.target.transaction,e=e.oldVersion;this.onUpgrade(t,i,e),this.needSetup(e)&&(this.#setup=!0)}})}#getAllByIndex(o,l,c,d=0,h=50,u=!1){return new Promise((i,t)=>{var e=this.db.transaction(o,"readonly").objectStore(o),a=c?IDBKeyRange.only(c):IDBKeyRange.lowerBound(0),e=e.index(l).openCursor(a,u?"prev":"next");let s=0==d,r=0;const n=[];e.onsuccess=e=>{var t,e=e.target.result;e?s?(t=e.value,n.push(t),++r<h?e.continue():i(n)):(s=!0,e.advance(d)):i(n)},e.onerror=e=>{t(e)}})}addOne(a,s){return new Promise((e,t)=>{var i=this.db.transaction(a,"readwrite").objectStore(a).add(s);i.onsuccess=e,i.onerror=t})}#rm(a,s){return new Promise((t,i)=>{var e=this.db.transaction(a,"readwrite").objectStore(a),e=s?e.delete(s):e.clear();e.onsuccess=function(e){t()},e.onerror=function(e){e.target.errorCode,i(e.target.errorCode)}})}#rmByIndex(a,s,r){return new Promise((t,e)=>{var i=this.db.transaction(a,"readwrite").objectStore(a).index(s).openCursor(r);i.onerror=t,i.onsuccess=e=>{e=e.target.result;e?(e.delete(),e.continue()):t()}})}#add(e,t){const a=this.db.transaction(e,"readwrite").objectStore(e);(t=Array.isArray(t)?t:[t]).map(e=>e.id);var i=[];for(const s of t)i.push(new Promise((t,e)=>{var i=a.add(s);i.onsuccess=function(e){t()},i.onerror=e}));return Promise.all(i)}#update(t,n,o,l={}){return new Promise((a,s)=>{const r=this.db.transaction(t,"readwrite").objectStore(t);var e=r.openCursor(IDBKeyRange.only(n));e.onsuccess=e=>{var t,e=e.target.result;let i;(i=e?(t=Object.assign(e.value,o),Object.deleteUndefined(t),e.update(t)):(e={id:n,...l,...o},r.add(e))).onsuccess=function(e){a()},i.onerror=s},e.onerror=s})}#updateByIndex(t,i,n,o,l={}){return new Promise((a,s)=>{const r=this.db.transaction(t,"readwrite").objectStore(t);var e=r.index(i).openCursor(n);e.onsuccess=e=>{var t,e=e.target.result;let i;(i=e?(t=Object.assign(e.value,o),Object.deleteUndefined(t),e.update(t)):(e={...l,...o},r.add(e))).onsuccess=function(e){a()},i.onerror=s},e.onerror=s})}#pushValue(a,s,r,n){return new Promise((e,t)=>{var i=this.db.transaction(a,"readwrite").objectStore(a).openCursor(IDBKeyRange.only(s));Xr(r,n,i,e,t)})}#pushValueByIndex(a,s,r,n,o){return new Promise((e,t)=>{var i=this.db.transaction(a,"readwrite").objectStore(a).index(s).openCursor(r);Xr(n,o,i,e,t)})}#deleteValue(a,s,r,n){return new Promise((e,t)=>{var i=this.db.transaction(a,"readwrite").objectStore(a).openCursor(IDBKeyRange.only(s));Yr(r,n,i,e,t)})}#deleteValueByIndex(a,s,r,n,o){return new Promise((e,t)=>{var i=this.db.transaction(a,"readwrite").objectStore(a).index(s).openCursor(r);Yr(n,o,i,e,t)})}#push(t,s,r,n){return new Promise((i,a)=>{var e=this.db.transaction(t,"readwrite").objectStore(t).openCursor(IDBKeyRange.only(s));e.onsuccess=e=>{var e=e.target.result;if(!e)return a("Appending to non-existing record");var t=e.value;t[r]?t[r].push(n):t[r]=[n],t.ts&&(t.ts=Date.seconds()),(e=e.update(t)).onsuccess=function(e){i()},e.onerror=function(e){e.target.errorCode,a(e.target.errorCode)}},e.onerror=a})}#getById(a,s){return new Promise((t,e)=>{var i=this.db.transaction(a,"readonly").objectStore(a).get(s);i.onsuccess=e=>{e.target.result?t(e.target.result):t(null)},i.onerror=e})}#getByIndex(a,s,r){return new Promise((t,e)=>{let i=this.db.transaction(a,"readonly").objectStore(a).index(s).get(r);i.onsuccess=e=>{t(i.result)},i.onerror=e})}#getAll(r,n,e,o){return new Promise((i,e)=>{var t=this.db.transaction(r,"readonly").objectStore(r);const a=[];t=t.openCursor(null,n?"prev":"next");let s=0;t.onsuccess=e=>{var t,e=e.target.result;e&&(t=e.value,a.push(t),++s<o)?e.continue():i(a)},t.onerror=e})}#getAllBy(o,l,c=0,d=50,h=!1){return new Promise((i,e)=>{var t=this.db.transaction(o,"readonly").objectStore(o),a=IDBKeyRange.lowerBound(0),t=t.index(l).openCursor(a,h?"prev":"next");let s=0==c,r=0;const n=[];t.onsuccess=e=>{var t,e=e.target.result;e?s?(t=e.value,n.push(t),++r<d?e.continue():i(n)):(s=!0,e.advance(c)):i(n)},t.onerror=e})}#getByRange(n,o,l,c,d=!1,h=50){return new Promise((i,e)=>{var t=this.db.transaction(n,"readonly").objectStore(n);let a;a=l?c?IDBKeyRange.bound(l,c,!1,!0):IDBKeyRange.lowerBound(l):IDBKeyRange.upperBound(c,!0);t=t.index(o).openCursor(a,d?"prev":"next");const s=[];let r=0;t.onsuccess=e=>{var t,e=e.target.result;e&&(t=e.value,s.push(t),++r<h)?e.continue():i(s)},t.onerror=e})}#count(a){return new Promise((t,e)=>{var i=this.db.transaction(a,"readonly").objectStore(a).count();i.onsuccess=e=>{e=e.target.result;t(e)},i.onerror=e})}#clear(a){return new Promise((e,t)=>{var i=this.db.transaction(a,"readonly").objectStore(a).clear();i.onsuccess=()=>e(),i.onerror=t})}delete(r,n,o,l){return new Promise((t,e)=>{var i=this.db.transaction(r,"readwrite").objectStore(r);let a,s;(s=n?(a=o==l?IDBKeyRange.only(o):o?l?IDBKeyRange.bound(o,l,!1,!0):IDBKeyRange.lowerBound(o):IDBKeyRange.upperBound(l,!0),i.index(n).openCursor(a)):i.openCursor()).onsuccess=e=>{e=e.target.result;e?(e.delete(),e.continue()):t()},s.onerror=e})}static put(e,t,i){const a=e.transaction(t,"readwrite").objectStore(t);var s=[];for(const r of i=Array.isArray(i)?i:[i])s.push(new Promise((t,e)=>{var i=a.put(r);i.onsuccess=function(e){t()},i.onerror=e}));return Promise.all(s)}static addTable=w;static addIndex=b;static deleteTable=Gr;static deleteIndex=Kr}function Xr(i,a,e,s,r){e.onsuccess=e=>{var t,e=e.target.result;e?((t=e.value)[i]||(t[i]=[]),Array.isArray(a)?t[i].push(...a):t[i].push(a),(e=e.update(t)).onsuccess=s,e.onerror=r):s()},e.onerror=r}function Yr(a,s,e,r,n){e.onsuccess=e=>{var t,i,e=e.target.result;e?(i=(t=e.value)[a],Array.isArray(i)&&s?t[a]=i.filter(e=>e!=s):delete t[a],(i=e.update(t)).onsuccess=function(e){r()},i.onerror=n):r()},e.onerror=n}function v(e){return"article"===e?"news":e}function w(e,t,i=!1,a="id"){e.createObjectStore(t,{keyPath:a,autoIncrement:i})}function Gr(e,t){e.deleteObjectStore(t)}function b(e,t,i,a=!1,s=t){i.objectStore(e).createIndex(s,t,{unique:a})}function Kr(e,t,i){i.objectStore(e).deleteIndex(t)}class Zr{#audio;#state="stopped";#mode="player";#queue=[];#recent=[];#current;#player;#progress;#offset=0;#duration=0;#radio=!1;get queueCount(){return this.#queue.length}get recent(){return this.#recent.reverse()}get videoElement(){return this.#audio}get isPlaying(){return"playing"==this.#state}get current(){return this.#current}constructor(){var e=Jr();e.onplaying=()=>this.#onPlaying(),e.onended=()=>this.#onEnd(),e.onpause=()=>this.#onPause(),e.onloadedmetadata=e=>{},this.#audio=e}registerEvents(){app.on("call",e=>this.#oncall(e.detail)),app.on("hangup",e=>this.#oncallend(e.detail))}pause(){this.#pause(),this.#state="paused",this.#progress&&(clearInterval(this.#progress),this.#progress=null)}resume(){this.#audio.play()}playYoutube(e){var t=e.dataset.id;if(this.#player){this.#player.stopVideo();const i=document.getElementById("player"),e=i.previousElementSibling;dom.showElement(e),dom.removeElement(i)}dom.hideElement(e);const i=dom.createElement("div");i.id="player",dom.insertAfter(i,e),this.#player=new YT.Player("player",{videoId:t,events:{onReady:function(e){e.target.playVideo()}}})}onYoutubeStateChange(){}onYoutubeError(e){console.error("YT player on error",e)}playFile(e,t=!1){if(e=Number(e),!t||!(0<this.#queue.length||"stopped"!=this.#state))return this.#playFile(e);this.#queue.includes(e)||(this.#queue.push(e),app.emit("trackqueued",e))}playNext(){var e;if(0!=this.#queue.length)return e=this.#queue.shift(),this.#playFile(e)}playPrev(){var e;if(!(this.#recent.length<2))return e=this.#recent[this.#recent.length-2],this.#playFile(e.id)}clear(){this.#recent=[]}remove(e){e=this.#queue.indexOf(e);-1!=e&&this.#queue.splice(e,1)}playRadio(e,t){this.#playRadio(e,t)}#playRadio(e,t){if(this.#radio)switch(t){case"play":this.#audio.src;this.resume();break;case"pause":this.pause()}else this.pause(),this.#radio=!0,this.#audio.src="http://127.0.0.1:8000/test",this.resume()}async#playFile(t){this.#offset=0,50<this.#recent.length&&this.#recent.shift();let e;var i=this.#recent.findIndex(e=>e.id==t),i=(-1!=i?(e=this.#recent[i],this.#recent.splice(i,1)):e=await app.db.get("audio",t),e.rating++,await app.db.update("audio",t,{rating:e.rating}),this.#current=e,this.#recent.push(e),this.#audio.src),i=(i&&!i.startsWith("http")&&URL.revokeObjectURL(i),URL.createObjectURL(e.file));this.#audio.src=i,this.#audio.play()}#oncall(){"playing"===this.#state&&this.#pause()}#oncallend(){"playing"===this.#state&&this.#resume()}#pause(){this.#audio.pause()}#resume(){this.#audio.play()}#checkState(e){}async#onPlaying(){if(this.#radio,this.#state="playing",!this.#radio){this.#duration=Math.round(this.#audio.duration),this.#startMonitor();let e=!0;this.#current.meta?this.#current.meta.duration?e=!1:this.#current.meta.duration=this.#duration:this.#current.meta={duration:this.#duration},e&&await app.db.update("audio",this.#current.id,{meta:this.#current.meta});var{id:t,rating:i,file:a,type:s}=this.#current,t={id:t,rating:i,file:a,type:s,duration:this.#duration},i=this.#current.meta;i&&(t.meta=i,t.title=fileX.getTitleFromMeta(t),t.desc=fileX.getDescriptionFromMeta(t)),app.addRecent("player",t),app.emit("trackchange",t)}}#onPause(){this.#stopMonitor(),app.emit("trackpause")}#onEnd(){0<this.#queue.length?this.playNext():(this.#stopMonitor(),this.#state="stopped",app.emit("trackstop"))}#createVideo(){}#startMonitor(){this.#progress||(this.#progress=setInterval(()=>app.emit("trackprogress",{sec:++this.#offset,total:this.#duration}),1e3))}#stopMonitor(){this.#progress&&(clearInterval(this.#progress),this.#progress=null)}}function Jr(){var e=dom.createElement("video");return e.controls=!0,e.disablePictureInPicture=!0,e.disableRemotePlayback=!0,e.setAttribute("controlslist","nodownload"),e}const Qr="base16-dark";function en(e){var t={js:"javascript",md:{name:"markdown",highlightFormatting:!0},html:"htmlmixed",css:"css"}[e];if(t)return t;throw new Error("Unsupported code editor mode:",e)}function tn(e={mode:"js"}){return Object.assign({keyMap:"vim",lineNumbers:!0,autoRefresh:!0,lineWrapping:!0,scrollbarStyle:"overlay",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{"Ctrl-Space":"autocomplete"},autoCloseTags:!0,matchBrackets:!0,autoCloseBrackets:!0},e)}const an=class{static createTextArea(e){var t=document.createElement("textarea");return e.appendChild(t),CodeMirror.fromTextArea(t,{mode:"javascript",keyMap:"vim",lineNumbers:!0,autoRefresh:!0,lineWrapping:!0,scrollbarStyle:"overlay",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]})}static async create(e,t="js",i=!1){t=en(t),await 0,t=tn({mode:t});return i&&(t.theme=Qr),CodeMirror(e,t)}static async bind(e,t="js",i=!1){t=en(t),await 0,t=tn({mode:t,height:"auto",viewportMargin:1/0});return i&&(t.theme=Qr),CodeMirror.fromTextArea(e,t)}};function sn(d,h){var u;function i(e){if(e){for(var t=e,i=0;i<t.length;i++)t[i].classList.remove("autocomplete-active");e[u=(u=u>=e.length?0:u)<0?e.length-1:u].classList.add("autocomplete-active")}}function p(e){for(var t=document.getElementsByClassName("autocomplete-items"),i=0;i<t.length;i++)e!=t[i]&&e!=d&&t[i].parentNode.removeChild(t[i])}d.name,d.addEventListener("input",function(e){var t,i,a=this.value;if(p(),delete this.dataset.id,!a)return!1;u=-1;var s=[];for(const l of h)(i="string"==typeof l?l:l.name).substr(0,a.length).toUpperCase()==a.toUpperCase()&&s.push(l);if(0!=s.length){(t=dom.createElement("div","autocomplete-items")).setAttribute("id",this.id+"autocomplete-list"),this.getBoundingClientRect().width,t.style.maxWidth=this.getBoundingClientRect().width+"px";var r=Lr.create(t);this.parentNode.appendChild(t);for(const c of s){var n=dom.createElement("div","item"),o="object"==typeof c;let e="";i=o?(c.photo?e+=`<img src="${c.photo}" class="photo">`:c.icon,e+=`<i class="${c.icon}"></i>`,c.name):c,e=(e+="<strong>"+i.substr(0,a.length)+"</strong>")+i.substr(a.length),o&&c.id?e+=`<input type="hidden" value="${i}" data-id="${c.id}">`:e+="<input type='hidden' value='"+i+"'>",n.innerHTML=e,n.addEventListener("click",function(e){var t=this.getElementsByTagName("input")[0];d.value=t.value,t.dataset.id&&(d.dataset.id=t.dataset.id),p()}),r.append(n)}r.registerEvents()}}),d.addEventListener("keydown",function(e){this.id;var t=(t=document.getElementById(this.id+"autocomplete-list"))&&t.getElementsByClassName("item");40==e.keyCode?(u++,i(t)):38==e.keyCode?(u--,i(t)):13==e.keyCode&&(e.preventDefault(),-1<u)&&t&&t[u].click()}),document.addEventListener("click",function(e){p(e.target)})}function k(e,n,o,l){return new(o=o||Promise)(function(i,t){function a(e){try{r(l.next(e))}catch(e){t(e)}}function s(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?i(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(a,s)}r((l=l.apply(e,n||[])).next())})}function _(e,t,i,a){if("a"===i&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e===t&&a:t.has(e))return"m"===i?a:"a"===i?a.call(e):a?a.value:t.get(e);throw new TypeError("Cannot read private member from an object whose class did not declare it")}function rn(e,t,i,a,s){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===a?s.call(e,i):s?s.value=i:t.set(e,i)}async function nn(e,t={}){const{local:i=!1,version:a="latest",cdnUrl:s,...r}=t;var t=function(e,t,i){let a=`https://cdn.jsdelivr.net/npm/emojibase-data@${t}/`+e;return"function"==typeof i?a=i(e,t):"string"==typeof i&&(a=i+"/"+e),a}(e,a,s),n=i?localStorage:sessionStorage,e=`emojibase/${a}/`+e,o=n.getItem(e);if(o)return Promise.resolve(JSON.parse(o));o=await fetch(t,{credentials:"omit",mode:"cors",redirect:"error",...r});if(!o.ok)throw new Error("Failed to load Emojibase dataset.");t=await o.json();try{n.setItem(e,JSON.stringify(t))}catch{}return t}const on={discord:"joypixels",slack:"iamcal"};async function ln(e,t,i){return nn(`${e}/shortcodes/${null!=(e=on[t])?e:t}.json`,i)}function cn(t,i){if(0!==i.length){const a=new Set(t.shortcodes);i.forEach(e=>{e=e[t.hexcode];Array.isArray(e)?e.forEach(e=>a.add(e)):e&&a.add(e)}),t.shortcodes=[...a],t.skins&&t.skins.forEach(e=>{cn(e,i)})}return t}async function dn(s,e={}){const{compact:t=!1,flat:i=!1,shortcodes:a=[],...r}=e;var n,e=await nn(s+`/${t?"compact":"data"}.json`,r);let o=[];if(0<a.length&&(o=await Promise.all(a.map(e=>{let t;var i,a;return(t=e.includes("/")?([i,a]=e.split("/"),ln(i,a,r)):ln(s,e,r)).catch(()=>({}))}))),i){var[l,c=[]]=[e,o];const d=[];return l.forEach(e=>{if(e.skins){const{skins:t,...i}=e;d.push(cn(i,c)),t.forEach(e=>{e={...e};i.tags&&(e.tags=[...i.tags]),d.push(cn(e,c))})}else d.push(cn(e,c))}),d}return l=e,0!==(n=o).length&&l.forEach(e=>{cn(e,n)}),l}async function hn(e,t){return nn(e+"/messages.json",t)}function un(e,t){const i=e.target.closest("[data-emoji]");if(i){e=t.find(e=>e.emoji===i.dataset.emoji);if(e)return e}return null}function pn(e){var t=null==(t=window.matchMedia)?void 0:t.call(window,"(prefers-reduced-motion: reduce)");return e.animate&&(null==t||!t.matches)}function mn(e,t){return e.toLowerCase().includes(t.toLowerCase())}function gn(e,t){let i=null;return()=>{i=i||window.setTimeout(()=>{e(),i=null},t)}}function fn(t,i){let a=null;return(...e)=>{a&&window.clearTimeout(a),a=window.setTimeout(()=>{t(...e),a=null},i)}}function vn(e,t,i,a){return pn(a)&&e.animate?e.animate(t,i).finished:Promise.resolve()}function wn(e){var t=document.createElement("template");return t.innerHTML=e,null==(e=t.content)?void 0:e.firstElementChild}function yn(e){return k(this,void 0,void 0,function*(){try{return(yield fetch(e,{method:"HEAD"})).headers.get("etag")}catch(e){return null}})}function bn(t,i,a){return k(this,void 0,void 0,function*(){var e=a||i(t);return yield e.open(),e})}function kn(r,n,o){return k(this,void 0,void 0,function*(){var e,t,i=yield bn(r,n,o),[a,s]=yield function(){var{emojisUrl:e,messagesUrl:t}={emojisUrl:(e="/ui/lib/picmo")+"/data.json",messagesUrl:e+"/messages.json"};try{return Promise.all([yn(e),yn(t)])}catch(e){return Promise.all([null,null])}}();return(yield i.isPopulated())?a&&s&&(yield function(a,s,r){return k(this,void 0,void 0,function*(){let t;try{t=yield a.getEtags()}catch(e){t={}}var{storedEmojisEtag:e,storedMessagesEtag:i}=t;r===i&&s===e||([i,e]=yield Promise.all([hn(a.locale),dn(a.locale)]),yield a.populate({groups:i.groups,emojis:e,emojisEtag:s,messagesEtag:r}))})}(i,a,s)):([e,t]=yield Promise.all([hn(r),dn(r)]),yield i.populate({groups:e.groups,emojis:t,emojisEtag:a,messagesEtag:s})),i})}function _n(i,a,s,r,n){return k(this,void 0,void 0,function*(){var e=yield bn(i,a,n),t=yield function(t){return k(this,void 0,void 0,function*(){var e=(new TextEncoder).encode(t),e=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")})}(r);return(yield e.isPopulated())&&!(yield function(t,i){return k(this,void 0,void 0,function*(){var e=yield t.getHash();return i!==e})}(e,t))||(yield e.populate({groups:s.groups,emojis:r,hash:t})),e})}function xn(e,t,i,a,s){return k(this,void 0,void 0,function*(){return i&&a?_n(e,t,i,a,s):kn(e,t,s)})}class Cn{constructor(){Pr.add(this),Rr.set(this,new Map)}on(e,t,i){_(this,Pr,"m",Br).call(this,e,t,i)}once(e,t,i){_(this,Pr,"m",Br).call(this,e,t,i,!0)}off(e,t){var i=_(this,Pr,"m",zr).call(this,e);_(this,Rr,"f").set(e,i.filter(e=>e.handler!==t))}emit(t,...i){_(this,Pr,"m",zr).call(this,t).forEach(e=>{e.handler.apply(e.context,i),e.once&&this.off(t,e.handler)})}removeAll(){_(this,Rr,"f").clear()}}Rr=new WeakMap,Pr=new WeakSet,zr=function(e){return _(this,Rr,"f").has(e)||_(this,Rr,"f").set(e,[]),_(this,Rr,"f").get(e)},Br=function(e,t,i,a=!1){_(this,Pr,"m",zr).call(this,e).push({context:i,handler:t,once:a})};class En extends Cn{}class Sn extends Cn{}class x{constructor({template:e,classes:t,parent:i}){this.isDestroyed=!1,this.appEvents={},this.uiEvents=[],this.uiElements={},this.ui={},this.template=e,this.classes=t,this.parent=i,this.keyBindingHandler=this.keyBindingHandler.bind(this)}initialize(){this.bindAppEvents()}setCustomEmojis(e){this.customEmojis=e}setEvents(e){this.events=e}setPickerId(e){this.pickerId=e}emit(e,...t){this.events.emit(e,...t)}setI18n(e){this.i18n=e}setRenderer(e){this.renderer=e}setEmojiData(e){(this.emojiDataPromise=e).then(e=>{this.emojiData=e})}updateEmojiData(e){this.emojiData=e,this.emojiDataPromise=Promise.resolve(e)}setOptions(e){this.options=e}renderSync(e={}){return this.el=this.template.renderSync(Object.assign({classes:this.classes,i18n:this.i18n,pickerId:this.pickerId},e)),this.postRender(),this.el}render(e={}){return k(this,void 0,void 0,function*(){return yield this.emojiDataPromise,this.el=yield this.template.renderAsync(Object.assign({classes:this.classes,i18n:this.i18n,pickerId:this.pickerId},e)),this.postRender(),this.el})}postRender(){this.bindUIElements(),this.bindKeyBindings(),this.bindUIEvents(),this.scheduleShowAnimation()}bindAppEvents(){Object.keys(this.appEvents).forEach(e=>{this.events.on(e,this.appEvents[e],this)}),this.events.on("data:ready",this.updateEmojiData,this)}unbindAppEvents(){Object.keys(this.appEvents).forEach(e=>{this.events.off(e,this.appEvents[e])}),this.events.off("data:ready",this.updateEmojiData)}keyBindingHandler(e){var t=this.keyBindings[e.key];t&&t.call(this,e)}bindKeyBindings(){this.keyBindings&&this.el.addEventListener("keydown",this.keyBindingHandler)}unbindKeyBindings(){this.keyBindings&&this.el.removeEventListener("keydown",this.keyBindingHandler)}bindUIElements(){this.ui=Object.keys(this.uiElements).reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:this.el.querySelector(this.uiElements[t])}),{})}bindUIEvents(){this.uiEvents.forEach(e=>{e.handler=e.handler.bind(this),(e.target?this.ui[e.target]:this.el).addEventListener(e.event,e.handler,e.options)})}unbindUIEvents(){this.uiEvents.forEach(e=>{(e.target?this.ui[e.target]:this.el).removeEventListener(e.event,e.handler)})}destroy(){this.unbindAppEvents(),this.unbindUIEvents(),this.unbindKeyBindings(),this.el.remove(),this.isDestroyed=!0}scheduleShowAnimation(){if(this.parent){const t=new MutationObserver(e=>{var[e]=e;"childList"===e.type&&e.addedNodes[0]===this.el&&(pn(this.options)&&this.animateShow&&this.animateShow(),t.disconnect)});t.observe(this.parent,{childList:!0})}}static childEvent(e,t,i,a={}){return{target:e,event:t,handler:i,options:a}}static uiEvent(e,t,i={}){return{event:e,handler:t,options:i}}static byClass(e){return"."+e}}var Tn={emojiCategory:"EmojiCategory_emojiCategory__7G3mq",categoryName:"EmojiCategory_categoryName__zHcOq",noRecents:"EmojiCategory_noRecents__Pk1Ys",recentEmojis:"EmojiCategory_recentEmojis__CybhN"};class An extends x{constructor({template:e,category:t,showVariants:i,lazyLoader:a}){super({template:e,classes:Tn}),this.baseUIElements={categoryName:x.byClass(Tn.categoryName)},this.category=t,this.showVariants=i,this.lazyLoader=a}setActive(e,t,i){this.emojiContainer.setActive(e,t,i)}}var Ln={icon:"icons_icon__YUQ3S","icon-small":"icons_icon-small__fEcU6","icon-medium":"icons_icon-medium__e5lKJ","icon-large":"icons_icon-large__t5mwg","icon-2x":"icons_icon-2x__on8is","icon-3x":"icons_icon-3x__RBDYg","icon-4x":"icons_icon-4x__UjvXP","icon-5x":"icons_icon-5x__zRG9K","icon-8x":"icons_icon-8x__PsCPS","icon-10x":"icons_icon-10x__WLjku"};const jn={clock:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512zM232 256C232 264 236 271.5 242.7 275.1L338.7 339.1C349.7 347.3 364.6 344.3 371.1 333.3C379.3 322.3 376.3 307.4 365.3 300L280 243.2V120C280 106.7 269.3 96 255.1 96C242.7 96 231.1 106.7 231.1 120L232 256z"/></svg>',flag:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M64 496C64 504.8 56.75 512 48 512h-32C7.25 512 0 504.8 0 496V32c0-17.75 14.25-32 32-32s32 14.25 32 32V496zM476.3 0c-6.365 0-13.01 1.35-19.34 4.233c-45.69 20.86-79.56 27.94-107.8 27.94c-59.96 0-94.81-31.86-163.9-31.87C160.9 .3055 131.6 4.867 96 15.75v350.5c32-9.984 59.87-14.1 84.85-14.1c73.63 0 124.9 31.78 198.6 31.78c31.91 0 68.02-5.971 111.1-23.09C504.1 355.9 512 344.4 512 332.1V30.73C512 11.1 495.3 0 476.3 0z"/></svg>',frown:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM176.4 240C194 240 208.4 225.7 208.4 208C208.4 190.3 194 176 176.4 176C158.7 176 144.4 190.3 144.4 208C144.4 225.7 158.7 240 176.4 240zM336.4 176C318.7 176 304.4 190.3 304.4 208C304.4 225.7 318.7 240 336.4 240C354 240 368.4 225.7 368.4 208C368.4 190.3 354 176 336.4 176zM259.9 369.4C288.8 369.4 316.2 375.2 340.6 385.5C352.9 390.7 366.7 381.3 361.4 369.1C344.8 330.9 305.6 303.1 259.9 303.1C214.3 303.1 175.1 330.8 158.4 369.1C153.1 381.3 166.1 390.6 179.3 385.4C203.7 375.1 231 369.4 259.9 369.4L259.9 369.4z"/></svg>',gamepad:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M448 64H192C85.96 64 0 149.1 0 256s85.96 192 192 192h256c106 0 192-85.96 192-192S554 64 448 64zM247.1 280h-32v32c0 13.2-10.78 24-23.98 24c-13.2 0-24.02-10.8-24.02-24v-32L136 279.1C122.8 279.1 111.1 269.2 111.1 256c0-13.2 10.85-24.01 24.05-24.01L167.1 232v-32c0-13.2 10.82-24 24.02-24c13.2 0 23.98 10.8 23.98 24v32h32c13.2 0 24.02 10.8 24.02 24C271.1 269.2 261.2 280 247.1 280zM431.1 344c-22.12 0-39.1-17.87-39.1-39.1s17.87-40 39.1-40s39.1 17.88 39.1 40S454.1 344 431.1 344zM495.1 248c-22.12 0-39.1-17.87-39.1-39.1s17.87-40 39.1-40c22.12 0 39.1 17.88 39.1 40S518.1 248 495.1 248z"/></svg>',lightbulb:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M112.1 454.3c0 6.297 1.816 12.44 5.284 17.69l17.14 25.69c5.25 7.875 17.17 14.28 26.64 14.28h61.67c9.438 0 21.36-6.401 26.61-14.28l17.08-25.68c2.938-4.438 5.348-12.37 5.348-17.7L272 415.1h-160L112.1 454.3zM191.4 .0132C89.44 .3257 16 82.97 16 175.1c0 44.38 16.44 84.84 43.56 115.8c16.53 18.84 42.34 58.23 52.22 91.45c.0313 .25 .0938 .5166 .125 .7823h160.2c.0313-.2656 .0938-.5166 .125-.7823c9.875-33.22 35.69-72.61 52.22-91.45C351.6 260.8 368 220.4 368 175.1C368 78.61 288.9-.2837 191.4 .0132zM192 96.01c-44.13 0-80 35.89-80 79.1C112 184.8 104.8 192 96 192S80 184.8 80 176c0-61.76 50.25-111.1 112-111.1c8.844 0 16 7.159 16 16S200.8 96.01 192 96.01z"/></svg>',mug:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M512 32H120c-13.25 0-24 10.75-24 24L96.01 288c0 53 43 96 96 96h192C437 384 480 341 480 288h32c70.63 0 128-57.38 128-128S582.6 32 512 32zM512 224h-32V96h32c35.25 0 64 28.75 64 64S547.3 224 512 224zM560 416h-544C7.164 416 0 423.2 0 432C0 458.5 21.49 480 48 480h480c26.51 0 48-21.49 48-48C576 423.2 568.8 416 560 416z"/></svg>',plane:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M482.3 192C516.5 192 576 221 576 256C576 292 516.5 320 482.3 320H365.7L265.2 495.9C259.5 505.8 248.9 512 237.4 512H181.2C170.6 512 162.9 501.8 165.8 491.6L214.9 320H112L68.8 377.6C65.78 381.6 61.04 384 56 384H14.03C6.284 384 0 377.7 0 369.1C0 368.7 .1818 367.4 .5398 366.1L32 256L.5398 145.9C.1818 144.6 0 143.3 0 142C0 134.3 6.284 128 14.03 128H56C61.04 128 65.78 130.4 68.8 134.4L112 192H214.9L165.8 20.4C162.9 10.17 170.6 0 181.2 0H237.4C248.9 0 259.5 6.153 265.2 16.12L365.7 192H482.3z"/></svg>',robot:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M9.375 233.4C3.375 239.4 0 247.5 0 256v128c0 8.5 3.375 16.62 9.375 22.62S23.5 416 32 416h32V224H32C23.5 224 15.38 227.4 9.375 233.4zM464 96H352V32c0-17.62-14.38-32-32-32S288 14.38 288 32v64H176C131.8 96 96 131.8 96 176V448c0 35.38 28.62 64 64 64h320c35.38 0 64-28.62 64-64V176C544 131.8 508.3 96 464 96zM256 416H192v-32h64V416zM224 296C201.9 296 184 278.1 184 256S201.9 216 224 216S264 233.9 264 256S246.1 296 224 296zM352 416H288v-32h64V416zM448 416h-64v-32h64V416zM416 296c-22.12 0-40-17.88-40-40S393.9 216 416 216S456 233.9 456 256S438.1 296 416 296zM630.6 233.4C624.6 227.4 616.5 224 608 224h-32v192h32c8.5 0 16.62-3.375 22.62-9.375S640 392.5 640 384V256C640 247.5 636.6 239.4 630.6 233.4z"/></svg>',sad:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n  <defs>\n    <radialGradient gradientUnits="userSpaceOnUse" cy="10%" id="gradient-0">\n      <stop offset="0" style="stop-color: hsl(50, 100%, 50%);"/>\n      <stop offset="1" style="stop-color: hsl(50, 100%, 60%);"/>\n    </radialGradient>\n  </defs>\n  \x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e\n  <ellipse style="stroke: rgb(0, 0, 0); fill: rgba(0, 0, 0, 0.59);" cx="172.586" cy="207.006" rx="39.974" ry="39.974"/>\n  <ellipse style="stroke: rgb(0, 0, 0); fill: rgba(0, 0, 0, 0.59);" cx="334.523" cy="207.481" rx="39.974" ry="39.974"/>\n  <ellipse style="stroke: rgb(0, 0, 0); fill: rgba(0, 0, 0, 0.59);" cx="313.325" cy="356.208" rx="91.497" ry="59.893"/>\n  <path style="fill: rgb(85, 167, 255);" d="M 159.427 274.06 L 102.158 363.286 L 124.366 417.011 L 160.476 423.338 L 196.937 414.736 L 218.502 375.214"></path>\n  <path style="fill: url(#gradient-0);" d="M256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0zM256 352C290.9 352 323.2 367.8 348.3 394.9C354.3 401.4 364.4 401.7 370.9 395.7C377.4 389.7 377.7 379.6 371.7 373.1C341.6 340.5 301 320 256 320C247.2 320 240 327.2 240 336C240 344.8 247.2 352 256 352H256zM208 369C208 349 179.6 308.6 166.4 291.3C163.2 286.9 156.8 286.9 153.6 291.3C140.6 308.6 112 349 112 369C112 395 133.5 416 160 416C186.5 416 208 395 208 369H208zM303.6 208C303.6 225.7 317.1 240 335.6 240C353.3 240 367.6 225.7 367.6 208C367.6 190.3 353.3 176 335.6 176C317.1 176 303.6 190.3 303.6 208zM207.6 208C207.6 190.3 193.3 176 175.6 176C157.1 176 143.6 190.3 143.6 208C143.6 225.7 157.1 240 175.6 240C193.3 240 207.6 225.7 207.6 208z" />\n</svg>',search:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M500.3 443.7l-119.7-119.7c27.22-40.41 40.65-90.9 33.46-144.7C401.8 87.79 326.8 13.32 235.2 1.723C99.01-15.51-15.51 99.01 1.724 235.2c11.6 91.64 86.08 166.7 177.6 178.9c53.8 7.189 104.3-6.236 144.7-33.46l119.7 119.7c15.62 15.62 40.95 15.62 56.57 0C515.9 484.7 515.9 459.3 500.3 443.7zM79.1 208c0-70.58 57.42-128 128-128s128 57.42 128 128c0 70.58-57.42 128-128 128S79.1 278.6 79.1 208z"/></svg>',smiley:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM256.3 331.8C208.9 331.8 164.1 324.9 124.5 312.8C112.2 309 100.2 319.7 105.2 331.5C130.1 390.6 188.4 432 256.3 432C324.2 432 382.4 390.6 407.4 331.5C412.4 319.7 400.4 309 388.1 312.8C348.4 324.9 303.7 331.8 256.3 331.8H256.3zM176.4 176C158.7 176 144.4 190.3 144.4 208C144.4 225.7 158.7 240 176.4 240C194 240 208.4 225.7 208.4 208C208.4 190.3 194 176 176.4 176zM336.4 240C354 240 368.4 225.7 368.4 208C368.4 190.3 354 176 336.4 176C318.7 176 304.4 190.3 304.4 208C304.4 225.7 318.7 240 336.4 240z"/></svg>',symbols:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M500.3 7.251C507.7 13.33 512 22.41 512 31.1V175.1C512 202.5 483.3 223.1 447.1 223.1C412.7 223.1 383.1 202.5 383.1 175.1C383.1 149.5 412.7 127.1 447.1 127.1V71.03L351.1 90.23V207.1C351.1 234.5 323.3 255.1 287.1 255.1C252.7 255.1 223.1 234.5 223.1 207.1C223.1 181.5 252.7 159.1 287.1 159.1V63.1C287.1 48.74 298.8 35.61 313.7 32.62L473.7 .6198C483.1-1.261 492.9 1.173 500.3 7.251H500.3zM74.66 303.1L86.5 286.2C92.43 277.3 102.4 271.1 113.1 271.1H174.9C185.6 271.1 195.6 277.3 201.5 286.2L213.3 303.1H239.1C266.5 303.1 287.1 325.5 287.1 351.1V463.1C287.1 490.5 266.5 511.1 239.1 511.1H47.1C21.49 511.1-.0019 490.5-.0019 463.1V351.1C-.0019 325.5 21.49 303.1 47.1 303.1H74.66zM143.1 359.1C117.5 359.1 95.1 381.5 95.1 407.1C95.1 434.5 117.5 455.1 143.1 455.1C170.5 455.1 191.1 434.5 191.1 407.1C191.1 381.5 170.5 359.1 143.1 359.1zM440.3 367.1H496C502.7 367.1 508.6 372.1 510.1 378.4C513.3 384.6 511.6 391.7 506.5 396L378.5 508C372.9 512.1 364.6 513.3 358.6 508.9C352.6 504.6 350.3 496.6 353.3 489.7L391.7 399.1H336C329.3 399.1 323.4 395.9 321 389.6C318.7 383.4 320.4 376.3 325.5 371.1L453.5 259.1C459.1 255 467.4 254.7 473.4 259.1C479.4 263.4 481.6 271.4 478.7 278.3L440.3 367.1zM116.7 219.1L19.85 119.2C-8.112 90.26-6.614 42.31 24.85 15.34C51.82-8.137 93.26-3.642 118.2 21.83L128.2 32.32L137.7 21.83C162.7-3.642 203.6-8.137 231.6 15.34C262.6 42.31 264.1 90.26 236.1 119.2L139.7 219.1C133.2 225.6 122.7 225.6 116.7 219.1H116.7z"/></svg>',tree:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M413.8 447.1L256 448l0 31.99C256 497.7 241.8 512 224.1 512c-17.67 0-32.1-14.32-32.1-31.99l0-31.99l-158.9-.0099c-28.5 0-43.69-34.49-24.69-56.4l68.98-79.59H62.22c-25.41 0-39.15-29.8-22.67-49.13l60.41-70.85H89.21c-21.28 0-32.87-22.5-19.28-37.31l134.8-146.5c10.4-11.3 28.22-11.3 38.62-.0033l134.9 146.5c13.62 14.81 2.001 37.31-19.28 37.31h-10.77l60.35 70.86c16.46 19.34 2.716 49.12-22.68 49.12h-15.2l68.98 79.59C458.7 413.7 443.1 447.1 413.8 447.1z"/></svg>',users:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M224 256c70.7 0 128-57.31 128-128S294.7 0 224 0C153.3 0 96 57.31 96 128S153.3 256 224 256zM274.7 304H173.3c-95.73 0-173.3 77.6-173.3 173.3C0 496.5 15.52 512 34.66 512H413.3C432.5 512 448 496.5 448 477.3C448 381.6 370.4 304 274.7 304zM479.1 320h-73.85C451.2 357.7 480 414.1 480 477.3C480 490.1 476.2 501.9 470 512h138C625.7 512 640 497.6 640 479.1C640 391.6 568.4 320 479.1 320zM432 256C493.9 256 544 205.9 544 144S493.9 32 432 32c-25.11 0-48.04 8.555-66.72 22.51C376.8 76.63 384 101.4 384 128c0 35.52-11.93 68.14-31.59 94.71C372.7 243.2 400.8 256 432 256z"/></svg>',warning:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n  <defs>\n    <radialGradient id="radial" cy="85%">\n      <stop offset="20%" stop-color="var(--color-secondary)" />\n      <stop offset="100%" stop-color="var(--color-primary)" />\n    </radialGradient>\n  </defs>\n  \x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e\n  <path fill="url(\'#radial\')" d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z" />\n</svg>',xmark:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>'},Mn={recents:"clock","smileys-emotion":"smiley","people-body":"users","animals-nature":"tree","food-drink":"mug",activities:"gamepad","travel-places":"plane",objects:"lightbulb",symbols:"symbols",flags:"flag",custom:"robot"};function In(e,t){var i,a;return e in jn?(i=e,(a=wn(a=jn[e])).dataset.icon=i,a.classList.add(Ln.icon),i=a,t&&i.classList.add(Ln["icon-"+t]),i):(console.warn(`Unknown icon: "${e}"`),document.createElement("div"))}const Dn={mode:"sync"};class C{constructor(e,t={}){Rn.add(this),On.set(this,void 0),Pn.set(this,void 0),rn(this,On,e,"f"),rn(this,Pn,t.mode||Dn.mode,"f")}renderSync(e={}){var t=wn(_(this,On,"f").call(this,e));return _(this,Rn,"m",Nn).call(this,t,e),_(this,Rn,"m",Bn).call(this,t),_(this,Rn,"m",zn).call(this,t,e),t}renderAsync(t={}){return k(this,void 0,void 0,function*(){var e=wn(_(this,On,"f").call(this,t));return _(this,Rn,"m",Nn).call(this,e,t),_(this,Rn,"m",Bn).call(this,e),yield _(this,Rn,"m",zn).call(this,e,t),e})}render(e){return"sync"===_(this,Pn,"f")?this.renderSync(e):this.renderAsync(e)}}var On=new WeakMap,Pn=new WeakMap,Rn=new WeakSet,zn=function(a,s){return k(this,void 0,void 0,function*(){var e=[];for(const i of a.querySelectorAll("[data-view]")){var t=s[i.dataset.view];t?"sync"!==i.dataset.render?e.push(t.render().then(e=>(i.replaceWith(e),e))):i.replaceWith(t.renderSync()):i.remove()}return Promise.all(e)})},Bn=function(e){e.querySelectorAll("i[data-icon]").forEach(e=>{var{icon:t,size:i}=e.dataset;e.replaceWith(In(t,i))})},Nn=function(e,a){return e.querySelectorAll("[data-placeholder]").forEach(e=>{var t,i=e.dataset.placeholder;i&&a[i]?(t=a[i],e.replaceWith(...[t].flat())):console.warn(`Missing placeholder element for key "${i}"`)}),e},Fn=new C(({classes:e,emoji:t})=>`
  <button
    class="${e.emoji}"
    title="${t.label}"
    data-emoji="${t.emoji}"
    tabindex="-1">
    <div data-placeholder="emojiContent"></div>
  </button>
`),qn={emoji:"Emoji_emoji__iKc1G"};class Un extends x{constructor({emoji:e,lazyLoader:t,category:i}){super({template:Fn,classes:qn}),this.emoji=e,this.lazyLoader=t,this.category=i}initialize(){this.uiEvents=[x.uiEvent("focus",this.handleFocus)],super.initialize()}handleFocus(){this.category&&this.events.emit("focus:change",this.category)}activateFocus(e){this.el.tabIndex=0,e&&this.el.focus()}deactivateFocus(){this.el.tabIndex=-1}renderSync(){return super.renderSync({emoji:this.emoji,emojiContent:this.renderer.doRender(this.emoji,this.lazyLoader)})}}class $n{constructor(e,t,i=0,a=0,s=!1){this.events=new Cn,this.keyHandlers={ArrowLeft:this.focusPrevious.bind(this),ArrowRight:this.focusNext.bind(this),ArrowUp:this.focusUp.bind(this),ArrowDown:this.focusDown.bind(this)},this.rowCount=Math.ceil(t/e),this.columnCount=e,this.focusedRow=i,this.focusedColumn=a,this.emojiCount=t,this.wrap=s,this.handleKeyDown=this.handleKeyDown.bind(this)}destroy(){this.events.removeAll()}on(e,t){this.events.on(e,t)}handleKeyDown(e){e.key in this.keyHandlers&&(e.preventDefault(),this.keyHandlers[e.key]())}setCell(e,t,i=!0){var a=this.getIndex();this.focusedRow=e,void 0!==t&&(this.focusedColumn=Math.min(this.columnCount,t)),(this.focusedRow>=this.rowCount||this.getIndex()>=this.emojiCount)&&(this.focusedRow=this.rowCount-1,this.focusedColumn=this.emojiCount%this.columnCount-1),this.events.emit("focus:change",{from:a,to:this.getIndex(),performFocus:i})}setFocusedIndex(e,t=!0){var i=Math.floor(e/this.columnCount),e=e%this.columnCount;this.setCell(i,e,t)}focusNext(){this.focusedColumn<this.columnCount-1&&this.getIndex()<this.emojiCount-1?this.setCell(this.focusedRow,this.focusedColumn+1):this.focusedRow<this.rowCount-1?this.setCell(this.focusedRow+1,0):this.wrap?this.setCell(0,0):this.events.emit("focus:overflow",0)}focusPrevious(){0<this.focusedColumn?this.setCell(this.focusedRow,this.focusedColumn-1):0<this.focusedRow?this.setCell(this.focusedRow-1,this.columnCount-1):this.wrap?this.setCell(this.rowCount-1,this.columnCount-1):this.events.emit("focus:underflow",this.columnCount-1)}focusUp(){0<this.focusedRow?this.setCell(this.focusedRow-1,this.focusedColumn):this.events.emit("focus:underflow",this.focusedColumn)}focusDown(){this.focusedRow<this.rowCount-1?this.setCell(this.focusedRow+1,this.focusedColumn):this.events.emit("focus:overflow",this.focusedColumn)}focusToIndex(e){this.setCell(Math.floor(e/this.columnCount),e%this.columnCount)}getIndex(){return this.focusedRow*this.columnCount+this.focusedColumn}getCell(){return{row:this.focusedRow,column:this.focusedColumn}}getRowCount(){return this.rowCount}}var Hn=new C(({classes:e})=>`
  <div class="${e.emojiContainer}">
    <div data-placeholder="emojis"></div>
  </div>
`),Wn={emojiContainer:"EmojiContainer_emojiContainer__4SPb5"};class Vn extends x{constructor({emojis:e,showVariants:t,preview:i=!0,lazyLoader:a,category:s,fullHeight:r=!1}){super({template:Hn,classes:Wn}),this.fullHeight=!1,this.showVariants=t,this.lazyLoader=a,this.preview=i,this.emojis=e,this.category=s,this.fullHeight=r,this.setFocus=this.setFocus.bind(this),this.triggerNextCategory=this.triggerNextCategory.bind(this),this.triggerPreviousCategory=this.triggerPreviousCategory.bind(this)}initialize(){this.grid=new $n(this.options.emojisPerRow,this.emojiCount,0,0,!this.category),this.grid.on("focus:change",this.setFocus),this.grid.on("focus:overflow",this.triggerNextCategory),this.grid.on("focus:underflow",this.triggerPreviousCategory),this.uiEvents=[x.uiEvent("click",this.selectEmoji),x.uiEvent("keydown",this.grid.handleKeyDown)],this.preview&&this.uiEvents.push(x.uiEvent("mouseover",this.showPreview),x.uiEvent("mouseout",this.hidePreview),x.uiEvent("focus",this.showPreview,{capture:!0}),x.uiEvent("blur",this.hidePreview,{capture:!0})),super.initialize()}setFocusedView(t,e){if(t)if("string"==typeof t){const i=this.emojis.findIndex(e=>e.emoji===t);this.grid.setFocusedIndex(i,!1),setTimeout(()=>{var e=this.emojiViews[i].el,t=(e.scrollIntoView(),null==(t=e.parentElement)?void 0:t.previousElementSibling);(null==(e=null==(e=e.parentElement)?void 0:e.parentElement)?void 0:e.parentElement).scrollTop-=null!=(e=null==t?void 0:t.offsetHeight)?e:0})}else"first"===t.row||0===t.row?this.grid.setCell(0,t.offset,e):"last"===t.row&&this.grid.setCell(this.grid.getRowCount()-1,t.offset,e)}setActive(e,t,i){e?this.setFocusedView(t,i):null!=(e=this.emojiViews[this.grid.getIndex()])&&e.deactivateFocus()}renderSync(){return this.emojiViews=this.emojis.map(e=>this.viewFactory.create(Un,{emoji:e,category:this.category,lazyLoader:this.lazyLoader,renderer:this.renderer})),this.emojiElements=this.emojiViews.map(e=>e.renderSync()),super.renderSync({emojis:this.emojiElements,i18n:this.i18n})}destroy(){super.destroy(),this.emojiViews.forEach(e=>e.destroy()),this.grid.destroy()}triggerPreviousCategory(e){this.events.emit("category:previous",e)}triggerNextCategory(e){this.category&&this.events.emit("category:next",e)}setFocus({from:e,to:t,performFocus:i}){null!=(e=this.emojiViews[e])&&e.deactivateFocus(),null!=(e=this.emojiViews[t])&&e.activateFocus(i)}selectEmoji(e){e=un(e,this.emojis);e&&this.events.emit("emoji:select",{emoji:e,showVariants:this.showVariants})}showPreview(e){var t=e.target.closest("button"),t=null==t?void 0:t.firstElementChild,e=un(e,this.emojis);e&&this.events.emit("preview:show",e,null==t?void 0:t.cloneNode(!0))}hidePreview(e){un(e,this.emojis)&&this.events.emit("preview:hide")}get emojiCount(){return this.emojis.length}}var Xn=new C(({classes:e,category:t,pickerId:i,icon:a,i18n:s})=>`
  <section class="${e.emojiCategory}" role="tabpanel" aria-labelledby="${i}-category-${t.key}">
    <h3 data-category="${t.key}" class="${e.categoryName}">
      <i data-icon="${a}"></i>
      ${s.get("categories."+t.key,t.message||t.key)}
    </h3>
    <div data-view="emojis" data-render="sync"></div>
  </section>
`);class Yn extends An{constructor({category:e,showVariants:t,lazyLoader:i,emojiVersion:a}){super({category:e,showVariants:t,lazyLoader:i,template:Xn}),this.showVariants=t,this.lazyLoader=i,this.emojiVersion=a}initialize(){this.uiElements=Object.assign({},this.baseUIElements),super.initialize()}render(){const t=Object.create(null,{render:{get:()=>super.render}});return k(this,void 0,void 0,function*(){yield this.emojiDataPromise;var e=yield this.emojiData.getEmojis(this.category,this.emojiVersion);return this.emojiContainer=this.viewFactory.create(Vn,{emojis:e,showVariants:this.showVariants,lazyLoader:this.lazyLoader,category:this.category.key}),t.render.call(this,{category:this.category,emojis:this.emojiContainer,emojiCount:e.length,icon:Mn[this.category.key]})})}}class Gn extends Vn{constructor({category:e,emojis:t,preview:i=!0,lazyLoader:a}){super({category:e,emojis:t,showVariants:!1,preview:i,lazyLoader:a})}addOrUpdate(i){return k(this,void 0,void 0,function*(){var e=this.el.querySelector(`[data-emoji="${i.emoji}"]`),e=(e&&(this.el.removeChild(e),this.emojis=this.emojis.filter(e=>e!==i)),this.viewFactory.create(Un,{emoji:i}));if(this.el.insertBefore(e.renderSync(),this.el.firstChild),this.emojis=[i,...this.emojis.filter(e=>e!==i)],this.emojis.length>this.options.maxRecents){this.emojis=this.emojis.slice(0,this.options.maxRecents);var t=this.el.childElementCount-this.options.maxRecents;for(let e=0;e<t;e++)this.el.lastElementChild&&this.el.removeChild(this.el.lastElementChild)}})}}const Kn="PicMo:recents";function Zn(e){var t;try{return JSON.parse(null!=(t=localStorage.getItem(Kn))?t:"[]").slice(0,e)}catch(e){return[]}}function Jn(t,e){e=[t,...Zn(e).filter(e=>e.hexcode!==t.hexcode)].slice(0,e);try{localStorage.setItem(Kn,JSON.stringify(e))}catch(e){}}var Qn=new C(({emojiCount:e,classes:t,category:i,pickerId:a,icon:s,i18n:r})=>`
  <section class="${t.emojiCategory}" role="tabpanel" aria-labelledby="${a}-category-${i.key}">
  <h3 data-category="${i.key}" class="${t.categoryName}">
    <i data-icon="${s}"></i>
    ${r.get("categories."+i.key,i.message||i.key)}
  </h3>
  <div data-empty="${0===e}" class="${t.recentEmojis}">
    <div data-view="emojis" data-render="sync"></div>
  </div>
  <div class="${t.noRecents}">
    ${r.get("recents.none")}
  </div>
</section>
`,{mode:"async"});var eo=new C(({classes:e,category:t,pickerId:i,icon:a,i18n:s})=>`
  <section class="${e.emojiCategory}" role="tabpanel" aria-labelledby="${i}-category-${t.key}">
    <h3 data-category="${t.key}" class="${e.categoryName}">
      <i data-icon="${a}"></i>
      ${s.get("categories."+t.key,t.message||t.key)}
    </h3>
    <div data-view="emojis" data-render="sync"></div>
  </section>
`);class to{constructor(){this.elements=new Map}lazyLoad(e,t){return this.elements.set(e,t),e}observe(e){if(window.IntersectionObserver){const i=new IntersectionObserver(e=>{e.filter(e=>0<e.intersectionRatio).map(e=>e.target).forEach(e=>{var t=this.elements.get(e);null!=t&&t(),i.unobserve(e)})},{root:e});this.elements.forEach((e,t)=>{i.observe(t)})}else this.elements.forEach(e=>{e()})}}var io={emojis:"EmojiArea_emojis__L4mMq"};const ao=new C(({classes:e})=>`
  <div class="${e.emojis}">
    <div data-placeholder="emojis"></div>
  </div>
`,{mode:"async"}),so={recents:class extends An{constructor({category:e,lazyLoader:t}){super({category:e,showVariants:!1,lazyLoader:t,template:Qn})}initialize(){this.uiElements=Object.assign(Object.assign({},this.baseUIElements),{recents:x.byClass(Tn.recentEmojis)}),this.appEvents={"recent:add":this.addRecent},super.initialize()}addRecent(e){return k(this,void 0,void 0,function*(){yield this.emojiContainer.addOrUpdate(e),this.ui.recents.dataset.empty="false"})}render(){const t=Object.create(null,{render:{get:()=>super.render}});return k(this,void 0,void 0,function*(){var e=Zn(this.options.maxRecents);return this.emojiContainer=this.viewFactory.create(Gn,{emojis:e,showVariants:!1,lazyLoader:this.lazyLoader,category:this.category.key}),yield t.render.call(this,{category:this.category,emojis:this.emojiContainer,emojiCount:e.length,icon:Mn[this.category.key]}),this.el})}},custom:class extends An{constructor({category:e,lazyLoader:t}){super({template:eo,showVariants:!1,lazyLoader:t,category:e})}initialize(){this.uiElements=Object.assign({},this.baseUIElements),super.initialize()}render(){const e=Object.create(null,{render:{get:()=>super.render}});return k(this,void 0,void 0,function*(){return this.emojiContainer=this.viewFactory.create(Vn,{emojis:this.customEmojis,showVariants:this.showVariants,lazyLoader:this.lazyLoader,category:this.category.key}),e.render.call(this,{category:this.category,emojis:this.emojiContainer,emojiCount:this.customEmojis.length,icon:Mn[this.category.key]})})}}};function ro(e){return so[e.key]||Yn}function no(e){return e&&"button"!==e?e:{row:"first",offset:0}}class oo extends x{constructor({categoryTabs:e,categories:t,emojiVersion:i}){super({template:ao,classes:io}),this.selectedCategory=0,this.scrollListenerState="active",this.lazyLoader=new to,this.categoryTabs=e,this.categories=t,this.emojiVersion=i,this.handleScroll=gn(this.handleScroll.bind(this),100)}initialize(){this.appEvents={"category:select":this.handleCategorySelect,"category:previous":this.focusPreviousCategory,"category:next":this.focusNextCategory,"focus:change":this.updateFocusedCategory},this.uiElements={emojis:x.byClass(io.emojis)},this.uiEvents=[x.uiEvent("scroll",this.handleScroll)],super.initialize()}get focusableEmoji(){return this.el.querySelector('[tabindex="0"]')}render(){const e=Object.create(null,{render:{get:()=>super.render}});return k(this,void 0,void 0,function*(){this.emojiCategories=this.categories.map(this.createCategory,this);const i={};return this.categories.forEach((e,t)=>{i["emojis-"+e.key]=this.emojiCategories[t]}),yield e.render.call(this,{emojis:yield Promise.all(this.emojiCategories.map(e=>e.render()))}),this.lazyLoader.observe(this.el),window.ResizeObserver&&(this.observer=new ResizeObserver(()=>{var e=this.el.scrollHeight-this.scrollHeight;0==this.el.scrollTop-this.scrollTop&&0<e&&(this.el.scrollTop+=e),this.scrollHeight=this.el.scrollHeight,this.scrollTop=this.el.scrollTop}),this.emojiCategories.forEach(e=>{this.observer.observe(e.el)})),this.el})}destroy(){super.destroy(),this.emojiCategories.forEach(e=>{var t;null!=(t=this.observer)&&t.unobserve(e.el),e.destroy()})}handleCategorySelect(e,t){this.selectCategory(e,t)}createCategory(e){var t=ro(e);return this.viewFactory.create(t,{category:e,showVariants:!0,lazyLoader:this.lazyLoader,emojiVersion:this.emojiVersion})}determineInitialCategory(){var e;return this.options.initialCategory&&this.categories.find(e=>e.key===this.options.initialCategory)?this.options.initialCategory:null==(e=this.categories.find(e=>"recents"!==e.key))?void 0:e.key}determineFocusTarget(t){var e=this.emojiCategories.find(e=>e.category.key===t);return this.options.initialEmoji&&null!=e&&e.el.querySelector(`[data-emoji="${this.options.initialEmoji}"]`)?this.options.initialEmoji:"button"}reset(){this.events.emit("preview:hide");var e=this.determineInitialCategory();e&&(this.selectCategory(e,{focus:this.determineFocusTarget(e),performFocus:!0,scroll:"jump"}),this.selectedCategory=this.getCategoryIndex(e))}getCategoryIndex(t){return this.categories.findIndex(e=>e.key===t)}focusPreviousCategory(e){0<this.selectedCategory&&this.focusCategory(this.selectedCategory-1,{row:"last",offset:null!=e?e:this.options.emojisPerRow})}focusNextCategory(e){this.selectedCategory<this.categories.length-1&&this.focusCategory(this.selectedCategory+1,{row:"first",offset:null!=e?e:0})}focusCategory(e,t){this.selectCategory(e,{focus:t,performFocus:!0})}selectCategory(r,n={}){var o;return k(this,void 0,void 0,function*(){this.scrollListenerState="suspend";var{focus:e,performFocus:t,scroll:i}=Object.assign({performFocus:!1},n),a=(this.emojiCategories[this.selectedCategory].setActive(!1),this.selectedCategory="number"==typeof r?r:this.getCategoryIndex(r)),s=(null!=(o=this.categoryTabs)&&o.setActiveTab(this.selectedCategory,t,"button"===e),this.emojiCategories[a].el.offsetTop);this.emojiCategories[a].setActive(!0,no(e),"button"!==e&&t),i&&(this.el.scrollTop=s),this.scrollListenerState="resume"})}updateFocusedCategory(e){this.categories[this.selectedCategory].key!==e&&(this.scrollListenerState="suspend",this.selectedCategory=this.getCategoryIndex(e),null!=(e=this.categoryTabs)&&e.setActiveTab(this.selectedCategory,!1),this.scrollListenerState="resume")}handleScroll(){if("suspend"!==this.scrollListenerState&&this.categoryTabs)if("resume"===this.scrollListenerState)this.scrollListenerState="active";else{const i=this.el.scrollTop;var e=this.el.scrollHeight-this.el.offsetHeight,t=this.emojiCategories.findIndex((e,t)=>{return i<(null==(t=this.emojiCategories[t+1])?void 0:t.el.offsetTop)});0===i?this.categoryTabs.setActiveTab(0,!1):Math.floor(i)===Math.floor(e)||t<0?this.categoryTabs.setActiveTab(this.categories.length-1,!1):this.categoryTabs.setActiveTab(t,!1)}}}var lo=new C(({classList:e,classes:t,icon:i,message:a})=>`
<div class="${e}" role="alert">
  <div class="${t.icon}"><i data-size="10x" data-icon="${i}"></i></div>
  <h3 class="${t.title}">${a}</h3>
</div>
`),co={error:"ErrorMessage_error__7I7y1",icon:"ErrorMessage_icon__4---V","appear-grow":"ErrorMessage_appear-grow__oBenJ",title:"ErrorMessage_title__shDDT",appear:"ErrorMessage_appear__kry-R"};class ho extends x{constructor({message:e,icon:t="warning",template:i=lo,className:a}){super({template:i,classes:co}),this.message=e,this.icon=t,this.className=a}renderSync(){var e=[co.error,this.className].join(" ").trim();return super.renderSync({message:this.message,icon:this.icon,classList:e})}}var uo="DataError_dataError__jyJ0H",po=new C(({classList:e,classes:t,icon:i,i18n:a,message:s})=>`
  <div class="${e}">
    <div class="${t.icon}"><i data-size="10x" data-icon="${i}"></i></div>
    <h3 class="${t.title}">${s}</h3>
    <button>${a.get("retry")}</button>
  </div>
`);class mo extends ho{constructor({message:e}){super({message:e,template:po,className:uo})}initialize(){this.uiElements={retryButton:"button"},this.uiEvents=[x.childEvent("retryButton","click",this.onRetry)],super.initialize()}onRetry(){return k(this,void 0,void 0,function*(){this.emojiData?yield this.emojiData.delete():yield this.options.dataStore.deleteDatabase(this.options.locale),this.events.emit("reinitialize");var e=yield xn(this.options.locale,this.options.dataStore,this.options.messages,this.options.emojiData,this.emojiData);this.viewFactory.setEmojiData(e),this.events.emit("data:ready",e)})}}var go={preview:"Preview_preview__HcFH6",previewEmoji:"Preview_previewEmoji__vjUki",previewName:"Preview_previewName__C79nL",tagList:"Preview_tagList__DielP",tag:"Preview_tag__aUSTM"};const fo=new C(({classes:e,tag:t})=>`
  <li class="${e.tag}">${t}</li>
`),vo=new C(({classes:e})=>`
  <div class="${e.preview}">
    <div class="${e.previewEmoji}"></div>
    <div class="${e.previewName}"></div>
    <ul class="${e.tagList}"></ul>
  </div>
`);class wo extends x{constructor(){super({template:vo,classes:go})}initialize(){this.uiElements={emoji:x.byClass(go.previewEmoji),name:x.byClass(go.previewName),tagList:x.byClass(go.tagList)},this.appEvents={"preview:show":this.showPreview,"preview:hide":this.hidePreview},super.initialize()}showPreview(e,t){this.ui.emoji.replaceChildren(t),this.ui.name.textContent=e.label,e.tags&&(this.ui.tagList.style.display="flex",t=e.tags.map(e=>fo.renderSync({tag:e,classes:go})),this.ui.tagList.replaceChildren(...t))}hidePreview(){this.ui.emoji.replaceChildren(),this.ui.name.textContent="",this.ui.tagList.replaceChildren()}}var yo={searchContainer:"Search_searchContainer__aJW7V",searchField:"Search_searchField__tENKn",clearButton:"Search_clearButton__oFTEY",searchAccessory:"Search_searchAccessory__0rdYO",clearSearchButton:"Search_clearSearchButton__AoDtB",notFound:"Search_notFound__rOdr1"};const bo=new C(({classes:e,i18n:t})=>`
  <button title="${t.get("search.clear")}" class="${e.clearSearchButton}">
    <i data-icon="xmark"></i>
  </button>
`),ko=new C(({classes:e,i18n:t})=>`
<div class="${e.searchContainer}">
  <input class="${e.searchField}" placeholder="${t.get("search")}">
  <span class="${e.searchAccessory}"></span>
</div>
`,{mode:"async"});class _o extends x{constructor({categories:e,emojiVersion:t}){super({template:ko,classes:yo}),this.categories=e.filter(e=>"recents"!==e.key),this.emojiVersion=t,this.search=fn(this.search.bind(this),100)}initialize(){this.uiElements={searchField:x.byClass(yo.searchField),searchAccessory:x.byClass(yo.searchAccessory)},this.uiEvents=[x.childEvent("searchField","keydown",this.onKeyDown),x.childEvent("searchField","input",this.onSearchInput)],super.initialize()}render(){const e=Object.create(null,{render:{get:()=>super.render}});return k(this,void 0,void 0,function*(){return yield e.render.call(this),this.searchIcon=In("search"),this.notFoundMessage=this.viewFactory.create(ho,{message:this.i18n.get("search.notFound"),className:yo.notFound,icon:"sad"}),this.notFoundMessage.renderSync(),this.errorMessage=this.viewFactory.create(ho,{message:this.i18n.get("search.error")}),this.errorMessage.renderSync(),this.clearSearchButton=bo.render({classes:yo,i18n:this.i18n}),this.clearSearchButton.addEventListener("click",e=>this.onClearSearch(e)),this.searchField=this.ui.searchField,this.showSearchIcon(),this.el})}showSearchIcon(){this.showSearchAccessory(this.searchIcon)}showClearSearchButton(){this.showSearchAccessory(this.clearSearchButton)}showSearchAccessory(e){this.ui.searchAccessory.replaceChildren(e)}clear(){this.searchField.value="",this.showSearchIcon()}focus(){this.searchField.focus()}onClearSearch(e){e.stopPropagation(),this.searchField.value="",null!=(e=this.resultsContainer)&&e.destroy(),this.resultsContainer=null,this.showSearchIcon(),this.events.emit("content:show"),this.searchField.focus()}handleResultsKeydown(e){this.resultsContainer&&"Escape"===e.key&&this.onClearSearch(e)}onKeyDown(e){"Escape"===e.key&&this.searchField.value?this.onClearSearch(e):"Enter"!==e.key&&"ArrowDown"!==e.key||!this.resultsContainer||(e.preventDefault(),null!=(e=this.resultsContainer.el.querySelector('[tabindex="0"]'))&&e.focus())}onSearchInput(e){this.searchField.value?(this.showClearSearchButton(),this.search()):this.onClearSearch(e)}search(){var i;return k(this,void 0,void 0,function*(){if(this.searchField.value)try{var e,t=yield this.emojiData.searchEmojis(this.searchField.value,this.customEmojis,this.emojiVersion,this.categories);this.events.emit("preview:hide"),t.length?(e=new to,this.resultsContainer=this.viewFactory.create(Vn,{emojis:t,fullHeight:!0,showVariants:!0,lazyLoader:e}),this.resultsContainer.renderSync(),null!=(i=this.resultsContainer)&&i.el&&(e.observe(this.resultsContainer.el),this.resultsContainer.setActive(!0,{row:0,offset:0},!1),this.resultsContainer.el.addEventListener("keydown",e=>this.handleResultsKeydown(e)),this.events.emit("content:show",this.resultsContainer))):this.events.emit("content:show",this.notFoundMessage)}catch(e){this.events.emit("content:show",this.errorMessage)}})}}class xo{constructor(){this.handleKeyDown=this.handleKeyDown.bind(this)}activate(e){this.rootElement=e,this.rootElement.addEventListener("keydown",this.handleKeyDown)}deactivate(){var e;null!=(e=this.rootElement)&&e.removeEventListener("keydown",this.handleKeyDown)}get focusableElements(){return this.rootElement.querySelectorAll('input, [tabindex="0"]')}get lastFocusableElement(){return this.focusableElements[this.focusableElements.length-1]}get firstFocusableElement(){return this.focusableElements[0]}checkFocus(e,t,i){e.target===t&&(i.focus(),e.preventDefault())}handleKeyDown(e){"Tab"===e.key&&this.checkFocus(e,e.shiftKey?this.firstFocusableElement:this.lastFocusableElement,e.shiftKey?this.lastFocusableElement:this.firstFocusableElement)}}var Co=new C(({classes:e})=>`
  <div class="${e.variantOverlay}">
    <div class="${e.variantPopup}">
      <div data-view="emojis" data-render="sync"></div>
    </div>
  </div>
`),Eo={variantOverlay:"VariantPopup_variantOverlay__gGwue",variantPopup:"VariantPopup_variantPopup__c2pHF"};const So={easing:"ease-in-out",duration:250,fill:"both"},To={opacity:[0,1]},Ao={opacity:[0,1],transform:["scale3d(0.8, 0.8, 0.8)","scale3d(1, 1, 1)"]};class Lo extends x{constructor({emoji:e,parent:t}){super({template:Co,classes:Eo,parent:t}),this.focusedEmojiIndex=0,this.focusTrap=new xo,this.animateShow=()=>Promise.all([vn(this.el,To,So,this.options),vn(this.ui.popup,Ao,So,this.options)]),this.emoji=e}initialize(){this.uiElements={popup:x.byClass(Eo.variantPopup)},this.uiEvents=[x.uiEvent("click",this.handleClick),x.uiEvent("keydown",this.handleKeydown)],super.initialize()}animateHide(){var e=Object.assign(Object.assign({},So),{direction:"reverse"});return Promise.all([vn(this.el,To,e,this.options),vn(this.ui.popup,Ao,e,this.options)])}hide(){return k(this,void 0,void 0,function*(){yield this.animateHide(),this.events.emit("variantPopup:hide")})}handleKeydown(e){"Escape"===e.key&&(this.hide(),e.stopPropagation())}handleClick(e){this.ui.popup.contains(e.target)||this.hide()}getEmoji(e){return this.renderedEmojis[e]}setFocusedEmoji(e){this.getEmoji(this.focusedEmojiIndex).tabIndex=-1,this.focusedEmojiIndex=e;e=this.getEmoji(this.focusedEmojiIndex);e.tabIndex=0,e.focus()}destroy(){this.emojiContainer.destroy(),this.focusTrap.deactivate(),super.destroy()}renderSync(){var e=[Object.assign(Object.assign({},this.emoji),{skins:null}),...(this.emoji.skins||[]).map(e=>Object.assign(Object.assign({},e),{label:this.emoji.label,tags:this.emoji.tags}))];return this.emojiContainer=this.viewFactory.create(Vn,{emojis:e,preview:!1}),super.renderSync({emojis:this.emojiContainer}),e.length<this.options.emojisPerRow&&this.el.style.setProperty("--emojis-per-row",e.length.toString()),this.el}activate(){this.emojiContainer.setActive(!0,{row:0,offset:0},!0),this.focusTrap.activate(this.el)}}var jo=new C(({classes:e,i18n:t,category:i,pickerId:a,icon:s})=>`
<li class="${e.categoryTab}">
  <button
    aria-selected="false"
    role="tab"
    class="${e.categoryButton}"
    tabindex="-1"
    title="${t.get("categories."+i.key,i.message||i.key)}"
    type="button"
    data-category="${i.key}"
    id="${a}-category-${i.key}"
  >
    <i data-icon="${s}"></i>
</li>
`),Mo={categoryButtons:"CategoryTabs_categoryButtons__dJVp-",categoryButton:"CategoryTabs_categoryButton__AsR9b",categoryTab:"CategoryTabs_categoryTab__fAgQT",categoryTabActive:"CategoryTabs_categoryTabActive__691be"};class Io extends x{constructor({category:e,icon:t}){super({template:jo,classes:Mo}),this.isActive=!1,this.category=e,this.icon=t}initialize(){this.uiElements={button:x.byClass(Mo.categoryButton)},this.uiEvents=[x.childEvent("button","click",this.selectCategory)],super.initialize()}renderSync(){return super.renderSync({category:this.category,icon:this.icon}),this.ui.button.ariaSelected="false",this.el}setActive(e,t=!0,i=!1){this.el.classList.toggle(Mo.categoryTabActive,e),t&&this.setFocused(e,i),this.isActive=e}setFocused(e,t=!1){this.ui.button.ariaSelected=e.toString(),e?(this.ui.button.tabIndex=0,this.ui.button.focus(),t&&this.events.emit("category:select",this.category.key,{scroll:"animate",focus:"button",performFocus:!1})):this.ui.button.tabIndex=-1}selectCategory(){this.isActive||this.events.emit("category:select",this.category.key,{scroll:"animate",focus:"button",performFocus:!0})}}var Do=new C(({classes:e})=>`
  <ul role="tablist" class="${e.categoryButtons}">
    <div data-placeholder="tabs"></div>
  </ul>
`);class Oo extends x{constructor({categories:e}){super({template:Do,classes:Mo}),this.activeCategoryIndex=0,this.categories=e}initialize(){this.keyBindings={ArrowLeft:this.stepSelectedTab(-1),ArrowRight:this.stepSelectedTab(1)},super.initialize()}renderSync(){return this.tabViews=this.categories.map(e=>this.viewFactory.create(Io,{category:e,icon:Mn[e.key]})),super.renderSync({tabs:this.tabViews.map(e=>e.renderSync())}),this.currentTabView.setActive(!0),this.el}get currentCategory(){return this.categories[this.activeCategoryIndex]}get currentTabView(){return this.tabViews[this.activeCategoryIndex]}setActiveTab(e,t=!0,i=!0){var a,s;e!==this.activeCategoryIndex&&(a=this.currentTabView,s=this.tabViews[e],a.setActive(!1,t),s.setActive(!0,t,i),this.activeCategoryIndex=e)}getTargetCategory(e){return e<0?this.categories.length-1:e>=this.categories.length?0:e}stepSelectedTab(t){return()=>{var e=this.activeCategoryIndex+t;this.setActiveTab(this.getTargetCategory(e))}}}const Po=[{version:15,emoji:String.fromCodePoint(129768)},{version:14,emoji:String.fromCodePoint(128733)},{version:13,emoji:String.fromCodePoint(129729)},{version:12,emoji:String.fromCodePoint(129449)},{version:11,emoji:String.fromCodePoint(129463)},{version:5,emoji:String.fromCodePoint(129322)},{version:4,emoji:String.fromCodePoint(9877)},{version:3,emoji:String.fromCodePoint(129314)},{version:2,emoji:String.fromCodePoint(128488)},{version:1,emoji:String.fromCodePoint(128512)}];function Ro(){var e=Po.find(e=>{var e=e.emoji,t=document.createElement("canvas").getContext("2d");if(t)return t.textBaseline="top",t.font="32px Arial",t.fillText(e,0,0),0!==t.getImageData(16,16,1,1).data[0]});return null!=(e=null==e?void 0:e.version)?e:1}function zo(e,t){return Array.from({length:e},()=>t).join("")}function Bo(e){var{emojiCount:t,classes:i,theme:a,className:s}=e;return`
    <div class="${i.skeleton} ${i.picker} ${a} ${s}">
      ${{showHeader:a,classes:s}=[e][0],a?`
    <header class="${s.header}">
      ${{showSearch:a,classes:s}=[e][0],a?`
    <div class="${s.searchSkeleton}">
      <div class="${s.searchInput} ${s.placeholder}"></div>
    </div>
  `:""}
      ${{showCategoryTabs:a,classes:s}=[e][0],a?`
    <div class="${s.categoryTabsSkeleton}">
      ${zo(10,`<div class="${s.placeholder} ${s.categoryTab}"></div>`)}
    </div>
  `:""}
    </header>
  `:""}
      <div class="${i.contentSkeleton}">
        <div class="${i.placeholder} ${i.categoryName}"></div>
        <div class="${i.emojiGrid}">
          ${zo(t,`<div class="${i.placeholder} ${i.emoji}"></div>`)}
        </div>
      </div>
      ${{showPreview:a,classes:s}=[e][0],a?`
    <div class="${s.previewSkeleton}">
      <div class="${s.placeholder} ${s.previewEmoji}"></div>
      <div class="${s.placeholder} ${s.previewName}"></div>
      <ul class="${s.tagList}">
        ${zo(3,`<li class="${s.placeholder} ${s.tag}"></li>`)}
      </ul>
    </div>
  `:""}
    </div>
  `}var No=new C(e=>(e.isLoaded?function(e){var{classes:t,theme:i,className:a=""}=e;return`
    <div class="${t.picker} ${i} ${a}">
      ${{showHeader:i,classes:a}=[e][0],i?`
    <header class="${a.header}">
      <div data-view="search"></div>
      <div data-view="categoryTabs" data-render="sync"></div>
    </header>
  `:""}
      <div class="${t.content}">
        <div data-view="emojiArea"></div>
      </div>
      <div data-view="preview"></div>
    </div>
  `}:Bo)(e)),Fo={picker:"EmojiPicker_picker__19Vln",skeleton:"EmojiPicker_skeleton__M1a2g",placeholder:"EmojiPicker_placeholder__YDJn-",shine:"EmojiPicker_shine__s-vEs",searchSkeleton:"EmojiPicker_searchSkeleton__gNgdU",searchInput:"EmojiPicker_searchInput__tpaBs",categoryTabsSkeleton:"EmojiPicker_categoryTabsSkeleton__2dISl",categoryTab:"EmojiPicker_categoryTab__mmSVF",contentSkeleton:"EmojiPicker_contentSkeleton__UWfQu",categoryName:"EmojiPicker_categoryName__d2-Ed",emojiGrid:"EmojiPicker_emojiGrid__WnoCI",emoji:"EmojiPicker_emoji__jaN-w",previewSkeleton:"EmojiPicker_previewSkeleton__Bjqkm",previewEmoji:"EmojiPicker_previewEmoji__uOLbA",previewName:"EmojiPicker_previewName__QJ47d",tagList:"EmojiPicker_tagList__tc6nv",tag:"EmojiPicker_tag__gAU6B",overlay:"EmojiPicker_overlay__kDT99",content:"EmojiPicker_content__xT6Kl",fullHeight:"EmojiPicker_fullHeight__7kz2H",pluginContainer:"EmojiPicker_pluginContainer__Gz3yT",header:"EmojiPicker_header__eDZPD"};const qo={emojisPerRow:"--emojis-per-row",visibleRows:"--row-count",emojiSize:"--emoji-size"};class Uo extends x{constructor(){super({template:No,classes:Fo}),this.pickerReady=!1,this.externalEvents=new Sn}initialize(){this.uiElements={pickerContent:x.byClass(Fo.content),header:x.byClass(Fo.header)},this.uiEvents=[x.uiEvent("keydown",this.handleKeyDown)],this.appEvents={error:this.onError,reinitialize:this.reinitialize,"data:ready":this.onDataReady,"content:show":this.showContent,"variantPopup:hide":this.hideVariantPopup,"emoji:select":this.selectEmoji},super.initialize()}destroy(){var e;super.destroy(),null!=(e=this.search)&&e.destroy(),this.emojiArea.destroy(),null!=(e=this.categoryTabs)&&e.destroy(),this.events.removeAll(),this.externalEvents.removeAll()}addEventListener(e,t){this.externalEvents.on(e,t)}removeEventListener(e,t){this.externalEvents.off(e,t)}initializePickerView(){this.pickerReady&&(this.showContent(),this.emojiArea.reset())}handleKeyDown(e){var t=e.ctrlKey||e.metaKey;"s"===e.key&&t&&this.search&&(e.preventDefault(),this.search.focus())}buildChildViews(){return this.options.showPreview&&(this.preview=this.viewFactory.create(wo)),this.options.showSearch&&(this.search=this.viewFactory.create(_o,{categories:this.categories,emojiVersion:this.emojiVersion})),this.options.showCategoryTabs&&(this.categoryTabs=this.viewFactory.create(Oo,{categories:this.categories})),this.currentView=this.emojiArea=this.viewFactory.create(oo,{categoryTabs:this.categoryTabs,categories:this.categories,emojiVersion:this.emojiVersion}),[this.preview,this.search,this.emojiArea,this.categoryTabs]}setStyleProperties(){this.options.showSearch||this.el.style.setProperty("--search-height-full","0px"),this.options.showCategoryTabs||(this.el.style.setProperty("--category-tabs-height","0px"),this.el.style.setProperty("--category-tabs-offset","0px")),this.options.showPreview||this.el.style.setProperty("--emoji-preview-height-full","0px"),Object.keys(qo).forEach(e=>{this.options[e]&&this.el.style.setProperty(qo[e],this.options[e].toString())})}reinitialize(){this.renderSync()}onError(e){var t=this.viewFactory.create(mo,{message:this.i18n.get("error.load")}),i=this.el.offsetHeight||375;throw this.el.style.height=i+"px",this.el.replaceChildren(t.renderSync()),e}onDataReady(r){const n=Object.create(null,{render:{get:()=>super.render}});return k(this,void 0,void 0,function*(){var e=this.el;try{r?this.emojiData=r:yield this.emojiDataPromise,"auto"===this.options.emojiVersion?this.emojiVersion=Ro()||parseFloat("14.0"):this.emojiVersion=this.options.emojiVersion,this.categories=yield this.emojiData.getCategories(this.options);var[t,i,a,s]=this.buildChildViews();yield n.render.call(this,{isLoaded:!0,search:i,categoryTabs:s,emojiArea:a,preview:t,showHeader:Boolean(this.search||this.categoryTabs),theme:this.options.theme,className:this.options.className}),this.el.style.setProperty("--category-count",this.categories.length.toString()),this.pickerReady=!0,e.replaceWith(this.el),this.setStyleProperties(),this.initializePickerView(),this.setInitialFocus(),this.externalEvents.emit("data:ready")}catch(e){this.events.emit("error",e)}})}renderSync(){if(super.renderSync({isLoaded:!1,theme:this.options.theme,showSearch:this.options.showSearch,showPreview:this.options.showPreview,showCategoryTabs:this.options.showCategoryTabs,showHeader:this.options.showSearch||this.options.showCategoryTabs,emojiCount:this.options.emojisPerRow*this.options.visibleRows}),this.options.rootElement)return this.options.rootElement.replaceChildren(this.el),this.setStyleProperties(),this.pickerReady&&this.initializePickerView(),this.el;throw new Error("Picker must be given a root element via the rootElement option")}setInitialFocus(){this.pickerReady&&(this.search&&this.options.autoFocusSearch?this.search:this.emojiArea.focusableEmoji).focus()}reset(){this.pickerReady&&(this.emojiArea.reset(),this.showContent(this.emojiArea)),this.search&&this.search.clear()}showContent(e=this.emojiArea){var t;e!==this.currentView&&(this.currentView!==this.emojiArea&&null!=(t=this.currentView)&&t.destroy(),this.ui.pickerContent.classList.toggle(Fo.fullHeight,e!==this.emojiArea),this.ui.pickerContent.replaceChildren(e.el),(this.currentView=e)===this.emojiArea?(this.emojiArea.reset(),this.categoryTabs&&this.ui.header.appendChild(this.categoryTabs.el)):null!=(t=this.categoryTabs)&&t.el.remove())}hideVariantPopup(){var e;null!=(e=this.variantPopup)&&e.destroy()}isPickerClick(e){var e=e.target,t=this.el.contains(e),i=null==(i=null==(i=this.variantPopup)?void 0:i.el)?void 0:i.contains(e);return t||i}selectEmoji({emoji:e}){var t;return k(this,void 0,void 0,function*(){null!=(t=e.skins)&&t.length&&this.options.showVariants&&!this.isVariantPopupOpen?this.showVariantPopup(e):(yield null==(t=this.variantPopup)?void 0:t.animateHide(),this.events.emit("variantPopup:hide"),yield this.emitEmoji(e))})}get isVariantPopupOpen(){return this.variantPopup&&!this.variantPopup.isDestroyed}showVariantPopup(t){return k(this,void 0,void 0,function*(){const e=document.activeElement;this.events.once("variantPopup:hide",()=>{null!==e&&void 0!==e&&e.focus()}),this.variantPopup=this.viewFactory.create(Lo,{emoji:t,parent:this.el}),this.el.appendChild(this.variantPopup.renderSync()),this.variantPopup.activate()})}emitEmoji(e){return k(this,void 0,void 0,function*(){this.externalEvents.emit("emoji:select",yield this.renderer.doEmit(e)),Jn(e,this.options.maxRecents),this.events.emit("recent:add",e)})}}class $o{constructor({events:e,i18n:t,renderer:i,emojiData:a,options:s,customEmojis:r=[],pickerId:n}){this.events=e,this.i18n=t,this.renderer=i,this.emojiData=a,this.options=s,this.customEmojis=r,this.pickerId=n}setEmojiData(e){this.emojiData=Promise.resolve(e)}create(e,...t){e=new e(...t);return e.setPickerId(this.pickerId),e.setEvents(this.events),e.setI18n(this.i18n),e.setRenderer(this.renderer),e.setEmojiData(this.emojiData),e.setOptions(this.options),e.setCustomEmojis(this.customEmojis),e.viewFactory=this,e.initialize(),e}}class Ho{constructor(e={}){Wo.set(this,void 0),rn(this,Wo,new Map(Object.entries(e)),"f")}get(e,t=e){return _(this,Wo,"f").get(e)||t}}var Wo=new WeakMap,Vo={imagePlaceholder:"common_imagePlaceholder__FRWLu",placeholder:"common_placeholder__qe-fo",shine:"common_shine__tUVG2"};const Xo=new C(({classes:e})=>`
  <div class="${e.placeholder} ${e.imagePlaceholder}"></div>
`);class Yo extends x{constructor({classNames:e}={}){super({template:Xo,classes:Vo}),this.classNames=e}load(e){const t=document.createElement("img");this.classNames&&(t.className=this.classNames),t.addEventListener("load",()=>{this.el.replaceWith(t)},{once:!0}),Promise.resolve(e).then(e=>t.src=e)}renderSync(){return super.renderSync(),this.classNames&&this.classNames.split(" ").forEach(e=>this.el.classList.add(e)),this.el}}var Go={customEmoji:"custom_customEmoji__Kspg6"};const Ko=new C(({emoji:e})=>`<span>${e}</span>`);a="themes_lightTheme__mMNem";const Zo=[(e,t)=>("1F91D"===e.hexcode&&t<14&&(e.skins=[]),e),(e,t)=>(e.skins&&(e.skins=e.skins.filter(e=>!e.version||e.version<=t)),e)];function Jo(e,a){return e.filter(e=>{return null!==(t=e,i=a,Zo.some(e=>null===e(t,i))?null:t);var t,i})}function Qo(e){var t;return{emoji:e.emoji,label:e.label,tags:e.tags,skins:null==(t=e.skins)?void 0:t.map(e=>Qo(e)),order:e.order,custom:!1,hexcode:e.hexcode,version:e.version}}function el(t,i,e){return!(e&&!e.some(e=>e.order===t.group))&&(mn(t.label,i)||(null==(e=t.tags)?void 0:e.some(e=>mn(e,i))))}class tl{constructor(e="en"){this.locale=e}}function il(e){return new al(e)}il.deleteDatabase=a=>new Promise((e,t)=>{var i=indexedDB.deleteDatabase("PicMo-"+a);i.addEventListener("success",e),i.addEventListener("error",t)});class al extends tl{open(){return k(this,void 0,void 0,function*(){const i=indexedDB.open("PicMo-"+this.locale);return new Promise((t,e)=>{i.addEventListener("success",e=>{this.db=null==(e=e.target)?void 0:e.result,t()}),i.addEventListener("error",e),i.addEventListener("upgradeneeded",t=>k(this,void 0,void 0,function*(){this.db=null==(e=t.target)?void 0:e.result,this.db.createObjectStore("category",{keyPath:"order"});var e=this.db.createObjectStore("emoji",{keyPath:"emoji"});e.createIndex("category","group"),e.createIndex("version","version"),this.db.createObjectStore("meta")}))})})}delete(){return k(this,void 0,void 0,function*(){this.close();var e=indexedDB.deleteDatabase("PicMo-"+this.locale);yield this.waitForRequest(e)})}close(){this.db.close()}getEmojiCount(){return k(this,void 0,void 0,function*(){var e=this.db.transaction("emoji","readonly").objectStore("emoji");return(yield this.waitForRequest(e.count())).target.result})}getEtags(){return k(this,void 0,void 0,function*(){var e=this.db.transaction("meta","readonly").objectStore("meta"),[e,t]=yield Promise.all([this.waitForRequest(e.get("emojisEtag")),this.waitForRequest(e.get("messagesEtag"))]);return{storedEmojisEtag:e.target.result,storedMessagesEtag:t.target.result}})}setMeta(a){return k(this,void 0,void 0,function*(){const t=this.db.transaction("meta","readwrite"),i=t.objectStore("meta");return new Promise(e=>{t.oncomplete=e,Object.keys(a).filter(Boolean).forEach(e=>{i.put(a[e],e)})})})}getHash(){return k(this,void 0,void 0,function*(){var e=this.db.transaction("meta","readonly").objectStore("meta");return(yield this.waitForRequest(e.get("hash"))).target.result})}isPopulated(){return k(this,void 0,void 0,function*(){var e=this.db.transaction("category","readonly").objectStore("category");return 0<(yield this.waitForRequest(e.count())).target.result})}populate({groups:t,emojis:i,emojisEtag:a,messagesEtag:s,hash:r}){return k(this,void 0,void 0,function*(){yield this.removeAllObjects("category","emoji");var e=[this.addObjects("category",t),this.addObjects("emoji",i),this.setMeta({emojisEtag:a,messagesEtag:s,hash:r})];yield Promise.all(e)})}getCategories(a){var s;return k(this,void 0,void 0,function*(){var e=this.db.transaction("category","readonly").objectStore("category");let t=(yield this.waitForRequest(e.getAll())).target.result.filter(e=>"component"!==e.key);if(a.showRecents&&t.unshift({key:"recents",order:-1}),null!=(s=a.custom)&&s.length&&t.push({key:"custom",order:10}),a.categories){const i=a.categories;(t=t.filter(e=>i.includes(e.key))).sort((e,t)=>i.indexOf(e.key)-i.indexOf(t.key))}else t.sort((e,t)=>e.order-t.order);return t})}getEmojis(t,i){return k(this,void 0,void 0,function*(){var e=this.db.transaction("emoji","readonly").objectStore("emoji").index("category");return Jo((yield this.waitForRequest(e.getAll(t.order))).target.result.filter(e=>e.version<=i).sort((e,t)=>null!=e.order&&null!=t.order?e.order-t.order:0).map(Qo),i)})}searchEmojis(s,r,n,o){return k(this,void 0,void 0,function*(){const a=[];return new Promise((i,t)=>{var e=this.db.transaction("emoji","readonly").objectStore("emoji").openCursor();e.addEventListener("success",e=>{e=null==(e=e.target)?void 0:e.result;if(!e)return i([...Jo(a,n),...r.filter(e=>el(e,s))]);var t=e.value;el(t,s,o)&&t.version<=n&&a.push(Qo(t)),e.continue()}),e.addEventListener("error",e=>{t(e)})})})}waitForRequest(i){return k(this,void 0,void 0,function*(){return new Promise((e,t)=>{i.onsuccess=e,i.onerror=t})})}withTransaction(a,s="readwrite",r){return new Promise((e,t)=>{var i=this.db.transaction(a,s);i.oncomplete=e,i.onerror=t,r(i)})}removeAllObjects(...i){return k(this,void 0,void 0,function*(){const t=this.db.transaction(i,"readwrite");var e=i.map(e=>t.objectStore(e));yield Promise.all(e.map(e=>this.waitForRequest(e.clear())))})}addObjects(i,a){return k(this,void 0,void 0,function*(){return this.withTransaction(i,"readwrite",e=>{const t=e.objectStore(i);a.forEach(e=>{t.add(e)})})})}}const sl={renderer:new class extends class{renderElement(e){return{content:e}}renderImage(e="",t){const i=new Yo({classNames:e});i.renderSync();return{content:i,resolver:()=>(i.load(t()),i.el)}}doRender(e,t,i){return e.custom?this.renderCustom(e,t,i):({content:e,resolver:i}=this.render(e,i),e=e instanceof HTMLElement?e:e.el,t&&i?t.lazyLoad(e,i):(i&&i(),e))}doEmit(e){return e.custom?this.emitCustom(e):this.emit(e)}emitCustom({url:e,label:t,emoji:i,data:a}){return{url:e,label:t,emoji:i,data:a}}renderCustom(e,t,i=""){var i=[Go.customEmoji,i].join(" ").trim(),{content:i,resolver:a}=this.renderImage(i,()=>e.url),i=i instanceof HTMLElement?i:i.el;return a&&a(),i}}{render(e){return this.renderElement(Ko.renderSync({emoji:e.emoji}))}emit({emoji:e,hexcode:t,label:i}){return{emoji:e,hexcode:t,label:i}}},dataStore:il,theme:a,animate:!0,showSearch:!0,showCategoryTabs:!0,showVariants:!0,showRecents:!0,showPreview:!0,emojisPerRow:8,visibleRows:6,emojiVersion:"auto",maxRecents:50,i18n:{"categories.activities":"Activities","categories.animals-nature":"Animals & Nature","categories.custom":"Custom","categories.flags":"Flags","categories.food-drink":"Food & Drink","categories.objects":"Objects","categories.people-body":"People & Body","categories.recents":"Recently Used","categories.smileys-emotion":"Smileys & Emotion","categories.symbols":"Symbols","categories.travel-places":"Travel & Places","error.load":"Failed to load emojis","recents.clear":"Clear recent emojis","recents.none":"You haven't selected any emojis yet.",retry:"Try again","search.clear":"Clear search","search.error":"Failed to search emojis","search.notFound":"No results found",search:"Search emojis..."},locale:"en",custom:[]};function rl(e={}){return Object.assign(Object.assign({},sl),e)}let nl=0;function ol(e){var e=rl(e),t=((null==e?void 0:e.custom)||[]).map(e=>Object.assign(Object.assign({},e),{custom:!0,tags:["custom",...e.tags||[]]}));const i=new En;var a=xn(e.locale,e.dataStore,e.messages,e.emojiData),s=new Ho(e.i18n);a.then(e=>{i.emit("data:ready",e)}).catch(e=>{i.emit("error",e)});s=new $o({events:i,i18n:s,customEmojis:t,renderer:e.renderer,options:e,emojiData:a,pickerId:`picmo-${Date.now()}-`+nl++}).create(Uo);return s.renderSync(),s}const ll="undefined"!=typeof window&&void 0!==window.document,cl=ll?window:{};rs=!(!ll||!cl.document.documentElement)&&"ontouchstart"in cl.document.documentElement,g=ll&&"PointerEvent"in cl;const E="cropper",dl="n",hl="ne",ul="nw",pl="se",ml="sw",gl=E+"-crop",fl=E+"-disabled",S=E+"-hidden",vl=E+"-hide",wl=(E,E+"-modal"),yl=E+"-move",bl=E+"Action",kl=E+"Preview",_l="crop",xl="crop",Cl="cropend",El="cropmove",Sl="cropstart",Tl="dblclick",Al=g?"pointerdown":rs?"touchstart":"mousedown",Ll=g?"pointermove":rs?"touchmove":"mousemove",jl=g?"pointerup pointercancel":rs?"touchend touchcancel":"mouseup",Ml="zoom",Il="image/jpeg",Dl=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Ol=/^data:/,Pl=/^data:image\/jpeg;base64,/,Rl=/^img|canvas$/i,zl={viewMode:0,dragMode:_l,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Bl=Number.isNaN||cl.isNaN;function T(e){return"number"==typeof e&&!Bl(e)}const Nl=e=>0<e&&e<1/0;function Fl(e){return void 0===e}function ql(e){return"object"==typeof e&&null!==e}const Ul=Object.prototype["hasOwnProperty"];function $l(e){if(!ql(e))return!1;try{var t=e["constructor"],i=t["prototype"];return t&&i&&Ul.call(i,"isPrototypeOf")}catch(e){return!1}}function A(e){return"function"==typeof e}const Hl=Array.prototype["slice"];function Wl(e){return Array.from?Array.from(e):Hl.call(e)}function L(i,a){return i&&A(a)&&(Array.isArray(i)||T(i.length)?Wl(i).forEach((e,t)=>{a.call(i,e,t,i)}):ql(i)&&Object.keys(i).forEach(e=>{a.call(i,i[e],e,i)})),i}const j=Object.assign||function(i,...e){return ql(i)&&0<e.length&&e.forEach(t=>{ql(t)&&Object.keys(t).forEach(e=>{i[e]=t[e]})}),i},Vl=/\.\d*(?:0|9){12}\d*$/;function Xl(e,t=1e11){return Vl.test(e)?Math.round(e*t)/t:e}const Yl=/^width|height|left|top|marginLeft|marginTop$/;function Gl(e,t){const i=e["style"];L(t,(e,t)=>{Yl.test(t)&&T(e)&&(e+="px"),i[t]=e})}function M(e,t){var i;t&&(T(e.length)?L(e,e=>{M(e,t)}):e.classList?e.classList.add(t):(i=e.className.trim())?i.indexOf(t)<0&&(e.className=i+" "+t):e.className=t)}function Kl(e,t){t&&(T(e.length)?L(e,e=>{Kl(e,t)}):e.classList?e.classList.remove(t):0<=e.className.indexOf(t)&&(e.className=e.className.replace(t,"")))}function Zl(e,t,i){t&&(T(e.length)?L(e,e=>{Zl(e,t,i)}):(i?M:Kl)(e,t))}const Jl=/([a-z\d])([A-Z])/g;function Ql(e){return e.replace(Jl,"$1-$2").toLowerCase()}function ec(e,t){return ql(e[t])?e[t]:e.dataset?e.dataset[t]:e.getAttribute("data-"+Ql(t))}function tc(e,t,i){ql(i)?e[t]=i:e.dataset?e.dataset[t]=i:e.setAttribute("data-"+Ql(t),i)}const ic=/\s\s*/,ac=(()=>{let e=!1;if(ll){let t=!1;var i=()=>{},a=Object.defineProperty({},"once",{get(){return e=!0,t},set(e){t=e}});cl.addEventListener("test",i,a),cl.removeEventListener("test",i,a)}return e})();function sc(i,e,a,s={}){let r=a;e.trim().split(ic).forEach(e=>{var t;ac||(t=i["listeners"],t&&t[e]&&t[e][a]&&(r=t[e][a],delete t[e][a],0===Object.keys(t[e]).length&&delete t[e],0===Object.keys(t).length)&&delete i.listeners),i.removeEventListener(e,r,s)})}function rc(a,e,s,r={}){let n=s;e.trim().split(ic).forEach(t=>{if(r.once&&!ac){const{listeners:i={}}=a;n=(...e)=>{delete i[t][s],a.removeEventListener(t,n,r),s.apply(a,e)},i[t]||(i[t]={}),i[t][s]&&a.removeEventListener(t,i[t][s],r),i[t][s]=n,a.listeners=i}a.addEventListener(t,n,r)})}function nc(e,t,i){let a;return A(Event)&&A(CustomEvent)?a=new CustomEvent(t,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,i),e.dispatchEvent(a)}function oc(e){e=e.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}const lc=cl["location"],cc=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function dc(e){e=e.match(cc);return null!==e&&(e[1]!==lc.protocol||e[2]!==lc.hostname||e[3]!==lc.port)}function hc(e){var t="timestamp="+(new Date).getTime();return e+(-1===e.indexOf("?")?"?":"&")+t}function uc({rotate:e,scaleX:t,scaleY:i,translateX:a,translateY:s}){var r=[],a=(T(a)&&0!==a&&r.push(`translateX(${a}px)`),T(s)&&0!==s&&r.push(`translateY(${s}px)`),T(e)&&0!==e&&r.push(`rotate(${e}deg)`),T(t)&&1!==t&&r.push(`scaleX(${t})`),T(i)&&1!==i&&r.push(`scaleY(${i})`),r.length?r.join(" "):"none");return{WebkitTransform:a,msTransform:a,transform:a}}function pc({pageX:e,pageY:t},i){var a={endX:e,endY:t};return i?a:{startX:e,startY:t,...a}}function mc({aspectRatio:e,height:t,width:i},a="contain"){var s,r=Nl(i),n=Nl(t);return r&&n?(s=t*e,"contain"===a&&i<s||"cover"===a&&s<i?t=i/e:i=t*e):r?t=i/e:n&&(i=t*e),{width:i,height:t}}const gc=String["fromCharCode"];const fc=/^data:.*,/;function vc(e){e=e.replace(fc,"");const i=atob(e);e=new ArrayBuffer(i.length);const a=new Uint8Array(e);return L(a,(e,t)=>{a[t]=i.charCodeAt(t)}),e}function wc(e,t){var i=[];let a=new Uint8Array(e);for(;0<a.length;)i.push(gc.apply(null,Wl(a.subarray(0,8192)))),a=a.subarray(8192);return`data:${t};base64,`+btoa(i.join(""))}function yc(e){var s,r,n,o,l=new DataView(e);let c;try{let t,i,a;if(255===l.getUint8(0)&&216===l.getUint8(1)){var d=l.byteLength;let e=2;for(;e+1<d;){if(255===l.getUint8(e)&&225===l.getUint8(e+1)){i=e;break}e+=1}}if(a=i&&(s=i+4,r=i+10,"Exif"===function(t,i,a){let s="";a+=i;for(let e=i;e<a;e+=1)s+=gc(t.getUint8(e));return s}(l,s,4))&&(n=l.getUint16(r),(t=18761===n)||19789===n)&&42===l.getUint16(r+2,t)&&8<=(o=l.getUint32(r+4,t))?r+o:a){var h,u=l.getUint16(a,t);let e;for(e=0;e<u;e+=1)if(h=a+12*e+2,274===l.getUint16(h,t)){h+=8,c=l.getUint16(h,t),l.setUint16(h,1,t);break}}}catch(e){c=1}return c}function bc(e){let t=0,i=1,a=1;switch(e){case 2:i=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90,a=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90}return{rotate:t,scaleX:i,scaleY:a}}ns={render(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer(){var{element:e,options:t,container:i,cropper:a}=this,s=Number(t.minContainerWidth),t=Number(t.minContainerHeight),s=(M(a,S),Kl(e,S),{width:Math.max(i.offsetWidth,0<=s?s:200),height:Math.max(i.offsetHeight,0<=t?t:100)});Gl(a,{width:(this.containerData=s).width,height:s.height}),M(e,S),Kl(a,S)},initCanvas(){var{containerData:e,imageData:t}=this,i=this.options["viewMode"],a=Math.abs(t.rotate)%180==90,s=a?t.naturalHeight:t.naturalWidth,a=a?t.naturalWidth:t.naturalHeight,t=s/a;let r=e.width,n=e.height;e.height*t>e.width?3===i?r=e.height*t:n=e.width/t:3===i?n=e.width/t:r=e.height*t;t={aspectRatio:t,naturalWidth:s,naturalHeight:a,width:r,height:n};this.canvasData=t,this.limited=1===i||2===i,this.limitCanvas(!0,!0),t.width=Math.min(Math.max(t.width,t.minWidth),t.maxWidth),t.height=Math.min(Math.max(t.height,t.minHeight),t.maxHeight),t.left=(e.width-t.width)/2,t.top=(e.height-t.height)/2,t.oldLeft=t.left,t.oldTop=t.top,this.initialCanvasData=j({},t)},limitCanvas(e,t){var{options:i,containerData:a,canvasData:s,cropBoxData:r}=this,n=i["viewMode"],o=s["aspectRatio"],l=this.cropped&&r;if(e){let e=Number(i.minCanvasWidth)||0,t=Number(i.minCanvasHeight)||0;1<n?(e=Math.max(e,a.width),t=Math.max(t,a.height),3===n&&(t*o>e?e=t*o:t=e/o)):0<n&&(e?e=Math.max(e,l?r.width:0):t?t=Math.max(t,l?r.height:0):l&&(e=r.width,(t=r.height)*o>e?e=t*o:t=e/o)),{width:e,height:t}=mc({aspectRatio:o,width:e,height:t}),s.minWidth=e,s.minHeight=t,s.maxWidth=1/0,s.maxHeight=1/0}t&&((l?0:1)<n?(e=a.width-s.width,i=a.height-s.height,s.minLeft=Math.min(0,e),s.minTop=Math.min(0,i),s.maxLeft=Math.max(0,e),s.maxTop=Math.max(0,i),l&&this.limited&&(s.minLeft=Math.min(r.left,r.left+(r.width-s.width)),s.minTop=Math.min(r.top,r.top+(r.height-s.height)),s.maxLeft=r.left,s.maxTop=r.top,2===n)&&(s.width>=a.width&&(s.minLeft=Math.min(0,e),s.maxLeft=Math.max(0,e)),s.height>=a.height)&&(s.minTop=Math.min(0,i),s.maxTop=Math.max(0,i))):(s.minLeft=-s.width,s.minTop=-s.height,s.maxLeft=a.width,s.maxTop=a.height))},renderCanvas(e,t){var i,a,s,r,{canvasData:n,imageData:o}=this;t&&({width:a,height:o}=({width:t,height:o,degree:i}=[{width:o.naturalWidth*Math.abs(o.scaleX||1),height:o.naturalHeight*Math.abs(o.scaleY||1),degree:o.rotate||0}][0],90===(i=Math.abs(i)%180)?{width:o,height:t}:(s=i%90*Math.PI/180,a=Math.sin(s),r=t*(s=Math.cos(s))+o*a,t=t*a+o*s,90<i?{width:t,height:r}:{width:r,height:t})),s=n.width*(a/n.naturalWidth),i=n.height*(o/n.naturalHeight),n.left-=(s-n.width)/2,n.top-=(i-n.height)/2,n.width=s,n.height=i,n.aspectRatio=a/o,n.naturalWidth=a,n.naturalHeight=o,this.limitCanvas(!0,!1)),(n.width>n.maxWidth||n.width<n.minWidth)&&(n.left=n.oldLeft),(n.height>n.maxHeight||n.height<n.minHeight)&&(n.top=n.oldTop),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),this.limitCanvas(!1,!0),n.left=Math.min(Math.max(n.left,n.minLeft),n.maxLeft),n.top=Math.min(Math.max(n.top,n.minTop),n.maxTop),n.oldLeft=n.left,n.oldTop=n.top,Gl(this.canvas,j({width:n.width,height:n.height},uc({translateX:n.left,translateY:n.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage(e){var{canvasData:t,imageData:i}=this,a=i.naturalWidth*(t.width/t.naturalWidth),s=i.naturalHeight*(t.height/t.naturalHeight);j(i,{width:a,height:s,left:(t.width-a)/2,top:(t.height-s)/2}),Gl(this.image,j({width:i.width,height:i.height},uc(j({translateX:i.left,translateY:i.top},i)))),e&&this.output()},initCropBox(){var{options:e,canvasData:t}=this,i=e.aspectRatio||e.initialAspectRatio,e=Number(e.autoCropArea)||.8,a={width:t.width,height:t.height};i&&(t.height*i>t.width?a.height=a.width/i:a.width=a.height*i),this.cropBoxData=a,this.limitCropBox(!0,!0),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),a.width=Math.max(a.minWidth,a.width*e),a.height=Math.max(a.minHeight,a.height*e),a.left=t.left+(t.width-a.width)/2,a.top=t.top+(t.height-a.height)/2,a.oldLeft=a.left,a.oldTop=a.top,this.initialCropBoxData=j({},a)},limitCropBox(e,t){var{options:s,containerData:r,canvasData:n,cropBoxData:o,limited:l}=this,c=s["aspectRatio"];if(e){let e=Number(s.minCropBoxWidth)||0,t=Number(s.minCropBoxHeight)||0,i=l?Math.min(r.width,n.width,n.width+n.left,r.width-n.left):r.width,a=l?Math.min(r.height,n.height,n.height+n.top,r.height-n.top):r.height;e=Math.min(e,r.width),t=Math.min(t,r.height),c&&(e&&t?t*c>e?t=e/c:e=t*c:e?t=e/c:t&&(e=t*c),a*c>i?a=i/c:i=a*c),o.minWidth=Math.min(e,i),o.minHeight=Math.min(t,a),o.maxWidth=i,o.maxHeight=a}t&&(l?(o.minLeft=Math.max(0,n.left),o.minTop=Math.max(0,n.top),o.maxLeft=Math.min(r.width,n.left+n.width)-o.width,o.maxTop=Math.min(r.height,n.top+n.height)-o.height):(o.minLeft=0,o.minTop=0,o.maxLeft=r.width-o.width,o.maxTop=r.height-o.height))},renderCropBox(){var{options:e,containerData:t,cropBoxData:i}=this;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,e.movable&&e.cropBoxMovable&&tc(this.face,bl,i.width>=t.width&&i.height>=t.height?"move":"all"),Gl(this.cropBox,j({width:i.width,height:i.height},uc({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output(){this.preview(),nc(this.element,xl,this.getData())}},os={initPreview(){const{element:t,crossOrigin:i}=this;var a=this.options["preview"];const s=i?this.crossOriginUrl:this.url,r=t.alt||"The image to preview";var e=document.createElement("img");if(i&&(e.crossOrigin=i),e.src=s,e.alt=r,this.viewBox.appendChild(e),this.viewBoxImage=e,a){let e=a;"string"==typeof a?e=t.ownerDocument.querySelectorAll(a):a.querySelector&&(e=[a]),L(this.previews=e,e=>{var t=document.createElement("img");tc(e,kl,{width:e.offsetWidth,height:e.offsetHeight,html:e.innerHTML}),i&&(t.crossOrigin=i),t.src=s,t.alt=r,t.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',e.innerHTML="",e.appendChild(t)})}},resetPreview(){L(this.previews,t=>{var i=ec(t,kl),i=(Gl(t,{width:i.width,height:i.height}),t.innerHTML=i.html,t),t=kl;if(ql(i[t]))try{delete i[t]}catch(e){i[t]=void 0}else if(i.dataset)try{delete i.dataset[t]}catch(e){i.dataset[t]=void 0}else i.removeAttribute("data-"+Ql(t))})},preview(){const{imageData:n,canvasData:e,cropBoxData:t}=this,{width:o,height:l}=t,{width:c,height:d}=n,h=t.left-e.left-n.left,u=t.top-e.top-n.top;this.cropped&&!this.disabled&&(Gl(this.viewBoxImage,j({width:c,height:d},uc(j({translateX:-h,translateY:-u},n)))),L(this.previews,e=>{var t=ec(e,kl),i=t.width,t=t.height;let a=i,s=t,r=1;o&&(r=i/o,s=l*r),l&&s>t&&(r=t/l,a=o*r,s=t),Gl(e,{width:a,height:s}),Gl(e.getElementsByTagName("img")[0],j({width:c*r,height:d*r},uc(j({translateX:-h*r,translateY:-u*r},n))))}))}},ls={bind(){var{element:e,options:t,cropper:i}=this;A(t.cropstart)&&rc(e,Sl,t.cropstart),A(t.cropmove)&&rc(e,El,t.cropmove),A(t.cropend)&&rc(e,Cl,t.cropend),A(t.crop)&&rc(e,xl,t.crop),A(t.zoom)&&rc(e,Ml,t.zoom),rc(i,Al,this.onCropStart=this.cropStart.bind(this)),t.zoomable&&t.zoomOnWheel&&rc(i,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&rc(i,Tl,this.onDblclick=this.dblclick.bind(this)),rc(e.ownerDocument,Ll,this.onCropMove=this.cropMove.bind(this)),rc(e.ownerDocument,jl,this.onCropEnd=this.cropEnd.bind(this)),t.responsive&&rc(window,"resize",this.onResize=this.resize.bind(this))},unbind(){var{element:e,options:t,cropper:i}=this;A(t.cropstart)&&sc(e,Sl,t.cropstart),A(t.cropmove)&&sc(e,El,t.cropmove),A(t.cropend)&&sc(e,Cl,t.cropend),A(t.crop)&&sc(e,xl,t.crop),A(t.zoom)&&sc(e,Ml,t.zoom),sc(i,Al,this.onCropStart),t.zoomable&&t.zoomOnWheel&&sc(i,"wheel",this.onWheel,{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&sc(i,Tl,this.onDblclick),sc(e.ownerDocument,Ll,this.onCropMove),sc(e.ownerDocument,jl,this.onCropEnd),t.responsive&&sc(window,"resize",this.onResize)}},cs={resize(){if(!this.disabled){var{options:e,container:t,containerData:i}=this,a=t.offsetWidth/i.width,t=t.offsetHeight/i.height;const s=Math.abs(a-1)>Math.abs(t-1)?a:t;if(1!=s){let i,a;e.restore&&(i=this.getCanvasData(),a=this.getCropBoxData()),this.render(),e.restore&&(this.setCanvasData(L(i,(e,t)=>{i[t]=e*s})),this.setCropBoxData(L(a,(e,t)=>{a[t]=e*s})))}}},dblclick(){var e,t;this.disabled||"none"===this.options.dragMode||this.setDragMode((e=this.dragBox,t=gl,(e.classList?e.classList.contains(t):-1<e.className.indexOf(t))?"move":_l))},wheel(e){var t=Number(this.options.wheelZoomRatio)||.1;let i=1;this.disabled||(e.preventDefault(),this.wheeling)||(this.wheeling=!0,setTimeout(()=>{this.wheeling=!1},50),e.deltaY?i=0<e.deltaY?1:-1:e.wheelDelta?i=-e.wheelDelta/120:e.detail&&(i=0<e.detail?1:-1),this.zoom(-i*t,e))},cropStart(t){var{buttons:e,button:i}=t;if(!(this.disabled||("mousedown"===t.type||"pointerdown"===t.type&&"mouse"===t.pointerType)&&(T(e)&&1!==e||T(i)&&0!==i||t.ctrlKey))){const{options:a,pointers:s}=this;let e;t.changedTouches?L(t.changedTouches,e=>{s[e.identifier]=pc(e)}):s[t.pointerId||0]=pc(t),e=1<Object.keys(s).length&&a.zoomable&&a.zoomOnTouch?"zoom":ec(t.target,bl),Dl.test(e)&&!1!==nc(this.element,Sl,{originalEvent:t,action:e})&&(t.preventDefault(),this.action=e,this.cropping=!1,"crop"===e)&&(this.cropping=!0,M(this.dragBox,wl))}},cropMove(e){var t=this["action"];if(!this.disabled&&t){const i=this["pointers"];e.preventDefault(),!1!==nc(this.element,El,{originalEvent:e,action:t})&&(e.changedTouches?L(e.changedTouches,e=>{j(i[e.identifier]||{},pc(e,!0))}):j(i[e.pointerId||0]||{},pc(e,!0)),this.change(e))}},cropEnd(e){if(!this.disabled){const{action:t,pointers:i}=this;e.changedTouches?L(e.changedTouches,e=>{delete i[e.identifier]}):delete i[e.pointerId||0],t&&(e.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,Zl(this.dragBox,wl,this.cropped&&this.options.modal)),nc(this.element,Cl,{originalEvent:e,action:t}))}}},t={change(e){var t,{options:i,canvasData:a,containerData:s,cropBoxData:r,pointers:n}=this;let o=this["action"],l=i["aspectRatio"],{left:c,top:d,width:h,height:u}=r;const p=c+h,m=d+u;let g=0,f=0,v=s.width,w=s.height,y=!0;!l&&e.shiftKey&&(l=h&&u?h/u:1),this.limited&&({minLeft:g,minTop:f}=r,v=g+Math.min(s.width,a.width,a.left+a.width),w=f+Math.min(s.height,a.height,a.top+a.height));var b=n[Object.keys(n)[0]];const k={x:b.endX-b.startX,y:b.endY-b.startY};var _=e=>{switch(e){case"e":p+k.x>v&&(k.x=v-p);break;case"w":c+k.x<g&&(k.x=g-c);break;case dl:d+k.y<f&&(k.y=f-d);break;case"s":m+k.y>w&&(k.y=w-m)}};switch(o){case"all":c+=k.x,d+=k.y;break;case"e":0<=k.x&&(p>=v||l&&(d<=f||m>=w))?y=!1:(_("e"),(h+=k.x)<0&&(o="w",h=-h,c-=h),l&&(u=h/l,d+=(r.height-u)/2));break;case dl:k.y<=0&&(d<=f||l&&(c<=g||p>=v))?y=!1:(_(dl),u-=k.y,d+=k.y,u<0&&(o="s",u=-u,d-=u),l&&(h=u*l,c+=(r.width-h)/2));break;case"w":k.x<=0&&(c<=g||l&&(d<=f||m>=w))?y=!1:(_("w"),h-=k.x,c+=k.x,h<0&&(o="e",h=-h,c-=h),l&&(u=h/l,d+=(r.height-u)/2));break;case"s":0<=k.y&&(m>=w||l&&(c<=g||p>=v))?y=!1:(_("s"),(u+=k.y)<0&&(o=dl,u=-u,d-=u),l&&(h=u*l,c+=(r.width-h)/2));break;case hl:if(l){if(k.y<=0&&(d<=f||p>=v)){y=!1;break}_(dl),u-=k.y,d+=k.y,h=u*l}else _(dl),_("e"),!(0<=k.x)||p<v?h+=k.x:k.y<=0&&d<=f&&(y=!1),(!(k.y<=0)||d>f)&&(u-=k.y,d+=k.y);h<0&&u<0?(o=ml,u=-u,h=-h,d-=u,c-=h):h<0?(o=ul,h=-h,c-=h):u<0&&(o=pl,u=-u,d-=u);break;case ul:if(l){if(k.y<=0&&(d<=f||c<=g)){y=!1;break}_(dl),u-=k.y,d+=k.y,h=u*l,c+=r.width-h}else _(dl),_("w"),!(k.x<=0)||c>g?(h-=k.x,c+=k.x):k.y<=0&&d<=f&&(y=!1),(!(k.y<=0)||d>f)&&(u-=k.y,d+=k.y);h<0&&u<0?(o=pl,u=-u,h=-h,d-=u,c-=h):h<0?(o=hl,h=-h,c-=h):u<0&&(o=ml,u=-u,d-=u);break;case ml:if(l){if(k.x<=0&&(c<=g||m>=w)){y=!1;break}_("w"),h-=k.x,c+=k.x,u=h/l}else _("s"),_("w"),!(k.x<=0)||c>g?(h-=k.x,c+=k.x):0<=k.y&&m>=w&&(y=!1),(!(0<=k.y)||m<w)&&(u+=k.y);h<0&&u<0?(o=hl,u=-u,h=-h,d-=u,c-=h):h<0?(o=pl,h=-h,c-=h):u<0&&(o=ul,u=-u,d-=u);break;case pl:if(l){if(0<=k.x&&(p>=v||m>=w)){y=!1;break}_("e"),h+=k.x,u=h/l}else _("s"),_("e"),!(0<=k.x)||p<v?h+=k.x:0<=k.y&&m>=w&&(y=!1),(!(0<=k.y)||m<w)&&(u+=k.y);h<0&&u<0?(o=ul,u=-u,h=-h,d-=u,c-=h):h<0?(o=ml,h=-h,c-=h):u<0&&(o=hl,u=-u,d-=u);break;case"move":this.move(k.x,k.y),y=!1;break;case"zoom":this.zoom(function(e){const t={...e};let r=0;return L(e,(s,e)=>{delete t[e],L(t,e=>{var t=Math.abs(s.startX-e.startX),i=Math.abs(s.startY-e.startY),a=Math.abs(s.endX-e.endX),e=Math.abs(s.endY-e.endY),t=Math.sqrt(t*t+i*i),i=(Math.sqrt(a*a+e*e)-t)/t;Math.abs(i)>Math.abs(r)&&(r=i)})}),r}(n),e),y=!1;break;case"crop":k.x&&k.y?(t=oc(this.cropper),c=b.startX-t.left,d=b.startY-t.top,h=r.minWidth,u=r.minHeight,0<k.x?o=0<k.y?pl:hl:k.x<0&&(c-=h,o=0<k.y?ml:ul),k.y<0&&(d-=u),this.cropped||(Kl(this.cropBox,S),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))):y=!1}y&&(r.width=h,r.height=u,r.left=c,r.top=d,this.action=o,this.renderCropBox()),L(n,e=>{e.startX=e.endX,e.startY=e.endY})}},m={crop(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&M(this.dragBox,wl),Kl(this.cropBox,S),this.setCropBoxData(this.initialCropBoxData)),this},reset(){return this.ready&&!this.disabled&&(this.imageData=j({},this.initialImageData),this.canvasData=j({},this.initialCanvasData),this.cropBoxData=j({},this.initialCropBoxData),this.renderCanvas(),this.cropped)&&this.renderCropBox(),this},clear(){return this.cropped&&!this.disabled&&(j(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),Kl(this.dragBox,wl),M(this.cropBox,S)),this},replace(t,e=!1){return!this.disabled&&t&&(this.isImg&&(this.element.src=t),e?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,L(this.previews,e=>{e.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable(){return this.ready&&this.disabled&&(this.disabled=!1,Kl(this.cropper,fl)),this},disable(){return this.ready&&!this.disabled&&(this.disabled=!0,M(this.cropper,fl)),this},destroy(){var e=this["element"];return e[E]&&(e[E]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate()),this},move(e,t=e){var{left:i,top:a}=this.canvasData;return this.moveTo(Fl(e)?e:i+Number(e),Fl(t)?t:a+Number(t))},moveTo(e,t=e){var i=this["canvasData"];let a=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.movable&&(T(e)&&(i.left=e,a=!0),T(t)&&(i.top=t,a=!0),a)&&this.renderCanvas(!0),this},zoom(e,t){var i=this["canvasData"];return e=Number(e),this.zoomTo(i.width*(e=e<0?1/(1-e):1+e)/i.naturalWidth,null,t)},zoomTo(e,t,i){var{options:a,canvasData:s}=this,{width:r,height:n,naturalWidth:o,naturalHeight:l}=s;if(0<=(e=Number(e))&&this.ready&&!this.disabled&&a.zoomable){a=o*e,l=l*e;if(!1===nc(this.element,Ml,{ratio:e,oldRatio:r/o,originalEvent:i}))return this;i?(e=this["pointers"],o=oc(this.cropper),e=e&&Object.keys(e).length?function(e){let i=0,a=0,s=0;return L(e,({startX:e,startY:t})=>{i+=e,a+=t,s+=1}),i/=s,a/=s,{pageX:i,pageY:a}}(e):{pageX:i.pageX,pageY:i.pageY},s.left-=(a-r)*((e.pageX-o.left-s.left)/r),s.top-=(l-n)*((e.pageY-o.top-s.top)/n)):$l(t)&&T(t.x)&&T(t.y)?(s.left-=(a-r)*((t.x-s.left)/r),s.top-=(l-n)*((t.y-s.top)/n)):(s.left-=(a-r)/2,s.top-=(l-n)/2),s.width=a,s.height=l,this.renderCanvas(!0)}return this},rotate(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo(e){return T(e=Number(e))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX(e){var t=this.imageData["scaleY"];return this.scale(e,T(t)?t:1)},scaleY(e){var t=this.imageData["scaleX"];return this.scale(T(t)?t:1,e)},scale(e,t=e){var i=this["imageData"];let a=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.scalable&&(T(e)&&(i.scaleX=e,a=!0),T(t)&&(i.scaleY=t,a=!0),a)&&this.renderCanvas(!0,!0),this},getData(e=!1){var{options:t,imageData:i,canvasData:a,cropBoxData:s}=this;let r;if(this.ready&&this.cropped){r={x:s.left-a.left,y:s.top-a.top,width:s.width,height:s.height};const n=i.width/i.naturalWidth;L(r,(e,t)=>{r[t]=e/n}),e&&(a=Math.round(r.y+r.height),s=Math.round(r.x+r.width),r.x=Math.round(r.x),r.y=Math.round(r.y),r.width=s-r.x,r.height=a-r.y)}else r={x:0,y:0,width:0,height:0};return t.rotatable&&(r.rotate=i.rotate||0),t.scalable&&(r.scaleX=i.scaleX||1,r.scaleY=i.scaleY||1),r},setData(t){var{options:i,imageData:a,canvasData:s}=this,r={};if(this.ready&&!this.disabled&&$l(t)){let e=!1;i.rotatable&&T(t.rotate)&&t.rotate!==a.rotate&&(a.rotate=t.rotate,e=!0),i.scalable&&(T(t.scaleX)&&t.scaleX!==a.scaleX&&(a.scaleX=t.scaleX,e=!0),T(t.scaleY))&&t.scaleY!==a.scaleY&&(a.scaleY=t.scaleY,e=!0),e&&this.renderCanvas(!0,!0);i=a.width/a.naturalWidth;T(t.x)&&(r.left=t.x*i+s.left),T(t.y)&&(r.top=t.y*i+s.top),T(t.width)&&(r.width=t.width*i),T(t.height)&&(r.height=t.height*i),this.setCropBoxData(r)}return this},getContainerData(){return this.ready?j({},this.containerData):{}},getImageData(){return this.sized?j({},this.imageData):{}},getCanvasData(){const t=this["canvasData"],i={};return this.ready&&L(["left","top","width","height","naturalWidth","naturalHeight"],e=>{i[e]=t[e]}),i},setCanvasData(e){var t=this["canvasData"],i=t["aspectRatio"];return this.ready&&!this.disabled&&$l(e)&&(T(e.left)&&(t.left=e.left),T(e.top)&&(t.top=e.top),T(e.width)?(t.width=e.width,t.height=e.width/i):T(e.height)&&(t.height=e.height,t.width=e.height*i),this.renderCanvas(!0)),this},getCropBoxData(){var e=this["cropBoxData"];let t;return(t=this.ready&&this.cropped?{left:e.left,top:e.top,width:e.width,height:e.height}:t)||{}},setCropBoxData(e){var t=this["cropBoxData"],i=this.options["aspectRatio"];let a,s;return this.ready&&this.cropped&&!this.disabled&&$l(e)&&(T(e.left)&&(t.left=e.left),T(e.top)&&(t.top=e.top),T(e.width)&&e.width!==t.width&&(a=!0,t.width=e.width),T(e.height)&&e.height!==t.height&&(s=!0,t.height=e.height),i&&(a?t.height=t.width/i:s&&(t.width=t.height*i)),this.renderCropBox()),this},getCroppedCanvas(e={}){if(!this.ready||!window.HTMLCanvasElement)return null;var t,i,a,s,r,n=this["canvasData"],o=([t,{aspectRatio:i,naturalWidth:p,naturalHeight:f,rotate:_=0,scaleX:x=1,scaleY:D=1},{aspectRatio:m,naturalWidth:b,naturalHeight:g},{fillColor:y="transparent",imageSmoothingEnabled:I=!0,imageSmoothingQuality:a="low",maxWidth:v=1/0,maxHeight:w=1/0,minWidth:o=0,minHeight:u=0}]=[this.image,this.imageData,n,e],s=document.createElement("canvas"),r=s.getContext("2d"),k=mc({aspectRatio:m,width:v,height:w}),m=mc({aspectRatio:m,width:o,height:u},"cover"),b=Math.min(k.width,Math.max(m.width,b)),k=Math.min(k.height,Math.max(m.height,g)),m=mc({aspectRatio:i,width:v,height:w}),g=mc({aspectRatio:i,width:o,height:u},"cover"),v=Math.min(m.width,Math.max(g.width,p)),w=Math.min(m.height,Math.max(g.height,f)),i=[-v/2,-w/2,v,w],s.width=Xl(b),s.height=Xl(k),r.fillStyle=y,r.fillRect(0,0,b,k),r.save(),r.translate(b/2,k/2),r.rotate(_*Math.PI/180),r.scale(x,D),r.imageSmoothingEnabled=I,r.imageSmoothingQuality=a,r.drawImage(t,...i.map(e=>Math.floor(Xl(e)))),r.restore(),s);if(!this.cropped)return o;let{x:l,y:c,width:d,height:h}=this.getData();var u=o.width/Math.floor(n.naturalWidth),p=(1!=u&&(l*=u,c*=u,d*=u,h*=u),d/h),m=mc({aspectRatio:p,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),g=mc({aspectRatio:p,width:e.minWidth||0,height:e.minHeight||0},"cover"),{width:f,height:v}=mc({aspectRatio:p,width:e.width||(1!=u?o.width:d),height:e.height||(1!=u?o.height:h)}),f=Math.min(m.width,Math.max(g.width,f)),v=Math.min(m.height,Math.max(g.height,v)),w=document.createElement("canvas"),y=w.getContext("2d"),{imageSmoothingEnabled:b=!0,imageSmoothingQuality:k}=(w.width=Xl(f),w.height=Xl(v),y.fillStyle=e.fillColor||"transparent",y.fillRect(0,0,f,v),e),_=(y.imageSmoothingEnabled=b,k&&(y.imageSmoothingQuality=k),o.width),x=o.height;let C=l,E=c,S,T,A,L,j,M;C<=-d||C>_?(C=0,S=0,A=0,j=0):C<=0?(A=-C,C=0,S=Math.min(_,d+C),j=S):C<=_&&(A=0,S=Math.min(d,_-C),j=S),S<=0||E<=-h||E>x?(E=0,T=0,L=0,M=0):E<=0?(L=-E,E=0,T=Math.min(x,h+E),M=T):E<=x&&(L=0,T=Math.min(h,x-E),M=T);var I,D=[C,E,S,T];return 0<j&&0<M&&(I=f/d,D.push(A*I,L*I,j*I,M*I)),y.drawImage(o,...D.map(e=>Math.floor(Xl(e)))),w},setAspectRatio(e){var t=this["options"];return this.disabled||Fl(e)||(t.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped)&&this.renderCropBox()),this},setDragMode(e){var t,i,{options:a,dragBox:s,face:r}=this;return this.ready&&!this.disabled&&(t=e===_l,i=a.movable&&"move"===e,a.dragMode=e=t||i?e:"none",tc(s,bl,e),Zl(s,gl,t),Zl(s,yl,i),a.cropBoxMovable||(tc(r,bl,e),Zl(r,gl,t),Zl(r,yl,i))),this}};const kc=cl.Cropper;class _c{constructor(e,t={}){if(!e||!Rl.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.options=j({},zl,$l(t)&&t),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}init(){var e=this["element"],t=e.tagName.toLowerCase();let i;if(!e[E]){if(e[E]=this,"img"===t){if(this.isImg=!0,i=e.getAttribute("src")||"",!(this.originalUrl=i))return;i=e.src}else"canvas"===t&&window.HTMLCanvasElement&&(i=e.toDataURL());this.load(i)}}load(e){if(e){this.url=e,this.imageData={};var{element:t,options:i}=this;if(i.rotatable||i.scalable||(i.checkOrientation=!1),i.checkOrientation&&window.ArrayBuffer)if(Ol.test(e))Pl.test(e)?this.read(vc(e)):this.clone();else{const s=new XMLHttpRequest;var a=this.clone.bind(this);this.reloading=!0,(this.xhr=s).onabort=a,s.onerror=a,s.ontimeout=a,s.onprogress=()=>{s.getResponseHeader("content-type")!==Il&&s.abort()},s.onload=()=>{this.read(s.response)},s.onloadend=()=>{this.reloading=!1,this.xhr=null},i.checkCrossOrigin&&dc(e)&&t.crossOrigin&&(e=hc(e)),s.open("GET",e,!0),s.responseType="arraybuffer",s.withCredentials="use-credentials"===t.crossOrigin,s.send()}else this.clone()}}read(e){var{options:t,imageData:i}=this,a=yc(e);let s=0,r=1,n=1;1<a&&(this.url=wc(e,Il),{rotate:s,scaleX:r,scaleY:n}=bc(a)),t.rotatable&&(i.rotate=s),t.scalable&&(i.scaleX=r,i.scaleY=n),this.clone()}clone(){var{element:e,url:t}=this;let i=e["crossOrigin"],a=t;this.options.checkCrossOrigin&&dc(t)&&(i=i||"anonymous",a=hc(t)),this.crossOrigin=i,this.crossOriginUrl=a;var s=document.createElement("img");i&&(s.crossOrigin=i),s.src=a||t,s.alt=e.alt||"The image to crop",(this.image=s).onload=this.start.bind(this),s.onerror=this.stop.bind(this),M(s,vl),e.parentNode.insertBefore(s,e.nextSibling)}start(){var e=this["image"];e.onload=null,e.onerror=null,this.sizing=!0;const t=cl.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(cl.navigator.userAgent),i=(e,t)=>{j(this.imageData,{naturalWidth:e,naturalHeight:t,aspectRatio:e/t}),this.initialImageData=j({},this.imageData),this.sizing=!1,this.sized=!0,this.build()};if(e.naturalWidth&&!t)i(e.naturalWidth,e.naturalHeight);else{const a=document.createElement("img"),s=document.body||document.documentElement;(this.sizingImage=a).onload=()=>{i(a.width,a.height),t||s.removeChild(a)},a.src=e.src,t||(a.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",s.appendChild(a))}}stop(){var e=this["image"];e.onload=null,e.onerror=null,e.parentNode.removeChild(e),this.image=null}build(){var e,t,i,a,s,r,n,o,l;this.sized&&!this.ready&&({element:e,options:t,image:i}=this,a=e.parentNode,(s=document.createElement("div")).innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',r=(s=s.querySelector(`.${E}-container`)).querySelector(`.${E}-canvas`),n=s.querySelector(`.${E}-drag-box`),l=(o=s.querySelector(`.${E}-crop-box`)).querySelector(`.${E}-face`),this.container=a,this.cropper=s,this.canvas=r,this.dragBox=n,this.cropBox=o,this.viewBox=s.querySelector(`.${E}-view-box`),this.face=l,r.appendChild(i),M(e,S),a.insertBefore(s,e.nextSibling),this.isImg||Kl(i,vl),this.initPreview(),this.bind(),t.initialAspectRatio=Math.max(0,t.initialAspectRatio)||NaN,t.aspectRatio=Math.max(0,t.aspectRatio)||NaN,t.viewMode=Math.max(0,Math.min(3,Math.round(t.viewMode)))||0,M(o,S),t.guides||M(o.getElementsByClassName(E+"-dashed"),S),t.center||M(o.getElementsByClassName(E+"-center"),S),t.background&&M(s,E+"-bg"),t.highlight||M(l,"cropper-invisible"),t.cropBoxMovable&&(M(l,yl),tc(l,bl,"all")),t.cropBoxResizable||(M(o.getElementsByClassName(E+"-line"),S),M(o.getElementsByClassName(E+"-point"),S)),this.render(),this.ready=!0,this.setDragMode(t.dragMode),t.autoCrop&&this.crop(),this.setData(t.data),A(t.ready)&&rc(e,"ready",t.ready,{once:!0}),nc(e,"ready"))}unbuild(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),Kl(this.element,S))}uncreate(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}static noConflict(){return window.Cropper=kc,_c}static setDefaults(e){j(zl,$l(e)&&e)}}j(_c.prototype,ns,os,ls,cs,t,m);const xc=_c,Cc=["edit","preview","test"];class Ec{#container;#valid=!0;#editors;#custom={};#md;#fields;#err;#pickers=[];#cropper;get area(){return this.#container.area}constructor(e){e.area.classList.add("settings","container-col","m5"),this.#container=e,this.area.oninput=e=>this.#handleInputChange(e.target),this.area.onchange=e=>this.#handleInputChange(e.target)}load(i,a={}){this.#reset();var s,r=new Map,n=new Set;for(s of i)if("string"==typeof s&&"opponent"===s&&(s={type:"autocomplete",name:"opponent",title:"Opponent",placeholder:"Select an opponent",value(e){return e.dataset.id},ds:"contact"}),!Cc.includes(s.type)){var o=s.name.toLowerCase();if("custom"==s.type){var t=new s.Instance,t=(this.#custom[o]=t).render(a);isPromise(t)?t.then(e=>this.#container.append(e)):this.#container.append(e)}else{s.name in a&&(s.val=a[s.name]);let t=s.type;"json"==t&&(t="text");const e=this.#container.addItemTemplate(`settings-${t}-field`,s);switch(r.set(o.toLowerCase(),s),(s.required&&!s.val||s.check&&s.val&&!s.check(s.val))&&n.add(o),s.type){case"autocomplete":{const w=e.querySelector("input");Array.isArray(s.options)?sn(w,s.options):"function"==typeof s.options&&(l=s.options(),isPromise(l)?l.then(e=>sn(w,e)):sn(w,l))}break;case"radio":var l=e.querySelectorAll("input");if(s.val){for(const e of l)if(e.value==s.val){e.checked=!0;break}}else l[0].checked=!0;break;case"region":case"option":s.val&&(c=e.querySelector(`select > option[value="${s.val}"]`))&&(c.selected=!0);break;case"optiontab":if(s.val){var c=e.querySelector(`select > option[value="${s.val}"]`),d=(c&&(c.selected=!0),{});for(const{name:y,fields:i}of s.options)if(i)for(const b of i)d[b.name]=b;for(const k of e.querySelectorAll("[data-tab] input")){var h=d[k.name];h&&h.val&&(k.value=h.val)}for(const _ of e.querySelectorAll("[data-tab] select")){var u=d[_.name];u&&u.val&&(u=_.querySelector(`option[value="${u.val}"]`))&&(u.selected=!0)}var p=e.querySelector(`[data-tab="${s.val}"]`);p&&dom.moveAfterTop(p)}break;case"text":p=e.querySelector("textarea");s.val&&(p.value=s.val),s.md&&(p.setAttribute("md",""),m=new MDE({element:p,spellChecker:!1,autoDownloadFontAwesome:!1}),this.#md=m);break;case"json":var m=e.querySelector("textarea");m.setAttribute("type","json"),s.val&&(m.value=JSON.stringify(s.val));break;case"list":if(s.val&&Array.isArray(s.val)){var g=e.querySelector("ul");for(const a of s.val){var f=dom.renderTemplate(s.template,a,"li");g.appendChild(f)}}break;case"faicon":var v=ol({rootElement:e.querySelector(".picker"),theme:"dark"});this.#pickers.push(v)}}}return this.#fields=r,this.#err=n,this.#valid=0==n.size,void this.onvalidchange(this.#valid)}getData(){var e,t,i={};for(const n of this.#queryInputs())if(""!=n.name)switch(n.tagName){case"INPUT":if(n.dataset.id)i[n.name]=n.dataset.id;else switch(n.type){case"checkbox":i[n.name]=!!n.checked;break;case"radio":n.checked&&(i[n.name]=n.value);break;case"number":i[n.name]=Number(n.value);break;default:i[n.name]=n.value}break;case"TEXTAREA":if(n.hasAttribute("md")){i[n.name]=this.#md.value();break}if("json"==n.getAttribute("type")){i[n.name]=JSON.parse(n.value);break}default:i[n.name]=n.value}for(const o of this.#queryLists()){var a=Array.from(o.querySelectorAll("li[data-id]")).map(e=>e.dataset.id);i[o.getAttribute("name")]=a}if(this.#editors)for(var[s,r]of Object.entries(this.#editors))i[s]=r.getValue();for([e,t]of Object.entries(this.#custom))i[e]=t.getValue();return this.#cropper&&(i.photo=Tc(this.#cropper)),i}onvalidchange(e){}async onFileDrop(e){var t=this.#container.querySelector(".dropzone");if(t){dom.removeChilds(t),t.classList.add("active");for(const i of e){this.#cropper=await Sc(i,t);break}}}#queryInputs(e=!0){return this.area.querySelectorAll(e?"input,select,textarea:not([data-mode])":"input,select,textarea")}#queryEdits(){return this.area.querySelectorAll("textarea[data-mode]")}#queryLists(){return this.area.querySelectorAll("ul[name]")}#reset(){if(this.#custom={},this.#cropper&&(this.#cropper.destroy(),this.#cropper=null),this.#md&&(this.#md.toTextArea(),this.#md=null),this.#editors){for(const e of Object.values(this.#editors))e.toTextArea();this.#editors=void 0}for(const t of this.#pickers)t.destroy();this.#pickers=[],this.#container.removeContent()}#handleInputChange(e){var t,i,a,s;""==e.name||"TEXTAREA"!=e.tagName&&("INPUT"!=e.tagName||["checkbox","radio","color"].includes(e.type))||(s=this.#fields,t=this.#err,i="INPUT"==e.tagName&&"checkbox"==e.type?!!e.checked:e.value,a=e.name,s=s.get(a)["check"],s&&!s(i)?(t.add(a),e.classList.add("error")):(t.delete(a),e.classList.remove("error")),0==t.size?(this.#valid||this.onvalidchange(!0),this.#valid=!0):(this.#valid&&this.onvalidchange(!1),this.#valid=!1))}}async function Sc(e,t,i="default"){var a=await loadImage(e,600),e=(e.name,t.appendChild(a),new xc(a,{aspectRatio:1,viewMode:1,ready:function(){}}));return e.name=i,e}function Tc(e){var t,i,a,s,e=e.getCroppedCanvas();return e=e,t=document.createElement("canvas"),i=t.getContext("2d"),a=e.width,s=e.height,t.width=a,t.height=s,i.imageSmoothingEnabled=!0,i.drawImage(e,0,0,a,s),i.globalCompositeOperation="destination-in",i.beginPath(),i.arc(a/2,s/2,Math.min(a,s)/2,0,2*Math.PI,!0),i.fill(),t.toDataURL("image/png")}Object.assign(Ec.prototype,UX.ListMixin);a={string(e={}){return Ac(e),Object.assign({type:"string",value:e=>e.value,valid:e=>!0},e)},time(e={}){return Ac(e),Object.assign({type:"time",value:e=>e.value,valid:e=>!0},e)},integer(e={}){return Ac(e),Object.assign({type:"number",value:e=>Number(e.value),valid:e=>!0},e)},option(e={}){return Ac(e),Object.assign({type:"option",value:e=>e.value.toLowerCase()},e)},variant(e={}){return Ac(e),Object.assign({type:"variant",value:e=>e.value.toLowerCase(),valid:e=>!0},e)},text(e={}){return Ac(e),Object.assign({type:"text",value:e=>e.value,valid:e=>!0},e)},radio(e={}){return Ac(e),Object.assign({type:"radio",value:e=>e.value.toLowerCase(),valid:e=>!0},e)},list(e={}){return Ac(e),Object.assign({type:"list"},e)},content(e={}){return Ac(e),Object.assign({type:"content"},e)},required(e){e={...e,required:!0};return e},name:{type:"string",name:"name",title:"Name",value:e=>e.value,check:e=>2<e.length,noedit:!0},firstname:{type:"string",name:"firstname",value:e=>e.value,check:e=>2<e.length},lastname:{type:"string",name:"lastname",value:e=>e.value,check:e=>2<=e.length},desc:{type:"text",name:"desc",title:"Description",value:e=>e.value,valid:e=>!0},email:{type:"string",name:"email",title:"Email",value:e=>e.value,check:validate.email},ns:{type:"string",name:"ns",title:"Namespace",value:e=>e.value,check:e=>3<e.length},domain:{type:"string",name:"domain",title:"Domain",value:e=>e.value,check:validate.domain},url:{type:"string",name:"url",title:"Url",value:e=>e.value,check:validate.url},role:{type:"option",name:"role",title:"Role",options:["User","Site admin","Admin"],value:e=>e.value.toLowerCase().replace(/ /g,""),valid:e=>!0},access:{type:"option",name:"access",title:"Access",options:["Public","Private"],value:e=>e.value.toLowerCase(),valid:e=>!0},perm:{type:"option",name:"perm",title:"Permission",options:["Full","Read only"],value:e=>e.value.toLowerCase().replace(/ /g,""),valid:e=>!0},channel:{type:"option",name:"channel",title:"Channel",options:()=>app.contacts.getChannels(),value:e=>Number(e.value),valid:e=>!0},comp:{type:"option",name:"comp",title:"Component",options:()=>app.contacts.getComponents(),value:e=>Number(e.value),valid:e=>!0},timeout:{type:"number",name:"timeout",title:"Timeout",value:e=>Number(e.value),valid:e=>!0},tls:{type:"boolean",name:"tls",title:"Tls",value:e=>e.checked,valid:e=>!0},category:{type:"option",name:"category",title:"Category",options:["News","Social","Sport","Education","Fun"],value:e=>e.value.toLowerCase(),valid:e=>!0},region:{type:"region",name:"region",title:"Region",options:["EU","Bulgaria"],value:e=>e.value.toLowerCase(),valid:e=>!0},tag:{type:"string",name:"tag",title:"Tag",value:e=>e.value.toLowerCase(),valid:e=>2<e.length}};function Ac(e){e.title||(e.title=e.name.capitalizeFirstLetter(),e.name=e.name.toLowerCase())}function Lc(e,n,o,l){return new(o=o||Promise)(function(i,t){function a(e){try{r(l.next(e))}catch(e){t(e)}}function s(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?i(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(a,s)}r((l=l.apply(e,n||[])).next())})}class jc extends Cn{}var I="top",Mc="bottom",Ic="right",D="left",Dc="auto",Oc=[I,Mc,Ic,D],Pc="start",Rc="end",zc="clippingParents",Bc="viewport",Nc="popper",Fc="reference",qc=Oc.reduce(function(e,t){return e.concat([t+"-"+Pc,t+"-"+Rc])},[]),Uc=[].concat(Oc,[Dc]).reduce(function(e,t){return e.concat([t,t+"-"+Pc,t+"-"+Rc])},[]),$c=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Hc(e){return e?(e.nodeName||"").toLowerCase():null}function Wc(e){var t;return null==e?window:"[object Window]"!==e.toString()?(t=e.ownerDocument)&&t.defaultView||window:e}function Vc(e){return e instanceof Wc(e).Element||e instanceof Element}function Xc(e){return e instanceof Wc(e).HTMLElement||e instanceof HTMLElement}function Yc(e){return"undefined"!=typeof ShadowRoot&&(e instanceof Wc(e).ShadowRoot||e instanceof ShadowRoot)}function Gc(e){return e.split("-")[0]}var Kc=Math.max,Zc=Math.min,Jc=Math.round;function Qc(e,t){void 0===t&&(t=!1);var i=e.getBoundingClientRect(),a=1,s=1;return Xc(e)&&t&&(t=e.offsetHeight,0<(e=e.offsetWidth)&&(a=Jc(i.width)/e||1),0<t)&&(s=Jc(i.height)/t||1),{width:i.width/a,height:i.height/s,top:i.top/s,right:i.right/a,bottom:i.bottom/s,left:i.left/a,x:i.left/a,y:i.top/s}}function ed(e){var t=Qc(e),i=e.offsetWidth,a=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:a}}function td(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&Yc(i)){var a=t;do{if(a&&e.isSameNode(a))return!0}while(a=a.parentNode||a.host)}return!1}function ad(e){return Wc(e).getComputedStyle(e)}function sd(e){return((Vc(e)?e.ownerDocument:e.document)||window.document).documentElement}function rd(e){return"html"===Hc(e)?e:e.assignedSlot||e.parentNode||(Yc(e)?e.host:null)||sd(e)}function nd(e){return Xc(e)&&"fixed"!==ad(e).position?e.offsetParent:null}function od(e){for(var t,i=Wc(e),a=nd(e);a&&(t=a,0<=["table","td","th"].indexOf(Hc(t)))&&"static"===ad(a).position;)a=nd(a);return(!a||"html"!==Hc(a)&&("body"!==Hc(a)||"static"!==ad(a).position))&&(a||function(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox"),i=-1!==navigator.userAgent.indexOf("Trident");if(!i||!Xc(e)||"fixed"!==ad(e).position){var a=rd(e);for(Yc(a)&&(a=a.host);Xc(a)&&["html","body"].indexOf(Hc(a))<0;){var s=ad(a);if("none"!==s.transform||"none"!==s.perspective||"paint"===s.contain||-1!==["transform","perspective"].indexOf(s.willChange)||t&&"filter"===s.willChange||t&&s.filter&&"none"!==s.filter)return a;a=a.parentNode}}return null}(e))||i}function ld(e){return 0<=["top","bottom"].indexOf(e)?"x":"y"}function cd(e,t,i){return Kc(e,Zc(t,i))}function dd(){return{top:0,right:0,bottom:0,left:0}}function hd(e){return Object.assign({},dd(),e)}function ud(i,e){return e.reduce(function(e,t){return e[t]=i,e},{})}function pd(e){return e.split("-")[1]}var md={top:"auto",right:"auto",bottom:"auto",left:"auto"};function gd(e){var t,i,a,s=e.popper,r=e.popperRect,n=e.placement,o=e.variation,l=e.offsets,c=e.position,d=e.gpuAcceleration,h=e.adaptive,u=e.roundOffsets,e=e.isFixed,p=l.x,p=void 0===p?0:p,m=l.y,m=void 0===m?0:m,g="function"==typeof u?u({x:p,y:m}):{x:p,y:m},g=(p=g.x,m=g.y,l.hasOwnProperty("x")),l=l.hasOwnProperty("y"),f=D,v=I,w=window,s=(h&&(i="clientHeight",t="clientWidth",(a=od(s))===Wc(s)&&"static"!==ad(a=sd(s)).position&&"absolute"===c&&(i="scrollHeight",t="scrollWidth"),n!==I&&(n!==D&&n!==Ic||o!==Rc)||(v=Mc,m=(m-((e&&a===w&&w.visualViewport?w.visualViewport.height:a[i])-r.height))*(d?1:-1)),n!==D&&(n!==I&&n!==Mc||o!==Rc)||(f=Ic,p=(p-((e&&a===w&&w.visualViewport?w.visualViewport.width:a[t])-r.width))*(d?1:-1))),Object.assign({position:c},h&&md)),e=!0===u?(n=(i={x:p,y:m}).x,i=i.y,o=window.devicePixelRatio||1,{x:Jc(n*o)/o||0,y:Jc(i*o)/o||0}):{x:p,y:m};return p=e.x,m=e.y,d?Object.assign({},s,((a={})[v]=l?"0":"",a[f]=g?"0":"",a.transform=(w.devicePixelRatio||1)<=1?"translate("+p+"px, "+m+"px)":"translate3d("+p+"px, "+m+"px, 0)",a)):Object.assign({},s,((t={})[v]=l?m+"px":"",t[f]=g?p+"px":"",t.transform="",t))}var fd={passive:!0};var vd={left:"right",right:"left",bottom:"top",top:"bottom"};function wd(e){return e.replace(/left|right|bottom|top/g,function(e){return vd[e]})}var yd={start:"end",end:"start"};function bd(e){return e.replace(/start|end/g,function(e){return yd[e]})}function kd(e){e=Wc(e);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function _d(e){return Qc(sd(e)).left+kd(e).scrollLeft}function xd(e){var e=ad(e),t=e.overflow,i=e.overflowX,e=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+e+i)}function Cd(e,t){void 0===t&&(t=[]);var i=function e(t){return 0<=["html","body","#document"].indexOf(Hc(t))?t.ownerDocument.body:Xc(t)&&xd(t)?t:e(rd(t))}(e),e=i===(null==(e=e.ownerDocument)?void 0:e.body),a=Wc(i),a=e?[a].concat(a.visualViewport||[],xd(i)?i:[]):i,i=t.concat(a);return e?i:i.concat(Cd(rd(a)))}function Ed(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Sd(e,t){return t===Bc?Ed((a=Wc(i=e),s=sd(i),a=a.visualViewport,r=s.clientWidth,s=s.clientHeight,o=n=0,a&&(r=a.width,s=a.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(n=a.offsetLeft,o=a.offsetTop)),{width:r,height:s,x:n+_d(i),y:o})):Vc(t)?((r=Qc(a=t)).top=r.top+a.clientTop,r.left=r.left+a.clientLeft,r.bottom=r.top+a.clientHeight,r.right=r.left+a.clientWidth,r.width=a.clientWidth,r.height=a.clientHeight,r.x=r.left,r.y=r.top,r):Ed((s=sd(e),n=sd(s),i=kd(s),o=null==(o=s.ownerDocument)?void 0:o.body,t=Kc(n.scrollWidth,n.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),e=Kc(n.scrollHeight,n.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),s=-i.scrollLeft+_d(s),i=-i.scrollTop,"rtl"===ad(o||n).direction&&(s+=Kc(n.clientWidth,o?o.clientWidth:0)-t),{width:t,height:e,x:s,y:i}));var i,a,s,r,n,o}function Td(i,e,t){var a,s="clippingParents"===e?(r=Cd(rd(s=i)),Vc(a=0<=["absolute","fixed"].indexOf(ad(s).position)&&Xc(s)?od(s):s)?r.filter(function(e){return Vc(e)&&td(e,a)&&"body"!==Hc(e)}):[]):[].concat(e),r=[].concat(s,[t]),e=r[0],t=r.reduce(function(e,t){t=Sd(i,t);return e.top=Kc(t.top,e.top),e.right=Zc(t.right,e.right),e.bottom=Zc(t.bottom,e.bottom),e.left=Kc(t.left,e.left),e},Sd(i,e));return t.width=t.right-t.left,t.height=t.bottom-t.top,t.x=t.left,t.y=t.top,t}function Ad(e){var t,i=e.reference,a=e.element,e=e.placement,s=e?Gc(e):null,e=e?pd(e):null,r=i.x+i.width/2-a.width/2,n=i.y+i.height/2-a.height/2;switch(s){case I:t={x:r,y:i.y-a.height};break;case Mc:t={x:r,y:i.y+i.height};break;case Ic:t={x:i.x+i.width,y:n};break;case D:t={x:i.x-a.width,y:n};break;default:t={x:i.x,y:i.y}}var o=s?ld(s):null;if(null!=o){var l="y"===o?"height":"width";switch(e){case Pc:t[o]=t[o]-(i[l]/2-a[l]/2);break;case Rc:t[o]=t[o]+(i[l]/2-a[l]/2)}}return t}function Ld(e,t){var a,t=t=void 0===t?{}:t,i=t.placement,i=void 0===i?e.placement:i,s=t.boundary,s=void 0===s?zc:s,r=t.rootBoundary,r=void 0===r?Bc:r,n=t.elementContext,n=void 0===n?Nc:n,o=t.altBoundary,o=void 0!==o&&o,t=t.padding,t=void 0===t?0:t,t=hd("number"!=typeof t?t:ud(t,Oc)),l=e.rects.popper,o=e.elements[o?n===Nc?Fc:Nc:n],o=Td(Vc(o)?o:o.contextElement||sd(e.elements.popper),s,r),s=Qc(e.elements.reference),r=Ad({reference:s,element:l,strategy:"absolute",placement:i}),l=Ed(Object.assign({},l,r)),r=n===Nc?l:s,c={top:o.top-r.top+t.top,bottom:r.bottom-o.bottom+t.bottom,left:o.left-r.left+t.left,right:r.right-o.right+t.right},l=e.modifiersData.offset;return n===Nc&&l&&(a=l[i],Object.keys(c).forEach(function(e){var t=0<=[Ic,Mc].indexOf(e)?1:-1,i=0<=[I,Mc].indexOf(e)?"y":"x";c[e]+=a[i]*t})),c}function jd(e,t,i){return{top:e.top-t.height-(i=void 0===i?{x:0,y:0}:i).y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function Md(t){return[I,Ic,Mc,D].some(function(e){return 0<=t[e]})}function Id(e,t,i){void 0===i&&(i=!1);var a=Xc(t),s=Xc(t)&&(n=(s=t).getBoundingClientRect(),r=Jc(n.width)/s.offsetWidth||1,n=Jc(n.height)/s.offsetHeight||1,1!==r||1!==n),r=sd(t),n=Qc(e,s),e={scrollLeft:0,scrollTop:0},o={x:0,y:0};return!a&&i||("body"===Hc(t)&&!xd(r)||(e=(a=t)!==Wc(a)&&Xc(a)?{scrollLeft:a.scrollLeft,scrollTop:a.scrollTop}:kd(a)),Xc(t)?((o=Qc(t,!0)).x+=t.clientLeft,o.y+=t.clientTop):r&&(o.x=_d(r))),{x:n.left+e.scrollLeft-o.x,y:n.top+e.scrollTop-o.y,width:n.width,height:n.height}}function Dd(e){var i=new Map,a=new Set,s=[];return e.forEach(function(e){i.set(e.name,e)}),e.forEach(function(e){a.has(e.name)||!function t(e){a.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){a.has(e)||(e=i.get(e))&&t(e)}),s.push(e)}(e)}),s}var Od={placement:"bottom",modifiers:[],strategy:"absolute"};function Pd(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}function Rd(e){var e=e=void 0===e?{}:e,t=e.defaultModifiers,h=void 0===t?[]:t,t=e.defaultOptions,u=void 0===t?Od:t;return function(a,s,t){void 0===t&&(t=u);var i,r,n={placement:"bottom",orderedModifiers:[],options:Object.assign({},Od,u),modifiersData:{},elements:{reference:a,popper:s},attributes:{},styles:{}},o=[],l=!1,c={state:n,setOptions:function(e){var i,t,e="function"==typeof e?e(n.options):e,e=(d(),n.options=Object.assign({},u,n.options,e),n.scrollParents={reference:Vc(a)?Cd(a):a.contextElement?Cd(a.contextElement):[],popper:Cd(s)},e=[].concat(h,n.options.modifiers),t=e.reduce(function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign({},i,t,{options:Object.assign({},i.options,t.options),data:Object.assign({},i.data,t.data)}):t,e},{}),e=Object.keys(t).map(function(e){return t[e]}),i=Dd(e),$c.reduce(function(e,t){return e.concat(i.filter(function(e){return e.phase===t}))},[]));return n.orderedModifiers=e.filter(function(e){return e.enabled}),n.orderedModifiers.forEach(function(e){var t=e.name,i=e.options,e=e.effect;"function"==typeof e&&(e=e({state:n,name:t,instance:c,options:void 0===i?{}:i}),o.push(e||function(){}))}),c.update()},forceUpdate:function(){if(!l){var e=n.elements,t=e.reference,e=e.popper;if(Pd(t,e)){n.rects={reference:Id(t,od(e),"fixed"===n.options.strategy),popper:ed(e)},n.reset=!1,n.placement=n.options.placement,n.orderedModifiers.forEach(function(e){return n.modifiersData[e.name]=Object.assign({},e.data)});for(var i,a,s,r=0;r<n.orderedModifiers.length;r++)!0===n.reset?(n.reset=!1,r=-1):(i=(s=n.orderedModifiers[r]).fn,a=s.options,s=s.name,"function"==typeof i&&(n=i({state:n,options:void 0===a?{}:a,name:s,instance:c})||n))}}},update:(i=function(){return new Promise(function(e){c.forceUpdate(),e(n)})},function(){return r=r||new Promise(function(e){Promise.resolve().then(function(){r=void 0,e(i())})})}),destroy:function(){d(),l=!0}};return Pd(a,s)&&c.setOptions(t).then(function(e){!l&&t.onFirstUpdate&&t.onFirstUpdate(e)}),c;function d(){o.forEach(function(e){return e()}),o=[]}}}var zd=Rd({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,i=e.instance,a=(e=e.options).scroll,s=void 0===a||a,r=void 0===(a=e.resize)||a,n=Wc(t.elements.popper),o=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&o.forEach(function(e){e.addEventListener("scroll",i.update,fd)}),r&&n.addEventListener("resize",i.update,fd),function(){s&&o.forEach(function(e){e.removeEventListener("scroll",i.update,fd)}),r&&n.removeEventListener("resize",i.update,fd)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,e=e.name;t.modifiersData[e]=Ad({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,e=e.options,i=void 0===(i=e.gpuAcceleration)||i,a=void 0===(a=e.adaptive)||a,e=void 0===(e=e.roundOffsets)||e,i={placement:Gc(t.placement),variation:pd(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,gd(Object.assign({},i,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:e})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,gd(Object.assign({},i,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:e})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var s=e.state;Object.keys(s.elements).forEach(function(e){var t=s.styles[e]||{},i=s.attributes[e]||{},a=s.elements[e];Xc(a)&&Hc(a)&&(Object.assign(a.style,t),Object.keys(i).forEach(function(e){var t=i[e];!1===t?a.removeAttribute(e):a.setAttribute(e,!0===t?"":t)}))})},effect:function(e){var a=e.state,s={popper:{position:a.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(a.elements.popper.style,s.popper),a.styles=s,a.elements.arrow&&Object.assign(a.elements.arrow.style,s.arrow),function(){Object.keys(a.elements).forEach(function(e){var t=a.elements[e],i=a.attributes[e]||{},e=Object.keys((a.styles.hasOwnProperty(e)?a.styles:s)[e]).reduce(function(e,t){return e[t]="",e},{});Xc(t)&&Hc(t)&&(Object.assign(t.style,e),Object.keys(i).forEach(function(e){t.removeAttribute(e)}))})}},requires:["computeStyles"]},{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var n=e.state,t=e.options,e=e.name,o=void 0===(t=t.offset)?[0,0]:t,t=Uc.reduce(function(e,t){var i,a,s,r;return e[t]=(t=t,i=n.rects,a=o,s=Gc(t),r=0<=[D,I].indexOf(s)?-1:1,t=(i="function"==typeof a?a(Object.assign({},i,{placement:t})):a)[0]||0,a=(i[1]||0)*r,0<=[D,Ic].indexOf(s)?{x:a,y:t}:{x:t,y:a}),e},{}),i=(a=t[n.placement]).x,a=a.y;null!=n.modifiersData.popperOffsets&&(n.modifiersData.popperOffsets.x+=i,n.modifiersData.popperOffsets.y+=a),n.modifiersData[e]=t}},{name:"flip",enabled:!0,phase:"main",fn:function(e){var h=e.state,t=e.options,e=e.name;if(!h.modifiersData[e]._skip){for(var i=t.mainAxis,a=void 0===i||i,i=t.altAxis,s=void 0===i||i,i=t.fallbackPlacements,u=t.padding,p=t.boundary,m=t.rootBoundary,r=t.altBoundary,n=t.flipVariations,g=void 0===n||n,f=t.allowedAutoPlacements,n=h.options.placement,t=Gc(n),i=i||(t===n||!g?[wd(n)]:Gc(i=n)===Dc?[]:(t=wd(i),[bd(i),t,bd(t)])),o=[n].concat(i).reduce(function(e,t){return e.concat(Gc(t)===Dc?(i=h,a=(e=e=void 0===(e={placement:t,boundary:p,rootBoundary:m,padding:u,flipVariations:g,allowedAutoPlacements:f})?{}:e).placement,s=e.boundary,r=e.rootBoundary,n=e.padding,o=e.flipVariations,l=void 0===(e=e.allowedAutoPlacements)?Uc:e,c=pd(a),e=c?o?qc:qc.filter(function(e){return pd(e)===c}):Oc,d=(a=0===(a=e.filter(function(e){return 0<=l.indexOf(e)})).length?e:a).reduce(function(e,t){return e[t]=Ld(i,{placement:t,boundary:s,rootBoundary:r,padding:n})[Gc(t)],e},{}),Object.keys(d).sort(function(e,t){return d[e]-d[t]})):t);var i,a,s,r,n,o,l,c,d},[]),l=h.rects.reference,c=h.rects.popper,d=new Map,v=!0,w=o[0],y=0;y<o.length;y++){var b=o[y],k=Gc(b),_=pd(b)===Pc,x=0<=[I,Mc].indexOf(k),C=x?"width":"height",E=Ld(h,{placement:b,boundary:p,rootBoundary:m,altBoundary:r,padding:u}),x=x?_?Ic:D:_?Mc:I,_=(l[C]>c[C]&&(x=wd(x)),wd(x)),C=[];if(a&&C.push(E[k]<=0),s&&C.push(E[x]<=0,E[_]<=0),C.every(function(e){return e})){w=b,v=!1;break}d.set(b,C)}if(v)for(var S=g?3:1;0<S;S--)if("break"===function(t){var e=o.find(function(e){e=d.get(e);if(e)return e.slice(0,t).every(function(e){return e})});if(e)return w=e,"break"}(S))break;h.placement!==w&&(h.modifiersData[e]._skip=!0,h.placement=w,h.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t,i,a,s,r,n,o,l,c,d=e.state,h=e.options,e=e.name,u=void 0===(u=h.mainAxis)||u,p=void 0!==(p=h.altAxis)&&p,m=h.boundary,g=h.rootBoundary,f=h.altBoundary,v=h.padding,w=void 0===(w=h.tether)||w,h=void 0===(h=h.tetherOffset)?0:h,m=Ld(d,{boundary:m,rootBoundary:g,padding:v,altBoundary:f}),g=Gc(d.placement),f=!(v=pd(d.placement)),y=ld(g),b="x"===y?"y":"x",k=d.modifiersData.popperOffsets,_=d.rects.reference,x=d.rects.popper,h="number"==typeof(h="function"==typeof h?h(Object.assign({},d.rects,{placement:d.placement})):h)?{mainAxis:h,altAxis:h}:Object.assign({mainAxis:0,altAxis:0},h),C=d.modifiersData.offset?d.modifiersData.offset[d.placement]:null,E={x:0,y:0};k&&(u&&(u="y"===y?"height":"width",n=(o=k[y])+m[i="y"===y?I:D],l=o-m[c="y"===y?Mc:Ic],t=w?-x[u]/2:0,s=(v===Pc?_:x)[u],v=v===Pc?-x[u]:-_[u],r=d.elements.arrow,r=w&&r?ed(r):{width:0,height:0},i=(a=d.modifiersData["arrow#persistent"]?d.modifiersData["arrow#persistent"].padding:dd())[i],a=a[c],c=cd(0,_[u],r[u]),r=f?_[u]/2-t-c-i-h.mainAxis:s-c-i-h.mainAxis,s=f?-_[u]/2+t+c+a+h.mainAxis:v+c+a+h.mainAxis,f=(i=d.elements.arrow&&od(d.elements.arrow))?"y"===y?i.clientTop||0:i.clientLeft||0:0,v=o+s-(t=null!=(u=null==C?void 0:C[y])?u:0),c=cd(w?Zc(n,o+r-t-f):n,o,w?Kc(l,v):l),k[y]=c,E[y]=c-o),p&&(a="y"==b?"height":"width",s=(i=k[b])+m["x"===y?I:D],u=i-m["x"===y?Mc:Ic],r=-1!==[I,D].indexOf(g),f=null!=(t=null==C?void 0:C[b])?t:0,n=r?s:i-_[a]-x[a]-f+h.altAxis,v=r?i+_[a]+x[a]-f-h.altAxis:u,o=w&&r?(l=cd(l=n,i,c=v),c<l?c:l):cd(w?n:s,i,w?v:u),k[b]=o,E[b]=o-i),d.modifiersData[e]=E)},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,i,a,s,r=e.state,n=e.name,e=e.options,o=r.elements.arrow,l=r.modifiersData.popperOffsets,c=ld(d=Gc(r.placement)),d=0<=[D,Ic].indexOf(d)?"height":"width";o&&l&&(e=e.padding,i=r,i=hd("number"!=typeof(e="function"==typeof e?e(Object.assign({},i.rects,{placement:i.placement})):e)?e:ud(e,Oc)),e=ed(o),s="y"===c?I:D,a="y"===c?Mc:Ic,t=r.rects.reference[d]+r.rects.reference[c]-l[c]-r.rects.popper[d],l=l[c]-r.rects.reference[c],o=(o=od(o))?"y"===c?o.clientHeight||0:o.clientWidth||0:0,s=i[s],i=o-e[d]-i[a],s=cd(s,a=o/2-e[d]/2+(t/2-l/2),i),r.modifiersData[n]=((o={})[c]=s,o.centerOffset=s-a,o))},effect:function(e){var t=e.state;null!=(e=void 0===(e=e.options.element)?"[data-popper-arrow]":e)&&("string"!=typeof e||(e=t.elements.popper.querySelector(e)))&&td(t.elements.popper,e)&&(t.elements.arrow=e)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,e=e.name,i=t.rects.reference,a=t.rects.popper,s=t.modifiersData.preventOverflow,r=Ld(t,{elementContext:"reference"}),n=Ld(t,{altBoundary:!0}),r=jd(r,i),i=jd(n,a,s),n=Md(r),a=Md(i);t.modifiersData[e]={referenceClippingOffsets:r,popperEscapeOffsets:i,isReferenceHidden:n,hasPopperEscaped:a},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":n,"data-popper-escaped":a})}}]});function Bd(e,t,i){if(i)if("string"==typeof i){var a=e,s=i;if(!t)throw new Error("Reference element is required for relative positioning");const n=zd(t,a,{placement:s,modifiers:[{name:"offset",options:{offset:[0,5]}}]});return()=>n.destroy()}else return t=i,(r=e).style.position="fixed",Object.entries(t).forEach(([e,t])=>{r.style[e]=t}),()=>{};throw new Error("Must provide a positioning option");var r}const Nd={hideOnClickOutside:!0,hideOnEmojiSelect:!0,hideOnEscape:!0,position:"auto",showCloseButton:!0};function Fd(e={}){return Object.assign(Object.assign(Object.assign({},Nd),{rootElement:document.body}),e)}var qd="popupPicker_popupContainer__-DboI",Ud="popupPicker_closeButton__j1nuQ";class $d{constructor(e,t){this.isOpen=!1,this.externalEvents=new jc,this.options=Object.assign(Object.assign({},Fd(t)),rl(e)),this.popupEl=document.createElement("div"),this.popupEl.classList.add(qd),this.popupEl.classList.add(this.options.theme),t.className&&this.popupEl.classList.add(t.className),this.options.showCloseButton&&(this.closeButton=document.createElement("button"),this.closeButton.classList.add(Ud),this.closeButton.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">\x3c!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --\x3e<path d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>',this.popupEl.appendChild(this.closeButton));e=document.createElement("div");this.popupEl.appendChild(e),this.picker=ol(Object.assign(Object.assign({},this.options),{rootElement:e})),this.focusTrap=new xo,this.picker.addEventListener("data:ready",()=>{this.focusTrap.activate(this.picker.el),this.picker.setInitialFocus()}),this.options.hideOnEmojiSelect&&this.picker.addEventListener("emoji:select",()=>{this.close()}),this.options.hideOnClickOutside&&(this.onDocumentClick=this.onDocumentClick.bind(this),document.addEventListener("click",this.onDocumentClick)),this.options.hideOnEscape&&(this.handleKeydown=this.handleKeydown.bind(this),this.popupEl.addEventListener("keydown",this.handleKeydown))}addEventListener(e,t){this.externalEvents.on(e,t),this.picker.addEventListener(e,t)}removeEventListener(e,t){this.externalEvents.off(e,t),this.picker.removeEventListener(e,t)}handleKeydown(e){"Escape"===e.key&&this.close()}destroy(){return Lc(this,void 0,void 0,function*(){this.isOpen&&(yield this.close()),document.removeEventListener("click",this.onDocumentClick),this.picker.destroy(),this.externalEvents.removeAll()})}toggle(){return this.isOpen?this.close():this.open()}open(){return Lc(this,void 0,void 0,function*(){this.isOpen||(yield this.initiateOpenStateChange(!0),this.options.rootElement.appendChild(this.popupEl),this.setPosition(),this.picker.reset(),yield this.animatePopup(!0),yield this.animateCloseButton(!0),this.picker.setInitialFocus(),this.externalEvents.emit("picker:open"))})}close(){var e;return Lc(this,void 0,void 0,function*(){this.isOpen&&(yield this.initiateOpenStateChange(!1),yield this.animateCloseButton(!1),yield this.animatePopup(!1),this.popupEl.remove(),this.picker.reset(),null!=(e=this.positionCleanup)&&e.call(this),this.focusTrap.deactivate(),null!=(e=this.options.triggerElement)&&e.focus(),this.externalEvents.emit("picker:close"))})}getRunningAnimations(){return this.picker.el.getAnimations().filter(e=>"running"===e.playState)}setPosition(){var e;null!=(e=this.positionCleanup)&&e.call(this),this.positionCleanup=Bd(this.popupEl,this.options.referenceElement,this.options.position)}awaitPendingAnimations(){return Promise.all(this.getRunningAnimations().map(e=>e.finished))}onDocumentClick(e){var t=e.target,i=null==(i=this.options.triggerElement)?void 0:i.contains(t);!this.isOpen||this.picker.isPickerClick(e)||i||this.close()}animatePopup(e){return vn(this.picker.el,{opacity:[0,1],transform:["scale(0.9)","scale(1)"]},{duration:150,id:e?"show-picker":"hide-picker",easing:"ease-in-out",direction:e?"normal":"reverse",fill:"both"},this.options)}animateCloseButton(e){if(this.closeButton)return vn(this.closeButton,{opacity:[0,1]},{duration:25,id:e?"show-close":"hide-close",easing:"ease-in-out",direction:e?"normal":"reverse",fill:"both"},this.options)}initiateOpenStateChange(e){return Lc(this,void 0,void 0,function*(){this.isOpen=e,yield this.awaitPendingAnimations()})}}const Hd='[role="icon"]';class Wd{#elem;constructor(e){this.#elem=e}set title(e){this.#elem.querySelector(".title").innerText=e}set desc(e){this.#elem.querySelector(".ns").innerText=e}set icon(e){var t=this.#elem.querySelector(Hd),i=t.className.split(" ").slice(0,-1);i.push(e),t.className=i.join(" ")}set avatar(e){this.#elem.querySelector(".avatar").src=e}set region(e){var t=this.#elem.querySelector(".flag-icon");t.className="flag-icon",e&&t.classList.add("flag-icon-"+e)}set mode(e){this.#elem.setAttribute("mode",e)}get icon(){return new class{#e;constructor(e){this.#e=e}set name(e){this.#e.setAttribute("name",e)}set id(e){this.#e.setAttribute("value",String.fromCodePoint(parseInt(e||"f111",16)))}set color(e){this.#e.style.color=e||"inherit"}set region(e){this.#e.querySelector(".flag-icon").className="flag-icon flag-icon-"+e}}(this.#elem.querySelector(Hd))}set admin(e){var t=this.#elem.querySelector('button[name="admin"]');t&&(e?dom.showElement(t):dom.hideElement(t))}get toolbar(){return this.#elem.querySelector(".toolbar")}get right(){return this.#elem.querySelector(".right")}set onclick(e){this.#elem.onclick=e}get headline(){return this.#elem.querySelector(".headline")}button(e){return this.#elem.querySelector(`button[name="${e}"]`)}role(e){return this.#elem.querySelector(`[role="${e}"]`)}q(e){return this.#elem.querySelector(e)}}class Vd{constructor(e){this.target=e}get contentEditable(){return!!this.target.contentEditable}getPos(){var e,t;return this.contentEditable?(this.target.focus(),(t=(e=document.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(this.target),t.setEnd(e.endContainer,e.endOffset),t.toString().length):this.target.selectionStart}setPos(e){if(this.contentEditable){this.target.focus();try{document.getSelection().collapse(this.target,e)}catch(e){}}else this.target.setSelectionRange(e,e)}}function Xd(e,a,t="auto"){s={triggerElement:e,referenceElement:e,position:t,hideOnClickOutside:!(t={})};const i=new $d(t,s);var s;i.addEventListener("picker:close",()=>{var e=a.tagName&&["INPUT","TEXTAREA"].includes(a.tagName)?a:a.element,t=new Vd(e),i=t.getPos();t.setPos(i+1),e.focus(),delete document._popup}),i.addEventListener("picker:open",()=>{document._popup=i}),i.addEventListener("emoji:select",e=>{e.emoji,a.value+=e.emoji+" ",a.parent.lastElementChild.disabled=!1}),e.blur(),i.open()}function Yd(e){if("INPUT"==e.tagName)return e;return new class{#input;constructor(e){this.#input=e}get element(){return this.#input}get parent(){return this.#input.parentElement}get value(){return this.#input.innerText}set value(e){this.#input.innerText=e}set oninput(e){return this.#input.oninput=e}set onkeydown(e){this.#input.onkeydown=e}focus(){this.#input.focus()}}(e)}function Gd(e,t){var i=/(http(s):\/\/.)[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g,a=/(drive:\/\/)([-_a-zA-Z0-9]{2,256})([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g;let s;for(var r=[];null!=(s=i.exec(t));){var n=s[0];try{var o,l,c,d,h,u=new URL(n);/youtube.com/.test(u.hostname)?(o=u.searchParams.get("v"))&&((l=dom.createElement("a","yt","w3-padding","noevents")).dataset.id=o,(c=dom.createElement("img")).src=`https://img.youtube.com/vi/${o}/hqdefault.jpg`,l.appendChild(c),e.appendChild(l)):(d=u.pathname,[,h]=fileX.getFilename(d),h&&fileX.isImage(h)&&r.push(n))}catch(e){console.error("Failed to parse URL:",n)}}for(;null!=(s=a.exec(t));){var p=s[0];"image"==new URL(p).searchParams.get("type")&&r.push(p)}0<r.length&&!async function(e,t){for(let e=0;e<t.length;++e){var i,a;(a=t[e]).startsWith("drive")&&([,a,i]=a.match(/drive:\/\/([^?]+)\?type=([a-z]+)/),a=await app.google.loadImage(a))&&(t[e]=a)}var s=dom.renderTemplate("slideshow",t,"div margin-top");e.appendChild(s)}(e,r)}class Kd{#container;#more;#less;#offset=0;#template;#ds;#search="";#results;get results(){return this.#results}get resultsElement(){return this.#container.querySelector(".results")}getResult(e){return this.#results.get(e)}constructor(e,t){this.#container=e,this.#more=e.querySelector('a[name="more"]'),this.#less=e.querySelector('a[name="less"]'),this.#template=`search-${t}-results`,this.#ds=app.ds(t)}async search(e=new Set,...t){dom.hideElement(this.#less),dom.hideElement(this.#more);var i=this.#container,t=(this.clear(),i.classList.add("loading3"),await delayResolve(this.#ds.search(this.#search,...t),1200));if(t&&0<t.length){t.local=e;e=dom.renderTemplate(this.#template,t);if(dom.insertBefore(e,i.lastElementChild),10<t.length){dom.showElement(this.#more);for(const a of Array.from(e.childNodes).slice(10))dom.hideElement(a)}}return i.classList.remove("loading3"),this.#results=new Map(t.map(e=>[e.id,e])),t}disableResult(e){var t,i=this.resultsElement.querySelector(`.item[data-id="${e}"]`);return i&&(t=i.querySelector(".actions"),dom.removeElement(t),i.classList.add("italic","watermark")),this.#results.get(e)}cloneResultElement(e,t,i=!1){var a,e=this.resultsElement.querySelector(`.item[data-id="${e}"]`);let s;if(e&&(s=e.cloneNode(!0),t&&(a=s.querySelector(".actions"),dom.removeElement(a),a=dom.renderTemplate(t),s.appendChild(a)),i)){const t=e.querySelector(".actions");dom.removeElement(t),e.classList.add("italic","watermark")}return s}clear(){var e=this.resultsElement,t=(e&&dom.removeElement(e),(e=this.#container.querySelector(".input-area")).firstElementChild);t.value="",t.focus(),e.lastElementChild.disabled=!0,dom.hideElement(this.#less),dom.hideElement(this.#more),this.#offset=0}showMore(){this.#offset+=10;var e=this.resultsElement,e=Array.from(e.childNodes);for(const t of e.slice(this.#offset,this.#offset+10))dom.showElement(t);this.#offset+10>=e.length&&dom.hideElement(this.#more),dom.showElement(this.#less)}showLess(){var e=this.resultsElement;for(const t of Array.from(e.childNodes).slice(this.#offset,this.#offset+10))dom.hideElement(t);this.#offset-=10,0==this.#offset&&dom.hideElement(this.#less),dom.showElement(this.#more)}onInput(e){e=e.value;this.#search=e}}class Zd{#container;#progress;#speed;#total;#start;constructor(e){this.#progress=e.querySelector("progress"),this.#speed=e.querySelector('[role="speed"]'),this.#total=parseInt(e.dataset.size),this.#start=Date.seconds(),(this.#container=e).setAttribute("state","downloading")}progress(e){var t;1==e?(t=this.#container.dataset.id,this.done(t)):(this.#progress.value=Math.floor(100*e),t=Math.floor(this.#total*e),e=Date.seconds()-this.#start,this.#speed.innerText=fileX.formatSize(t/e)+"/s")}done(e){this.#progress.value=100,this.#container.setAttribute("state","done")}}a.string({name:"status",title:"Status"});class Jd extends UX.Page{get area(){return this.container}constructor(e,t){t=t?dom.renderTemplate(t):dom.createElement("div","container-col","settings","fade","hidden");e.appendChild(t),super(t)}}Object.assign(Jd.prototype,UX.ListMixin);class Qd extends Jd{}class eh extends Jd{#cm;constructor(e){super(e,"editor-add-code")}async load(){var e=this.querySelector('textarea[name="code"]');this.#cm=await an.bind(e,"js",!0)}set value(e){this.#cm.setValue(e||"")}get value(){return this.#cm.getValue()}async onAction(e,t,i){}}class th extends Jd{#results;constructor(e,t=0){super(e,"editor-add-test");e=this.querySelector(".results");this.#results=UX.List.createMixin(e)}async onAction(e,t,i){if(this.#results.clear(),t.domain)if(t.domain,t.location,t.code){t.code;try{let e=await ajax.post("/api/scrap/test",t);if(Array.isArray(e)||"object"==typeof e&&(e=e.data),e.length,Array.isArray(e))for(const a of e)this.#results.addItemTemplate("channel-feed",a);else"string"==typeof e&&(result.innerHTML=dom.markdown(e))}catch(e){console.error("Test request failed:",e)}}else console.error("Test request without code!");else console.error("Test request without domain!")}}class ih extends UX.ListPage{static Fields=a;static kOptions={};static register(e,t,i){i&&(t.onAdd=i),ih.kOptions[e]=t}static kPreview={};static preview(e,t){ih.kPreview[e]=t}#settings;#tabs;#code={};#editor;#preview;#test;#onadd;#onpreview;get id(){return"add"}get storageId(){return this.id+"-"+this.type}get dragOptions(){return{directory:!1,hover:!1,files:["image"]}}get excludeFromStack(){return!0}constructor(e="add-editor"){super(e),this.pages=new Map;let t=this.headerElement.querySelector('button[name="submit"]');e=this.editorElement,this.#tabs=e.querySelector(".tabbar"),e=new Qd(this.area),this.addPage("main",e),e=new Ec(e);e.onvalidchange=e=>t.disabled=!e,this.#settings=e}get inputSelector(){return"input:not([type=radio]),select,textarea,input[type=radio]:checked"}onFileDrop(e){this.#settings.onFileDrop(e)}onAction(e){switch(e){case"submit":this.onAddClicked(this.#settings.getData());break;case"cancel":app.cancelEditor()}}onEditorAction(e,t,i){switch(this.current){case"code":var a=this.#settings.getData();this.#editor.onAction(e,a,i);break;case"test":a=this.#settings.getData();a.code=this.#editor?this.#editor.value:"",this.#test.onAction(e,a,i)}}open(i,a,s){if(s.reload||this.type!=a){s.items||(r=ih.kOptions[a],Array.isArray(r)?s.items=r:Object.assign(s,r)),this.type=a;var{icon:r,desc:s,items:n,onAdd:o,info:l,onPreview:c}=s;let e=i.capitalizeFirstLetter()+" "+a.toLowerCase();"edit"==i&&(e+=` '${l.name}'`);a=new Wd(this.headerElement);a.icon=r,a.title=e,a.desc=s||"no description";let t=l;l||(i=this.storageId,t=(t=localStorage.getItem(i)||void 0)&&JSON.parse(t)),this.#settings.load(n,t),this.#onadd=n.onAdd||o,this.#onpreview=c||function(){};r=n.filter(e=>"edit"==e.type),a=n.filter(e=>["test","preview"].includes(e.type));if(0==r.length)dom.hideElement(this.#tabs);else{dom.showElement(this.#tabs),this.#code={};let e=this.#tabs.firstElementChild.nextElementSibling;for(;e;){var d=e;e=e.nextElementSibling,dom.removeElement(d)}for(const h of r)this.#addTab(h.name),this.#code[h.name]=l?l[h.name]||"":h.val||"";for(const u of a)this.#addTab(u.name)}this.#tabs.firstElementChild.classList.add("active"),this.switchTo("main")}}async onTabChange(e,t){var i;["main","preview","test"].includes(t)||(i=this.#editor?this.#editor.value:"// add code here\n",this.#code[t]=i);let a=!1;"preview"==e?(a=!0,this.#preview||((t=new ih.kPreview[this.type](this.area)).updateSize(this.height),this.addPage("preview",t),this.#preview=t),i=Object.values(this.#code)[0],this.#preview.loadFromCode(i)):"main"!=e&&("test"==e?this.#test||(t=new th(this.area),this.addPage("test",t),this.#test=t):(a=!0,this.#editor||(i=new eh(this.area),await(this.#editor=i).load(),this.addPage("code",i)),this.#editor.current=e,this.#editor.value=this.#code[e],e="code")),a?this.area.classList.add("max-height"):this.area.classList.remove("max-height"),this.switchTo(e)}onAddClicked(e){e.name&&(e.name=e.name.trim().replace(/\s+/g," "));var t=this.storageId;localStorage.setItem(t,JSON.stringify(e)),this.#onadd&&("main"!=this.current&&(this.#code[this.#editor.current]=this.#editor.value),Object.assign(e,this.#code),this.#onadd(e))}#addTab(e){var t=dom.createElement("span","tab");t.innerText=e,t.setAttribute("tab",e),this.#tabs.appendChild(t)}}Object.assign(ih.prototype,UX.PageControllerMixin),window.AddEditor=ih;class ah extends UX.ListPage{static id="find";static kAttributes={};static register(e,t){this.kAttributes[e]=t}#params;#locals;#search="";#searchb;#lastSelected=new Set;get excludeFromStack(){return!0}constructor(e){e||((e=dom.renderTemplate("editor-base",{},"div",["editor-header-grid","editor-find-toolbar"],"editor-find-base")).id="find-editor",dom.hideElement(e)),super(e),this.area.classList.add("cc","m2","results","list"),this.#searchb=this.editorElement.querySelector('button[name="search"]')}set search(e){this.#searchb.disabled=e}onAction(e,t,i){this.#handleAction(e,i)}onEditorAction(e,t,i){"search"===e?(i.disabled=!0,this.#doSearch()):(i=t.dataset.id,i=this.#locals.get(i),this.#params.onaction&&this.#params.onaction(e,i),t.classList.add("local"))}onClick(e,t){var i=t.dataset;"select"==this.#params.type?i.selected="false"==i.selected:(i=this.#params.onclick)&&i(t.dataset)}onInput(e,t){e.target;var i=e.value,a=3<=i.length;e.nextElementSibling.disabled=!a,1!=i.length&&this.filter(i),this.#search=a?i:""}onKeyPress(e,t){"Enter"==t&&0<this.#search.length&&this.#doSearch()}open(e,t={ds:e,mode:"ls"}){var i,a;this.action==e&&!t.force&&this.#params&&t.mode==this.#params.mode&&t.type==this.#params.type||(t.ds||(t.ds=e),t.mode||(t.mode="ls"),this.action=e,(i=new Wd(this.headerElement)).title=t.title||"Find "+e,i.desc=t.desc||"Search database for "+e,i.icon.name=e,a=t.type||"find",this.#setMode(a,i,!!t.add),a=i.button("new"),t.add?dom.showElement(a):dom.hideElement(a),this.clear(),this.#load(t))}async#load(e){var{local:t,remote:i,ds:a,cmd:s}=e;if(!e.result&&a&&(e.result=`find-${a}-item`),s?(this.area.setAttribute("group",a||t),this.area.setAttribute("cmd",s)):(this.area.removeAttribute("group"),this.area.removeAttribute("cmd")),this.#locals=null,this.#params=e,a)return this.#loadFromDS(e);if(this.search=!i,t){s=await app.db.ls(t);if(0!=s.length){sh(s,this.#lastSelected);var r=new Map;for(const n of s)r.set(n.id,n),this.#addItem(n);this.#locals=r}}}async#loadFromDS({ds:e,result:t,results:i,mode:a}){if(this.search=!1,"string"==typeof e&&(e=app.ds(e)),"ls"===a){var s,a=await e.ls();sh(a,this.#lastSelected);for(const r of a)s=r.ds||e.name,s=i&&i[s]||t,this.#addItem(r,s);this.#locals=new Map(a.map(e=>[e.id.toString(),e]))}}async#doSearch(){var e,t=this.#search;let{remote:i,index:a,local:s,table:r,ds:n}=this.#params;this.toggleLoading();let o;if(n?("string"==typeof n&&(n=app.ds(n)),e=ah.kAttributes[n.name]||[],o=await delayResolve(n.search(this.#search,e,a)),s=s&&n):o=await delayResolve(r?this.#queryDatabase(r,null,this.#search):this.#queryFirebase(i,a||"name",t.toLowerCase())),o){this.#locals||(this.#locals=new Map);var l=this.#locals,c=[];for(const u of o){var d,h=u.id.toString();l.has(h)?(d=this.getItem(h))&&dom.showElement(d):(u.user&&(u.user=await app.loadContact(u.user)),u.remote=!0,c.push(u),l.set(h,u),this.#addItem(u,null,!0))}if(s&&0<c.length)try{"string"==typeof s?await app.db.add(s,c,"add"):await s.put(c)}catch(e){console.error("Failed to add results into local db",e)}}this.toggleLoading()}async#queryFirebase(e,t,i){t=i?await app.firebase.search(e,t,i):await app.firebase.ls(e);return t?Object.toArray(t):[]}async#queryDatabase(t,e,i){let a;try{let e="/api/search/"+t;var s;i&&(s=new URLSearchParams({what:i}),e+="?"+s.toString()),a=await ajax.get(e)}catch(e){console.error("Failed to query database")}return a}#addItem(e,t,i=!1){var{result:a,type:s,isselected:r,purge:n}=this.#params,a=(e.id,this.addItemTemplate(t=t||a,e,i));a.dataset.name=e.display||e.name,e.remote||a.classList.add("local"),"select"==s?(t=dom.createElement("i","fa","check","fa-circle","stroke","w3-text-blue"),a.dataset.selected=!!r&&r(e),a.removeAttribute("cmd"),a.appendChild(t)):"cmd"!=s&&("rm"==s?((i=dom.createElement("button","icon","fa","display-hover")).name="remove",i.title="Remove",r=this.#params.ds,i.setAttribute("cmd",(n?"purge":"rm")+"-"+r),a.appendChild(i)):((t=dom.createElement("button","icon","fa","display-hover")).name="add",t.title="Add",a.appendChild(t),e.remote||a.classList.add("local")))}#setMode(e,t,i=!1){var a=t.button("new"),a=(dom.showElement(a,i),t.button("submit"));dom.showElement(a,"select"==e)}#handleAction(e,t){switch(e){case"new":case"add":return void app.executeCommand("add","new",this.action);case"submit":if(this.#params.ondone){var i=Array.from(this.getItems("selected","true")).map(e=>e.dataset.id),a=i.map(e=>this.#locals.get(e));this.#params.ondone(a);for(const s of i)this.#lastSelected.add(s)}break;case"select":return}app.cancelEditor()}}function sh(e,i){e.sort((e,t)=>i.has(e.id)?-1:i.has(t)?1:0)}window.FindEditor=ah;class rh extends UX.ListPageController{#active;#opened=!1;get active(){return this.#active}get header(){var e=this.headerElement;return new Wd(e)}get opened(){return this.#opened}show(){this.#opened=!0,super.show()}hide(){this.#opened=!1,super.hide()}switchTo(e){this.#active=super.switchTo(e)}onInput(...e){this.#active&&this.#active.onInput(...e)}onFilter(...e){this.#active&&this.#active.onFilter(...e)}onKeyPress(...e){this.#active&&this.#active.onKeyPress(...e)}onClick(...e){this.#active&&this.#active.onClick(...e)}onElementClick(e){if(this.#active)switch(e.tagName){case"A":case"BUTTON":return this.#active.onAction(e.getAttribute("name"),null,e)}}onEditorAction(...e){this.#active&&this.#active.onAction(...e)}onAction(){}onFileDrop(){}onScrollY(){}onResize(){}}class nh extends UX.List{#width;#parent;#sash;#tabbar;#navbar;#collapsed=!1;pages=new Map;get collapsed(){return this.#collapsed}constructor(e,t,i=[]){let a;e?a=e.nextElementSibling:(a=dom.createElement("div","v-sash","reverse"),e=dom.renderTemplate("editor-sidebar",i),parent.appendChild(e),parent.appendChild(a)),super(e.querySelector(".scrollable")),this.container=e,this.#sash=a,this.#tabbar=e.querySelector(".tabbar"),this.#navbar=e.querySelector(".navbar");let s=250,r=!1;t&&(e.id=t,i=app.ui[t])&&(r=!!i.collapsed,s=i.width||s),e.style.width=s+"px",r&&this.toggle()}onAction(e,t,i){switch(e){case"collapse":case"expand":this.toggle();break;default:this.handleAction(e,t,i)}}onElementClick(){}handleAction(){}toggle(){var e=this.container.classList.toggle("collapsed");let t;t=e?(this.#sash&&dom.hideElement(this.#sash),this.#width=this.container.style.width,this.container.style.width=null,!1):(this.#sash&&dom.showElement(this.#sash),this.container.style.width=this.#width,!0),this.#collapsed=!t;var i=this.container.closest(".sidebar").id;return i&&app.updateSetting(i,{collapsed:e}),t}show(){this.#collapsed=!1,dom.showElement(this.container),this.container.style.width=this.#width,this.#sash&&dom.showElement(this.#sash)}hide(){this.#collapsed=!0,dom.hideElement(this.container),this.#sash&&dom.hideElement(this.#sash)}load(e,t=e){}loadTabs(e=0){var t=this.tabs;for(const i of t)this.#addPage(new oh(i,!0));this.switchTo(t[e])}onTabChange(e,t){this.switchTo(e)}add(e,t=!1){var i=e.renderTab();this.#tabbar.insertBefore(i,this.#tabbar.lastElementChild),this.#addPage(e),t&&(i.classList.add("active"),this.switchTo(e.name))}onClick(){}#addPage(e){this.area.appendChild(e.container),this.addPage(e.id,e)}#switchTo(e){this.#tabbar.querySelector(".active").classList.remove("active"),e.classList.add("active");e=e.dataset.tab;this.switchTo(e)}updateTimes(){this.getCurrentPage().updateTimes()}}Object.assign(nh.prototype,UX.PageControllerMixin);class oh extends UX.Page{#name;constructor(e,t=!1){var i=dom.createElement("div","column","fit","hidden");t&&i.classList.add("show-empty"),super(i),this.reverse&&i.classList.add("reverse"),this.#name=e}get id(){return this.#name}get area(){return this.container}get name(){return this.#name}renderTab(){var e,t=dom.createElement("span","tab","text-center","fit");return this.icon&&(e=dom.createElement("i","fa",...this.icon.split(" ")),t.classList.add("icon"),t.appendChild(e)),t}updateTimes(){var e=Date.now();for(const i of this.container.querySelectorAll("time[data-time]")){var t=1e3*Number(i.dataset.time),t=new Date(t);i.innerText=t.offsetFrom(e)}}createList(){return UX.List.createMixin(this.container)}}async function lh(e,t,i=!1,a=!1){let s,r="";if(i?s=t:(s=dom.createElement("span","article","md","nomargin","fade"),t&&(a?dom.insertBefore(s,t.lastElementChild):t.appendChild(s))),s.classList.add("loading3"),e.content)r=e.content;else{var n,a="string"==typeof e?e:e.id,e=app.ds("news");try{(n=await e.local.get(a))&&n.content?r=n.content:(n=await delayResolve(e.remote.get(a),1200),r=n.content,await e.local.put(n))}catch(e){return console.error("Failed to load article"),t&&dom.removeElement(s),s.classList.remove("loading3"),null}}r=toMarkdown(r);a=dom.markdown(r);return s.classList.remove("loading3"),i?s.innerHTML+=a:s.innerHTML=a,s}Object.assign(oh.prototype,UX.ListMixin);class ch extends UX.PageController{static Page=rh;static Sidebar=nh;static#editors={};static register(e,t=e.id){ch.#editors[t]=e}#dragCounter=0;#container;#stack=[];#mo;#scrollable;#sidebar;#current;#autocomplete;get currentEditor(){return this.#current}get loadingElement(){return document.getElementById("editor-loading")}get showHover(){return this.#current.dragOptions&&this.#current.dragOptions.hover}get container(){return this.#container}get dragOptions(){return this.#current.dragOptions}constructor(e="editor"){super();e=document.getElementById(e);(this.#container=e).onclick=e=>this.#onClick(e.target,{x:e.clientX,y:e.clientY}),e.oninput=e=>this.onInput(e.target,e.data),e.onkeyup=t=>{if("Enter"==t.key&&!t.shiftKey){t.preventDefault();var i=t.target,a=i.closest(".search-area");let e=!0;(e=a?!uh(a):e)&&this.onKeyPress(i,t.key)}},e.onkeydown=e=>{"Enter"!=e.key||e.shiftKey||e.preventDefault()},e.onchange=e=>this.onChange(e.target,e.target.value),this.#addCommonEditors()}registerMouseEvents(){document.onmousedown=e=>{var t=e.target;if(t.classList.contains("v-sash")){const a=t.previousElementSibling,i=t.classList.contains("reverse"),s=e.clientX,r=a.offsetWidth,n=(document.body.style.cursor="e-resize",e=>{e=s-e.clientX,e=i?r+e:r-e;a.style.width=e+"px"}),o=e=>{document.documentElement.removeEventListener("mousemove",n,!1),document.documentElement.removeEventListener("mouseup",o,!1),document.body.style.cursor="default";var t,i=a.id;i&&(t=parseInt(a.style.width),this.updateWidth(i,t))};document.documentElement.addEventListener("mousemove",n,!1),document.documentElement.addEventListener("mouseup",o,!1)}}}onAction(t,i,a){var s=[];switch(t){case"send":var r=a.closest(".input-area");if(r){a.disabled=!0;r=r.firstElementChild;let e;r.hasAttribute("contenteditable")?(e=r.innerText,r.innerText=""):(e=r.value,r.value=""),e=e.trim(),a.inputValue=e,s.push(e)}break;case"play":r="pause"==a.value?"play":"pause";a.value=r,a.title=r.capitalizeFirstLetter()}var n=a.getAttribute("link");if(n)[,...n]=n.split("/"),app.openEditor(...n);else{let e=a.getAttribute("cmd");if(!(e=/^cmd-/.test(t)?t.substr(4):e)||!this.#onCommand(e,i,a,...s)){n=this.currentEditor;if(n){var o=n.headerElement;if(o&&o.contains(a))n.onAction(t,i,a);else{o=n.sidebar;if(o&&o.container.contains(a))o.onAction(t,i,a);else{if(n.hasComments)if(a.closest("[comments]"))return void app.comments.onAction(a);var l;switch(t){case"call":return void app.openEditor("video","call",i.dataset.id,{audio:!0,video:!1});case"emoji":return void Xd(a,Yd(a.parentElement.firstElementChild),"top-end");case"share":if(i.dataset.type)return void app.share(i.dataset.type,i.dataset.id);break;case"cancel":case"submit":"edit"==i.getAttribute("mode")&&(i.removeAttribute("mode"),l=i.querySelector('[role="edit"]'),dom.removeElement(l));break;case"remove":case"delete":dom.removeElement(i)}n.onEditorAction(t,i,a)}}}}}}onClick(s,e){let r=this.currentEditor;if(r){var n=r.sidebar;if(n&&n.container.contains(s))r=n;else{if(s.hasAttribute("contenteditable")||["INPUT","SELECT"].includes(s.tagName))return;if(r.hasComments){const e=s.closest("[comments]");if(e)return void app.comments.onClick(s,e)}}let t,i,a;if((s=s.hasAttribute("expandable")&&(n=s.closest("[data-id]"))?n:s).classList.contains("item")){s.removeAttribute("new"),s.classList.remove("new");n=s.querySelector("[collapsable]"),n=(n&&n.classList.toggle("hidden"),s.hasAttribute("selected")?(a=!1,s.removeAttribute("selected")):(a=!0,s.setAttribute("selected","")),t=s.dataset.id,s.closest("[group]"));i=n?n.getAttribute("group"):null;let e=s.getAttribute("cmd");(e=!e&&n?n.getAttribute("cmd"):e)&&this.#onCommand(e,s),r.onClick(t,s,a,i)}else{var o,l,c,n=s.getAttribute("tab");n?s.classList.contains("active")||((o=(l=s.parentElement).querySelector(".tab.active")).classList.remove("active"),s.classList.add("active"),o=o.getAttribute("tab"),"tab-area"==(l=l.nextElementSibling).getAttribute("role")?(c=l.querySelector(`[page="${o}"]`),dom.hideElement(c),c=l.querySelector(`[page="${n}"]`),dom.showElement(c)):r.onTabChange(n,o)):((l=s.getAttribute("cmd"))&&(c=s.closest(".item"),this.#onCommand(l,c,s)),r.onElementClick(s,e))}}}onInput(e,t){mh();var i=e.getAttribute("name"),a=this.currentEditor;let s=!1;if("INPUT"==e.tagName){var r,n,o=e.value.trim();if(t){if(o.isExpression())return e.setAttribute("exp",!0),e.setAttribute("_ph",e.placeholder),e.placeholder="expression",e.spellcheck=!1,e.value="",void(s=!0);s=e.hasAttribute("exp")}else""==o&&e.hasAttribute("exp")&&(e.placeholder=e.getAttribute("_ph"),e.removeAttribute("_ph"),e.removeAttribute("exp"));if("search"==i)return r=e.parentElement.lastElementChild,n=2<o.length,r.disabled=!n,r.previousElementSibling.disabled=0==o.length,void(a&&a.onFilter(o,e))}a&&("comment"==i?(n=e.innerText,e.parentElement.lastElementChild.disabled=!/.{2,2000}/.test(n.trim())):(s||((r=e.getAttribute("ds"))&&(o=app.ds(r))&&gh(this.#autocomplete=e,o),(r=e.getAttribute("_ac"))&&fh(this.#autocomplete=e,a,r),e.hasAttribute("contenteditable")&&(e.value=e.innerText)),a.onInput(e,t,s)))}onKeyPress(i,e){var a,s,r,t=this.currentEditor;if(t){if(t.hasComments)if(i.closest("[comments]"))return void app.comments.onKeyPress(i,e);if("Enter"==e){let e=i.tagName.toLowerCase(),t=i.value;i.hasAttribute("contenteditable")?(t=i.innerText,e="input",i.innerText=""):i.value="",["input"].includes(e)&&(t=t.trim(),i.inputValue=t,"comment"===i.getAttribute("name"))&&(s=(a=(r=i.parentElement).lastElementChild).getAttribute("cmd"))&&((r=r.closest("[data-id]"))&&r.removeAttribute("selected"),this.#onCommand(s,r,a,t))}t.onKeyPress(i,e)}}onChange(e,t){var i;"SELECT"==e.tagName&&(mh(),i=this.currentEditor)&&i.onChange(e,t)}onElementClick(){}handleCommand(){}scrollTo(e){this.#scrollable&&this.#scrollable.scrollTo(e)}scrollBottom(){this.#scrollable&&this.#scrollable.scrollBottom()}switchTo(e){let t=this.currentEditor;if(t){if(this.current==e)return t;const i=this.loadingElement;t.hide(),dom.showElement(i),t=this.getPage(e),setTimeout(()=>{dom.hideElement(i),super.switchTo(e)},800)}else t=super.switchTo(e);return t&&this.#setCurrent(t),t}addToStack(){var e=this.current;!e||this.currentPage.excludeFromStack||0!=this.#stack.length&&this.#stack[this.#stack.length-1]==e||this.#stack.push(e)}handleEvent(e){switch(e.stopPropagation(),e.preventDefault(),e.type){case"dragenter":return 0==this.#dragCounter++&&this.showHover&&this.#container.classList.add("hover"),e.target.classList.contains("dropzone")&&e.target.classList.add("hover"),!1;case"dragleave":return 0==--this.#dragCounter&&this.#container.classList.remove("hover","error"),e.target.classList.contains("dropzone")&&e.target.classList.remove("hover"),!1;case"drop":this.onDrop(e)}}addPage(e,t,i=!0){e=super.addPage(e,t);i&&this.#container.appendChild(e.container)}open(t,e,...i){"string"!=typeof t&&(t=t.id),this.addToStack(t),this.#dragCounter=0;let a=this.switchTo(t);if(!a){var s=ch.#editors[t];if(!s)throw console.error("Invalid editor:",t),new Error("Invalid editor "+t);let e;s.create&&(e=s.create()),a=new s(e),this.addPage(t,a),this.switchTo(t)}a.open(e,...i)}back(){var e=this.#stack.pop();this.switchTo(e)}cancel(e){var t;this.#stack,0!=this.#stack.length&&(t=this.#stack[this.#stack.length-1],this.switchTo(t))}notify(e,t="success"){var i=this.currentEditor;if(i){i=i.editorElement;const a=dom.createElement("div","popup","top-right","w3-container","w3-padding","w3-round");a.setAttribute("value",t),a.innerHTML=e,i.appendChild(a),setTimeout(()=>dom.removeElement(a),3e3)}}showNotification(e,t="warning",i=2e3){var a=this.#container.querySelector('[role="popup-area"]');if(a){const s=dom.renderTemplate("popup-item",{msg:e});return a.appendChild(s),"progress"!=t&&setTimeout(()=>dom.removeElement(s),i),s}}async onDrop(e){var t,e=e.dataTransfer,i=(e.files,[]);let a;for await(const s of[...e.items].filter(e=>"file"===e.kind).map(e=>e.getAsFileSystemHandle()))"directory"===s.kind?(s.name,await hh(s,i),a=s.name):(s.name,t=await s.getFile(),i.push(t));this.#dragCounter=0,this.#container.classList.remove("hover"),this.handleImport(i,a)}async onImport(e){var t,i=[];let a;for(const s of e)"directory"===s.kind?(s.name,await hh(s,i),a=s.name):(s.name,t=await s.getFile(),i.push(t));this.handleImport(i,a)}async handleImport(t,i){if(0<t.length){t[0].type;var e=[],s=[],a=[];for(const o of t){var r=fileX.getExtension(o.name);(fileX.isImage(r)?e:fileX.isMedia(r)?s:a).push(o)}if(0<s.length){const l=this.showNotification(`### Importing ${s.length} files`,"progress");let a;await app.importAudioFiles(s,(e,t,i)=>{switch(t){case"begin":a=dom.renderTemplate("popup-file-item",i),l.appendChild(a);break;case"end":a.setAttribute("state","done");break;case"meta":break;case"done":dom.removeElement(l)}})}var n=dh(t,this.dragOptions);0<n.length&&await this.currentPage.onFileDrop(n,null,i),app.emit("filesdropped",t)}else{n=dt.getData("type"),i=this.currentPage.dragOptions;if(!i.items||i.items.includes(n)){let e=dt.getData("data");if(e)e=JSON.parse(dt.getData("data"));else{t=dt.getData("id");if(!t)return void console.error("No data assigned");i=app.ds(n);if(!i)return void console.error("DataSource not exists:",n);e=await i.get(t)}this.currentPage.onDrop(e,n)}}}#onClick(e,t){if(this.#autocomplete){if(e==this.#autocomplete)return;var i,a,s,r=this.#autocomplete;if(this.#autocomplete=null,e.classList.contains("autocomplete-item"))return s=(i=e.querySelector("input")).value,i=i.dataset.id,(n=(a=e.parentElement).previousElementSibling).value=s,n.dataset.id=i,dom.removeElement(a),void((s=this.currentEditor)&&s.onInput(r));var n=r.nextElementSibling;n&&dom.removeElement(n)}if(!e.hasAttribute("contenteditable")&&!UX.List.handleClick(e))switch(e.tagName){case"A":this.#handleClickLink(e);break;case"BUTTON":this.#handleClickButton(e);break;case"I":if(e.hasAttribute("tooltip")){var o,l=e.closest("button"),c=e.getAttribute("value"),c=(l.value=c,l.closest("[container]")||l.parentElement);"like"==l.name&&(l.disabled=!0,o=e.parentElement,dom.removeElement(o)),this.onAction(l.name,c,l);break}default:this.onClick(e,t)}}#handleClickButton(e){let t=e.getAttribute("state");if(t){var i=t;switch(t){case"on":t="off";break;case"off":t="on"}e.setAttribute("state",t);var a,s=e.title;s&&-1!=(a=s.lastIndexOf(t))&&(e.title=s.slice(0,a)+i)}switch(e.name){case"like":var r=e.querySelector(".reaction");r&&dom.removeElement(r),e.disabled=!0;break;case"search":r=e.closest(".search-area");if(r&&uh(r))return;break;case"clear":var r=e.closest(".search-area");if(r)return ph(r),void((r=this.currentEditor)&&r.onFilter("",e))}s=e.closest("[data-id]")||e.parentElement;switch(e.name){case"accept":var n=e.nextElementSibling;e.disabled=!0,n.disabled=!0;break;case"reject":n=e.previousElementSibling;e.disabled=!0,n.disabled=!0}this.onAction(e.name,s,e)}#handleClickLink(t){if(t.classList.contains("yt"))app.player.playYoutube(t);else{var i=t.getAttribute("name");if(["next","prev"].includes(i)){var a=t.closest(".slideshow-container");if(a){var s=a.querySelectorAll("img");for(let e=0;e<s.length;++e){const t=s[e];if(!dom.isHidden(t)){"prev"==i?--e<0&&(e=s.length-1):++e,e%=s.length,a.querySelector(".number").innerText=e+1+" / "+s.length,dom.hideElement(t),dom.showElement(s[e]);break}}return}}else if(["more","less"].includes(i)){var e=t.closest(".search-area");if(e){var e=e.querySelector(".results").firstElementChild.querySelectorAll(".item.hidden"),e=Array.from(e).slice(0,10);for(const r of e)dom.showElement(r);return void(e.length<10&&dom.hideElement(t))}}this.currentEditor&&((e=t.getAttribute("link"))&&e.startsWith("#")?(e=((e=e.slice(1)).startsWith("/")?e.slice(1):e).replaceAll("/","-"),app.executeCommand("open-page-wiki",e)):this.onClick(t,pos))}}#onCommand(e,i,a,...s){if(this.handleCommand(e,i,a))return!0;var t,[r,...e]=e.split("-");switch(s.unshift(...e),a&&"play"===a.name&&(e=a.getAttribute("state"),a.setAttribute("state",t="play"==e?"pause":"play"),a.title=t.capitalizeFirstLetter(),s.push(e)),r){case"copy":var n=s.shift();if("code"===n){const c=a.previousElementSibling;c&&(o=c.innerText,navigator.clipboard.writeText(o),this.notify("Copied to cliboard"))}else console.error("Copy not implemented:",n);break;case"find":return app.find(...s),!0;case"share":{var o=s.shift();let e;switch(o){case"channel":if(i||"channel"!=this.#current.type)break;{const l=this.#current.id;return app.share("channel",l),!0}case"post":case"article":if("channel"===this.#current.type)e=this.#current.current;else{const c=i.closest("[data-channel]");c&&(e=c.dataset.channel)}}const l=i.dataset.id;let t;e&&(t={channel:e}),app.share(o,l,t)}return!0;case"follow":if(i||"channel"!=this.#current.type)break;{let e=this.#current.follow;const l=this.#current.id;n=this.#current.type;return e=e?(l,!1):(l,!0),a.value=e,a.title=e?"Unfollow":"Follow",app.executeCommand("follow","channel",n,l),!0}case"torrent":o=i.dataset.id,n=new Zd(i);app.downloadTorrent(o,n);break;case"load":{const c=i;o=c.dataset.link;const l=c.dataset.id;c.removeAttribute("cmd");n=c.querySelector(".md");n&&lh({id:l,link:o},n,!0)}break;default:"pin"===r&&dom.removeElement(a)}let l,c=i;if(i){let e=i;(l=e.dataset.id)||(e=a.closest("[data-id]"))&&(l=e.dataset.id);let t;return e&&(t=Object.assign({target:a,item:i,parent:e},e.dataset)),app.executeCommand(r,...s,l,t),a&&this.#current.onAction(a.name||r,i,a),!0}return app.executeCommand(r,...s),!1}#setCurrent(e){(this.#current=e).dragOptions?this.#registerListeners():this.#unregisterListeners(),this.#scrollable&&(this.#scrollable.unregisterEvents(),this.#scrollable=null),this.#sidebar&&(this.#sidebar.unregisterEvents(),this.#sidebar=null);var t=e.editorElement.querySelector(".scrollable"),e=(t&&(this.#scrollable=new UX.Scrollable(t),this.#scrollable.registerEvents(),this.#scrollable.onScrollY=(...e)=>this.#current.onScrollY(...e),this.#scrollable.onHeightChange=(...e)=>this.#current.onResize(...e)),e.sidebarElement);e&&(t=e.querySelector(".scrollable"),this.#sidebar=new UX.Scrollable(t),this.#sidebar.registerEvents())}#registerListeners(){this.#container.addEventListener("dragenter",this,!0),this.#container.addEventListener("dragleave",this,!0),this.#container.addEventListener("dragover",this,!0),this.#container.addEventListener("drop",this,!0)}#unregisterListeners(){this.#container.removeEventListener("dragenter",this),this.#container.removeEventListener("dragleave",this)}#addCommonEditors(){this.addPage("add",new AddEditor),this.addPage("find",new FindEditor)}#createMutationObserver(){this.#mo=new MutationObserver(e=>{let t=0,i=0;for(const a of e)t+=a.addedNodes,i+=a.removedNodes;t,i})}#addObserver(e){var t=e.editorElement;t&&(e.id,this.#mo.observe(t,{childList:!0}))}}function dh(e,t){return t?Array.from(e).filter(e=>t.files.includes(e.type?fileX.getType(e.type):fileX.getTypeFromFilename(e.name))):[]}async function hh(e,t){var i,a,s,r=e.name;for await(const n of e.values())"file"==n.kind&&([s,a]=fileX.getFilename(n.name),i={album:r},fileX.isMedia(a)&&(a=s.match(/^([0-9]{1,2})([ -.]+)?(.*)/))&&(i.title=a[3],i.track=parseInt(a[1])),(s=await n.getFile()).meta=i,t.push(s));t.map(e=>e.meta)}async function uh(e){var t=e.getAttribute("ds"),i=e.getAttribute("template"),a=e.querySelector(".input-area"),s=a.firstElementChild.value;a.lastElementChild.disabled=!0,(o=e.querySelector(".results"))&&dom.removeElement(o);const r=!1;if(app){a=app.ds(t);if(a){e.classList.toggle("loading3");try{var n=await delayResolve(a.search(s),1200),o=dom.renderTemplate("search-area-results",n,"div",i);e.appendChild(o),r=!0}catch(o){}e.classList.toggle("loading3")}}return r}function ph(e){var t=e.querySelector(".input-area");t.firstElementChild.value="";t.lastElementChild.disabled=!0;t=e.querySelector(".results");t&&dom.removeElement(t)}function mh(){for(var e=document.getElementsByClassName("autocomplete-items"),t=0;t<e.length;t++)dom.removeElement(e[t])}async function gh(e,t){e._items||(e._items=await t.ls()),vh(e,e._items)}async function fh(e,t,i){i=await t.loadAutocomplete(i);i?vh(e,i):t.onInput(e)}function vh(e,s){var r,n,o,l=e.value;if(l&&0!=s.length){(r=dom.createElement("div","autocomplete-items")).setAttribute("id",e.name+"autocomplete-list"),e.parentNode.appendChild(r);let t,i,a;for(o=0;o<s.length;o++)if(a=null,"string"==typeof s[o]?(t=s[o].capitalizeFirstLetter(),i=s[o]):(t=s[o].display||s[o].name.capitalizeFirstLetter(),i=s[o].id||s[o].name,a=s[o].photo||s[o].avatar),t.substr(0,l.length).toUpperCase()==l.toUpperCase()){let e="";a&&(e+=`<img src="${a}" class="photo x24 w3-margin-right">`),e=(e=(e+=`<strong>${t.substr(0,l.length)}</strong>`)+t.substr(l.length))+`<input type='hidden' value='${t}' data-id='${i}'>`,(n=dom.createElement("div","noevents","autocomplete-item","row","ci","w3-padding-small")).innerHTML=e,r.appendChild(n)}}}class wh{#current;#selected;#container;get selected(){return this.#container.querySelector("button.selected")}get active(){return this.#current}constructor(e="navbar"){let t=document.getElementById(e);(t=t||dom.createElement("div")).onclick=e=>{var t,e=e.target;"BUTTON"==e.tagName&&(t=e.name)&&this.switchTo(t,e)},this.#container=t,app.on("channelmsg",e=>this.#onMessage("channel",e.detail)),app.on("chatmsg",e=>this.#onMessage("contact",e.detail)),app.on("roommsg",e=>this.#onMessage("contact",e.detail)),app.on("gamemsg",e=>this.#onMessage("game",e.detail)),app.on("hangup",e=>{e.detail.missed&&this.#onMessage("contact",data.detail)})}e;item(e){return this.#container.querySelector(`button[name="${e}"]`)}addAction({id:e,icon:t}){var i=this.#container.querySelector(".actions"),a=dom.createElement("button","icon","item");a.title=e.capitalizeFirstLetter(),a.dataset.action=e.toLowerCase(),a.innerHTML=`<i class="fa ${t}"></i>`,i.appendChild(a)}show(){dom.showElement(this.#container)}hide(){dom.hideElement(this.#container)}switchTo(e,t){var i;this.#current==e?["home","task"].includes(e)||(this.#selected&&this.#selected.classList.toggle("selected"),this.toggle()):(this.clearSelection(),this.select(e,t),t&&(i=t.querySelector(".badge"))&&t.removeChild(i),this.onChange(e))}clearSelection(){var e;this.#current&&((e=this.selected)&&e.classList.remove("selected"),this.#current=null)}select(e,t){t=t||this.item(e),this.#current=e,(this.#selected=t)&&t.classList.add("selected")}onOpenEditor(e){this.#current!=e&&("home"==this.#current&&this.clearSelection(),["task","help"].includes(e))&&(this.clearSelection(),this.select(e))}addNotification(e,t){e=this.item(e);let i=e.querySelector(".badge"),a=0;if(i){var s=i.innerText;if("9+"==s)return;a=Number(s)}else(i=document.createElement("div")).classList.add("badge"),e.appendChild(i);9<++a?i.innerText="9+":i.innerText=""+a}onChange(){}toggle(){}#onMessage(e,t){this.selected&&e==this.selected.name||t.own||this.addNotification(e,t)}}class yh extends UX.Page{#type;get type(){return this.#type}get area(){return this.container}get showFilter(){return!0}get filter(){}set filter(e){}constructor(e,t){super(t),this.#type=e}onDragStart(){}getIconId(){}static registerOptions(e,t){AddEditor.register(e,t.items)}}Object.assign(yh.prototype,UX.ListMixin,{clearSelection(){var e=document.querySelector("#sidebar .list2");UX.List.clearSelection(e)},add(e,t=!1){return"string"==typeof e?e={id:e}:e.id||(e.id=e.name),this.addTemplate(this.template_,e,t)},getDataType(){return this.opt.dataType},onAdd(){}});class bh extends UX.List{static Page=yh;static#views={};static register(e,t=e.id){bh.#views[t]=e}#container;#pages=new Map;#current=null;#icon;#title;#filter;#add;#import;#search;#navbar;#collapsed=!0;#filterTimeout;set width(e){this.parentElement.style.width=e}constructor(e="sidebar"){e="string"==typeof e?document.getElementById(e):e,super(e.querySelector(".scrollable")),this.#container=e,this.width=app.ui.sidebar.width,this.registerEvents(),this.registerClickHandlers(),e=e.querySelector(".head");this.#icon=e.querySelector("i.fa.icon"),this.#title=e.querySelector(".title"),this.#filter=e.querySelector('input[name="filter"]'),this.#add=e.querySelector('button[name="add"]'),this.#import=e.querySelector('button[name="import"]'),this.#search=e.querySelector('button[name="search"]'),this.#add.onclick=()=>this.#onAdd(),this.#search.onclick=()=>this.#onSearch(),this.#import.onclick=()=>this.onAction("import",null,this.#import),this.#navbar=new wh,this.#navbar.onChange=e=>{switch(e){case"home":case"task":app.openEditor(e);break;default:this.open(e)}},this.#navbar.toggle=()=>this.toggle(),this.#filter.oninput=e=>this.#onFilter(e.target,e.data),this.area.ondragstart=e=>{var t=e.dataTransfer,e=e.target,i=e.dataset.id,e=e.parentElement.getAttribute("group");t.setData("type",e),t.setData("id",i)},app.on("timeupdate",e=>this.#onTimeUpdate(e.detail))}toggle(){this.#collapsed=this.#container.classList.toggle("collapsed")}show(){dom.showElement(this.#container)}hide(){dom.hideElement(this.#container)}async open(t){if(this.#collapsed&&this.toggle(),!this.#current||this.#current.type!=t){this.#navbar.active!=t&&this.#navbar.switchTo(t);let e=this.#pages.get(t);e||await(e=this.#createPage(t)).load(),this.#current&&this.#current.hide();var i=(this.#current=e).filter,i=(i?(this.#filter.value=i,this.#doFilter(i)):this.#filter.value="",e.title||t);this.#loadHead(e),this.#setTitle(i),e.show()}}onClick(i,a,s){if(s&&"A"===s.tagName){s=s.getAttribute("link");if(s){const[e,t,i]=s.slice(1).split("/");return void("add"===t&&app.add(e,i))}}if(this.selectItem(i),a.classList.remove("missed"),this.#current){let e,t;s=a.closest("[group]");if(s&&(e=s.getAttribute("group"),t=s.getAttribute("cmd")),t=t||a.getAttribute("cmd")){const i=a.dataset.id;app.executeCommand(...t.split("-"),i)}this.#current.onClick(i,a,e)}}onAction(e,t,i){var a,s=i.getAttribute("cmd");s?([s,...a]=s.split("-"),"find"===s?app.find(a[0]):app.executeCommand(s,...a,t)):this.#current&&this.#current.onAction(e,t,i)}onOpenEditor(e,t,i){switch(this.#current,this.#navbar.onOpenEditor(e),e){case"contact":case"channel":this.selectItem(i);break;case"home":case"task":this.#collapsed||this.toggle(),this.clearSelection()}}switchTo(e){return this.open(e)}load(e){}has(e){return this.#pages.has(e)}#createPage(e){var t,i=bh.#views[e];if(i)return(t=dom.createElement("div","sb-"+e,"fit","fade","hidden")).dataset.type=e,i=new i(t),this.append(t),this.#pages.set(e,i),i;throw console.error("Sidebar: unknown page",e),new Error("Invalid sidebar page:",e)}#setTitle(e){var t=this.#current.icon;t?this.#icon.setAttribute("icon-id",t):this.#icon.removeAttribute("icon-id"),this.#title.innerText=e.toUpperCase()}#loadHead(e){var t=!!e.showFilter,i=!!e.showAdd,a=!!e.showSearch,t=(t?dom.showElement(this.#filter):dom.hideElement(this.#filter),i?dom.showElement(this.#add):dom.hideElement(this.#add),a?dom.showElement(this.#search):dom.hideElement(this.#search),e.showImport);this.#import.title="Import",this.#import.removeAttribute("cmd"),t?("string"==typeof t?this.#import.title=t:"object"==typeof t&&(this.#import.title=t.title,t.cmd)&&this.#import.setAttribute("cmd",t.cmd),dom.showElement(this.#import)):(this.#import.title="Import",this.#import.removeAttribute("cmd"),dom.hideElement(this.#import))}#onAdd(){this.#current&&app.executeCommand("add","new",this.#current.type)}#onSearch(){this.#current&&app.find(this.#current.type)}#onTimeUpdate(e){this.#current&&this.#current.updateTimes(e)}#onFilter(e,t){this.#filterTimeout||(this.#filterTimeout=setTimeout(()=>{var e;this.#current&&(e=this.#filter.value.trim(),this.#doFilter(e),this.#filterTimeout=null)},2e3))}#doFilter(e){var t=this.#current.querySelectorAll("[group]");e&&(this.#current.filter=e);for(const i of t)UX.List.createMixin(i).filter(e)}static defaultSettings(){return{width:"260px"}}}Object.assign(bh.prototype,UX.PageMixin);const kh={interval:30,log:!1},_h=86400;class xh{#queue=[];#interval;#opt;#suspended=!1;get interval(){return this.#opt.interval}set interval(e){this.#opt.interval=e}constructor(e=kh){this.#opt=Object.assign({},kh,e)}setTimeout(e,t,i=!1,a=e,s=""){t=this.createTask(t,s);return i&&(t.interval=e),this.push(a,t),this.#suspended||this.#start(),t}suspend(){this.#suspended=!0,this.#stop()}resume(){this.#suspended=!1,0<this.#queue.length&&this.#start()}reset(){this.#stop(),this.#queue=[],this.#suspended=!1,this.#start()}execute(){return this.#execute()}setInterval(e){var t=this.interval;if(e!=t){var i=[],a=Th(this.#queue);if(e<t){var s,r,n=Math.floor(t/e);for([s,r]of a)i[s*n]=r}else{var o,l,c=Math.floor(e/t);for([o,l]of a)i[Math.floor(o/c)]=l}this.interval=e,this.#queue=i,this.#restart()}}createTask(...e){return xh.createTask(...e)}checkStop(){0==this.#queue.length&&this.#stop()}push(e,t){let i=Math.round(e/this.#opt.interval);0<i&&--i;e=this.#queue[i];e?e.add(t):this.#queue[i]=new Set([t]),t.queue=this.#queue[i]}shift(){return this.#queue.shift()}#start(){var e;this.#interval||(e=this.interval,this.#interval=setInterval(()=>this.execute(),1e3*e))}#stop(){this.#interval&&(clearInterval(this.#interval),this.#interval=void 0)}#restart(){this.#suspended||(this.interval,this.#stop(),this.#start())}#execute(){var e=this.#queue.shift();if(e)for(const t of e)t.interval&&this.push(t.interval,t),t.execute(!1);this.checkStop()}static createTask(e,t){return{name:t,callback:e,cancel(){this.queue.delete(this)},execute(e=!0){return Date.formatTimeDate(),this.name,e?(this.forced=!0,this.callback(this)):this.forced?void delete this.forced:this.callback(this)},skipNext(){this.forced=!0}}}}class Ch extends xh{#intervals;#tasks;constructor(e=[1800,600,60]){e.sort((e,t)=>t-e),super({interval:e[e.length-1]}),this.#intervals=e,this.#tasks=e.map(e=>0),this.#intervals}setTimeout(t,...e){var i=this.#intervals;let a,s;for(let e=0;e<i.length-1;++e){var r=i[e];if(r<=t){var n=t/r;if(.9<(n-=Math.floor(n))||n<.1){a=r,s=e;break}}}if(a||(s=i.length-1,a=i[s]),1==++this.#tasks[s]){let t=!0;for(let e=s+1;e<this.#tasks.length;++e)if(0<this.#tasks[e]){t=!1;break}(t||a<this.interval)&&this.setInterval(a)}const o=super.setTimeout(t,...e);return o._index=s,o.cancel=()=>{if(o.queue.delete(o),(o.interval=0)==--this.#tasks[s])for(let e=s-1;0<=e;--e)if(0<this.#tasks[e]){this.setInterval(this.#intervals[e]);break}},o}async execute(){var e=this.shift();if(e){var t,i=[];for(const a of e)t=a.execute(!1),isPromise(t)?(i.push(t),t.then(()=>this.checkPush(a))):this.checkPush(a);0<i.length&&await Promise.all(i)}this.checkStop()}checkPush(e){e.interval&&super.push(e.interval,e)}createDailyRunner(e=0,t=5,i=6,a=14){return new Eh(this,e,t,i,a)}createDailyRunner2(e=0){return new Sh(this,e)}}class Eh{#task;#tasks=[];#start;#end;#iteration=1;#interval=1;constructor(e,t,i,a,s){var r=Date.seconds(),[t,n]=Lh(t,r);this.#interval=i,Date.formatTimeDate(r),Math.floor(t/60),this.#start=e.setTimeout(_h,()=>{this.#task=e.setTimeout(60*i,()=>this.#execute(),!0)},!0,t),this.#end=e.setTimeout(_h,()=>this.#task.cancel(),!0,n)}setInterval(e,t){e=Math.ceil(e/this.#interval)-1;this.#tasks[e]?this.#tasks[e].push(t):this.#tasks[e]=[t]}#execute(){(new Date).formatTimeDate();var t,i=[];for(let e=0;e<this.#tasks.length;++e)this.#iteration%(e+1)||(t=this.#tasks[e])&&i.push(...t);++this.#iteration,0<i.length&&Ah(i)}}class Sh{#runner;#queue=[];#tasks=[];#running=!1;#starting;constructor(e,t){var[t,i,a]=jh(t);e.setTimeout(_h,()=>this.#startTasks(),!0,t,"Daily start task"),e.setTimeout(_h,()=>this.#stopTasks(),!0,i,"Daily stop task"),this.#runner=e,a&&this.#startTasks()}setInterval(e,t,i=!1,a=""){this.#queue.push({interval:e,cb:t}),this.#running&&this.#startTask(e,t,i,a)}#startTasks(){this.#starting=[...this.#queue],this.#running=!0,this.#starting.length,this.#runner.setTimeout(20,e=>{var t=this.#starting.shift();t?this.#startTask(t.interval,t.cb):e.cancel()},!0,0,"Starter Task")}#stopTasks(){for(const e of this.#tasks)e.cancel();this.#running=!1,this.#tasks=[]}#startTask(e,t,i=!0,a=""){i=i?0:Math.ceil(.2*e*Math.random()),e=this.#runner.setTimeout(e,t,!0,i,a);this.#tasks.push(e)}}function Th(e){return Array.from(e.entries()).filter(e=>null!=e[1]&&0<e[1].size)}function Ah(e){var t=e.shift();if(t(),0<e.length){const i=setInterval(()=>{e.shift()(),0==e.length&&clearInterval(i)},2e3)}}function Lh(e,t=Date.seconds()){var i=Math.floor(t/_h)*_h;let a=i+3600*(6-e),s=i+3600*(20-e);return t>=a?t<s?(a=0,s-=t):(a=a+_h-t,s=a+50400):(a-=t,s-=t),[a,s]}function jh(e,t=Date.seconds()){var i=Math.floor(t/_h)*_h;let a=i+3600*(6-e),s=i+3600*(20-e),r=!1;return t>=a?(a=a+_h-t,t<s?(r=!0,s-=t):s=a+50400):(a-=t,s-=t),[a,s,r]}class Mh{#name;get name(){return this.#name}constructor(e){this.#name=e}ls(){}count(){}get(){}put(){}set(){}search(){}}class O extends Mh{ls(...e){return app.db.ls(this.name,...e)}lsByIndex(...e){return app.db.lsByIndex(this.name,...e)}lsByRange(...e){return app.db.lsByRange(this.name,...e)}count(){return app.db.count(this.name)}async get(e){e=await app.db.get(this.name,e);return e&&e.content&&"string"!=typeof e.content&&(e.content=unzip(e.content)),e}async getByIndex(e,t){e=await app.db.getByIndex(this.name,e,t);return e&&e.content&&"string"!=typeof e.content&&(e.content=unzip(e.content)),e}put(e){for(const t of Array.isArray(e)?e:[e])t.content&&(t.content=zip(t.content));return app.db.put(this.name,e)}update(e,...t){t=[e,...t],"object"==typeof e&&t.unshift(e.id),e=t[1];return e&&e.content&&(e.content=zip(e.content)),app.db.update(this.name,...t)}rm(e){return app.db.rm(this.name,e)}}class Ih extends O{#index;constructor(e,t){super(e),this.#index=t}async get(e){e=await app.db.getByIndex(this.name,this.#index,e);return e&&e.content&&"string"!=typeof e.content&&(e.content=unzip(e.content)),e}}class Dh extends Mh{#path;get path(){return this.#path+"/"+this.name}constructor(e,t="/api"){super(e),this.#path=t}async ls(e=0,t=50,i=0){var a=new URLSearchParams,e=(a.set("offset",e),a.set("limit",t),i&&a.set("ts",i),await ajax.get(this.path+"?"+a.toString()));return e||[]}async get(e){e=await this.query(null,e);return e&&Array.isArray(e)?0<e.length?e[0]:null:e}query(e,t){let i=this.path;return e&&(i+="/"+e),"object"==typeof t?(e=new URLSearchParams(Object.entries(t)),i+="?"+e.toString()):i+="/"+t.toString(),ajax.get(i)}search(e,t,i=0,a=20){var s=`${this.#path}/search/${this.name}?`,e=("string"==typeof e&&(e={what:e}),new URLSearchParams(e));return t&&0<t.length&&(t.push("id"),e.set("attr",t.join(","))),e.set("offset",i),e.set("limit",a),s+=e.toString(),ajax.get(s)}}class Oh extends Dh{put(e){return ajax.post(this.path,e)}rm(e){return ajax.delete(this.path+"/"+e)}}class Ph extends Dh{async ls(e,t){var i=await app.firebase.ls(this.name);if(!i)return null;i=Object.toArray(i);for(const a of i)a.user=await app.loadContact(a.user);return i}get(e){return app.firebase.get(this.name,e)}async search(e,t,i){i=await app.firebase.search(this.name,i,e.toLowerCase());return i?Object.toArray(i):null}set(...e){return app.firebase.set(...e)}}class Rh extends Mh{static Base=Mh;static Database=O;static Rest=Dh;#local;#remote;get local(){return this.#local}get remote(){return this.#remote}constructor(e,t=e){super("string"==typeof e?e:e.name),this.#local="string"==typeof e?new O(e):e,this.#remote="string"==typeof t?new Ph(t):t}ls(...e){return this.#local.ls(...e)}count(){return this.#local.count()}async get(e){let t=await this.#local.get(e);var i;return t||(t=await this.#remote.get(e))&&("string"==typeof t?(i={id:e,content:t},t=i):(t.id=e,t.remote=!0),await this.#local.put(t)),t}async put(e,t=0){var i=await this.#remote.put(e);i&&!Array.isArray(e)&&Object.assign(e,i),await this.#local.put(e)}async search(...e){return await this.#remote.search(...e)}async pull(e){e=await this.#remote.ls(0,50,e);return 0<e.length&&await this.#local.put(e),e}update(...e){return this.#local.update(...e)}rm(e){return this.#local.rm(e)}async purge(e){return await this.#remote.rm(e),this.#local.rm(e)}}function zh(e){class t extends e{#cache;#opt;get local(){return this.#cache||super.local}constructor(...e){var t={maxCacheSize:1e3,maxCacheTime:1728e5},i=e[e.length-1];"object"==typeof i&&"Object"==i.constructor.name&&(e.pop(),Object.assign(t,i)),super(...e),this.#opt=t}async ls(...e){if(!this.#cache){this.#cache=new CacheMap(this.#opt);e=await super.ls(...e);if(e)for(const t of e)this.#cache.set(t.id,t)}return this.#cache.values()}async get(e){await this.ls();var t=this.#cache.get(e);return t||(t=await super.get(e))&&(t.id=t.id||e,this.#cache.set(e,t)),t}put(e){if(this.#cache)for(const t of e=Array.isArray(e)?e:[e])this.#cache.set(t.id,t);return super.put(e)}update(e,t,i={}){var a;return this.#cache&&((a=this.#cache.get(e))?Object.assign(a,t):this.#cache.set(e,Object.assign({id:e},i,t))),super.update(e,t,i)}}return t}const Bh=zh(Rh),Nh=zh(O);zh(Ih);class Fh extends Rh{get path(){return this.remote.path}constructor(e,t=e,...i){super(e,"string"==typeof t?new Dh(t,...i):t)}async ls(){let e=await this.local.ls();return 0==e.length&&0<(e=await this.remote.ls()).length&&await this.local.put(e),e}async rm(e){await this.remote.rm(e),await this.local.rm(e)}}(class extends null{});class qh extends Mh{#rest;#fb;get fb(){return this.#fb}constructor(e){super(e),this.#rest=new Dh(e),this.#fb=new Ph(e)}ls(...e){return this.#fb.ls(...e)}get(...e){return this.#fb.get(...e)}put(...e){return this.#rest.put(...e)}search(...e){return this.#rest.search(...e)}rm(e){return this.#rest.rm(e)}}class Uh extends Mh{#sources;constructor(...e){super(e.map(e=>e.name).join("-")),this.#sources=[...e]}async ls(){var e=[];for(const a of this.#sources){var t=await a.ls(),i=a.name;for(const s of t)e.push({...s,ds:i})}return e}}class $h{#ds;#filter;constructor(e,t=e=>!0){this.#ds=e,this.#filter=t}get name(){return this.#ds.name}get(...e){return this.#ds.get(...e)}put(...e){return this.#ds.put(...e)}update(...e){return this.#ds.update(...e)}async ls(...e){return(await this.#ds.ls(...e)).filter(this.#filter)}async search(...e){e=await this.#ds.search(...e);return e?e.filter(this.#filter):null}}const Hh=new O("update");class Wh extends Fh{#update;#id;constructor(e,t=e){super(e,t),this.#id="string"==typeof e?e:e.name}async ls(e=0,t=50){var i,a=Date.now();let s=!1,r;return(s=!this.#update||7200<a-this.#update?!0:s)&&(this.#update=a,(i=await Hh.get(this.#id))&&(i=i.ts,0<(r=await this.remote.ls(e,t,i)).length)&&await this.local.put(r),await Hh.put({id:this.#id,ts:a})),0==(r=await super.ls()).length&&0<(r=await this.remote.ls()).length&&this.local.put(r),r}}(class extends null{});g={initEvents(){this.event=new EventTarget},on(e,t){this.event.addEventListener(e,t)},emit(e,t){this.event.dispatchEvent(new CustomEvent(e,{detail:t}))}};class Vh extends UX.Page{static Database=Vr;static Player=Zr;static Editor=ch;static Sidebar=bh;static DataSource=Rh;static Commands={register(e,t){this[e]=t}};#notifications=!1;#active=!1;#home={};#ui;#db;#fs;#settings={};#runner=new Ch([1800,300,60]);#monitor=new xh({interval:5,log:!0});#idle;#sidebar;#editor;get runner(){return this.#runner}get monitor(){return this.#monitor}get sidebar(){return this.#sidebar}get editor(){return this.#editor}get expanded(){return!0}get ui(){return this.#ui}get currentEditor(){return this.editor.currentEditor}get db(){return this.#db}get fs(){return this.#fs.root}get musicDirectory(){return this.#home?this.#home.music:null}get defaultAvatar(){return"/ui/svg/contact.svg"}get defaultRoom(){return"/ui/svg/contact-green.svg"}get recent(){return this._recent}get recentPath(){return"recent"}handleCommand(e,...t){e=Vh.Commands[e];return!!e&&(e(...t),!0)}isme(e){return!!e&&("string"==typeof e?e.isEmail()?e==this.email:e==this.uid:e.id==this.uid)}memberOf(){return!1}constructor(e="main"){super(e),(window.app=this).event=new EventTarget,this._={};Xh(localStorage.getItem("theme"),window.matchMedia("(prefers-color-scheme: dark)"));window.onbeforeunload=()=>this.unload(),document.onvisibilitychange=()=>document.hidden?this.onBlur():this.onFocus(),document.onclick=e=>{var t=e.target;document._popup&&document._popup.onDocumentClick(e),t.hasAttribute("expandable")?["A","CODE"].includes(t.tagName)||t.classList.toggle("expanded"):"BUTTON"===t.tagName&&t.closest("#titlebar")&&this.onAction(t.name,t)},document.onchange=e=>{var t,e=e.target;"SELECT"===e.tagName&&e.hasAttribute("tab")&&(t=e.parentElement.querySelector(`[data-tab="${e.value}"]`),dom.insertAfter(t,e))},document.onmousedown=e=>{var t=e.target;if(t.classList.contains("v-sash")){const a=t.previousElementSibling,i=t.classList.contains("reverse"),s=e.clientX,r=a.offsetWidth,n=(document.body.style.cursor="e-resize",e=>{e=s-e.clientX,e=i?r+e:r-e;a.style.width=e+"px"}),o=e=>{document.documentElement.removeEventListener("mousemove",n,!1),document.documentElement.removeEventListener("mouseup",o,!1),document.body.style.cursor="default";var t,i=a.id;i&&(t=parseInt(a.style.width),this.updateWidth(i,t))};document.documentElement.addEventListener("mousemove",n,!1),document.documentElement.addEventListener("mouseup",o,!1)}},document.oncopy=e=>{var t=e.target;t.hasAttribute("contenteditable")&&(e.clipboardData.setData("text/plain",t.textContent.trim()),e.preventDefault())},window.addEventListener("freeze",e=>{},{capture:!0}),window.addEventListener("resume",e=>{},{capture:!0})}createDatabase(){return new Vr}createEditor(){return new ch}createSidebar(){return new bh}async setupDatabase(){}addDS(e,t){this._[t||e.name]=e}ds(e){return this._[e]}toggleLoading(){return super.toggleLoading("loading2")}async load(){try{this.#fs=await fs.init()}catch(e){console.error("Failed to initialize TMPFS",e)}var e=this.createDatabase();try{await e.init(),this.#db=e}catch(e){console.error("Failed to initialize IndexedDB",e)}await this.loadSettings(),await this.registerServiceWorker(),this.#sidebar=this.createSidebar(),this.#editor=this.createEditor(),this.#active=!0,this.#notifications=await this.requestNotifications(),this.#notifications,this.#loadSettingFields(),this.player=new Zr,this.player.registerEvents()}requestNotifications(){return!1}registerServiceWorker(){}unload(){}onFocus(){this.#active=!0,this.#monitor.resume(),this.#idle?(clearTimeout(this.#idle),this.#idle=void 0):(this.runner.resume(),this.emit("idle",!1))}onBlur(){this.#active=!1,this.#monitor.suspend(),this.#idle=setTimeout(()=>{this.#idle=void 0,this.runner.suspend(),this.emit("idle",!0)},12e4)}onHibernate(){this.db.updateHistory()}onResume(){}async setHomeDirectory(e){var t=e.getDirectoryHandle("Pictures",{create:!0}),i=e.getDirectoryHandle("Music",{create:!0});return this.#home={root:e,images:t,music:i},this.#db.put("settings",{type:"storage",root:e})}getRootDirectory(e){return fs.directory(this.fs,e,{create:!0})}async getImagesDirectory(){return this.#home.images||(this.#home.images=await this.getRootDirectory("Images")),this.#home.images}async loadSettings(){var e=localStorage.getItem("ui"),e=(e?this.#ui=JSON.parse(e):this.defaultSettings(),await this.db.ls("settings"));for(const i of e){var t=i.type;delete i.type,"storage"===t?this.#home=i:this.#settings[t]=i}}initUser(){}defaultSettings(){this.#ui={sidebar:bh.defaultSettings()},this.updateSettings()}setUserInfo(){var e=this.container.querySelectorAll('[role="username"]'),t=this.displayName;for(const i of e)i.innerText=t}updateSettings(){localStorage.setItem("ui",JSON.stringify(this.#ui))}updateWidth(e,t){var i=this.#ui[e];i?i.width=t:this.#ui[e]={width:t},this.updateSettings()}updateSetting(e,t){var i=this.#ui[e];i?Object.assign(i,t):this.#ui[e]=t,this.updateSettings()}async startIdleDetecton(){if("granted"!==await IdleDetector.requestPermission())console.error("Idle detection permission denied.");else try{const e=new IdleDetector;e.addEventListener("change",()=>{e.userState,e.screenState}),await e.start({threshold:6e4,signal:signal})}catch(e){console.error(e.name,e.message)}}startLifecycle(e=!0){var t=new Date,i=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1);setTimeout(()=>{this.emit("datechange"),setInterval(()=>this.emit("datechange"),864e5)},i-t),e&&this.#runner.setTimeout(120,()=>this.emit("timeupdate",Date.now()),!0)}openEditor(...e){this.onOpenEditor(...e),this.editor.open(...e)}cancelEditor(){this.editor.cancel()}onOpenEditor(e,...t){["find","add","video"].includes(e)||this.sidebar.onOpenEditor(e,...t)}doOpenEditor(...e){this.editor.open(...e)}doSave(){localStorage.setItem("objects",JSON.stringify([...this.objects]))}save(e=!1){e?this.doSave():this.saveTimeout||(this.saveTimeout=setTimeout(()=>{this.doSave(),delete this.saveTimeout},kSaveTimeout))}async add(e,t,i=!1){this.editor.notify(`'${e}' `+(i?"updated":"added")),i||this.emit(e+"add",t)}startPushClient(){var e=`ws://${location.host}/push/ws`;const t=new WebSocket(e);t.onopen=e=>{t.send(JSON.stringify({method:"bind",user:this.uid}))},t.onmessage=t=>{var t=t.data,t=JSON.parse(t),[,i,a]=t.to.match(/\/topics\/(channel-)?(.+)/),s=t.data;if(i)s.id=a,this.onChannelPush(s);else{let e=s.msg;if(s.user&&s.user.startsWith("chat-")){i=s.msg.match(/\[(.+)\]: (.+)/);if(!i)return void console.error("Message not matching room format:",s);var[,a,i]=i;s.room=s.user.slice(5),s.user=a,e=i}a="json"==t.type||/^\{.*\}$/.test(e);s.msg=a?JSON.parse(e):e,this.onPush(s)}},t.onclose=()=>{},t.onerror=e=>{console.error("PUSH socket error",e)}}getInfo(e,t){if("channel"===e){var i=Vh.kVirtualChannels[t];if(i)return i}return this.db.get(e,t)}showNotification(e,t,i="warning",a=2e3){if("editor"===e)return this.#editor.showNotification(t,i,a)}onAction(e,t){(t=t.getAttribute("cmd"))&&this.executeCommand(...t.split("-"))}async importAudioFiles(e,t=function(){}){var i=[];for(const n of e){var a,s=n.name.hashCode(),r=(t(s,"begin",n),await this.db.get("audio",s));r?n.meta=r.meta:(r=n.meta||await fileX.getMeta(n),a=fileX.getExtension(n.name),a=fileX.isVideo(a)?"video":"audio",a=(t(s,"meta",r),{id:s,type:a,file:n}),n.name,a.rating=0,a.meta=r,a.album=r.album?r.album.toLowerCase().hashCode():0,await app.db.put("audio",a),t(s,"end"),i.push(a))}return t(null,"done"),app.emit("audioadd",i),i}#loadSettingFields(){}static kVirtualChannels={support:{id:"support",display:"Support",desc:"Get help from Support Team",icon:"f059"}};get virtualChannels(){return Vh.kVirtualChannels}}function Xh(e,t){return null!==e?e:t.matches?"dark":"light"}Object.assign(Vh.prototype,g),window.App=Vh;const Yh={support:{topic:"Support channel room"}};rs={cache:new class{async get(e,t){t=await app.db.getByIndex("cache","uid",[t,e]);return t&&(t.content=su(t.content)),t}async load(e,t,i=3600){var a=Date.seconds(),s=await this.get(e,t);if(s&&s.expire>a)return s.content;let r;r="channel"===e?"/channel/"+t:`/api/content/${e}/`+t;var n,s=await ajax.fetch(r,{cache:"reload"});return s?(n=ru(s),await app.db.put("cache",{id:t,type:e,content:n,expire:a+i})):console.error("Failed to pull content:",e,t),s}delete(e,t){return app.db.rm("cache",t)}update(e,t,i){return"string"==typeof i&&(i=zip(i)),app.db.updateByIndex("cache","uid",[t,e],{content:i},{id:t,type:e})}},initUser(){var e=new Bh(new nu("contact"),"user"),t=new Rh(new Nh("channel"),new qh("channel")),i=new Fh("news"),a=new Zh,s=new Jh,e=new $h(e,e=>!this.isme(e.id)),r=new $h(t,e=>this.sudo?"blog"==e.type:this.isme(e.user));this._.contacts=e,this._.channel=t,this._.room=a,this.domains=new Bh("domain"),this.scrapers=new Fh("scraper"),this._.task=new Wh("task"),this._.post=s,this._.article=i,this._.latest=new CacheMap({maxCacheSize:500}),this._.recent=new O("recent"),this._.share=new Uh(e,a),this._.sharex=new Uh(e,a,r),this._.torrent=new au,this._.comment=new Qh,this._.pin=new O("pin"),this._.channelnews=new $h(t,e=>"news"==e.type),this._.channeladm=r,this._.wiki=new tu("wiki"),this._.radio=new Rh("radio",new qh("radio")),this.initUserGames(),this.initUserPlayer()},initUserGames(){this._.game=new eu(this.cache),this._.games=function(e,t){class i extends e{async ls(...e){e=await super.ls(...e);return await app.loadContacts(e),e}async lsByIndex(...e){e=await super.lsByIndex(...e);return await app.loadContacts(e),e}async lsByRange(...e){e=await super.lsByRange(...e);return await app.loadContacts(e),e}async get(e){e=await super.get(e);return e&&await app.loadContact(e),e}async getByIndex(...e){e=await super.getByIndex(...e);return e&&await app.loadContact(e),e}}return new i(...t)}(O,["games"])},initUserPlayer(){this._.playlist=new O("playlist")},ds(e,t=!1){let i;switch(e){case"scraper":i=this.scrapers;break;case"news":i=this._.article;break;default:i=this._[e]}return t?new Kh(i):i},dsFilter(e,t){e="string"==typeof e?this.ds(e):e;return new $h(e,t)},async updateProfileOld({name:e,photo:t,status:i}){let a=this.displayName,s=this.avatar;var r=this.email;try{e?a=e:e=a;var n={name:e,photo:t=t?s=await this.firebase.uploadPhoto(t):s,email:r,username:e.toLowerCase()},o=(i&&(n.status=i),"/user/"+app.uid);await this.firebase.update(o,n),await this.firebase.updateProfile({displayName:a,photoURL:s}),this.emit("profile",{photo:t,name:e})}catch(e){return console.error("Failed to update profile:",e),!1}return!0},getContacts(){return this._.contacts},async loadContact(e){if(e==this.uid)return{id:e,photo:this.avatar,name:this.displayName};var t=this.ds("contact");let i;return"object"==typeof e?(i=await t.get(e.user),Object.assign(e,{name:i.name,photo:i.photo||app.defaultAvatar,user:i})):i=await t.get(e),i.photo=i.photo||app.defaultAvatar,i},async loadContacts(e){var t,i={};for(const a of e)"string"==typeof a?i[(t=await this.loadContact(a)).id]=t:await this.loadContact(a);return i},async loadRoom(e){let t;if(!t){var i=this.ds("room");if(!(t=await i.get(e)))throw console.error("Ignorring message from unknown room",e),new Error("Message from unknown user!")}return t},async loadChannel(e){var t,i=this.ds("channel");let a;return"object"==typeof e?(t=e.channel||e.id,a=await i.get(t),e.channel?e.channel=a:Object.assign(e,a)):a=await i.get(e),a},async loadChannels(e){if(e){const i={};for(const a of e){var t=await this.loadChannel(a);i[a]=t}return i}return e=await this.ds("channel").ls(),Object.fromArray(e)},async createChannel(e){let t=e.display||e.name;t=t.trim().replace(/[ \t]+/," "),e.owner=app.uid,"private"==e.access?delete e.name:(e.name=t,e.index=""+e.type+e.region);let i;var a=await ajax.post("/api/channel",e);return i=a.id,a.key&&(e.key=a.key),e.admin=!0,i},async loadContent(e){let t,i,a;if(e.startsWith("/")){var[e,s]=e.split("?");if([i,a]=e.slice(1).split("/"),!(t=await this.db.get(i,a))){e=this.ds(i);if(!e)return void console.error("Unknown DataSource:",i);if(!(t=await e.get(a)))return void console.error("Not found",i,a)}s&&(e=new URLSearchParams(s),Object.assign(t,Object.fromEntries(e))),t.channel&&"string"==typeof t.channel&&(t.channel=await this.loadChannel(t.channel)),t.user&&"string"==typeof t.user&&(t.user=await this.loadContact(t.user))}return[t,i]},userKey(e,t=16){return Uint8Array.from(e.toByteArray().slice(0,t))},share(r,n,o){var e={title:"Share",desc:"Share files, contacts and torrents",ds:"share",results:{contact:"find-contact-item",room:"find-room-item"},mode:"ls",type:"select",force:!0,ondone:async e=>{var t,i={_type:r};if("object"==typeof n)o&&Object.assign(n,o);else if("room"==r)t=this.ds("room"),n=await t.get(n);else{let e=r+"://"+n;o&&(e+="?"+new URLSearchParams(Object.entries(o)).toString()),i.url=e}switch(r){case"torrent":case"playlist":i.info=await this.createTorrentFromPlaylist(n);break;default:i.url||Object.assign(i,function(e,t){if("post"===t)return{id:e.id,channel:e.channel};return e}(n,r))}for(const s of e){var a="string"==typeof s?s:s.id;switch(s.ds){case"room":await this.sendRoomMessage(a,i);break;case"channel":await async function(e,t,i){let a,s=t;if("string"==typeof t){const[l,d]=t.split("?"),[,e]=d.split("=");if(!(a=i.get(t)))return!console.error("Failed to create post",s)}else a=t,s=a.link;const r=await toMarkdown(a,"article"),n=Date.seconds(),o=app.uid,l="data/channel/"+e,c={content:r,user:o,ts:n,likes:{l:0,s:0,o:0,u:0},replies:{count:0},link:s};return app.firebase.push(l,c)}(a,i.info,this._.latest);break;default:await this.sendMessage(a,i)}}}};switch(r){case"article":case"item":e.ds="sharex",e.results.channel="find-channel-item"}this.openEditor("find","contact",e)},find(e){let t;switch(e){case"contact":t={index:"username",local:!0,onaction(e,t){"add"===e&&app.add("contact",t)}};break;case"channel":t={desc:"Search, add or remove public channels",add:!0,onaction(e,t){"add"===e&&app.add("channel",t,"import")}};break;case"game":t={desc:"Search for games",add:!0,onaction(e,t){"add"===e&&app.add("game",t,"import")}};break;case"scraper":t={index:"name",type:"cmd",onclick:(e,t)=>app.executeCommand("edit",null,"scraper",e)};break;case"radio":t={desc:"Listen online radio"}}t.mode="ls",t.ds||(t.ds=e),this.openEditor("find",e,t)},async subscribe(t){try{await ajax.post("/api/subscribe/"+t,{}),await app.db.update("channel",t,{follow:!0})}catch(e){console.error("Failed to subscribe for channel:",t)}},registerGameHandler(e){e?(this.event.removeEventListener("gamemsg",Gh),this.event.addEventListener("gamemsg",e)):this.event.addEventListener("gamemsg",Gh)}};async function Gh(e){}class Kh{#ds;#cache=new Map;constructor(e){this.#ds=e}async get(e){let t=this.#cache.get(e);return t||(t=await this.#ds.get(e),this.#cache.set(e,t)),t}async ls(){var e=await this.#ds.ls();return this.#cache=new Map(e.map(e=>[e.id,e])),e}}class Zh extends Nh{constructor(){super("room")}get(e){var t=Yh[e];return t?Object.assign({id:e,name:e.capitalizeFirstLetter()},t):super.get(e)}async ls(){return(await super.ls()).filter(e=>!["notify"].includes(e.id))}}class Jh extends O{constructor(){super("post")}async get(e,t){let i=await super.get(e);return i||(i=await app.firebase.value("data","channel",t,e))&&(i.id=e,await super.put(i)),i.md||(i.md=i.content),i.title||(t=fromMarkdown(i,"post"),Object.assign(i,t)),await app.loadChannel(i),i}}class Qh extends O{constructor(){super("comment")}async ls(){var e=await super.ls();return this.#loadData(e)}async lsByIndex(...e){e=await super.lsByIndex(...e);return this.#loadData(e)}async getByIndex(...e){e=await super.getByIndex(...e);return e&&this.#loadData(e)}async get(e){e=await super.get(e);return e&&this.#loadData(e)}async put(e,t=0){var i;return app.isme(e.user)&&e.channel!=e.parent&&(i={reply:e.id},await super.update(e.gid,i)),super.put(e)}async#loadData(e){async function t(e){await app.loadContact(e),await app.loadChannel(e),e.own=app.isme(e.user);var t=e.replies;if(t&&0<t.count){var i,a=[];for(const s of t.recent)i=await app.loadContact(s),a.push(i);t.recent=a}else e.reply&&(e.replies={count:1,recent:[app.userinfo]});return e.canreply=function(){return this.level<2},e}if(!Array.isArray(e))return t(e);var i=new Map(e.map(e=>[e.id,e])),a=app.ds("post",!0);for(const r of e){var s=r.gid;r.parent==r.channel?(s=await a.get(s),r.post=s):(s=r.gid,r.comment=i.get(s)),await t(r)}return e}}class eu extends Fh{#cache;constructor(e){super("game"),this.#cache=e}async search(...e){var t=await this.local.ls(),i=new Set(t.map(e=>e.id)),t=await super.search(...e),a=[];for(const s of t)i.has(s.id)||(s.remote=!0,a.push(s));return 0<a.length&&this.local.put(a),t}async put(e){return await super.put(e),this.#cache.update("game",e.id,e.content)}async get(e){let t;return(t=await super.get(e)).user=await app.loadContact(t.user),t}}class tu extends Rh{constructor(e){super(e,new qh(e))}async get(...e){e=await super.get(...e);return e&&await this.#loadData(e),e}async ls(...e){e=await super.ls(...e);for(const t of e)await this.#loadData(t);return e}async search(...e){e=await super.search(...e);for(const t of e)await this.#loadData(t);return e}async#loadData(e){e.user&&(e.user=await app.loadContact(e.user))}}class iu extends tu{#locals=new Map;#index;constructor(e,t=e=>e.name||e.title){super(e),this.#index=t}async ls(...e){e=await super.ls(...e);for(const t of e)this.#locals.set(t.id,this.#index(t));return e}async search(...e){e=await super.search(...e);if(0<e.length){await this.addRemotes(e);for(const t of e)this.#locals.has(t.id)&&(t.local=!t.remote)}return e}addRemotes(e){e=e.filter(e=>!this.#locals.has(e.id));return e.map(e=>e.remote=!0),this.local.put(e)}}class au extends iu{constructor(){super("torrent")}async ls(...e){return(await super.ls(...e)).filter(e=>e.local)}async update(e,t){await super.update(e,t),"done"==t.state&&(t=this.remote.fb,e=`data/${this.name}/${e}/`+app.uid,await t.set(e,Date.seconds()))}}function su(e){e=unzip(e);return/^[{\[](.*)[}\]]$/.test(e)?JSON.parse(e):e}function ru(e){e="string"==typeof e?e:JSON.stringify(e);return zip(e)}class nu extends O{ls(e=0,t=50){return super.lsByIndex("ts",null,e,t,!0)}}const ou={chat:[],channel:[],comment:[],post:[],player:[],game:[]};ns={async loadRecent(){var e=localStorage.getItem(this.recentPath),e=e?JSON.parse(e):ou,t=[];for(const i of t)i.channel&&(getPostInfo(i),"string"==typeof i.channel&&(i.channel=await this.loadChannel(i.channel)),i.link)&&(i.id=i.link.hashCode().toString());e.post=t;t=Date.seconds(),t=await this.db.lsByRange("recent","latest",["chat",0],["chat",t],!0);for(const a of t)await this.loadContact(a);e.chat=t;t=await async function(){app.ds("comment",!0);var e=await app.db.lsByRange("recent","latest",["comment",0],["comment",Date.seconds()],!0);var t=[];for(const s of e){a=s.channel;var i=await app.db.get("comment",s.id),a=await app.db.lsByIndex("comment","topic",[a,s.gid]);i.childs=a,await lu(s),await lu(i);for(const r of a)await lu(r);t.push(i)}return t}(),e.comment=t,t=e.game;for(const s of t)await this.loadContact(s);return this._recent=e},async addRecent(e,t){return;{const e=void 0}}};async function lu(e){await app.loadContact(e),e.channel=await app.loadChannel(e.channel),e.canreply=function(){return!this.own&&this.level<2}}os={async executeCommand(s,r,n,...e){var o=s.split("-"),o=(1<o.length&&(s=o.shift(),r&&(n&&e.unshift(n),n=r),r=o.shift(),0<o.length&&(n&&e.unshift(n),n=o.shift()),e.unshift(...o)),[s,r,n].filter(e=>!!e).join("-"));if(!this.handleCommand(o,...e)){if("edit"==s||"add"==s&&"new"==r){let t,i=!1;"edit"==s&&(t=n,n=r,r="update",i=!0);o={};let a;if("profile"==n?o.info={name:app.displayName,status:app.status,photo:app.avatar}:0<e.length&&"string"==typeof(a=e[0])&&(t=a),t){let e=app.ds(n);if(e&&(a=await e.get(t),i)&&"scraper"===n)if(!a.code&&(e=app.ds("code")))try{var l=(await e.get(t)).content;a.code="string"==typeof l?l:unzip(l)}catch(e){console.error("Scraper code not exists:",t)}}return a&&(o.info=a),Object.assign(o,{async onAdd(e){if(t&&(e.id=t),"add"==s&&"task"===n&&(e.ts=Date.seconds()),e.user=app.uid||"admin",await app.add(n,e,r),e.id){if("task"===n)return app.openEditor("support","task",e.id,!0);app.cancelEditor()}}}),i?(o.reload=!0,this.openEditor("add","edit",n,o)):this.openEditor(s,r,n,o)}let t=e.pop();switch(s){case"share":return this.share(n,t,...e);case"find":return this.find(n);case"add":return this.add(n,t);case"join":return t=n,n=r,t,this.add(n,t,"import");case"help":if("editor"===n){var i=this.editor.currentEditor;if(i){const n=i.type;return this.openEditor("wiki","wiki",n)}}return;case"task":return this.openEditor("support","task",n);case"player":switch(r){case"file":return this.player.playFile(n);case"radio":return this.player.playRadio(t,n)}case"import":var i=this.ds(r),a=this.ds(n);"torrent"==r&&t.startsWith("magnet:")&&(c=parseMagnetURI(t)["hash"],t=c);var c=function(e,t){if("torrent"===e)if("playlist"===t)return e=>Object({id:e.id,genre:e.genre||"pop",display:e.title,name:e.title.toLowerCase(),tracks:e.files,torrent:e.uri});return e=>e}(r,n)(await i.get(t));return await a.put(c),void app.emit(n+"add",c);case"rm":return t=t||n,n=r,await this.ds(n).rm(t),void app.emit(n+"rm",t);case"purge":return t=n,n=r,await this.ds(n).purge(t),void app.emit(n+"rm",t);case"pin":i=await app.ds(n).get(t);if(i){const{id:e,channel:h,content:u,ts:p,user:m}=i;this.add("pin",{id:e,channel:h,content:u,ts:p,user:m,type:n})}return;case"select":if("channel"===r)switch(n){case"scraper":{var d=`data/scraper/${t}/scrapers`;const g=await app.firebase.ls(d)||{};t,g,app.openEditor("find","scraper",{icon:"fa-scissors",title:"Edit scrapers",desc:"Add or remove channel scrapers",ds:"scraper",type:"select",force:!0,isselected:e=>!!g[e.id],ondone:async e=>{e={channel:t,scrapers:e.map(e=>e.id)};try{await ajax.post("/channel/scrapers",e)}catch(e){console.error("Failed to update scrapers")}}})}break;case"admin":d={title:this.name,desc:"Add or remove channel admin users",ds:"contact",type:"select",force:!0,isselected:e=>!!this.admins&&this.admins[e.id],ondone:async e=>{this.admins;try{var t={};for(const i of e)t[i]=!0;await app.db.update("channel",this.channel,{admins:t}),await app.firebase.update(this.adminPath,t),this.admins=t}catch(e){console.error("Failed to updates channel admins",e)}}};app.openEditor("find","channel-admin",d);break;default:console.error("CMD: Invalid select channel:",n)}else console.error("CMD: Invalid select:",r);return;case"follow":"channel"===r&&(t,app.subscribe(t));break;case"open":return this.openEditor(n,r,...e,t)}}}};const cu=SIP.Web.SimpleUser,du=Config.messagetone||Config.sip.messagetone||"/ui/ogg/popsound.mp3";function hu(e,...t){e("SIP",(new Date).toLocaleTimeString()+":",...t)}function uu(...e){hu(console.log,...e)}function pu(...e){hu(console.error,...e)}function mu(...e){hu(console.debug,...e)}class gu{#timeout;#opt;#started;#state="idle";#sharing;#canvas;#video;#unregister;#publisher;get uri(){return this.ua.options.aor}get domain(){return this.#opt.domain}constructor(e=!0){this.channels=new Set,this.audio=new Audio,this.#unregister=e}get connected(){return this.ua.isConnected()}get registering(){return this.ua.registerRequested}get localView(){return document.getElementById("local-video")}get remoteView(){return document.getElementById("remote-video")}get remoteAudio(){return document.getElementById("remote-audio")}get canCall(){return this.#state="idle"}getURI(e){return`sip:${e}@`+this.domain}async addAccount(e,t){var i=Config.sip.url||Config.sip.proxy||`ws://${location.host}/messenger/sip`,i=i.startsWith("/")?`${"http:"==location.protocol?"ws":"wss"}://`+location.host+i:i,a=(this.#opt=Object.assign({},{domain:"ftalk.net",registrationExpires:600,inactiveTimeout:60,userAgent:"ftalk-beta"},Config.sip),this.localView),s=this.remoteView,r=(this.remoteAudio,Config.ice.servers.map(e=>({urls:e}))),i=new cu(i,{delegate:this,aor:"sip:"+e,media:{constraints:{audio:!0,video:!1},local:{video:a},remote:{video:s,audio:s}},userAgentOptions:{displayName:t,logLevel:"error",userAgentString:this.#opt.userAgent,sessionDescriptionHandlerFactoryOptions:{iceGatheringTimeout:5e3,peerConnectionConfiguration:{iceServers:r,iceTransportPolicy:"all",rtcpMuxPolicy:"require"}}}});this.ua=i,await this.#register()}async offline(){uu("Go offline"),await this.unregister(),await this.ua.disconnect()}register(){return this.#checkRegistered()}unregister(){return this.ua.unregister()}async publish(e,t="presence"){this.#publisher||(this.#publisher=this.ua.publisher(this.uri,t));let i='<?xml version="1.0" encoding="UTF-8"?>';return"presence"===t&&(i+=ku({tuple:{_attr:[["id","status"]],status:{basic:"open",im:"online"},...e}},t)),mu("Sending PUBLISH:",i),await this.#checkRegistered(),this.#publisher.publish(i)}subscribe(e,t="presence"){e=`sip:${e}@`+this.#opt.domain;return this.ua.subscribe(e,t)}onServerConnect(){uu("Connected to server")}onServerDisconnect(){pu("Disconnected!!!")}onRegistered(){uu("Registered"),this.#resetInactiveTimeout(),this.#started||(this.#started=!0,app.onStarted())}onUnregistered(){uu("Unregistered"),this.#timeout=null,app.onUnregister()}onNotify({request:e}){mu("notification received:",e);new DOMParser;var t=e.body,e=e.from.uri.user,t=_u(t);t.tuple&&app.onNotify(e,t.tuple)}onCallCreated(){this.#cancelInactiveTimeout()}onCallReceived(e){this.#state="ringing",this.#cancelInactiveTimeout();var t=this.audio;t.src=Config.ringtone,t.loop=!0,t.play(),app.onIncomingCall(e)}onCallAnswered(){this.#state="incall",this.audio.pause(),app.onAnswer()}onCallHangup(e){dom.hideElement(this.localView);var t="ringing"==this.#state;this.#state="idle",this.#sharing&&(this.#sharing.stop(),this.#sharing=null),this.#resetInactiveTimeout(),this.audio.pause(),app.onHangup(e,t)}onMessageReceived(e,t,i){if(this.#resetInactiveTimeout(),(a=i.Timestamp)?e.ts=parseInt(a[0].raw):(a=i.Expires)?e.ts=parseInt(a[0].raw)-864e5:(a=i.Date)&&(i=new Date(a[0].raw),e.ts=i.getTime()),/chat-/.test(e.user)){if(/^\*\*\* (.+)$/.test(t))return;var a=t.match(/\[(.+)\]:\s+(.+)/s);if(!a)return void console.error("Message not matching room format:",t);var[,i,a]=a,[,s]=e.user.match(/chat-([^@]+)/);e.user=i,e.room=s,t=a.trim()}/^\{.*\}$/.test(t)?(t=JSON.parse(t),!e.ts&&t.ts&&(e.ts=t.ts)):/^\[.*\]$/.test(t),"string"==typeof t&&(t=t.replaceAll("\\n","\n").trim()),e.tid=((e.user.hashCode()^e.ts)>>>0).toString(16),app.onMessage(e,t)}playNotification(){var e;"idle"==this.#state&&((e=this.audio).src=du,e.loop=!1,e.play())}async send(e,t,i=!0){await this.#checkRegistered(),this.#resetInactiveTimeout();var e="sip:"+e,a=["Timestamp: "+Date.now()];if(i&&(a.push("X-push: 1"),"object"==typeof i))for(var[s,r]of Object.entries(i))a.push(`X-${s}: `+r);return this.ua.message(e,t,a)}sendMessage(e,t,i=!0){e=e+"@"+this.domain;return"string"==typeof t&&(t=t.replace(/\n/g,"\\n")),this.send(e,t,i)}sendRoomMessage(e,t,i){var a=Config.sip.room,a=e.startsWith(a)?e:a+e;let s;return s="string"==typeof t?t.startsWith("#")?" "+t:t:JSON.stringify(t),this.sendMessage(a,s,i)}sendRoomCommand(e,t,...i){var a=Config.sip.room,t="#"+t+" "+i.join(" "),i=e.startsWith(a)?e:a+e;this.sendMessage(i,t,!1)}createChannel(e,t=!1){var[e,t]=fu(e);return this.channels.add(e),this.send(e,t)}lsChannel(e){var[e,t]=vu(e);return this.send(e,t)}room(e,t){e=`chat-${e}@`+this.#opt.domain;return this.send(e,"#"+t)}joinChannel(e){return this.send(`chat-${e}@`+this.#opt.domainChannel,"#join")}call(e,t={audio:!0,video:"dummy",muted:!1}){var i;"idle"!=this.#state?console.error("Already in call!"):(this.#state="calling",(i=this.audio).src=Config.ringbacktone,i.loop=!0,i.play(),i=`sip:${e}@`+this.#opt.domain,e={constraints:t},t.muted,this.ua.muted=t.muted,t=this.localView,dom.hideElement(t),this.ua.call(i,{sessionDescriptionHandlerOptions:e}))}callTest(e,t={audio:!0,video:!0,muted:!1}){var i;"idle"!=this.#state?console.error("Already in call!"):(this.#state="calling",(i=this.audio).src="/ui/ogg/ringback-tone.ogg",i.loop=!0,i.play(),(i=this.local)&&(t.video?dom.hideElement(i):dom.showElement(i)))}answer(){this.#state="incall",this.audio.pause(),this.ua.answer()}hangup(){var e=this.#state;switch(this.#state="idle",dom.hideElement(this.localView),this.audio.pause(),e){case"calling":case"incall":this.ua.hangup();break;default:this.ua.decline()}}async startVideo(){var e=await yu(),t=e.getVideoTracks()[0],i=this.#getPeerConnection();this.#canvas=bu(i,t),this.#video=t,this.localView.srcObject=e,this.localView.classList.remove("hidden")}async stopVideo(){bu(this.#getPeerConnection(),this.#canvas),this.#video.stop(),dom.hideElement(this.localView)}async startScreenSharing(){var e=(await wu()).getVideoTracks()[0];if(e){const t=this.#getPeerConnection();this.#sharing=bu(t,e),e.onended=()=>{bu(t,this.#sharing),this.#sharing=null}}}async#register(){await this.ua.connect(),this.registering||(mu("Registering ...",this.#opt.registrationExpires),await this.ua.register({expires:this.#opt.registrationExpires})),this.#resetInactiveTimeout()}#checkRegistered(){if(!this.connected)return this.#register()}#cancelInactiveTimeout(){this.#timeout&&clearTimeout(this.#timeout)}#resetInactiveTimeout(){this.#unregister&&(this.#cancelInactiveTimeout(),this.#timeout=setTimeout(()=>this.offline(),1e3*this.#opt.inactiveTimeout))}#getPeerConnection(){if(!this.ua.session)throw new Error("Session does not exist.");var e=this.ua.session.sessionDescriptionHandler.peerConnection;if(e)return e;throw new Error("Peer connection closed.")}#stopTracks(){try{for(const e of this.#getPeerConnection().getSenders())e.track.stop()}catch(e){console.error("Peerconnection release:",e)}}}function fu(e){return[`chat-${e}@`+kDomain,"#join"]}function vu(e){return[`chat-${e}@`+kDomain,"#members"]}async function wu(){try{var e={video:{cursor:"always",mediaSource:"screen"},audio:!1};return await navigator.mediaDevices.getDisplayMedia(e)}catch(e){console.error("failed to get local screen",e)}}async function yu(){try{var e={video:!0,audio:!1};return await navigator.mediaDevices.getUserMedia(e)}catch(e){console.error("failed to get local screen",e)}}function bu(e,t){if(t){var i,e=e.getSenders().find(e=>e.track.kind===t.kind);if(e)return i=e.track,e.replaceTrack(t),i;console.warn("failed to find sender")}}function ku(e,t="presence"){const n=document.implementation.createDocument(null,null,null);t=n.createElement(t);return function e(t,i){if(i._attr){for(const r of i._attr)t.setAttribute(r[0],r[1]);delete i._attr}for(var[a,s]of Object.entries(i))a=n.createElement(a),"object"==typeof s?e(a,s):(s=n.createTextNode(s),a.appendChild(s)),t.appendChild(a)}(t,e),n.appendChild(t),(new XMLSerializer).serializeToString(n)}function _u(e){return function e(t){var i={};for(const a of t.childNodes)a.nodeType===Node.ELEMENT_NODE&&(1<a.childNodes.length||1===a.childNodes.length&&a.firstChild.nodeType===Node.ELEMENT_NODE?i[a.nodeName]=e(a):i[a.nodeName]=a.textContent.trim());return i}((new DOMParser).parseFromString(e,"application/xml").documentElement)}ls={recentUpdaters:new Map,startMessenger(e=!0){e=new gu(!this.sudo&&e);e.addAccount(this.sipUri,this.displayName),this.messenger=e,this._.pushed=[],this._confirm=new Map,this._caller,this._video,document.getElementById("answer-btn").addEventListener("click",function(){Su(),app.answer()}),document.getElementById("reject-btn").addEventListener("click",function(){Su(),app.hangup()})},inCall(){return!this.messenger.canCall},isInternalRoom(e){return["support"].includes(e)},onStarted(){this.publish()},publish(){var e;Config.sip.publish&&(e={name:app.displayName,note:app.status||"No status"},app.photo&&(e.photo=encodeURIComponent(app.photo)),this.messenger.publish(e,"presence"))},async sendMessage(t,i,a=!1,s=!0){var e=this._confirm.get(t);e&&(e.cancel(),this._confirm.delete(t));const r=xu(i);try{await this.messenger.sendMessage(t,r,s);var n=Date.seconds(),o="string"==typeof i?i:{...i},l={ts:n,own:!0,msg:i};switch(l.user=await this.loadContact(t),i._type){case"seed":case"push":case"comment":return;case"game":return l.id=t+"@"+i.id,l.type=i.id,void this.emit("gamemsg",l)}[l.short,l.shortHTML]=Cu(i,!0);let e=this.recentUpdaters.get(t);if((e=e||new Eu(this.recentUpdaters,t,app.ds("contact"))).update(l.short,n),this.emit("chatmsg",l),this.addRecent("chat",l),a&&!i._type){const r={uid:t,own:!0,ts:n,msg:o,recent:1};this.db.addHistory(r)}}catch(e){throw console.error("APP: Failed to send message",e),e}},async sendRoomMessage(t,i,a=!1){const s=xu(i);var r=s.ts||Date.seconds(),n=this.ds("room"),o=(await this.messenger.sendRoomMessage(t,s,!0),{user:this.user,own:!0,room:t});if(o.room=await n.get(t),"object"==typeof i?Object.assign(o,i):o.msg=i,"seed"!==o.type){[o.short,o.shortHTML]=Cu(i,!0);let e=this.recentUpdaters.get(t);if((e=e||new Eu(this.recentUpdaters,t,n)).update(o.short,r),this.emit("chatmsg",o),this.addRecent("chat",o),a){const s={uid:t,msg:i,own:!0,ts:r,user:this.uid,recent:1};this.db.addHistory(s)}}},async sendRoomInvite(e,t){var t=t.map(e=>this.messenger.getURI(e)),i=await app.ds("room").get(e);i._type="info",await this.messenger.sendRoomCommand(e,"invite",...t),await this.messenger.sendRoomMessage(e,i,!1)},subscribeUserPresence(e){if(Config.sip.publish)return this.messenger.subscribe(e,"presence")},sendConfirm(e){this._confirm.delete(e);return this.messenger.sendMessage(e,{_type:"confirm"},!1)},async joinRoom(e,t=!0){var i,a;this.isInternalRoom(e)||((i=this.ds("room"))&&((a=await i.get(e))?a.join||await i.update(e,{join:!0}):await i.put({id:e,join:!0})),t&&this.messenger.room(e,"join"))},async leaveRoom(e){var t;if(!this.isInternalRoom(e))return await(t=this.ds("room")).get(e)&&await t.update(e,{join:!1}),this.messenger.room(e,"leave")},onUnregister(){this._.pushed=[]},async onMessage(a,s,r=!1){if("confirm"==s._type)this.emit("confirm",{...a,...s});else{var n=a.ts||Date.now();a.tid;if(a.user,""==s)console.error("Ingoring empty message!");else{if(a.domain==Config.sip.internal)return this.handleInternalMessage(a,s);var o=!!a.room,l=a.user;if(o){var c=this.ds("room");if("info"==s._type){try{delete s._type,await c.update(a.room,s,s)}catch(e){console.error("Failed to update room info",a.room)}return}a.room=await c.get(a.room),"string"==typeof a.user&&(a.user=await this.loadContact(a.user))}else if(!a.name||!a.photo){let e;try{e=await this.loadContact(a.user)}catch(e){return void console.error("Cannot load contact information",a)}a.user=Object.assign({photo:app.defaultAvatar},e)}let e=!0;let t=!(r||o),i="string"==typeof s?s:{...s};var d={...a,own:!1,ts:Date.toSeconds(n)};if("string"==typeof s)d.text=s;else{c=s.link||s.url;if(c){if(!c.startsWith("/")){var h,u,r=new URL(c),o=r.protocol.slice(0,-1);let e=r.host||r.pathname.slice(2);isNaN(e)||(e=parseInt(e)),s._type=o,s.id=e;for([h,u]of r.searchParams)s[h]=u;var n=this.ds(o);n&&(r=await n.get(e))&&Object.assign(s,r)}i=c}switch((d.msg=s).channel&&"string"==typeof s.channel&&(s.channel=await this.loadChannel(s.channel)),s.user&&"string"==typeof s.user&&(s.user=await this.loadContact(s.user)),s._type){case"game":return d.id=d.user.id+"@"+s.id,d.type=s.id,d.invite=!!s.params,this.handleGameMessage(d),void this.emit("gamemsg",d);case"room":await app.ds("room").update(s.id,{},{name:s.name,topic:s.topic,domain:s.domain||Config.sip.domain});case"contact":i=s._type+"://"+s.id;break;case"comment":t=!1,e=!1;break;case"task":case"wiki":t=!1;break;default:e=!1}d.md||(d.md=toMarkdown(s,s._type))}if(this.messenger.playNotification(),t){const p=a.user.id;this._confirm.get(p)||(o=this.runner.setTimeout(30,()=>this.sendConfirm(p)),this._confirm.set(p,o))}e&&(n={uid:l,own:!1,msg:i,ts:d.ts,recent:1},d.room&&(n.uid=d.room.id,n.user=d.user.id),this.db.addHistory(n)),[d.short,d.shortHTML]=Cu(s,!1),"comment"===s._type?await this.comments.onComment(d):this.emit("chatmsg",d)}}},handleInternalMessage(e,t){"task"===t.type&&this.task.update(t)},async onNotify(e,t){t.photo&&(t.photo=decodeURIComponent(t.photo)),t.status=t.note,delete t.note;try{await this.ds("contact").update(e,t),t.id=e,this.emit("status",t)}catch(e){console.error("Failed to update user status",e)}},call(e,t={audio:!0,video:"dummy"}){this.messenger.canCall&&(this.emit("call",{id:e}),this.messenger.call(e,t),this.openEditor("video","call",e,t))},onIncomingCall(e){this.emit("call",{id:e});e=e.uri.user;!async function(e){"granted"===Notification.permission&&(new Notification("Incoming Call",{body:"You have an incoming call..."}).onclick=function(){this.close(),window.parent.focus()});var e=await app.loadContact(e),t=document.getElementById("notification-popup"),i=t.querySelector(".name"),a=t.querySelector(".avatar");i.innerText=e.name,a.src=e.photo||app.defaultAvatar,dom.showElement(t)}(this._caller=e)},onHangup(e,t){"video"==this.editor.current&&this.editor.cancel(),Su(),this.emit("hangup",{user:e,missed:t})},onAnswer(){Su(),this.emit("answer")},answer(){this.messenger.answer(),this.openEditor("video","incall",this._caller)},hangup(){try{this.messenger.hangup()}catch(e){this.emit("hangup")}},toggleCamera(){this._video?this.messenger.stopVideo():this.messenger.startVideo(),this._video=!this._video}};function xu(e){let t=e;if("object"==typeof e)switch(e.type){case"torrent":var i={...e},a={...e.info};return a.files=e.info.files.map(e=>Object({name:e.name,type:e.type,size:e.size})),i.info=a,i;case"comment":{const{channel:s,id:r,gid:n,msg:e,ts:o,user:l,name:c,photo:d}=t;t={channel:s,id:r,gid:n,msg:e,ts:o,user:l,name:c,photo:d}}}return t}function Cu(e,t){let i;i="string"==typeof e?e.split("\n").slice(0,1).map(e=>e.replace(/^#{1,6}[ \t]+/,"").replace(/```(.+?)```/gs,"***code***")).join("\n"):`**Share a ${e._type}**`,t&&(i="*you:* "+i);e=dom.escapeTags(i).replace(/\*\*(.+?)\*\*/g,(e,t)=>`<b>${t}</b>`).replace(/\*(.+?)\*/g,(e,t)=>`<i>${t}</i>`).replaceAll("\n","<br>");return[i,dom.renderEmojis(e)]}App.Commands.register("send-chat-message",(e,t,i)=>{i&&i.room?app.sendRoomMessage(t,e,!0):app.sendMessage(t,e,!0)});class Eu{#ts;#msg;constructor(e,t,i){e.set(t,this),app.runner.setTimeout(120,()=>{e.delete(t),this.#msg&&i.update(t,{msg:this.#msg,ts:this.#ts})})}update(e,t=Date.seconds()){this.#msg=e,this.#ts=t}}function Su(){var e=document.getElementById("notification-popup");dom.hideElement(e)}cs=__webpack_require__(867);const Tu="https://www.googleapis.com/drive/v3/files",Au="https://photoslibrary.googleapis.com",Lu=Config.gapi?Config.gapi.key:Config.gapiKey;t={async startGoogleAPI(){},google:{signOut(){this.token=null},async contacts(){var e=[];try{var t=await this.refreshToken();if(!t)throw new Error("GAPI: No access token");var i={authorization:"Bearer "+t,accept:"application/json"},a=await ajax.get("https://people.googleapis.com/v1/people/me/connections?personFields=names,emailAddresses,photos",i);if(a.connections)for(const r of a.connections){var s={};if(s.name=r.names[0].displayName,r.photos&&(s.photo=r.photos[0].url),r.emailAddresses){for(const n of r.emailAddresses)if(n.value.endsWith("gmail.com")){s.email=n.value;break}s.email?e.push(s):name}else name}}catch(e){console.error("GAPI Failed to load contacts:",e)}return e},async files(){try{await gapi.client.drive.files.list({pageSize:10,fields:"files(id, name)"})}catch(e){console.error("GAPI FAILED to list files",this.token,e)}},async upload(s,r,e,n){n||("function"==typeof r?n=r:"function"==typeof e&&(n=e)),s instanceof Blob?(r=s.type,s instanceof File&&(e=s.name)):(r=fileX.getMimeType(r),s=new Blob([s],{type:r}));var t=app.drivePublicDir;const o={name:e,mimeType:r,parents:[t]},l=(o,await this.refreshToken());return r=fileX.getType(r),new Promise((t,i)=>{var e=new FormData,a=(e.append("metadata",new Blob([JSON.stringify(o)],{type:"application/json"})),e.append("file",s),new XMLHttpRequest);a.open("post","https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart"),a.setRequestHeader("Authorization","Bearer "+l),a.responseType="json",a.onload=()=>{var e=a.response;e.error?i(e.error):(n&&n(e),e=`drive://${e.id}?type=`+r,t(e))},a.send(e)})},async getDirectoryId(e){var t=await this.refreshToken(),e=`parents in 'root' and mimeType = 'application/vnd.google-apps.folder' and name ='${e}'`,e=Tu+"?q="+encodeURIComponent(e),t=await ajax.token(t).get(e),e=0<t.files.length?t.files[0].id:null;return e},async refreshToken(e=Date.now()){var t;return this.token||(this.token={token:app.user.accessToken,expire:app.user.accessTokenExpire}),(!this.token.token||this.token.expire<e)&&(t={},app.loggedIn&&(t.uid=app.uid),this.token=await ajax.post("/auth/refresh",t)),Math.ceil((this.token.expire-e)/6e4),this.token.token},viewLink(e){return"https://drive.google.com/file/d/$id}/view"},async loadImage(t,e=600){let i;var a=new URLSearchParams,a=(a.set("fields","thumbnailLink"),a.set("key",Lu),Tu+"/"+t+"?"+a.toString());try{var s=await ajax.get(a),r=(i=s.thumbnailLink).lastIndexOf("=");-1!=r&&(i=i.slice(0,r)),i+="=s"+e}catch(e){console.error("Failed to load image from Google Drive",t)}return i},async createAlbum(e,t=0){try{var i=await this.refreshToken();await ajax.token(i).post(Au+"/v1/albums",{album:{title:"sipme"}})}catch(e){console.error("Failed to create Photo library album",e)}},async listAlbums(){let e;try{var t=await this.refreshToken();e=await ajax.token(t).get(Au+"/v1/albums")}catch(e){console.error("Failed to create Photo library album",e)}return e},async uploadPhoto(e){let t;try{var i=await this.refreshToken(),a={"Content-type":"application/octet-stream","X-Goog-Upload-Content-Type":e.type,"X-Goog-Upload-Protocol":"raw"},s=ajax.token(i)["post"],r=await s("https://photoslibrary.googleapis.com/v1/uploads",e,a),n=await s("https://photoslibrary.googleapis.com/v1/mediaItems:batchCreate",{newMediaItems:[{description:"item-description",simpleMediaItem:{fileName:e.name,uploadToken:r}}]}),o=n.newMediaItemResults[0]["mediaItem"];t=o.productUrl}catch(e){console.error("Failed to upload image",e)}return t}}};m={initializeApp:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_app_js_97f2d8e8__.initializeApp},g={},__webpack_require__.d(g,m);const ju=g;m={connectAuthEmulator:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_auth_js_2c88a4ff__.connectAuthEmulator,getAuth:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_auth_js_2c88a4ff__.getAuth,onAuthStateChanged:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_auth_js_2c88a4ff__.onAuthStateChanged,signInWithCustomToken:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_auth_js_2c88a4ff__.signInWithCustomToken,signOut:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_auth_js_2c88a4ff__.signOut,updateProfile:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_auth_js_2c88a4ff__.updateProfile},g={},__webpack_require__.d(g,m);const Mu=g;m={connectDatabaseEmulator:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_database_js_4fdd5b49__.connectDatabaseEmulator},g={},__webpack_require__.d(g,m);const Iu=g;m={connectStorageEmulator:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_storage_js_e5eea211__.connectStorageEmulator,getDownloadURL:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_storage_js_e5eea211__.getDownloadURL,getStorage:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_storage_js_e5eea211__.getStorage,ref:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_storage_js_e5eea211__.ref,uploadBytes:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_storage_js_e5eea211__.uploadBytes,uploadString:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_storage_js_e5eea211__.uploadString},g={},__webpack_require__.d(g,m);const Du=g;m={getMessaging:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_messaging_js_6c0776cf__.getMessaging,getToken:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_messaging_js_6c0776cf__.getToken,onMessage:()=>__WEBPACK_EXTERNAL_MODULE_https_www_gstatic_com_firebasejs_10_7_0_firebase_messaging_js_6c0776cf__.onMessage},g={},__webpack_require__.d(g,m);const Ou=g;class Pu{#timeout;#nextOnline;#state="disconnected";#offline=[];#token;get currentUser(){return this.auth.currentUser}get connected(){return"connected"==this.#state}get offline(){return"disconnected"==this.#state}constructor(){var e,t=Config.firebase,i=Config.firebase.emulator||!1,a=location.protocol.startsWith("https");i||a?(a=(0,ju.initializeApp)(t),t=Mu.getAuth(a),a=Du.getStorage(a),e=Ou.getMessaging(),i&&(location.hostname,Mu.connectAuthEmulator(t,kEmulators.auth.url,{disableWarnings:!0}),Iu.connectDatabaseEmulator(db,kEmulators.database.host,kEmulators.database.port),Du.connectStorageEmulator(a,kEmulators.storage.host,kEmulators.storage.port)),Ou.onMessage(e,e=>this.#onMessage(e)),this.auth=t,this.storage=a,this.messaging=e):console.error("Failed to connect to firebase on not secured connection")}async connect(e){return e=Array.isArray(e)?e[0]:e,Mu.signInWithCustomToken(this.auth,e)}onAuthStateChanged(...e){Mu.onAuthStateChanged(this.auth,...e)}signOut(){Mu.signOut(this.auth)}async uploadImage(e,t,i=0){var{ref:a,uploadString:s,getDownloadURL:r}=Du,r=await r((await s(a(this.storage,e),t,"data_url")).ref);return r}async uploadFile(e,t,i="png"){var{ref:a,uploadBytes:s,getDownloadURL:r}=Du,a=(e+="/"+t.name,a(this.storage,e)),e=await r((await s(a,t,"string"==typeof i?{contentType:fileX.getMimeType(i)}:i)).ref);return e}async uploadPhoto(e,t="png"){var i="/photo/"+app.uid,i=this.uploadImage(i,e,t);return URL.revokeObjectURL(e),i}async loadContacts(){var e=app.accessToken,t=new XMLHttpRequest;t.open("get","https://people.googleapis.com/v1/people/me/connections"),t.setRequestHeader("Authorization","Bearer "+e),t.responseType="json",t.onload=()=>{t.response},t.send()}updateProfile(e){return Mu.updateProfile(this.auth.currentUser,e)}getRegistrationToken(e){var t={vapidKey:Config.firebase.vapidKey};return e&&(t.serviceWorkerRegistration=e),Ou.getToken(this.messaging,t)}#onMessage(e){app.onPushMessage(e)}}m={_pushMessages:new CacheMap({maxCacheTime:3e4}),async startFirebase(){var e=this.user.firebaseToken;try{if(e){var t=new Pu,i=(await t.connect(e),t);if("serviceWorker"in navigator){var a="did-"+app.uid;let e;var s=localStorage.getItem(a),r={scope:"/"},n="/sw.js?"+new URLSearchParams(Object.entries(Config.firebase)).toString(),n=await navigator.serviceWorker.register(n,r);n.installing?e=n.installing:n.waiting?e=n.waiting:n.active&&(e=n.active),s||!async function(e,t,i){try{var a=await e.getRegistrationToken(t);await ajax.post("/api/register",{token:a}),localStorage.setItem(i,a)}catch(e){console.error("Failed to register device token")}}(i,n,a),navigator.serviceWorker.addEventListener("message",function(e){app.onPushMessage(e.data)})}await 0,this.firebase=t}}catch(e){console.error("Firebase failed to connect:",e)}},async onPushMessage(t){if(!t.messageType){var{notification:t,data:i}=t;let e=t["body"];var{user:t,room:a,type:s}=i;"invite"===s?this.messenger.register():(s={user:t},a&&(s.room=a),i.body&&(e=JSON.parse(i.body)),this.onMessage(s,e,!0))}}};const Ru=86400,zu="contact",Bu="channel",Nu="history",Fu="post",qu="comment",Uu="games2",$u="audio",Hu="playlist",Wu="settings",Vu="chat",Xu=new TextDecoder("utf-8");class Yu extends Vr{get version(){return 6}async init(){await super.init(),await this.updateHistory()}setup(){return app.setupDatabase(this)}onUpgrade(e,t,i){switch(i){case 0:Yu.addTable(e,Wu),Yu.addTable(e,$u),Yu.addTable(e,"radio"),Yu.addTable(e,Hu),Yu.addIndex($u,"rating",t),Yu.addIndex($u,"type",t),Yu.addIndex(Hu,"type",t);case 1:w(e,Wu),w(e,zu),w(e,Bu),w(e,Fu),w(e,qu),w(e,Nu,!0),w(e,"room"),w(e,$u),w(e,Hu),w(e,"torrent"),w(e,"recent",!1,"_id"),w(e,"game"),w(e,"offline",!0),w(e,"file"),w(e,"scraper"),w(e,"domain"),w(e,"news"),w(e,"task"),w(e,Vu,!0),w(e,"games"),w(e,"cache"),w(e,"pin"),w(e,"radio"),b(zu,"email",t,!0),b(Bu,"ts",t),b(Bu,"remote",t),b(Fu,"ts",t),b(Fu,"channel",t),b(qu,["channel","gid"],t,!1,"topic"),b(qu,["user","ts"],t,!1,"latest"),b(Nu,"uid",t),b($u,"rating",t),b($u,"type",t),b("file","type",t),b(Vu,"uid",t),b(Vu,"ts",t),b("games","user",t),b("games",["id","user"],t,!0,"gid"),b("cache",["id","type"],t,!0,"uid"),b("recent",["_type","ts"],t,!1,"latest"),b("pin","type",t);case 1:b(zu,"ts",t);case 2:w(e,"update");case 3:w(e,Uu),b(Uu,"type",t),b(Uu,"user",t);case 4:b(Uu,["type","ts"],t,!1,"recent");case 5:b("room","uid",t)}}addHistory(e){return this.addOne(Vu,e)}async getHistory(e,t=Date.seconds()){var i=[e,0],e=[e,t],t=await this.lsByRange(Vu,"user",i,e,!0,10);let a=t.length;var i=10==t.length,s=[];for(const r of t.slice().reverse()){if(!r.data)break;--a,s.push(...Ju(r))}return s.reverse(),t.splice(a,t.length-a,...s),[t,i]}async getHistoryOld(e,t=-1){if(-1==t){const a=await this.lsByIndex(Vu,"uid",e,!1,1e4);if(0<a.length)return[a,!0];t=0}var[i]=await this.lsByIndex(Nu,"uid",e,!0,1,t);if(!i)return null;const a=[];var s=new TextDecoder("utf-8");let r=unzip(i.data,null);for(;0<r.length;){var n=new DataView(r.buffer),o=n.getUint16(0)+i.ts,n=!!n.getUint8(2);r=r.slice(3);let e=0;for(;e<r.length&&0!=r[e];++e);var l=r.slice(0,e);const c={ts:o,own:n};o=s.decode(l).replace(/^\[\[([A-z0-9]+)\]\] /,(e,t)=>(c.user=t,""));c.msg=o,a.push(c),r=r.slice(e+1)}return[a,!1]}async updateHistory(){var i=[Date.seconds(Ru),1];const a=await this.lsByRange(Vu,"latest",[0,1],i,!1,1e4);if(0!=a.length){var s,r=a[0].ts,n=new Map;let e=0,t;for(const d of a)d.ts>=e&&(s=Zu(a[0].ts),e=s+Ru,t=[],n.set(s,t)),t.push(d);for(const[t,h]of n.entries()){var o=new Map;for(const u of h){var l=u.uid;delete u.uid,u.ts-=t;let e=o.get(l);e||(e=[],o.set(l,e));l=Gu(u);e.push(l)}for(const[p,a]of o.entries()){var c=Ku(a),c=zip(c);await this.put(Vu,{uid:p,ts:t,data:c})}}return this.delete(Vu,"ts",r,i)}}clearHistory(e){return this.delete(Nu,"uid",e,e)}}function Gu({msg:e,info:t,type:i,ts:a,own:s,user:r}){i&&(e=s?`**Share ${i}:** `+t.name:i+"://"+t.id),r&&(e=`[[${r}]] `+e);i=new TextEncoder("utf-8").encode(e),t=3+i.length+1,i.length,r=new ArrayBuffer(t),e=new DataView(r),e.setUint16(0,a),e.setUint8(2,s),a=new Uint8Array(r);return a.set(i,3),a.set(0,t-1),r}function Ku(e){var t=e.reduce((e,t)=>e+t.byteLength,0);const i=new Uint8Array(t);return e.reduce((e,t)=>(i.set(new Uint8Array(t),e),e+t.byteLength),0),i.buffer}function Zu(e){return Math.floor(e/Ru)*Ru}function Ju(t){let i=unzip(t.data,null);for(var a=[];0<i.length;){var s=new DataView(i.buffer),r=s.getUint16(0)+t.ts,s=!!s.getUint8(2);i=i.slice(3);let e=0;for(;e<i.length&&0!=i[e];++e);var n=i.slice(0,e);const o={ts:r,own:s,uid:t.uid,text:Xu.decode(n).replace(/^\[\[([A-z0-9]+)\]\] /,(e,t)=>(o.user=t,""))};a.push(o),i=i.slice(e+1)}return a}const Qu="contact",ep="history",tp="games",ip="audio",ap="task",sp="chat";class P extends Yu{get version(){return 7}needSetup(e){return e<2}onUpgrade(e,t,i){switch(i){case 0:this.addCommonTables(e,t);case 1:P.addTable(e,Qu),P.addTable(e,ep,!0),P.addTable(e,"room"),P.addTable(e,"wiki"),P.addTable(e,"game"),P.addTable(e,ap),P.addTable(e,sp,!0),P.addTable(e,tp),P.addTable(e,"cache"),P.addTable(e,"pin"),P.addTable(e,"enum"),P.addIndex(Qu,"email",t,!0),P.addIndex(Qu,"ts",t),P.addIndex(ep,"uid",t),P.addIndex(sp,"uid",t),P.addIndex(sp,"ts",t),P.addIndex("cache",["id","type"],t,!0,"uid"),P.addIndex("pin","type",t),P.addIndex("room","uid",t),P.addIndex(tp,"type",t),P.addIndex(tp,"user",t),P.addIndex(tp,["type","ts"],t,!1,"recent");case 2:P.addIndex(ap,["owner","time"],t,!0,"own"),P.addIndex(ap,["reporter","time"],t,!0,"reported");case 3:P.addIndex(ap,"time",t,!1,"created"),P.addIndex(ap,"time",t,!1,"updated");case 4:P.addIndex(ap,["owner","changetime"],t,!0,"ownu"),P.addIndex(ap,["reporter","changetime"],t,!0,"reportedu");case 5:P.addIndex(sp,["uid","ts"],t,!1,"user");case 6:P.addIndex(sp,["ts","recent"],t,!1,"latest")}}addCommonTables(e,t){P.addTable(e,"settings"),P.addTable(e,ip),P.addTable(e,"radio"),P.addTable(e,"playlist"),P.addTable(e,"recent"),P.addTable(e,"torrent"),P.addIndex("recent",["_type","ts"],t,!1,"latest"),P.addIndex(ip,"rating",t),P.addIndex(ip,"type",t)}}const rp="/api/ticket/",np=["medium","low","high","critical"],op=["minor","major","blocker","critical","trivial"],lp=["new","assigned","closed"],cp=60*Config.task.update,dp=new Fh("task",new Oh("ticket"));class hp{#loaded=!1;#tasks=[];#milestones;#components;#latest;#updater;get components(){return this.#components}get milestones(){return this.#milestones}get severity(){return np}get priority(){return op}get status(){return lp}constructor(){app.addDS(new pp),app.addDS(new mp),app.addDS(this,"task")}async init(){var e=app.db,t=await e.get("enum","component"),e=(this.#components=t.value,t=await e.get("enum","milestone"),this.#milestones=t.value,(new Date).toJSON()),t=[app.email,e],e=[app.email,"1985-05-03T00:00:00.000Z"],i=await app.db.lsByRange("task","ownu",e,t,!0,30),e=await app.db.lsByRange("task","reportedu",e,t,!0,30);new Set([...i.map(e=>e.id.toString()),...e.map(e=>e.id.toString())]);let a;if(0<i.length&&(a=i[0].changetime),a=0<e.length&&(!a||a<e[0].changetime)?e[0].changetime:a){t=await dp.remote.query("updates",{time:a});if(t.length,0<t.length){var s,r,n,o,l,i=Object.groupBy(t,({ticket:e})=>e.toString());for([o,l]of Object.entries(i)){n=parseInt(o),r=(s=l.map(({ticket:e,...t})=>t))[s.length-1].time,await app.db.pushValue("task",n,"change",s);var c={changetime:r};for(const d of s)"comment"!=d.field&&(c[d.field]=d.newvalue);await app.db.update("task",n,c)}}}}async load(r=gp){let e,n=localStorage.getItem("task_update");try{(e=await dp.local.ls()).sort((e,t)=>String.sort(t.time,e.time)),!n&&0<e.length&&(n=e[0].time),e;for(const t of e.uniqueId())await vp(t),r.add(t)}catch(e){console.error("Failed to load tasks",e)}return this.#tasks.push(r),app.runner.setTimeout(cp,async()=>{n;try{var t,i=await dp.remote.ls(0,20,n);if(0<i.length){await dp.local.put(i),n=i[i.length-1].time,localStorage.setItem("task_update",n);for(const a of i)await vp(a),(t=r.add(a,!0)).classList.add("new"),dom.highlightElement(t);let e=`### ${i.length} new tickets`+"\n";for(const s of i)e+=`+ ${s.summary} (**${s.type}**)`+"\n";app.showNotification("editor",e,"info",1e4)}}catch(e){console.error("TASK failed to pull from remote")}},!0,300),e}wrap(e,t="editor-taskboard-edit-task"){return wp(e),new fp(e,t)}async update({id:e,data:t}){var i=app.ds("email"),e=document.querySelectorAll(`[task][data-id="${e}"]`);t.author=await i.get(t.author);for(const a of e)await _p(a,t),a.classList.add("new"),dom.moveTop(a),dom.highlightElement(a)}async updateOld({id:e,data:t}){let i;for(const s of this.#tasks){var a;(i=s.get(e))?(await _p(i,t.field,t.newvalue,t.author),s.handleUpdate&&(i=s.handleUpdate(e,t)||i)):(await kp(e,t),a=await app.ds("task").get(e),i=s.add(a)),i&&(i.classList.add("new"),dom.moveTop(i),dom.highlightElement(i))}}perm(e,t){return!(!app.sudo&&!app.isme(t.reporter))||"rm"!=e&&"comment"===e}static async setup(e){var t,i=await ajax.get("/api/ticketenum");for(const a of i)"string"==typeof a.value&&(a.value=JSON.parse(a.value));return await e.put("enum",i),t=i,0<(i=await ajax.get("/api/ticket/own")).length&&await e.put("task",i),{enums:t,tickets:i}}}class up{#time;#last;#index;#field;get name(){return"taskown"}constructor(e,t){this.#index=e,this.#field=t}async load(e){this.#time||(this.#time=new Date);let t,i=!0;var a=e.childCount(),s=dp.local,r=dp.remote,n=app.email;try{if(0<(t=await s.lsByIndex(this.#index,[n,this.#time],!0,a,5)).length&&(this.#last=t[t.length-1].time),t.length<5){var o={limit:5,user:this.#field},l=(this.#last&&(o.time=this.#last),i=!1,await r.query(null,o));0<l.length&&(await s.put(l),t.push(...l),i=5<=l.length,this.#last=l[l.length-1].time);for(const c of t)await vp(c),wp(e.add(c))}}catch(e){console.error("Failed to load own tasks:",e)}return i}}class pp extends up{get name(){return"taskown"}constructor(){super("own","owner")}}class mp extends up{get name(){return"taskreported"}constructor(){super("reported","reporter")}}const gp={add(){},get(){}};class fp{#container;#template;constructor(e,t){this.#container=e,this.#template=t}async open(e){let t,i;try{t="object"==typeof e?e:await dp.get(e);var a,s,r=app.email;t.reporter!=r&&t.owner!=r&&(a=t.time,s=await dp.remote.query(t.id,{time:a}))&&0<s.length&&(await app.db.pushValue("task",e,"change",s),t.change||(t.change=[]),t.change.push(...s)),await vp(t),this.#container.innerHTML="",i=dom.renderTemplate(this.#template,t),this.#container.appendChild(i)}catch(i){console.error("Failed to load task",i)}return t}}async function vp(e){var t=app.ds("email"),i=await t.get(e.reporter);if(i&&(e.reporter=i),e.owner&&(i=await t.get(e.owner))&&(e.owner=i),e.change)for(const a of e.change)[a.label,a.text]=bp(a.field,a.newvalue||a.value),a.author=await t.get(a.author)}function wp(e){e.onclick=e=>{var t=e.target;let i=!1;switch(t.tagName){case"BUTTON":i=function(e){let t=!0;var i=e.closest("[data-id]"),a=e.name;switch(a){case"comment":var s=function(e){var e=e.parentElement,e=e.firstElementChild,t=e.innerText.trim();return e.innerText="",t}(e);s&&!async function(e,t){e.dataset.id;t={author:app.user,value:t,field:"comment",time:new Date};try{await _p(e,t)}catch(e){console.error("Failed to add comment",e)}}(i,s);break;case"edit":{var s=e.parentElement,r=s.querySelector("textarea");const o=i.querySelector('button[name="submit"]');s.setAttribute("edit","");var n=MDE.wrap(r);n.codemirror.on("update",e=>o.disabled=!1),r.mde=n}break;case"submit":yp(i,!0);break;case"cancel":yp(i,!1);break;default:t=!1}return t}(t);break;case"A":i=function(e){var t=e.getAttribute("name"),i=e.closest("[data-id]");switch(t){case"assign":_p(i,"owner",app.email),_p(i,"status");break;case"unassign":case"close":_p(i,"status");break;default:return!1}return!0}(t)}i&&e.stopPropagation()},e.onchange=e=>{var t=e.target;let i=!1;switch(t.tagName){case"SELECT":var a=t,s=a.name,r=a.value;_p(a=a.closest("[data-id]"),{field:s,value:r,time:new Date,author:app.user});case"TEXTAREA":i=!0}i&&e.stopPropagation()}}function yp(e,t=!0){var i=e.querySelector("[edit]");i&&(i.removeAttribute("edit"),(i=i.querySelector("textarea")).mde)&&(i.mde.toTextArea(),delete i.mde,t)&&(i.value,_p(e,"description")),e.querySelector('button[name="submit"]').disabled=!0}function bp(e,t){return"comment"==e?["commented",t]:["updated "+e]}async function kp(e,t){t.author=app.email,await app.db.pushValue("task",e,"change",t);var i={};i[t.field]=t.newvalue,i.changetime=t.time||Date.now(),await app.db.update("task",e,i),app.emit("taskupdate",{id:e,data:t})}async function _p(e,t){var{field:i,value:a}=t,s=(await async function(e,{field:t,value:i,author:a,time:s}){"object"==typeof a&&(a=a.id);t={value:i,field:t,time:s};try{var r;isNaN(e)||(e=parseInt(e)),app.isme(a)&&(r=await ajax.post(rp+"update/"+e,t),t.time=r.time),t.newvalue=i,delete t.value,await kp(e,t)}catch(e){console.error("Failed to add comment",e)}return t}(e.dataset.id,t),e),r=i,n=a;switch(r){case"description":!function(e,t){var i=e.querySelector(".md"),i=(i.innerHTML=dom.markdown(t),Date.now(),e.querySelector("time"));i.dataset.time=Date.seconds(),i.innerText="now"}(s,n);break;case"owner":!async function(e,t){"string"==typeof t&&(t=await app.ds(t.isEmail()?"email":"contact").get(t));xp(e,"owner",t||"")}(s,n);break;case"comment":break;default:xp(s,r,n)}var e=e.querySelector('[role="updates"]');e&&(e=UX.List.wrapGroup(e),[t.label,t.text]=bp(i,a),e.add(t))}function xp(e,t,i){e=e.querySelector(`[role="${t}"]`);e&&(["owner"].includes(t)?(e.innerHTML="",e.appendChild(dom.renderTemplate("task-"+t,i))):"SELECT"===e.tagName?e.value=i:e.innerText=i)}(class extends null{});g=[a.string({name:"summary",title:"Title"}),a.option({name:"type",options:["issue","task","improvement","feature"]}),a.option({name:"component",options:function(){return app.task.components}}),a.option({name:"milestone",options:function(){return app.task.milestones}}),a.option({name:"severity",options:np}),a.option({name:"priority",options:op}),a.text({name:"description",md:!0})];AddEditor.register("task",g,async e=>{try{e.description=e.description||"**todo**: *add description*",e.status="new",await dp.put(e),e.time=e.changetime=Date.now(),app.openEditor("task","ticket",e),app.emit("taskadd",e)}catch(e){console.error("Failed to add new task",e)}});const Cp={board:{title:"Task Board",desc:"Monitor project progress",icon:"tasks"},ticket:{title:"Ticket",desc:"Edit ticket content",icon:"tasks"}};const Ep=["editor-header-grid",null,"editor-taskboard-actions"],Sp=["editor-scrollable","editor-taskboard-base"];class Tp extends UX.ListPage{static id="task";#current;#submit;#updates;#error=!1;#loaded=!1;#mode;#task;#tasks;set mode(e){this.#mode=e,this.container.setAttribute("mode",e)}get current(){return this.#mode}constructor(){super(dom.renderTemplate("editor-base",Cp.board,"div",Ep,Sp)),this.mode="board",this.area.classList.add("hide"),this.#tasks=new Ap(this);var e=this.querySelector('[view="edit"]');this.#task=app.task.wrap(e,"editor-taskboard-edit"),app.on("taskadd",e=>this.#onTask(e.detail))}async open(e,t,i=0){var a,s,r,n;(e=e||"board")!=this.current&&(a=new Wd(this.headerElement),{title:n,desc:s,icon:r}=Cp[e],a.title=n,a.desc=s,a.icon=r),t?(this.mode="task",this.toggleLoading(),isNaN(t)||(t=parseInt(t)),n=await delayResolve(this.#task.open(t),1200),this.toggleLoading(),this.#current=n):(this.mode="board",this.#current&&(this.#current=null),"board"!==e||this.#loaded||(this.#loaded=!0,this.#loadTasks()))}onAction(e){if("reload"===e)return this.open(this.current,null,!0)}onInput(e){var t;e.name,"mode"===e.name&&(t=this.editorElement.querySelector('[view="main"]'))&&t.setAttribute("mode",e.value)}#checkTitle(e){e.value.trim().length<5?(e.classList.add("error"),this.#error=!0,this.#submit.disabled=!0):(e.classList.remove("error"),this.#error=!1,this.#submit.disabled=!1)}#onTask(e){this.#tasks.add(e,!0)}#onTaskUpdate({id:e,data:t}){this.#current&&this.#current.id==e&&(e=this.querySelector('[view="edit"]'))&&Task.update(e,t)}#renderTask(e){var t=this.querySelector('[view="edit"]'),e=(t.innerHTML="",dom.renderTemplate("editor-taskboard-edit",e));t.appendChild(e)}#loadTasks(){return app.task.load(this.#tasks,!1)}}class Ap{#main;#issues;#tasks;#improvements;#assigned;#closed;constructor(e){this.#main=e,this.#issues=e.wrapGroup("issue"),this.#tasks=e.wrapGroup("task"),this.#improvements=e.wrapGroup("enhancement"),this.#assigned=e.wrapGroup("assigned"),this.#closed=e.wrapGroup("closed")}add(e,t){return this.#getGroup(e.status,e.type).add(e,t)}get(e){return this.#main.getElement(e)}rm(e){e=this.get(e);return dom.removeElement(e)}#getGroup(e,t){let i;switch(e){case"assigned":i=this.#assigned;break;case"closed":i=this.#closed;break;default:switch(t){case"task":i=this.#tasks;break;case"enhancement":i=this.#improvements;break;default:i=this.#issues}}return i}handleUpdate(e,t){var{field:t,newvalue:i}=t;"status"==t&&(t=this.rm(e))&&this.#getGroup(i).insertTop(t)}}const Lp=["editor-header-avatar","editor-video-toolbar"];class jp extends UX.Page{static id="video";#timeUpdater;#status;#duration;get excludeFromStack(){return!0}constructor(){var e=dom.renderTemplate("editor-base",{},"div",Lp,"editor-video-base");e.id="video-editor",e.classList.add("video-editor"),super(e),this.editorElement.classList.add("dark"),this.#status=this.headerElement.querySelector(".ns"),app.on("answer",e=>this.#setState("call")),app.on("hangup",e=>this.#setState("initial"))}async open(e,t,i=0){var a=(t="string"==typeof t?await app.loadContact(t):t).photo||app.defaultAvatar,s=new Wd(this.headerElement);switch(s.title=t.display||t.name,s.desc="Ringing ...",s.avatar=a,this.container.querySelector("#remote-video").style.background=`transparent url(${a}) no-repeat center center`,e){case"call":case"incomingcall":this.#setState("ringing")}}#setState(e){switch(this.container.setAttribute("state",e),this.#timeUpdater&&(clearInterval(this.#timeUpdater),this.#timeUpdater=null),e){case"ringing":break;case"call":this.#duration=0,this.#timeUpdater=setInterval(()=>{this.#status.innerText=Mp(++this.#duration)},1e3)}}#handleAction(e,t){switch(e){case"hangup":app.hangup();break;case"answer":app.answer()}}}function Mp(e){var t=Math.floor(e/60),e=e%60;return(t<10?"0"+t:t)+":"+(e<10?"0"+e:e)}class Ip extends ch{constructor(e=0){super(),this.#addCommonEditors(),app.on("timeupdate",e=>this.#onTimeUpdate(e.detail))}set dirty(e){this.currentPage.dirty=e}#addCommonEditors(){this.addPage("video",new jp)}#onTimeUpdate(e){this.currentEditor.updateTimes(e)}static defaultSettings(){return{menu:{panel:{width:width}}}}}const Dp=["editor-scrollable","editor-welcome-content"];class Op extends UX.ListPage{static id="welcome";#updater;#lastUpdateTime;#loaded=!1;#tasks;#chat;#room;#comments;#game;#track;#news={};#messages=[];constructor(){var e;super(dom.renderTemplate("editor-base",{},"div","editor-welcome-header",Dp)),this.#tasks=this.wrapGroup("task"),this.#chat=this.wrapGroup("chat"),this.#room=this.wrapGroup("chat","editor-room-item"),e=this.querySelector('[role="game"]'),this.#game=this.wrapGroup(e),e=this.querySelector('[role="track"]'),this.#track=this.wrapGroup(e),app.on("chatmsg",e=>{var t=!this.#messages.length;this.#messages.push(e.detail),t&&this.#onMessage(e.detail)}),app.on("trackchange",e=>this.#onTrackChange(e.detail)),app.on("trackstop",e=>this.#onTrackStop(e.detail)),app.on("taskadd",e=>this.#onTaskAdd(e.detail)),app.on("gamemove",e=>this.#onGameMove(e.detail)),app.on("gameover",e=>this.#onGameOver(e.detail))}async load(){try{this.loadGroups();for(const e of await app.game.load())this.#game.add(e)}catch(e){console.error("Failed to load Welcome page",e)}}async open(){this.#loaded||(this.#loaded=!0,await this.load())}async onClick(e,t,i,a){a}#sendMessage(e,t,i=!1){(i="string"==typeof i?"true"==i:i)?app.sendRoomMessage(e,t):app.sendMessage(e,t)}#onMessage(){for(var t;t=this.#messages.shift();){var i=(t.room||t.user).id;let e;(e=this.#chat.getItem(i))?(e.querySelector(".msg").innerHTML=t.shortHTML,(i=e.querySelector("time")).dataset.time=Date.seconds(),i.innerText="now"):(i=t.room?this.#room:this.#chat,(e=i.add(t)).classList.add("new")),this.#chat.moveTop(e,!0),dom.highlightElement(e)}}#onGameMove(e){var{id:t,own:i}=e,t=this.#game.getItem(t);t?i&&dom.removeElement(t):i||this.#game.add(e)}#onGameOver({id:e}){e=this.#game.getItem(e);dom.removeElement(e)}#onTrackChange(e){e.id;var t=this.#track,i=t.getElementByClass("playing");if(i){if(i.dataset.id==e.id)return;i.classList.remove("playing")}let a=t.getElement(e.id);a?t.moveTop(a):a=t.add(e,!0),a.classList.add("playing")}#onTrackStop(){var e=this.#track.getElementByClass("playing");e&&e.classList.remove("playing")}#onTaskAdd(e){this.#tasks.add(e,!0,"new")}}App.Editor.register(Op,"home");const Pp=["editor-header-grid","editor-admin-actions"],Rp=["editor-scrollable","editor-admin-content"],zp={user:{title:"Users",desc:"Invite, remove users and update permissions",icon:"fa-user"},room:{title:"Rooms",desc:"Create, remove rooms",icon:"fa-user-friends"}};class Bp extends UX.ListPage{static id="admin";#updater;#lastUpdateTime;#loaded=!1;#mode;#users;#rooms;get mode(){return this.container.getAttribute("mode")}set mode(e){this.container.setAttribute("mode",e)}constructor(){var e;super(dom.renderTemplate("editor-base",{},"div",Pp,Rp)),e=this.querySelector('[role="main"]'),this.#users=this.wrapGroup(e,"editor-admin-user-item"),this.#rooms=this.wrapGroup(e,"editor-admin-room-item"),app.on("memberadd",e=>this.#addMembers(e.detail)),app.on("useradd",e=>this.#addUser(e.detail)),app.on("roomadd",e=>this.#addRoom(e.detail))}async open(e){var t=this.mode;if(t!=e){var i,a,t="room"==(this.mode=e),s=t?this.#rooms:this.#users,e=(s.clear(),zp[e]),r=new Wd(this.headerElement);r.title=e.title,r.desc=e.desc,r.icon=e.icon;try{if(i=await app.ds(t?"room":"contact").ls(),t)for(const n of i)n.members?(a=await app.loadContacts(n.members),n.members=Object.toArray(a)):n.members=[];for(const o of i)s.add(o)}catch(e){console.error("Failed to load Admin page",e)}}}onAction(e){"add"===e&&this.#onAdd()}async onClick(e,t,i,a){a}async onElementClick(e){}async onEditorAction(e,t,i){e}#onAdd(){switch(this.container.getAttribute("mode")){case"user":app.executeCommand("invite-new-user");break;case"room":app.executeCommand("create-new-room")}}#addMembers({room:e,users:t}){let i=this.#rooms.getItem(e);if(i){var a=i.querySelector('[role="members"]'),s=this.wrapGroup(a,"editor-admin-room-member");for(const r of t)(i=s.getItem(r.id))||s.add(r,!0,[e])}}#addUser(e){this.#users.add(e,!0)}#addRoom(e){this.#rooms.add(e,!0)}}AddEditor.register("user",{title:"New user",desc:"Invite user to join",icon:"fa-user",items:[a.firstname,a.lastname,a.email]}),App.Editor.register(Bp),App.Commands.register("invite-new-user",()=>{app.openEditor("add","new","user",{async onAdd(e){e.name=e.firstname+" "+e.lastname,e.id=e.id||e.email.hashHex(),delete e.firstname,delete e.lastname;var t=app.ds("user");try{await t.put(e),app.emit("useradd",e)}catch(e){console.error("Failed to add user",e)}app.executeCommand("open-user-admin")}})}),App.Commands.register("create-new-room",()=>{app.openEditor("add","new","room",{async onAdd(e){e.members=[];var t=app.ds("room");try{await t.put(e),app.emit("roomadd",e)}catch(e){console.error("Failed to add room",e)}app.editor.cancel()}})}),App.Commands.register("room-rm-user",async(e,t)=>{try{await app.db.deleteValueByIndex("room","uid",parseInt(e),"members",t),await ajax.delete(`/api/member/${e}/`+t)}catch(e){console.error("Failed to add user",e)}}),App.Commands.register("room-add-user",async i=>{i=parseInt(i);var e=(await app.ds("room").local.getByIndex("uid",i))["members"],t=app.ds("user");const a=new Set(e);e={title:"Users",desc:"Invite users",ds:new DataSourceFilter(t,e=>!a.has(e.id)),result:"find-contact-item",mode:"ls",type:"select",force:!0,ondone:async e=>{try{var t=e.map(e=>e.id);await ajax.post("/api/member/"+i,t),await app.db.pushValueByIndex("room","uid",i,"members",t),app.emit("memberadd",{room:i,users:e})}catch(e){console.error("Failed to update room members",e)}}};app.openEditor("find","contact",e)});const Np={extensions:["jpg","jpeg","png","gif","svg"],maxWidth:650};function Fp(e){var e=e?new Date(1e3*e):new Date,t=e.getHours(),e=e.getMinutes();return`${9<t?t:"0"+t}:`+(9<e?e:"0"+e)}function qp(e){var e="number"==typeof e?new Date(e):e,t=e.toLocaleString("default",{month:"short"});return e.getDate()+" "+t}async function Up(e){e.length;var t=[],i=[],a=[],s=[],r=[],n=[];for(const h of e)switch(fileX.getType(h.type)){case"image":var o=await loadImage(h,Np.maxWidth);o.classList.add("image"),o.dataset.id=h.name.hashCode(),o.name=h.name,o.size=h.size,t.push(o);break;case"audio":i.push(h);break;case"video":a.push(h);break;case"text":s.push(h);break;case"zip":r.push(h);break;case"pdf":n.push(h)}var e=t.length+i.length+a.length,l=[];if(1==s.length&&0==[r,n].reduce((e,t)=>e.length+t.length,0)&&s[0].size<2048&&l.push("message"),l.push("drive"),app.sudo&&l.push("storage"),0!=l.length){var e={images:t,audio:i,video:a,total:e,text:s,zip:r,pdf:n,options:l},c=dom.createElement("div","container-col","max-width","w3-padding-bottom"),l=dom.renderTemplate("file-upload-message",e);0<t.length&&1<(e=l.querySelectorAll("img")).length&&Array.from(e).slice(1).map(e=>dom.hideElement(e)),dom.openTab(l,"torrent"),c.appendChild(l);for(const u of a){var d=await loadVideoThumb(u);c.appendChild(d)}return c}console.error("No available destinations")}class $p extends UX.Page{#info;#y=1;#offset=Date.seconds();#top;#current;#today;#last;#more=!0;#loading=!1;#tomorrow=Date.tomorrowSeconds();#sender=new Vp;#destroy;#uploads=new Map;get groupTemplate(){return"editor-contact-chat-message"}constructor(e,t){var i=dom.createElement("div","show-empty","fit","container-col","reverse");i.dataset.type=e.id,t.append(i),super(i),this.#info=e}get id(){return this.#info.id}get uri(){return this.id}get username(){return this.#info.username}get name(){return this.#info.display||this.#info.name}get email(){return this.#info.email}get photo(){return this.#info.photo||app.defaultAvatar}get info(){return this.#info}get status(){return this.#info.desc||this.#info.email}get offset(){return this.#offset}get more(){return this.#more}get isChannel(){return!1}set y(e){this.#y=e}get y(){return this.#y}get area(){return this.container}get loading(){return this.#loading}set loading(e){this.toggleLoading(),this.#loading=e}load(){return this.loadHistory()}show(){this.#destroy&&(this.#destroy.cancel(),this.#destroy=null),super.show()}hide(e){this.#destroy=app.runner.setTimeout(300,()=>e.destroyContent(this)),super.hide()}clearChat(){this.clearContent()}onDestroy(){this.id,this.removeSelf()}async loadHistory(){if(this.#more&&!this.loading){this.#offset,this.loading=!0;var[e,t]=await delayResolve(app.db.getHistory(this.id,this.#offset),1200);if(this.#more=t,0<e.length){var t=e[0].ts,i=e[e.length-1].ts;this.#offset=i,this.#top&&this.#top.matchTimestapm(i)||(this.#top=this.#addGroup(i)),!this.#today&&Date.today()<t&&(this.#today=this.#top);for(const a of e)a.user=await app.loadContact(this.isChannel?a.user:a.uid),"string"==typeof a.msg&&(a.text=a.msg),this.#top.matchTimestapm(a.ts)||(this.#top=this.#addGroup(a.ts)),this.#top.add(a)}this.loading=!1}}async loadHistoryOld(){if(this.#more&&!this.loading){this.#offset,this.loading=!0;var i=await delayResolve(app.db.getHistory(this.id,this.#offset),1200);if(i){this.#offset++;var a,[i,s]=i;0!=this.#offset||s||this.#offset++;let e,t=0;for(const d of i)if((!e||d.ts>=t)&&(e=this.#addGroup(d.ts,s),t=Date.dayStartSeconds(d.ts,1)),d.time=Fp(d.ts),d.own?d.name="you":(!d.name&&d.user&&await app.loadContact(d),d.name=d.name||this.name,this.isChannel&&(d.avatar=d.photo||app.defaultAvatar,d.user={name:d.name,photo:d.avatar})),"string"==typeof d.msg){const h=[];d.msg=d.msg.replace(/(contact|channel|room|article|news|task):\/\/(.*)/,(e,t,i)=>(isNaN(i)||(i=parseInt(i)),h.push([t,i]),`**${t.capitalizeFirstLetter()} share**`)),d.text=d.msg,delete d.id;var r,n,o=e.add(d);for([r,n]of h){var l,c=await app.ds(r).get(n);c&&(l=r+"-share",l=dom.renderTemplate(l,c),o.appendChild(l))}}else d._type&&await this.#addMessage(d,e);s&&(i=i[i.length-1],a=Date.dayStartSeconds(),i.ts>a)&&(this.#today=e)}else this.#more=!1;this.loading=!1}}onMessage(e){}onDateChange(){this.#today=null}addMessage(e){e.ts=e.ts||Date.seconds(),e.time=Fp(e.ts),e.name||(e.name=e.own?"you":this.name),this.#today?e.ts>this.#tomorrow&&(this.#today=this.#addGroup(),this.#tomorrow=Date.tomorrowSeconds()):this.#today=this.#addGroup();let t=!1;this.#last&&(i=this.#last.msg,e.own==i.own)&&(e.own||i.user.id==e.user.id)&&e.ts-i.ts<90&&(t=!0);var i=e.text||e.msg;i._type&&e.own&&(e.text=`**Share ${i._type}:** *${i.name}*`);let a;t?(i=dom.renderTemplate("editor-contact-chat-message-item",e),(a=this.#last.container).appendChild(i)):(a=this.#today.add(e,!0,null,"fade"),this.onRenderMessage(e,a),this.#last={msg:e,container:a}),!e.own&&e.text&&Gd(a,e.text)}onRenderMessage(){}async uploadFiles(e){try{var t=await Up(e),i=e[0].name,a=generatePushID(i);t.dataset.id=a,this.#uploads.set(a,e),this.appendChild(t,!0)}catch(e){console.error("Failed to upload files:",e)}}async sendFile(e){var t=await fileX.readFile(e),e=`##### ${e.name}
`;this.handleSendMessage(e+="```\n"+t+"\n```")}addImageFromFile(e){this.#current.addImageFromFile(e)}addAudioFromFile(e,t){}addContact(e){this.#current.addContact(e)}destroy(){dom.removeElement(this.container)}async sendImage(e,t){let i;if("torrent"==e){var a=[];for(const r of t){var s=await app.db.get("file",r);a.push(s.file)}e=await app.seed(a),t=e.magnetURI;i={type:"torrent",info:{link:t,files:a}}}try{await this.sendMessage(i)}catch(e){console.error("Failed to send torrent link",e)}}handleSendMessage(e){var t="string"==typeof e?{text:dom.escapeTags(e)}:{msg:e};t.own=!0,this.#sender.send(e,this),this.addMessage(t)}onAction(e,t){var i=t.dataset.id;switch(e){case"cancel":dom.removeElement(t),this.#uploads.delete(i);break;case"submit":this.#onUpload(i,t)}}sendMessage(e){"string"==typeof e&&(e=e.trim());var t=this.id;return app.sendMessage(t,e,!0)}#addGroup(e,t=!1){e?"number"==typeof e&&(e=Date.fromSeconds(e)):(e=new Date,t=!0);var i={id:e.getTime(),item:this.groupTemplate,title:qp(e),titlestyles:"bold text-center",header:"small watermark-8 w3-padding-small",content:"cc reverse m5 w3-container",hide:!0,actions:[{name:"remove",cmd:"chat-remove-history"}]},i=this.addGroup(i,t),t=Date.today(e);return i.area.dataset.id=t,i.startTimestamp=t,i.matchTimestapm=function(e){return e>=this.startTimestamp},i}async#addMessage(t,i=this.#today){t.time=Fp(t.ts);let a;if(t.own)t.msg=`<span><b>Share ${t._type}:</b>' <i>${t.info.name}</i></span>`,a=i.add(t,!1);else{let e=t.info;var s,r=[];switch(t.type&&r.push(t.type+"-share"),t.type){case"article":(e="string"==typeof e&&e.startsWith("/")?await app.loadContent(e):e).time=new Date(1e3*e.ts),e.logo||(s=new URL(e.link),e.logo=s.origin+"/favicon.ico"),e.short||(e.short=e.title);break;case"task":t.md&&(e.md=t.md)}a=i.add(t,!1,r)}this.#last={msg:t,container:a}}async#onUpload(e,t){var i=this.#uploads.get(e),e=(this.#uploads.delete(e),t.querySelector("[actions]")),e=(dom.removeElement(e),t.querySelector("[options]")),e=(dom.removeElement(e),e.querySelector('input[name="type"]:checked')),a=e.value,s=t.querySelector("[files]");for(const c of t.querySelectorAll('input[type="checkbox"]'))c.disabled=!0;var r=[];for(const d of i){const e=d.name.hashCode();var n=fileX.getExtension(d.name);const t=s.querySelector(`[data-id="${e}"]`);if(t.querySelector('input[type="checkbox"]').checked){var o=t.querySelector("progress");dom.showElement(o);let e;switch(a){case"drive:":e=app.google.upload(d);break;case"google":e=app.google.uploadPhoto(d);break;case"firebase":e=app.firebase.uploadFile("uploads",d,n)}var l=await delayResolve(e,1200);d.link=l,dom.removeElement(o),r.push(d)}}dom.removeElement(t),0<r.length&&(e=toMarkdown(r,"files"),this.handleSendMessage(e))}}Object.assign($p.prototype,UX.ListMixin);class Hp extends $p{#key;get key(){return this.#key}get status(){var e=this.info;return e.status||e.email}get type(){return"contact"}addMessage(e){if(!e.own){for(const t of this.container.querySelectorAll('[state="new"]'))t.setAttribute("state","sent");if("confirm"==e._type)return}super.addMessage(e)}onRenderMessage(e,t){e.own&&t.setAttribute("state","new")}async loadKey(){return this.key||(this.#key=await app.loadUserKey(this.id)),this.#key}}class Wp extends Hp{get topic(){return this.info.topic}get status(){return this.topic}get isChannel(){return!0}get type(){return"room"}get groupTemplate(){return"editor-contact-room-message"}addMessage(e){e.own||(e.avatar=e.photo||app.avatar),super.addMessage(e)}destroy(){super.destroy(),app.leaveRoom(this.id).then(()=>{},e=>{})}sendMessage(e){return"string"==typeof e&&(e=e.trim()),app.sendRoomMessage(this.uri,e,!0)}}class Vp{#timeout;#text="";send(e,t){"string"!=typeof e?t.sendMessage(e):(this.#timeout||(this.#timeout=setTimeout(()=>{var e=this.#text;this.#text="",this.#timeout=null,t.sendMessage(e)},3e3)),this.#text+=e+"\n")}}class Xp extends UX.ListPage{static id="contact";#active=!1;get active(){return this.#active}constructor(e){super(e),this.bottom=!0}get type(){return Xp.id}get loadingElement(){return this.area.querySelector(".loading")}get contentElement(){return this.area.querySelector(".chat-content")}get dragOptions(){return{directory:!1,hover:!0,files:["image","audio","video","text","pdf","zip"],items:["contact","room","channel","playlist"]}}show(){this.#active=!0,super.show()}hide(){this.#active=!1,super.hide()}toggleLoading(){this.loadingElement.classList.toggle("hidden")}showLoading(e=!0){var t=this.loadingElement;e?t.classList.remove("hidden"):t.classList.add("hidden")}}(class{[Xp](){}});App.Editor.register(class extends Xp{#content=null;get uri(){return this.#content.uri}get id(){return this.#content.id}get isChannel(){return this.#content.isChannel}set mode(e){this.container.setAttribute("mode",e),this.headerElement.querySelector('button[name="share"]').setAttribute("cmd","share-"+e)}constructor(e){e||((e=dom.renderTemplate("editor-base",{},"div","editor-header-contact","editor-chat")).id="contact-editor"),super(e),this.mode="contact",this.cache=new Map,this.lastMsgDay=0,app.on("chatmsg",e=>this.onMessage(e.detail)),app.on("confirm",e=>this.onMessage(e.detail)),app.on("gamemsg",e=>this.onGameMessage(e.detail)),app.on("status",e=>this.updateStatus(e.detail)),app.on("answer",e=>{var t;for(const i of this.area.querySelectorAll("iframe, video"))"video"===i.tagName.toLowerCase()?i.pause():(t=i.src,i.src=t)}),app.on("contactadd",e=>this.#onContactAdd(e.detail)),app.on("daychange",()=>{this.#content&&this.#content.onDateChange()})}get current(){return this.id}get head(){var e=this.headerElement;return{title:e.querySelector("h2"),ns:e.querySelector(".ns"),avatar:e.querySelector("img.avatar"),call:e.querySelector('button[name="call"]'),header:e}}onAction(e,t,i){this.#content&&"clear"===e&&this.#content.clearChat()}onEditorAction(e,t,i){"send"===e?this.#handleSend(null,i):this.#content.onAction(e,t,i)}onCommand(e,t){}onInput(e){var t=e.innerText.trim(),e=e.parentElement.lastElementChild;""==t?e.disabled=!0:(t.length,e.disabled=!1)}onKeyPress(e,t){"Enter"==t&&this.#handleSend(e)}async open(t,i){let a;if("object"==typeof i&&(i=(a=i).id),this.#content){if(t==this.#content.type&&i==this.#content.id)return;this.#content.y=this.posY,this.#content.hide(this)}var e=this.cache.get(i);let s,r=!1;if(e)s=e.content;else{let e=a;s=new("room"==t?(e=e||await app.loadRoom(i),Wp):(e=e||await app.loadContact(i),Hp))(e,this),this.cache.set(i,{contact:e,content:s}),r=!0}this.mode=t;var{title:e,ns:t,avatar:n,call:o,header:l}=this.head,c=s.name,d=s.status;l.dataset.id=i,e.innerText=c,t.innerHTML=dom.renderEmojis(d),n.src=s.photo,o.disabled=s.isChannel,this.#content=s,r&&(await s.load(),s.isChannel||app.subscribeUserPresence(i)),s.show(this)}async sendMessage(e){if(e=e.trim()){this.id;try{await this.#sendMessage(this.id,e),this.posY=1}catch(e){console.error("Exception",e)}}}destroyContent(e){var t=e.id;this.cache.delete(t),e.onDestroy()}async onMessage(e){var t=(e.room||e.user).id;let i,a=!1;this.#content&&t==this.id?(i=this.#content,a=!0):(t=this.cache.get(t))&&(i=t.content),i&&!e.own&&("object"==typeof e&&e.encrypted,i.addMessage(e)),this.active&&a&&app.editor.scrollBottom()}onGameMessage(e){e.params&&this.onMessage(e.user,e)}updateStatus(e){var t;this.#content&&e.id==this.id&&(t=this.headerElement,dom.updateValues(t,e))}onScrollY(e){10<e||this.#content&&this.#content.more&&this.#content.loadHistory()}onResize(e,t,i){this.#content&&this.#content.more&&t<=i&&this.#content.loadHistory()}async onFileDrop(e){if(1==e.length){var t=e[0];if(t.size<2600&&"text"==fileX.getFileType(t))return void this.#content.sendFile(t)}e.length;t=[];this.#content.uploadFiles(e),0<t.length&&console.error("Skipped files:",t.length)}async onDrop(e,t){if(this.id!=e.id)return e._type=t,this.#sendMessage(this.id,e)}async onClick(e,t,i){"BUTTON"===i.tagName?this.#handleAction(i.name,i,e,t):t.classList.contains("feed")&&((i=t.querySelector(".article"))?i.classList.toggle("hidden"):(i={id:e},dom.getValues(t,i),await lh(i,t)))}#sendMessage(e,...t){return this.#content.handleSendMessage(...t)}#onUpdate(){var e,t,i=Date.now();for([e,t]of this.cache){var a=t.content;a!=this.#content&&a.timeout<i&&(a.destroy(),this.cache.delete(e))}}#handleAction(e,t,i,a){"remove"===e&&dom.removeElement(a)}#handleSend(e,t){let i;t?e||(e=t.parentElement.firstElementChild,i=t.inputValue):(t=e.parentElement.lastElementChild,i=e.value||e.innerText),t.disabled=!0;e=i.trim();e&&this.sendMessage(e)}#onContactAdd({id:e}){this.#content.id==e&&(this.mode="contact")}}),App.Commands.register("chat-clear-history",async(e,t)=>{try{await app.db.rmByIndex("chat","uid",e),await app.db.rmByIndex("history","uid",e)}catch(e){console.error("Failed to delete history")}}),App.Commands.register("chat-add-contact",async e=>{app.add("contact",e)}),App.Commands.register("chat-invite-users",async t=>{let e=[];var i=await app.ds("room").local.get(t);(e=i&&i.members?i.members:e).push(app.uid);const a=new Set(e);i=app.ds("contact"),i={title:"Users",desc:"Invite users",ds:new $h(i,e=>!a.has(e.id)),result:"find-contact-item",mode:"ls",type:"select",force:!0,ondone:async e=>{e=e.map(e=>e.id);if(0!=e.length)try{await app.db.pushValue("room",t,"members",e),await app.sendRoomInvite(t,e),app.emit("memberadd",{room:t,users:e})}catch(e){console.error("Failed to update room members",e)}}};app.openEditor("find","contact",i)}),App.Commands.register("add-new-room",()=>{app.openEditor("add","new","room",{icon:"fa-user-friends",desc:"Create new room and invite users",async onAdd(e){var t=app.uid;e.id=generatePushID(e.name),e.ts=Date.seconds(),e.user=t,e.members=[t];try{await app.add("room",e,"new"),app.openEditor("contact","room",e)}catch(e){console.error("Failed to create room")}}})}),App.Commands.register("import-gmail-contacts",async()=>{try{var e=await app.google.contacts(),t=[];if(0<e.length){var i,a=Date.seconds(),s=app.ds("email");for(const r of e){if(i=await s.get(r.email)){if("contact"==i.type)continue;r.ts=a,r.status=i.status,r.user=i}else r.id=r.email.hashHex(),i={...r},r.ts=a,r.type="gmail",r.remote=!0,await s.put(r),Object.assign(r,{user:i,status:"not invited"});t.push(r)}0<t.length&&app.emit("useradd",t)}}catch(e){console.error("Failed to import Gmail contact:",e)}});g=[{...a.name,placeholder:"room name"},a.string({name:"topic",title:"Topic"})],AddEditor.register("room",g),g=a.string({name:"status",title:"Status"});AddEditor.register("profile",{title:"Profile",desc:"Change photo and nickname",icon:"profile",items:[a.name,g,{type:"photo",name:"photo",title:"Avatar"}],onAdd(e){app.executeCommand("update-user-profile",e),app.cancelEditor()}}),App.Commands.register("update-user-profile",async e=>{const{photo:t,...i}=e;var a,s,r=new FormData;for([a,s]of Object.entries(i))r.append(a,s);if(t)if(app.firebase)try{var n=await app.firebase.uploadPhoto(t);r.append("photo",n)}catch(e){console.error("Failed to upload photo into Firebase",e)}else{e=function(e){var e=e.split(","),t=(0<=e[0].indexOf("base64")?atob:decodeURI)(e[1]),e=e[0].split(":")[1].split(";")[0],i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return new Blob([i],{type:e})}(t);r.append("file",e,"avatar.png")}try{const i=await ajax.post("/api/profile",r);await app.updateProfile(i)}catch(e){console.error("Failed to update profile",e)}});class Yp extends nh{static getTabs(){return[{name:"active",icon:"fa-user-friends watermark-6"},{name:"recent",icon:"fa-list alt watermark-6"}]}get tabs(){return Yp.getTabs().map(e=>e.name.toLowerCase())}#active;#invites;#recent;#loaded=!1;constructor(e){super(e,"sidebar-game")}toggle(){if(super.toggle()&&!this.#loaded)return this.#load()}onClick(e,t,i){"BUTTON"==i.tagName&&i.name}update(e){}onMove(i,a,e){if(this.#loaded){let t;var s=i.id+"@"+i.user;if(i.isover)this.#active.delete(s),t=this.#addRecent(i,!0);else if(i.invite)i.own||s==a||(t=(t=this.#invites.getElement(s))||this.#invites.add(i,!0));else{this.#invites.delete(s);let e=!0;(t=this.#active.getElement(s))?(dom.moveTop(t),s==a&&(t.removeAttribute("new"),e=!1)):t=this.#active.add(i,!0),!i.own&&e&&t.setAttribute("new","")}dom.highlightElement(t)}}onOver(e){this.#loaded&&(this.#active.delete(e.id),this.#addRecent(e,!0))}async#load(){this.#loaded=!0,this.loadTabs();var e={badge:!0,content:"w3-padding-tiny"};let t=this.getPage("recent");this.#recent=t.addGroup({item:"sidebar-game-recent-item",template:null}),t=this.getPage("active"),this.#active=t.addGroup({...e,name:"active",icon:"fac-play-recent",empty:!0,item:"sidebar-game-active",cmd:"game-open-user"}),this.#invites=t.addGroup({...e,name:"invites",icon:"fa-clock w3-color-green",hide:!0,item:"sidebar-game-invite",cmd:"game-open-user"});var e=await app.db.ls("games"),i=(await app.loadContacts(e),[]);for(const a of e)a.invite?this.#invites.add(a):a.state?this.#active.add(a):i.push(a);i.sort((e,t)=>t.ts-e.ts);for(const s of i)this.#addRecent(s)}#addRecent(e,t=!1){let i=this.#recent.getElement(e.id);return i?t&&dom.moveTop(i):i=this.#recent.add(e,t),i}}class Gp extends UX.Page{#ctx;get ctx(){return this.#ctx}get canvas(){return this.#ctx.canvas}set width(e){this.canvas.width=e,this.canvas.style.width=e+"px"}set height(e){this.canvas.height=e,this.canvas.style.height=e+"px"}get width(){return this.canvas.width}get height(){return this.canvas.height}get clientRect(){return this.canvas.getBoundingClientRect()}get viewport(){return this.container.getBoundingClientRect()}constructor(e){let t=e.querySelector("canvas");t||(t=dom.createElement("canvas"),e.appendChild(t)),super(e),this.#ctx=t.getContext("2d"),t.onmousemove=e=>this.onMouse(e),t.onclick=e=>this.onClick(e)}registerHandlers(){var e=this.canvas;e.onmousemove=e=>this.onMouse(e),e.onclick=e=>this.onClick(e),new ResizeObserver(e=>this.handleResize(e[0].contentRect)).observe(this.container)}init(){}onMouse(e){this.handleMouseMove(this.#getPos(e),this.width,this.height)}onClick(e){this.handleClick(this.#getPos(e),this.width,this.height)}handleClick(){}handleMouseMove(){}handleResize(){}#getPos(e){var t=this.clientRect,i=t.width,a=t.height,e={x:e.clientX-t.left,y:e.clientY-t.top};return e.xp=parseFloat(e.x/i*50).toFixed(2),e.yp=parseFloat(e.y/a*50).toFixed(2),e}}class Kp extends Gp{#games=new Map;#current;#user;#id;get gid(){return this.#id+"-"+this.#user}get uri(){return this.#id+"@"+this.#user}get info(){return this.#current?{score:this.#current.current,stat:this.#current.stat}:null}get id(){return this.#current.id}constructor(e){var t=dom.createElement("div","preview","fade","fit","noverflow","max-height");super(t),e.appendChild(t),this.registerHandlers()}async load(e,t,i){this.#current=await app.game.load(t,e,i),this.handleResize(this.viewport)}#render(){var{game:e,state:t}=this.#current;e.render(t,this.ctx)}async reload(){await app.game.reload(this.id),this.#render()}async handleMove(){this.#render()}async resign(e){var t=this.#current;await app.db.update("games",this.uri,{last:void 0,state:void 0}),t.reset(),t.render(this)}updateSize(e){this.container.style.height=e-10+"px"}handleClick(e){this.#current&&this.#current.game.onclick(this.#current.state,e,this.ctx)&&this.#handleOver()}handleResize(i){if(this.#current){var a=this.#current.game.ratio;let e=i.width,t=Math.floor(e*a);t>i.height&&(t=i.height,e=Math.floor(t*(1/a))),this.width=e,this.height=t,this.#render()}}async update(e){}#handleOver(){var e=this.#user;this.#user=null,app.openEditor("game","over",this.#id,e)}}AddEditor.preview("game",Kp);const Zp=["editor-header-avatar-grid","game-editor-toolbar",null];class Jp extends UX.ListPageController{static id="game";#history;#sidebar;#game;#home;#user;#id;get sidebar(){return this.#sidebar}set id(e){(this.#id=e)?this.container.dataset.id=e:delete this.container.dataset.id}constructor(e){e||((e=dom.renderTemplate("editor-base-sidebar",{},"div",Zp,"editor-scrollable",Yp.getTabs())).id="game-editor"),super(e);e=this.editorElement,y.createMixin(e.querySelector(".history"),"li"),e=new Yp(this.sidebarElement);e.toggle(),this.#sidebar=e,this.#home=new Qp(this.area),this.#game=new em(this.area,e),this.addPage("home",this.#home),this.addPage("game",this.#game),app.on("gamemove",e=>this.#handleMove(e.detail)),app.on("gameover",e=>this.#handleGameOver(e.detail))}async open(e,t,i,a){var s,r=new Wd(this.headerElement);if("over"==e){const i=a;this.#sidebar.onOver(t,i),e="home"}return"home"==e?(e=await app.ds("game").get(t),r.title="Game",r.desc="Home page",r.mode="new",(s=r.icon).id=e.icon,s.color=e.iconcolor,this.id=null,this.switchTo("home"),this.#home.open(e)):(s=(i="string"==typeof i?await app.loadContact(i):i).id+"@"+t,"game"!=this.current||s!=this.#id?(this.switchTo("game"),r.avatar=i.photo||app.defaultAvatar,r.title=i.name,r.desc=t,r.mode="game",this.#user=i,this.id=s,this.#game.open(t,i.id,a)):void(a&&this.#game.open(t,i.id,a)))}switchTo(e){"game"==e?this.area.classList.add("max-height"):this.area.classList.remove("max-height"),super.switchTo(e)}onAction(e){switch(e){case"chat":app.openEditor("contact","chat",this.#user.id);break;case"call":app.openEditor("video","call",this.#user.id,{audio:!0,video:!1});break;case"reload":this.#game.reload();break;default:this.currentPage.onAction(e,this.#user)}}#handleMove(e){e.id==this.#id&&this.#game.onMove(e)}#handleGameOver(e){var{id:t,type:i}=e;this.#sidebar.onOver(e),t==this.#id&&this.open("home",i)}}class Qp extends UX.Page{constructor(e){var t=dom.createElement("div","w3-container","hidden");super(t),e.appendChild(t)}async open(e){this.removeChilds();var t=im(e),i=(e.md=t,t=dom.renderTemplate("editor-game-info",e),this.appendChild(t),app.ds("games")),a=[e.id,Number.MAX_SAFE_INTEGER],i=await i.lsByRange("recent",null,a,!0),t=dom.renderTemplate("editor-game-recent",i,"div",[e.id]);this.appendChild(t)}}class em extends UX.Page{#view;#sidebar;#stat;get uri(){return this.#view.uri}get info(){return this.#view.info}constructor(e,t){var i=dom.renderTemplate("editor-game-base"),e=(super(i),e.appendChild(i),i.querySelector('[role="stat"]'));e&&(this.#stat=new tm(e)),this.#view=new Kp(i),this.#sidebar=t}async open(...t){try{await this.#view.load(...t)}catch(e){app.openEditor("game","home",...t)}}reload(){this.#view.reload()}async onMove(e){e.own||await this.#view.handleMove(e),this.#stat&&(e=e["stat"],this.#stat.stat={score:[e.score.win,e.score.loss],total:[e.total.win,e.total.loss],game:[e.win,e.loss]})}}class tm{#container;constructor(e){this.#container=e}set score(e){this.#score("score",e)}set stat(e){for(var[t,i]of Object.entries(e))this.#score(t,i)}#score(e,t){e=this.#container.querySelector(`[role="${e}"]`).querySelectorAll("[data-count]");e[0].dataset.count=t[0],e[1].dataset.count=t[1]}}function im(e){return`
# ${(e.name||e.id).capitalizeFirstLetter()}

|  |  |
|--|--|
|**Author**|*${e.user.name}*|
|**Type**|*${e.type}*|

${e.desc||e.description}
`}App.Editor.register(Jp),App.Commands.register("game-open-user",async e=>{var[e,t]=e.split("@");app.openEditor("game","open",t,e)}),App.Commands.register("game-invite-user",async i=>{var t=app.ds("game"),a=["opponent"];try{app.toggleLoading();var s,r,n=await t.get(i),o=await app.game.params(i);let e;for([s,r]of Object.entries(o))e={name:s},Array.isArray(r)?(e.type=r.length<5?"radio":"option",e.options=r.map(e=>e.toString())):r?e.type=r:e=s,a.push(e);return o={desc:"Create new game",items:a,icon:n.icon,reload:!0,onAdd({opponent:e,...t}){app.openEditor("game","open",i,e,t)}},app.openEditor("add","new","game",o)}catch(e){}finally{app.toggleLoading()}}),App.Commands.register("game-resign-user",async e=>{app.game.resign(e)}),FindEditor.register("game",["id","description","user","info"]),App.Commands.register("video-call-user",e=>app.call(e)),App.Commands.register("video-call-hangup",e=>app.hangup()),App.Commands.register("video-toggle-camera",e=>app.toggleCamera()),App.Commands.register("video-screen-share",()=>{app.messenger.startScreenSharing()});a.string({name:"title",validate(e){return 3<e.length}}),a.string({name:"tags",validate(e){return/[a-z][a-z0-9]{2,}/.test(e)}});const am=["editor-header-grid","editor-wiki-toolbar"],sm=["editor-scrollable","wiki-editor-content"],rm=[{name:"pin",icon:"pin watermark-6"}];class nm extends UX.ListPage{#main;#sidebar;#current;#id;#mde;#path=[];static id="wiki";get sidebar(){return this.#sidebar}constructor(){var e=dom.renderTemplate("editor-base-sidebar",{},"div",am,sm,rm),e=(e.id="wiki-editor",super(e),this.mode="view",new Wd(this.headerElement)),e=(e.title="Wiki",e.desc="Search the database for examples and tips",e.icon="fa-search",this.editorElement),t=e.querySelector(".main"),t=(this.#main=UX.List.createMixin(t),this.sidebarElement),t=(this.#sidebar=new nh(t),this.#sidebar.toggle(),e.querySelector("textarea"));this.#mde=new MDE({element:t,spellChecker:!1,autoDownloadFontAwesome:!1})}async open(e,t){t&&this.#id==t||("start"==e&&(e="page",this.#path=[]),this.#current=e,this.#id=t,this.container.dataset.id=t,"search"===e?this.mode="search":(this.mode="view",await this.#loadDocument(t)))}onAction(e){"edit"===e&&this.#edit(this.#id,!1)}async onEditorAction(e,t,i){if("A"==i.tagName)(i=i.getAttribute("link"))&&this.#handleAction(i);else{var a=t.dataset.id;switch(e){case"submit":var s=this.#mde.value();this.mode="view",this.#updateDocument(a,s);break;case"cancel":this.mode="view";break;case"edit":this.#edit(a,!1)}}}onLinkClick(e){e.startsWith("/")?this.#loadDocument(e):(e=`#${this.#current}_`+e,(e=this.#main.querySelector(e))&&app.editor.scrollTo(e))}async#updateDocument(t,e){var e=e.trim(),i=(this.#main.toggleLoading(),this.#main.removeContent(),app.ds("wiki"));try{var a={id:t,content:e,tags:"wiki"};await delayResolve(i.put(a),1200),this.#renderDocument(t,e)}catch(e){console.error("Failed to update document",t)}this.#main.toggleLoading()}async#edit(e,t=!1){this.mode="edit";let i="";t||(t=await om(e))&&(i=t),this.editorElement.querySelector('[role="edit"]').dataset.id=e,this.#mde.value(i)}async#handleAction(e){var t;e.startsWith("#")?(t=`#${this.#current}_`+e.substr(1),(t=this.#main.querySelector(t))&&this.scrollTo(t)):this.#loadDocument(e)}async#loadDocument(e){e.startsWith("/")&&(e=e.slice(1).split("/").join("-")),this.#main.toggleLoading();var t=await delayResolve(om(e),1200);if(this.#main.toggleLoading(),t){var i=this.#path.indexOf(e);i<0?this.#path.push(e):this.#path.splice(i+1,this.#path.length-(i+1)),this.#id=e,this.container.dataset.id=e,this.#renderDocument(e,t)}else if(app.sudo)return this.#edit(e,!0)}#renderDocument(e,t,i=!0){!i&&e==this.#id||(this.#main.removeContent(),this.posY=0,this.#main.appendTemplate("editor-wiki-doc-content",{id:e,text:t,marked:lm(e)},"div"),this.#renderPath())}#renderPath(){var e=this.#main.querySelector(".path");this.#path,dom.removeChilds(e);for(const s of this.#path.slice(0,-1)){var t=s.split("-"),i="#/"+t.join("/"),a=dom.createElement("a","smaller");a.setAttribute("link",i),a.innerText=t.join(" "),e.appendChild(a)}}}function om(e){return app.cache.load("wiki",e)}function lm(e){return{headerIds:!0,headerPrefix:e+"_"}}App.Editor.register(nm),App.Commands.register("wiki-load-content",async(e,{item:t})=>{let i=t.querySelector('[role="content"]');if(!i)try{i=dom.renderTemplate("wiki-search-result-content"),dom.toggleLoading(i),t.appendChild(i);var a=await delayResolve(app.cache.load("wiki",e),1200);i.innerHTML=dom.markdown(a)}catch(i){console.error("Failed to load content",i)}finally{dom.toggleLoading(i)}});class cm extends nh{static getTabs(){return[{name:"recent",icon:"fa-clock"}]}#current;#queue;#recent;get tabs(){return cm.getTabs().map(e=>e.name.toLowerCase())}constructor(e){super(e,"sidebar-player"),this.loadTabs();var e=this.getPage("recent"),t={visible:100,badge:!0,hide:!0,cmd:"player-play-file",icon:"fac-queue",name:"queue",item:"editor-player-sidebar-queue-item",actions:[{name:"clear"}]};this.#queue=e.addGroup(t),t.icon="fac-play-recent",t.name="recent",t.item="editor-player-sidebar-playlist-file",t.actions=[{name:"add",cmd:"add-new-playlist"},{name:"clear"}],this.#recent=e.addGroup(t),app.on("trackqueued",e=>this.#onTrackQueued(e.detail)),app.on("trackchange",e=>this.#onTrackChange(e.detail))}handleAction(e,t,i){switch(e){case"delete":var a=t.getAttribute("group");id,"queue"===a&&(app.player.remove(parseInt(id)),this.#queue.remove(id));break;case"clear":app.player.clear(),this.#recent.clear()}}onClick(e,t,i){}async#onTrackQueued(e){e=await app.db.get("audio",e);e.title||(e.title=fileX.getTitleFromMeta(e)),this.#queue.add(e)}#onTrackChange(e){var t,i=e.id;this.#queue.delete(i),i!=this.#current&&(e.title||(e.title=fileX.getTitleFromMeta(e)),t=e.meta,!e.album&&t.album&&(e.album=t.year?t.album+" - "+t.year:t.album),this.#recent.add(e,!0)),this.#current=i}}class dm extends UX.Page{#container;get area(){return this.#container}constructor(e,t,i="editor-player-content-base"){i=dom.renderTemplate(i,{});e&&e.appendChild(i),super(i),this.#container=i.querySelector('[role="main"]')}load(){}search(){}onClick(){}onInput(){}onAction(){}onFilesDrop(){}onTabChange(){}onTrackChange(){}onTrackStop(){}}Object.assign(dm.prototype,UX.ListMixin);class hm extends dm{static id="files";#offset=0;#total=0;#track;#more=!1;get more(){return this.#more}constructor(e){super(e,hm.id),app.on("audioadd",e=>this.#onAudioImport(e.detail))}open(e){var t=this.container;e?(t.setAttribute("playlist",""),this.loadPlaylist(e.tracks)):t.removeAttribute("playlist")}async load(e=!1){e||(this.#offset=0,this.#total=await app.db.count("audio"));e=await app.db.lsByRating("audio",this.#offset);return this.loadFiles(e)}loadFiles(t){this.#offset,t.length,this.#total,this.#offset+=t.length,this.#more=50<=t.length;for(const e of t)this.#renderItem(e);if(this.sort(um),app.player.isPlaying){t=app.player.current;let e=this.getElementBy("id",t.id);(e=e||this.#renderItem(t,!0)).classList.add("playing"),this.#track=t.id}}async loadPlaylist(e){for(const t of this.getElementsBy("playlist","true"))delete t.dataset.playlist;for(const i of e){let e=this.getElement(i.id);(e=e||this.#renderItem(i)).dataset.playlist=!0}}onFilesDrop(e){e.length}onAction(e,t,i){if("delete"===e)return dom.removeElement(i),app.db.rm("audio",parseInt(t))}onInput(e){"filter"===e.name&&this.filter(e.value)}onTrackChange(e){this.state="playing",this.#updateCurrentTrack(),this.#track=e.id;var t,i,a=this.getElement(e.id);if(a)return a.classList.add("playing"),i=a.querySelector(".title"),t=Math.floor(i.innerText.length/4),i.style["animation-duration"]=t+"s","video"==a.dataset.type&&(i=app.player.videoElement,a.appendChild(i)),pm(a,e.duration),a}onTrackStop(){this.#updateCurrentTrack()}#updateCurrentTrack(){var e;this.#track&&(e=this.getElement(this.#track))&&(e.classList.remove("playing"),e=e.querySelector("video"))&&dom.removeElement(e)}#renderItem(e,t=!1){var i=e.name||e.filename||e.file.name,a=e.type?fileX.getType(e.type):mm(i),i={id:e.id||i.hashCode(),title:fileX.getTitleFromMeta(e),desc:fileX.getDescriptionFromMeta(e),rating:e.rating,type:a},e=(e.meta&&e.meta.duration&&(i.duration=e.meta.duration),this.addItemTemplate("edior-player-track-item-file",i,t));return e.dataset.name=i.title.slice(0,8).toLowerCase(),e.dataset.type=a,e}#onAudioImport(e){for(const t of e)this.#renderItem(t,!0)}}function um(e,t){return e.dataset.rating==t.dataset.rating?e.dataset.name>t.dataset.name?1:-1:parseInt(t.dataset.rating)-parseInt(e.dataset.rating)}function pm(e,t){e.querySelector(".time").innerText=fileX.getDuration(t)}function mm(e){e=fileX.getExtension(e);return fileX.isVideo(e)?"video":"audio"}class gm{#progress;#speed;#start;#total;#info;#timeout;#next=0;#more=!0;get id(){return this.#info.id}get uri(){return this.#info.uri}constructor(e){this.#progress=e.querySelector("progress"),this.#speed=e.querySelector(".speed")}download(e){this.#info=e,this.#start=Date.seconds(),this.#total=e.files.reduce((e,t)=>e+t.size,0),this.#timeout=setInterval(()=>this.#push(),1e4),app.downloadTorrent(e.uri,this)}progress(e){this.#timeout=clearInterval(this.#timeout),this.#progress.value=Math.floor(100*e);var e=Math.floor(this.#total*e),t=Date.seconds()-this.#start;this.#speed.innerText=fileX.formatSize(e/t)+"/s"}done(){app.db.update("torrent",this.id,{progress:100}),app.firebase.set("data/torrent",this.id,app.uid,Date.seconds()),this.ondone()}error(e){}ondone(){}async#push(){!this.#more&&0<this.#next&&(this.#next=0,this.#more=!0);let e=0;var t=this.id,i=await app.firebase.ls("data/torrent/"+t,3,this.#next,!0);if(i){for(const a of Object.keys(i))await app.sendMessage(a,{type:"push",torrent:t},!1),e+=1;this.#next+=e,e<3&&(this.#more=!1)}else this.#more=!1}}class fm extends dm{static id="torrent";#offset=0;#more=!1;#results;#main;#local;get more(){return this.#results&&10==this.#results.length}get ds(){return app.ds("torrent")}constructor(e){super(e,fm.id,"editor-player-content-torrent");e=this.container.querySelector(".search-area");this.#results=new Kd(e,"torrent"),this.#main=UX.List.createMixin(this.container.querySelector(".main")),app.on("torrentdownloading",e=>this.#onDownload(e.detail))}load(){return this.#load()}open(){}onAction(e,t,i){switch(e){case"more":this.#results.showMore();break;case"less":this.#results.showLess();break;case"clear":this.#results.clear();break;case"search":this.#results.search(this.#local);break;default:this.#handleAction(e,t,i)}}onFilesDrop(e,t){this.#renderNewTorrent(e,t)}async search(e){try{await this.#results.search(e)}catch(e){console.error("Search request failed",e)}}onInput(e){"search"===e.getAttribute("name")&&this.#results.onInput(e)}async#load(){var e=await this.ds.ls(!1,this.#offset),t=e.filter(e=>!e.remote),i=(this.#offset,e.length,this.#offset+=e.length,this.#more=50<=e.length,[]);for(const s of t){var a=this.#main.addItemTemplate("editor-player-torrent",s,!1,["torrent-actions"]);s.progress<100&&(a.classList.add("downloading"),i.push([s,a]))}this.#sort(),this.#local=new Set(t.map(e=>e.id))}#sort(){this.#main.sort((e,t)=>!(e.progress<100)&&(t.progress<100||Number(e.dataset.rating)<Number(t.dataset.rating)||e.dataset.name>t.dataset.name)?1:-1)}#renderNewTorrent(o,e){o.sort((e,t)=>e.meta&&e.meta.track&&t.meta&&t.meta.track?e.meta.track-t.meta.track:-1);var t=o.map(e=>Object({name:e.meta&&e.meta.title?e.meta.title:fileX.getName(e.name),size:e.size,type:fileX.getType(e.type)}));let l=dom.renderTemplate("editor-player-torrent-new",t);this.append(l,!0);const c=l.querySelector('button[name="submit"]'),d=l.querySelector('input[name="title"]');for(const i of o)if(i.meta&&i.meta.album){d.value=i.meta.album;break}let h=o.length;l.onclick=e=>{var t=e.target;switch(t.tagName){case"BUTTON":switch(t.name){case"submit":var i=Array.from(l.querySelectorAll('input[type="checkbox"]:not(:checked)')).map(e=>e.dataset.index);i.length;for(const r of i)o[parseInt(r)]=null;(o=o.filter(e=>!!e)).map(e=>e.name);var i=d.value,a={id:o.map(e=>e.name.hashCode()).reduce((e,t)=>e^t,0)>>>0,title:i,rating:0,files:[]};for(const n of o){var s={name:n.name,size:n.size};n.meta&&n.meta.title&&(s.display=n.meta.title),a.files.push(s)}dom.removeElement(l),this.#addTorrent(a,o);break;case"cancel":dom.removeElement(l)}break;case"INPUT":"checkbox"==t.type&&(h+=t.checked?1:-1,c.disabled=0==h)}}}async#addTorrent(e,t){try{var i,a;t&&((i=await app.seed(t)).infoHash,e.hash=i.infoHash,e.uri=i.magnetURI,(a=await ajax.post("/api/torrent",e)).id,e.id=a.id),await app.db.put("torrent",e),this.#main.addItemTemplate("editor-player-torrent",e,!0)}catch(e){console.error("Failed to add torrent",e)}}async#handleAction(e,t,i){let a=t.dataset.id;var s;a&&a.startsWith("magnet:")&&(s=parseMagnetURI(a)["hash"],a=s),"download"===e&&(s=t.dataset.id,this.#results.disableResult(s),e=this.#results.getResult(a))&&(this.#renderTorrent(e),app.downloadTorrent(s))}#download(e,t){var i=new gm(t);i.ondone=()=>{var e=t.querySelector(".progress");dom.removeElement(e),t.classList.remove("downloading"),dom.highlightElement(t)},i.download(e)}async#onDownload(e){e=e.infoHash;let t=this.#results.getResult(e);t=t||await this.ds.get(e);var i=this.#renderTorrent(t),i=new Zd(i);app.addTorrentMonitor(e,i)}#renderTorrent(e,t="downloading"){let i=this.#main.getElement(e.id);return i||((i=this.#main.addItemTemplate("editor-player-torrent",e,!0,["torrent-actions"])).dataset.id=e.id),i.setAttribute("state",t),i}}class vm extends dm{static id="radio";pages=new Map;#ws;#tracks;#recent;#queue;#chat;#id;constructor(e){super(e,vm.id);e=dom.renderTemplate("editor-player-radio",{name:"Nula",desc:"Classic jazz, soul",code:777});this.#chat=UX.List.createMixin(e.querySelector('[role="chat"]')),this.container.appendChild(e),this.addPage("main",new UX.Page(e)),this.switchTo("main"),app.on("radiomsg",e=>this.#onMessage(e.detail))}async open(e){var t,i;this.#id!=e&&(this.#id=e,this.toggleLoading(),(t=this.switchTo("main")).removeChilds(),i=app.ds("radio"),i=await delayResolve(i.get(e),1200),this.toggleLoading(),t.addTemplate("editor-player-radio",i))}load(){}onTabChange(e,t){let i=this.switchTo(e);i||("player"===e&&(i=this.#createPlayerPage()),this.addPage(e,i),this.switchTo(e))}onAction(...e){this.onEditorAction(...e)}onEditorAction(e,t,i){"send"===e&&this.#handleSend(i)}onKeyPress(e,t){"Enter"==t&&this.#handleSend(e)}#handleSend(e){e=e.inputValue;this.#send(e)}#send(e){this.#chat.addItemTemplate("editor-contact-chat-message",{name:"Alice Freeman",own:!0,msg:e},!0),app.sendRoomMessage("radio",e,!1)}#createPlayerPage(){var e=dom.renderTemplate("editor-player-remote"),t=(this.container.appendChild(e),e.querySelector('[role="tracks"]')),i=e.querySelector('[role="playlist"]'),t=(this.#tracks=UX.List.createMixin(t),UX.List.createMixin(i));return this.#queue=t.addGroup({name:"next",badge:"true",hidable:!0,count:!0}),this.#loadAdmin(),new UX.Page(e)}#onMessage(e){e.avatar=e.avatar||e.photo||"/ui/svg/contact.svg",this.#chat.addItemTemplate("editor-contact-chat-message",e,!0)}async#loadAdmin(){if(!this.#ws){var e=`ws://${location.host}:9084`;const t=new WebSocket(e);t.onopen=e=>{t.send(JSON.stringify({method:"ls"})),t.send(JSON.stringify({method:"bind"}))},t.onmessage=e=>{e=e.data,e=JSON.parse(e);const{method:t,...i}=e;if("ls"==t)for(const s of i.tracks)s,this.#tracks.addItemTemplate("edior-player-track-item-file",s);else switch(t){case"queue":{const e=this.#queue.addTemplate("editor-player-sidebar-queue-item",i);e.dataset.id=i.id}break;case"onchange":{var a=i.id;const e=this.#queue.getElement(a);e&&dom.removeElement(e)}}},t.onclose=()=>{this.#ws=null},t.onerror=e=>{console.error("PUSH socket error",e),this.#ws=null},this.#ws=t}}}Object.assign(vm.prototype,UX.PageControllerMixin);const wm={files:{title:"Local files",desc:"Play and share with friends your media files"},youtube:{title:"Youtube",desc:"Play and share with friends your favorite videos"},torrent:{title:"Torrents",desc:"Play and share with friends your media files"},radio:{title:"Radio",desc:"Listen online radio"}};class ym extends rh{static#pages={};static register(e){this.#pages[e.id]=e}static id="player";#sidebar;#panel=[];#offset=0;#loading;#state;#progress;#info;get sidebar(){return this.#sidebar}get dragOptions(){return{directory:!1,hover:!0,files:["audio","video","image"],items:["playlist"]}}set state(e){e!=this.#state&&(this.#state=e,this.container.setAttribute("state",e),this.container.querySelector('.header button[name="play"]').title="playing"==e?"Pause":"Play")}constructor(e){e||((e=dom.renderTemplate("editor-base-sidebar",{},"div","editor-player-header","editor-player-base",cm.getTabs())).id="player-editor",e.classList.add("dark","player")),super(e),this.#createSidebar();var e=this.header,t=(e.icon,e.q(".progress")),t=(this.#progress=new bm(t),app.on("trackchange",e=>this.#onTrackChange(e.detail)),app.on("trackstop",e=>this.#onTrackStop(e.detail)),app.on("trackpause",e=>this.#onTrackPause(e.detail)),app.on("trackprogress",e=>this.#onTrackProgress(e.detail)),app.on("filesdropped",e=>this.#onFilesDropped(e.detail)),this.editorElement);this.#handleInput(t),this.#panel.push(e.button("play")),this.#panel.push(e.button("prev")),this.#panel.push(e.button("next")),this.state=app.player.isPlaying?"playing":"paused"}async open(e,...t){this.#info=null,this.container.setAttribute("view",e);var i=this.header,a=i.icon,s=wm[e];switch(e){case"torrent":case"files":case"radio":i.title=s.title,i.desc=s.desc,a.name=e,this.#open(e);break;default:var r=app.ds("playlist"),n=t.shift(),r=await r.get(n||e);i.title=r.display||r.name,i.desc=`${r.genre}, ${r.tracks.length} tracks`,a.name="playlist",this.#info=r,this.#open("files",r.tracks)}}onAction(e,t,i){switch(e){case"next":app.player.playNext();break;case"prev":app.player.playPrev();break;case"play":"paused"==this.#state?app.player.resume():app.player.pause();break;case"share":app.share("playlist",this.#info)}}onFileDrop(i,e,a){i.length;var s=[],r=[],n=[];for(const c of i){var t=fileX.getExtension(c.name);(fileX.isImage(t)?s:fileX.isMedia(t)?r:n).push(c)}if(r.length){this.active.onFilesDrop(r,s,n);var o=[],l=[];let e,t;for(const d of r)t=d.name.hashCode(),e=d.name,d.meta&&(e=d.meta.title||e,d.meta.album&&l.push(d.meta.album),delete d.meta),o.push({id:t,title:e,file:d});if(2<r.length){let e=a;r.length==l.length&&1==l.unique().length?(i={name:e=l[0],id:e.hashCode().toString(),type:"album",tracks:r.map(e=>({id:e.id||e.name.hashCode(),filename:e.name,size:e.size,title:e.meta&&e.meta.title?e.meta.title:e.name}))},0<s.length&&(s.sort((e,t)=>e.size-t.size),i.cover=s[0]),app.add("playlist",i,"new")):app.executeCommand("add-new-playlist",o,e)}}}onTabChange(...e){this.active&&this.active.onTabChange(...e)}async onScrollY(e,t){if(this.active.more&&t-e<30&&!this.#loading){this.#loading=!0,this.toggleLoading();try{await sleep(1200),await this.active.load(!0)}catch(e){}finally{this.toggleLoading()}this.#loading=!1}}async#open(e,...t){return this.switchTo(e),this.active||(this.#addPage(e),this.switchTo(e),await this.active.load()),this.#info&&t.unshift(this.#info),this.active.open(...t)}#openRadio(e){}#addPage(e){var t=new ym.#pages[e](this.area);return this.addPage(e,t),t}#createSidebar(){var e=this.sidebarElement,e=new cm(e);this.#sidebar=e}#onTrackChange(e){this.#progress.resume();e=this.active.onTrackChange(e);e&&app.editor.scrollTo(e),this.state="playing"}#onTrackStop(){this.state="paused",this.active.onTrackStop()}#onTrackPause(){this.state="paused"}#onTrackProgress({sec:e,total:t}){this.#progress.update(e,t)}#onFilesDropped(e){}#handleInput(e){e.querySelector('input[name="filter"]')}#handleTestInput(e){const t=e.querySelector('input[name="magnet"]'),i=e.querySelector('button[name="download"]');e=e.querySelector('button[name="stop"]');let a;e.onclick=()=>{a&&app.cancelTorrent(a),t.disabled=!1,i.disabled=!1},i.onclick=async()=>{var e;""!=(a=t.value)&&(t.disabled=!0,i.disabled=!0,a,e=await app.firebase.get("torrent",a),app.downloadTorrent(e.uri,{progress(){},done(){t.disabled=!1,i.disabled=!1}}))}}}class bm{#slider;#time;constructor(e){this.#slider=e.querySelector('input[type="range"]'),this.#time=e.querySelector("time")}update(e,t){this.#slider.value=Math.round(e/t*100);let i=t-e;i<0&&(i=0),this.#time.innerText=fileX.getDuration(i)}pause(){this.#slider.disabled=!0}resume(){this.#slider.disabled=!1,dom.showElement(this.#time)}end(){this.#slider.value=0,this.#slider.disabled=!0,dom.hideElement(this.#time)}}ym.register(hm),ym.register(fm),ym.register(vm),App.Editor.register(ym),App.Commands.register("add-new-playlist",(a=app.player.recent,e=null)=>{var t={icon:"",desc:"Create a new playlist",reload:!0,onAdd(t){t.name=t.display.toLowerCase(),t.id=t.name.hashCode().toString();var e=a.filter(e=>!t.tracks.includes(e.id));for(const i of e)i.filename=i.file.name,i.size=i.file.size,delete i.file;t.tracks=e,app.add("playlist",t,"new")}};t.info={tracks:a},e&&(t.display=e),app.openEditor("add","new","playlist",t)}),App.Commands.register("player-import-files",async()=>{try{var e=await showOpenFilePicker({id:"media",multiple:!0,startIn:"music",excludeAcceptAllOption:!0,types:[{description:"Media files",accept:{"audio/*":[".mp3",".ogg",".flac"],"video/*":[".webm",".mkv",".avi"]}}]});app.editor.onImport(e)}catch(e){console.error("Failed to import files")}}),App.Commands.register("player-play-file",e=>app.player.playFile(e)),App.Commands.register("player-queue-file",e=>app.player.playFile(e,!0));g=AddEditor.Fields;AddEditor.register("playlist",[g.string({name:"display",title:"Name",required:!0}),g.option({name:"genre",options:["Pop","Rock","Hip Hop","R&B","Electronic","Country","Jazz","Classic","Reggae","Metal","Blues","Folk","Soul","Dance","Punk"]}),g.list({name:"tracks",template:"editor-player-sidebar-playlist-file"})]);class km extends yh{static id="contact";#users;#filter;get title(){return"chat"}get filter(){return this.#filter}set filter(e){this.#filter=e}get showImport(){return!(!app.user.google||!app.user.google.contact)&&{title:"Import Gmail contacts",cmd:"import-gmail-contacts"}}constructor(e="sidebar-contact"){super(km.id,e),app.on("chatmsg",e=>this.#onMessage(e.detail)),app.on("contactadd",e=>this.add("contact",e.detail)),app.on("roomadd",e=>this.add("room",e.detail)),app.on("useradd",e=>this.add("user",e.detail)),app.on("status",e=>this.#updateStatus(e.detail)),app.on("hangup",e=>this.#onHangup(e.detail))}reload(){}async load(e){await this.loadContacts(),await this.loadRooms();var t=this.addGroup({name:"user",title:"Users",visible:100,badge:!0,hide:!0,item:"sidebar-user-item",cmd:"open-user-contact"});this.#users=t}async loadContacts(){var e=app.ds("contact"),t=this.addGroup({title:"friends",name:"contact",visible:8,badge:!0,draggable:!0,item:"sidebar-contact-item",cmd:"open-contact-contact",actions:[{name:"add",icon:"add",cmd:"find-contact"}]}),e=(await e.ls()).filter(e=>!e.remote);const s=app.recent.chat;e.sort((t,i)=>{var e=s.findIndex(e=>e.user==t.id),a=s.findIndex(e=>e.user==i.id);return-1<e&&(t.short=s[e].short),-1<a&&(i.short=s[a].short),(e>>>0)-(a>>>0)});for(const i of e)app.isme(i.id)||(i.uri=i.uri||i.email,t.add(i));this.contacts=t}async loadRooms(){var e=this.addGroup({name:"room",visible:8,badge:!0,draggable:!0,cmd:"open-room-contact",item:"sidebar-room-item",actions:[{name:"add",icon:"add",cmd:"add-new-room"}]}),t=app.ds("room");await e.load(t,_m),this.channels=e}add(e,t){switch(e){case"contact":var i=t.id;this.contacts.getElement(i)||this.contacts.add(t,!0),this.#users.delete(i);break;case"room":var i=t.id,a=`chat-${i}@ftalk.net`;this.channels.getElement(i)||this.channels.add({...t,uri:a},!0);break;case"user":i=Array.isArray(t)?t:[t];this.#users.push(...i)}}onClick(e,t,i){let a=t.querySelector("[data-count]");a&&(a.dataset.count=0),(a=t.querySelector("[data-missed]"))&&(a.dataset.missed=0)}async#onMessage(e){var t,i,a;"confirm"!=e._type&&(t=(e.room||e.user).id,(i=this.getElement(t))?(a=e.shortHTML,e.room&&Cm(i,e.own?app.avatar:e.user.photo||app.defaultRoom),xm(i,a,e.own,e.ts),dom.moveTop(i),dom.highlightElement(i)):e.room?(e.id=e.room.id,e.display=e.room.name,this.channels.add(e,!0)):(this.#users.add(e),console.error("Sidebar contact. URI not found:",t)))}#updateStatus(e){var t=this.contacts.getItem(e.id);t&&(dom.updateValues(t,e),dom.highlightElement(t))}#onHangup({user:e,missed:t}){var i,a;if(t)for(const s of[this.contacts,this.#users])if(i=s.getItem(e)){i.hasAttribute("selected")||(i=i.querySelector("[data-missed]"),a=parseInt(i.dataset.missed),i.dataset.missed=a+1);break}}static defaultSettings(){return{contact:{visible:10,order:[]}}}}function _m(e,t){e=e.name,t=t.name;return e<t?-1:t<e?1:0}function xm(e,t,i,a=Date.seconds()){i||e.hasAttribute("selected")||(i=e.querySelector("[data-count]"),s=parseInt(i.dataset.count),i.dataset.count=s+1);var s,i=e.querySelector("time");i.dataset.time=a,i.innerText=Date.secondsElapsed(a),e.querySelector(".msg").innerHTML=t}function Cm(e,t){e.querySelector(".avatar").src=t}a=km;class Em extends yh{static id="game";#own;#invite;#active;get showAdd(){return!0}get showSearch(){return!0}constructor(e="sidebar-game"){super(Em.id,e),app.on("gameadd",e=>this.#own.add(e.detail,!0)),app.on("gamemsg",e=>this.#onMessage(e.detail)),app.on("gameover",e=>this.#onOver(e.detail))}async load(e){var t={name:"invites",visible:100,badge:!0,item:"sidebar-game-invite-item",hide:!0,cmd:"game-open-user"},i=this.addGroup(t),a=(t.name="active",this.addGroup(t)),t=await app.ds("games").ls();t.sortTimestamp();for(const s of t)s.invite?i.add(s):s.state&&!s.own&&a.add(s);return this.#invite=i,this.#active=a,this.#load()}async#load(){var e,t,i={visible:100,badge:!0,item:"sidebar-base-item",cmd:"open-home-game"},a={add:"game-invite-user"};for([e,t]of Object.entries({board:[{id:"backgammon"}]})){i.name=e;var s,r,n=this.addGroup(i);for({id:s,icon:r}of t)r=r||s,n.add({id:s,icon:r,...a})}}async#loadGames(e=app.uid){var t=this.addGroup({name:"own",badge:!0,hide:!0,item:"sidebar-base-item",cmd:"edit-own-game"});for(const i of await app.ds("game").ls())!app.sudo&&e!=i.user||t.add(i);this.#own=t}#onMessage(e){var t=e.id;let i=this.#invite.getItem(t);e.own?(dom.removeElement(i),(i=this.#active.getItem(t))&&dom.removeElement(i)):e.invite?i||this.#invite.add(e,!0):(i=this.#active.add(e,!0),dom.highlightElement(i))}#onOver({id:e}){e=this.#active.getItem(e);dom.removeElement(e)}}class Sm extends yh{static id="account";constructor(e){super("account",e)}get showFilter(){return!1}load(e){this.addGroup({name:"info",icon:"fa-info-circle stroke",badge:!0,item:"sidebar-base-item",actions:[]}).add({id:"profile",icon:"fa-fw fa-xs profile wm6",cmd:"edit-profile"})}}class Tm extends yh{static id="player";#album;#playlist;get icon(){return""}constructor(e="sidebar-player"){super(Tm.id,e),app.on("playlistadd",e=>this.#addPlaylist(e.detail,!0)),app.on("playlistrm",e=>this.#removePlaylist(e.detail))}load(e){return this.#reload()}async#reload(){this.#loadMainItems(),this.#loadRadioChannels();var e,t={visible:100,badge:!0,draggable:!0,hide:!0,cmd:"open-playlist-player",item:"sidebar-player-item-playlist"};t.name="album",t.icon="fa-compact-disc w3-text-purple",e=this.addGroup(t),this.#album=e,t.name="playlist",t.icon="playlist w3-text-deep-orange",e=this.addGroup(t),this.#playlist=e;for(const i of await app.ds("playlist").ls())this.#addPlaylist(i)}add(e,t){e}#loadMainItems(){for(const e of[{display:"Local files",id:"files",icon:"folder",cmd:"open-files-player"}])this.addItemTemplate("sidebar-player-item",e)}async#loadRadioChannels(){var e=this.addGroup({name:"radio",icon:"fa-radio w3-text-red",visible:5,badge:!1,draggable:!0,item:"sidebar-radio-item",cmd:"open-radio-player",actions:[{name:"add",icon:"add",cmd:"find-radio"}]}),t=await app.ds("radio").ls();for(const i of t)e.add(i)}#addPlaylist(e,t=!1){var i="album"==e.type?this.#album:this.#playlist;t&&i.getElement(e.id)||i.add(e)}#removePlaylist(e){this.#playlist.delete(e)}static defaultSettings(){return{playlist:{visible:10,order:[]}}}}g=Tm;class Am extends yh{static id="help";static action={id:"wiki",icon:"wiki"};get title(){return""}get showFilter(){return!1}constructor(e="sidebar-game"){super(Am.id,e)}load(e){this.addItemTemplate("sidebar-base-item",{icon:"fa-search",name:"Search",cmd:"open-search-wiki"}),this.addItemTemplate("sidebar-base-item",{icon:"fa-wikipedia-w",name:"Wiki",cmd:"open-start-wiki-wiki"});var t={item:"sidebar-base-item",actions:[],name:"site",cmd:"open-start-wiki"},t=this.addGroup(t);t.add({id:"outsorcing",icon:"fa-futbol"}),t.add({id:"contact",icon:"fa-user-friends"}),t.add({id:"about",icon:"fa-address-card"})}}class Lm extends yh{static id="admin";#editors;constructor(e="admin"){super("admin",e)}get showFilter(){return!1}reload(){}async load(e){var t=this.addGroup({name:"site",badge:!0,item:"sidebar-base-item",actions:[]});t.add({id:"user",icon:"fa-user",add:"invite-new-user",cmd:"open-user-admin"}),t.add({id:"room",icon:"fa-user-friends",add:"create-new-room",cmd:"open-room-admin"})}add(e){}update(){}onAction(e,t){"add"===e&&this.#handleAdd(t)}async onClick(e){e}#handleAdd(e){e}static defaultSettings(){return{admin:{visible:16}}}}var jm=Lm;const Mm=Config.sip.room;class Im extends Vh{#user;get sipUri(){return this.#user.id+"@"+Config.sip.domain}get email(){return this.#user.email}get displayName(){return this.#user.name}get avatar(){return this.#user.photo||app.defaultAvatar}get photo(){return this.#user.photo}get status(){return this.#user.status||"No status"}get uid(){return this.#user.id}get sudo(){return this.#user.su}get user(){return this.#user}constructor(e){super(document.getElementById("app-page")),e&&(window.Config=e),this.task=new hp}createDatabase(){return new P}createEditor(){return new Ip}async requestNotifications(){try{return await Notification.requestPermission(),!0}catch(e){return!1}}async registerServiceWorker(){if("serviceWorker"in navigator){var e={scope:"/"};try{await navigator.serviceWorker.register("/static.js",e)}catch(e){console.error("Failed to register service worker",e)}}}async setupDatabase(e){try{await hp.setup(e);var t=await ajax.get("/api/game");0<t.length&&await e.put("game",t)}catch(e){console.error("Failed to setup databse",e)}}async load(e){var t=location.protocol.startsWith("https"),t=!!Config.firebase&&t;this.#user=e,this.initDataSource(),await super.load(),await this.loadRecent(),await this.task.init(),this.startLifecycle(),this.startMessenger(t),this.initGame(),await this.startGoogleAPI(),await this.startFirebase(),this.sudo&&document.body.setAttribute("su",""),this.openEditor("home")}initDataSource(){var e=new Dm("contact"),t=new Bh(e,new Dh("users")),t=new $h(t,e=>!this.isme(e.id)),i=new Nh("room");this.addDS(t),this.addDS(new Pm,"email"),this.addDS(i),this.addDS(new Uh(t,i),"share"),this.addDS(new Rh("radio",new Dh("radio"))),this.sudo&&(this.addDS(new Fh(e,new Oh("login")),"user"),this._.room=new Fh(new O("room"),new Rm)),this.addDS(new Fh(new zm("wiki"),new Oh("wiki"))),this.initUserGames(),this.initUserPlayer()}async signOut(){window.location.href="/logout"}async updateProfile(e){try{await this.ds("contact").update(this.uid,e,this.#user),Object.assign(this.#user,e),app.publish()}catch(e){}}async add(t,e,i="import"){var a=app.ds(t);let s,r=!1;if("string"==typeof e){if(s=e,!(e=await a.get(s)))return void console.error("Failed to",i,t,s)}else s=e.id;try{"import"===i?(e.remote=void 0,a.update(e,i)):r=!0;var n=["update","edit"].includes(i);r&&a&&await a.put(e,n),super.add(t,e,n)}catch(e){console.error("APP: failed to add =>",t,e)}return e.id}}Object.assign(Im.prototype,ls,rs,ns,os,cs.E,t,m),Im.Editor.register(Tp),Im.Sidebar.register(a),Im.Sidebar.register(Em),Im.Sidebar.register(g),Im.Sidebar.register(Sm),Im.Sidebar.register(Am),Im.Sidebar.register(jm);class Dm extends O{put(e){for(const t of e=Array.isArray(e)?e:[e])t.data&&(Object.assign(t,t.data),delete t.data),t.type=t.type||"user",t.username=t.email.split("@")[0];return super.put(e)}update(e,t,...i){return"import"==t?(e.type="contact",super.update(e)):super.update(e,t,...i)}}class Om extends Dh{constructor(){super("users")}get(e){e=e.isEmail()?{email:e}:e;return super.get(e)}}class Pm extends Bh{constructor(){super(new Ih("contact","email"),new Om)}async get(e){e=app.isme(e)?app.user:await super.get(e);return e&&e.data&&(Object.assign(e,e.data),delete e.data),e}}class Rm extends Oh{constructor(){super("room")}async ls(...e){e=await super.ls(...e);return this.#convert(e)}async put(e){e=await super.put(e);return{id:Bm(e.name),uid:e.id,name:e.display||Nm(e.name)}}async search(...e){e=await super.search(...e);return this.#convert(e)}#convert(e){return e.map(e=>({uid:e.id,id:"number"==typeof e.id?Bm(e.name):e.id,name:e.display||Nm(e.name),topic:e.topic||"No topic",domain:e.domain||Config.sip.domain,members:e.members||[]}))}}class zm extends O{async put(e){var t=e.content;delete e.content,await super.put(e),await app.cache.update(this.name,e.id,t)}async get(e){var t=await super.get(e);return t&&!t.content&&(t.content=await app.cache.load(this.name,e)),t}}function Bm(e){return e.startsWith(Mm)?e.slice(Mm.length):e}function Nm(e){return(e=Bm(e)).replaceAll("-"," ").capitalizeFirstLetter()}})(),__webpack_exports__.g);export{__webpack_exports__App as App};